<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å—æ±</title>
  
  <subtitle>å‹‡æ•¢çš„å»åšä½ è®¤ä¸ºæ­£ç¡®çš„äº‹æƒ…ï¼</subtitle>
  <link href="https://smallflames.github.io/atom.xml" rel="self"/>
  
  <link href="https://smallflames.github.io/"/>
  <updated>2024-01-25T11:40:44.048Z</updated>
  <id>https://smallflames.github.io/</id>
  
  <author>
    <name>Xia Zheng</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å—æ±çš„äº‘ç«¯å°é“º</title>
    <link href="https://smallflames.github.io/2024/01/25/%E5%8D%97%E6%B1%90%E7%9A%84%E4%BA%91%E7%AB%AF%E5%B0%8F%E9%93%BA/"/>
    <id>https://smallflames.github.io/2024/01/25/%E5%8D%97%E6%B1%90%E7%9A%84%E4%BA%91%E7%AB%AF%E5%B0%8F%E9%93%BA/</id>
    <published>2024-01-25T10:03:10.000Z</published>
    <updated>2024-01-25T11:40:44.048Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>å—æ±çš„äº‘ç«¯å°é“º(Shellç‰ˆ)</center></h1><blockquote><p>ğŸƒâ€ƒçªå‘å¥‡æƒ³ï¼Œæ€ä¹ˆæ ·è®©å¤§å®¶å¿«é€Ÿçš„æŒæ¡ç¼–ç¨‹é‡Œé¢çš„åˆ¤æ–­å’Œå¾ªç¯å‘¢ï¼Œç†è®ºçŸ¥è¯†åªæ˜¯åŸºç¡€ï¼Œå…³é”®åœ¨äºè‡ªå·±çš„ä»£ç æ‰‹æ„Ÿå’Œç¼–ç¨‹çš„æ€ç»´ï¼Œæ— ä»–ï¼Œå­¦ä¹ ç¼–ç¨‹æˆ‘ä»¬åªéœ€è¦è®°ä½ä¸€ç‚¹ï¼š<font color=red><strong>ç™¾ç‚¼æˆç¥</strong></font>ã€‚å…¶ä½™ï¼Œåº•å±‚çš„åŸç†å’Œæ¶æ„æ˜¯æˆ‘ä»¬é«˜çº¬åº¦çš„ç©ºé—´ï¼Œå¤©æ¢¯æ˜¯ä¸å¯åƒ­è¶Šçš„ï¼Œéœ€è¦ä¸€æ­¥ä¸€æ­¥æ”€ç™»ï¼</p></blockquote><table><tr><td bgcolor=#000000><font color="white">åŠŸèƒ½ä»‹ç»</font></td></tr></table><p><font color="#fc5531">â–šâ€‚ä»‹ç»â€‚ï¼šå—æ±çš„äº‘ç«¯å°é“ºæš‚æ—¶æš‚æ—¶åªå†™äº†ä¸€ä¸ªæ¿å—ï¼ˆä»Šæ—¥ä¸Šæ–°ï¼‰ï¼Œå…¶ä»–æ¿å—å¤§å®¶å¯è‡ªè¡Œæ‹“å±•ï¼Œæˆ–è€…å—æ±æ”¹å¤©å¯ä»¥å†å®Œå–„ä¸€ä¸‹ï¼Œç›®å‰å®ç°çš„åŠŸèƒ½æœ‰ï¼šèœå•æ˜¾ç¤ºã€å•†å“è´­ä¹°ã€ç”¨æˆ·ç™»å½•éªŒè¯ä¸æ³¨å†Œã€è´¦æˆ·ä½™é¢å……å€¼ä¸æ˜¾ç¤ºã€è´­ç‰©è´¦å•æ‰“å°ã€‚ç»†èŠ‚å¤§å®¶å¯è‡ªè¡Œæµ‹è¯•ï¼Œé‡‘æ— è¶³èµ¤ï¼Œäººæ— å®Œäººï¼Œå¦‚æœ‰Bugï¼Œæ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºåé¦ˆï¼Œæˆ–è€…åˆ†äº«å»ºè®®å“¦~ãƒ¾(â€¢Ï‰â€¢`)o</font></p><table><tr><td bgcolor=#000000><font color="white">å®ç°æ•ˆæœ</font></td></tr></table><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxi_shell.gif" alt="nanxi_shell"></p><div class="tips"><p>æç¤ºï¼šè„šæœ¬é»˜è®¤ä¼šåˆ›å»ºåˆå§‹ç”¨æˆ· <code>nanxi</code>  å¯†ç ï¼š<code>nanxi123</code>ï¼Œå½“ç„¶å¤§å®¶ä¹Ÿå¯ä»¥è‡ªè¡Œæ³¨å†Œè¯•ç©ï¼Œæˆ–è€…æ‹“å±•~</p></div><span id="more"></span><table><tr><td bgcolor=#000000><font color="white">è„šæœ¬å®ç°</font></td></tr></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author:  nanxi</span></span><br><span class="line"><span class="comment">#Date: 2024-1-24</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ˜¾ç¤ºèœå•</span></span><br><span class="line"><span class="function"><span class="title">home</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;------------------------------------------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                                              |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                1)   ä»Šæ—¥ä¸Šæ–°                 |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                2)   ç‹¬å®¶å¥½ç‰©                 |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                3)   äº‘ç«¯å°å±‹                 |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                                              |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-----------  æ¬¢è¿æ¥åˆ°å—æ±çš„äº‘ç«¯å°é“º  -----------&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">new</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-----------------------------------------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                                             |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;| 1)æœˆäº®ç§å­ 2)å¯’å†°å®å‰‘ 3)æ˜Ÿè¾°çº±è¡£ 4)é’ä¸˜å¹¼ç‹ |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|   ï¿¥:666     ï¿¥:777     ï¿¥:888     ï¿¥:999   |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                                             |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-----------------------------------------------&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">cloud</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-----------------------------------------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                                             |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|  1)ç§‹å¶åŸ   2)æ—¶å…‰æµ·   3)åŸé›ªç•Œ   4)å½©è™¹æ¡¥  |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                                             |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-----------------------------------------------&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">exclusive</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-----------------------------------------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                                             |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;| 1)æ—¶å…‰æœºå™¨ 2)ä¹é¾™èŸ æ¡ƒ 3)é’æ˜¥ä¸è€æ¶² 4)å¿˜å¿§è‰ |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                                             |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-----------------------------------------------&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®šä¹‰å˜é‡</span></span><br><span class="line">back=<span class="string">&quot;(0è¿”å›åº—é“ºé¦–é¡µ)&quot;</span></span><br><span class="line">flag=0</span><br><span class="line">logfile=/tmp/.nanxi.log</span><br><span class="line">username=null</span><br><span class="line">password=null</span><br><span class="line"></span><br><span class="line"><span class="comment">#åŠŸèƒ½å®ç°</span></span><br><span class="line"><span class="function"><span class="title">shop</span></span>()&#123;</span><br><span class="line">    <span class="built_in">sum</span>=0</span><br><span class="line">    array=()</span><br><span class="line">    i=0</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;1ã€2ã€3ã€4ä¸ºå•†å“æŒ‡ä»¤ï¼Œ6ä¸ºè´­ä¹°æŒ‡ä»¤ï¼Œ0è¿”å›åº—é“ºé¦–é¡µ&quot;</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;äº²äº²,è¯·è¾“å…¥æ‚¨çš„è´­ä¹°æŒ‡ä»¤<span class="variable">$back</span>: &quot;</span> num</span><br><span class="line">    check_in</span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$num</span> <span class="keyword">in</span></span><br><span class="line">        0)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">        ;;</span><br><span class="line">        1)</span><br><span class="line">            <span class="built_in">let</span> i++</span><br><span class="line">            <span class="built_in">sum</span>=$(<span class="built_in">expr</span> <span class="variable">$sum</span> + 666)</span><br><span class="line">            array[<span class="variable">$i</span>]=<span class="string">&quot;æœˆäº®ç§å­&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">        2)</span><br><span class="line">            <span class="built_in">let</span> i++</span><br><span class="line">            <span class="built_in">sum</span>=$(<span class="built_in">expr</span> <span class="variable">$sum</span> + 777)</span><br><span class="line">            array[<span class="variable">$i</span>]=<span class="string">&quot;å¯’å†°å®å‰‘&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">        3)</span><br><span class="line">            <span class="built_in">let</span> i++</span><br><span class="line">            <span class="built_in">sum</span>=$(<span class="built_in">expr</span> <span class="variable">$sum</span> + 888)</span><br><span class="line">            array[<span class="variable">$i</span>]=<span class="string">&quot;æ˜Ÿè¾°çº±è¡£&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">        4)</span><br><span class="line">            <span class="built_in">let</span> i++</span><br><span class="line">            <span class="built_in">sum</span>=$(<span class="built_in">expr</span> <span class="variable">$sum</span> + 999)</span><br><span class="line">            array[<span class="variable">$i</span>]=<span class="string">&quot;é’ä¸˜å¹¼ç‹&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">        6)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="variable">$flag</span> -ne 1 ];<span class="keyword">then</span></span><br><span class="line">                logon</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            pay</span><br><span class="line">        ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="built_in">continue</span></span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">check_in</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> ! [[ <span class="variable">$num</span> =~ ^[012346]$ ]];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;è´­ä¹°æŒ‡ä»¤å¼‚å¸¸ï¼Œæ‚¨éœ€è¦é‡æ–°è¾“å…¥!!!&quot;</span></span><br><span class="line">        <span class="built_in">echo</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">elif</span> [ <span class="variable">$num</span> -gt 6 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;è´­ä¹°æŒ‡ä»¤å¼‚å¸¸ï¼Œæ‚¨éœ€è¦é‡æ–°è¾“å…¥!!!&quot;</span></span><br><span class="line">        <span class="built_in">echo</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">logon</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ ! -f <span class="variable">$logfile</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">touch</span> <span class="variable">$logfile</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;nanxi\t\tnanxi123\t\t9999999999&quot;</span> &gt; <span class="variable">$logfile</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$flag</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;æ­¤æ“ä½œéœ€è¦æ‚¨ç™»å½•è´¦æˆ·ï¼Œæ˜¯å¦ç™»å½•(y/n): &quot;</span> <span class="built_in">log</span></span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$log</span> <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">yes</span>|y)</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line">            <span class="keyword">do</span></span><br><span class="line">            <span class="built_in">read</span> -p <span class="string">&quot;è¯·è¾“å…¥æ‚¨çš„è´¦æˆ·: &quot;</span> username</span><br><span class="line">            <span class="built_in">read</span> -s -p <span class="string">&quot;è¯·è¾“å…¥æ‚¨çš„å¯†ç : &quot;</span> password</span><br><span class="line">            <span class="built_in">echo</span></span><br><span class="line">            check_user</span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">        ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="built_in">break</span> 1</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">check_user</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> ! egrep -w <span class="string">&quot;<span class="variable">$username</span>|<span class="variable">$password</span>&quot;</span> <span class="variable">$logfile</span> &gt;/dev/null;<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;æœªæ£€æµ‹åˆ°å½“å‰ç”¨æˆ·ï¼Œæˆ–å½“å‰è´¦æˆ·çŠ¶æ€å¼‚å¸¸!!!&quot;</span></span><br><span class="line">        <span class="built_in">echo</span></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;æ‚¨æ˜¯å¦éœ€è¦æ³¨å†Œç”¨æˆ·(y/n): &quot;</span> sta</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$sta</span> <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">yes</span>|y)</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line">            <span class="keyword">do</span></span><br><span class="line">            <span class="built_in">read</span> -p <span class="string">&quot;è¯·è¾“å…¥æ‚¨è¦æ³¨å†Œçš„è´¦æˆ·å: &quot;</span> username</span><br><span class="line">            <span class="built_in">read</span> -p <span class="string">&quot;è¯·è®¾ç½®æ‚¨è´¦æˆ·çš„å¯¹åº”å¯†ç : &quot;</span> password</span><br><span class="line">            <span class="keyword">if</span> [[ <span class="variable">$username</span> =~ ^[0-Z_]+$ ]] &amp;&amp; [ <span class="variable">$&#123;#username&#125;</span> -ge 8 -a <span class="variable">$&#123;#username&#125;</span> -le 12 ];<span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">echo</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;ç”¨æˆ·åªèƒ½ç”±æ•°å­—ã€å­—æ¯ã€ä¸‹åˆ’çº¿ç»„åˆï¼Œä¸”é•¿åº¦ä¸º8-12ä½~&quot;</span></span><br><span class="line">                <span class="built_in">echo</span></span><br><span class="line">                <span class="built_in">continue</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">if</span> awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> <span class="variable">$logfile</span> |grep <span class="variable">$username</span> &gt;/dev/null;<span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;\e[1;31mè´¦æˆ·åå·²å­˜åœ¨ï¼Œè¯·é‡æ–°è¾“å…¥...\e[0m&quot;</span></span><br><span class="line">                <span class="built_in">echo</span></span><br><span class="line">                <span class="built_in">continue</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">break</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$username</span>\t\t<span class="variable">$password</span>\t\t0&quot;</span> &gt;&gt; <span class="variable">$logfile</span></span><br><span class="line">            <span class="built_in">echo</span></span><br><span class="line">        ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="built_in">break</span> 2</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span> egrep -w <span class="string">&quot;<span class="variable">$username</span>&quot;</span> <span class="variable">$logfile</span> &gt;/dev/null;<span class="keyword">then</span></span><br><span class="line">           <span class="keyword">if</span> egrep -w <span class="string">&quot;<span class="variable">$username</span>&quot;</span> <span class="variable">$logfile</span>|grep -w <span class="string">&quot;<span class="variable">$password</span>&quot;</span> &gt;/dev/null;<span class="keyword">then</span></span><br><span class="line">               logon_success</span><br><span class="line">               flag=1</span><br><span class="line">               <span class="built_in">break</span></span><br><span class="line">           <span class="keyword">else</span></span><br><span class="line">               <span class="built_in">echo</span> -e <span class="string">&quot;\e[1;31m\033[05må¯†ç è¾“å…¥é”™è¯¯ï¼ï¼ï¼\e[0m&quot;</span></span><br><span class="line">               <span class="built_in">echo</span></span><br><span class="line">           <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">           <span class="keyword">if</span> egrep -w <span class="string">&quot;<span class="variable">$password</span>&quot;</span> <span class="variable">$logfile</span>|grep -w <span class="string">&quot;<span class="variable">$username</span> &quot;</span> &gt;/dev/null;<span class="keyword">then</span></span><br><span class="line">               logon_success</span><br><span class="line">               flag=1</span><br><span class="line">               <span class="built_in">break</span></span><br><span class="line">           <span class="keyword">else</span></span><br><span class="line">               <span class="built_in">echo</span> -e <span class="string">&quot;\e[1;31m\033[05mç”¨æˆ·åè¾“å…¥é”™è¯¯ï¼ï¼ï¼\e[0m&quot;</span></span><br><span class="line">               <span class="built_in">echo</span></span><br><span class="line">           <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">logon_success</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;---------\t\tç™»å½•æˆåŠŸ\t\t---------&quot;</span></span><br><span class="line">    egrep -w <span class="string">&quot;<span class="variable">$username</span>&quot;</span> <span class="variable">$logfile</span>|awk <span class="string">&#x27;&#123;print $0&#125;&#x27;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;---------\t\té¾™å¹´å¤§å‰\t\t---------&quot;</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">pay</span></span>()&#123;</span><br><span class="line">    value=$(egrep -w <span class="string">&quot;<span class="variable">$username</span>&quot;</span> <span class="variable">$logfile</span>|awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$value</span> -ge <span class="variable">$sum</span> ];<span class="keyword">then</span></span><br><span class="line">        bill</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\e[1;31mæ‚¨çš„è´¦æˆ·ä½™é¢ä¸è¶³ï¼Œè¯·åŠæ—¶å……å€¼ï¼ï¼ï¼\e[0m&quot;</span></span><br><span class="line">        <span class="built_in">echo</span></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;æ˜¯å¦é€‰æ‹©å……å€¼(y/n): &quot;</span> recharge</span><br><span class="line">        <span class="built_in">echo</span></span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$recharge</span> <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">yes</span>|y)</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line">            <span class="keyword">do</span></span><br><span class="line">            <span class="built_in">read</span> -p <span class="string">&quot;è¯·è¾“å…¥å……å€¼é‡‘é¢ï¼Œå»ºè®®è´¦æˆ·ä½™é¢è‡³å°‘ï¿¥<span class="variable">$sum</span>: &quot;</span> coin</span><br><span class="line">            <span class="keyword">if</span> [[ <span class="variable">$coin</span> =~ ^[0-9]+$ ]];<span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span></span><br><span class="line">                surplus=$(<span class="built_in">expr</span> $(grep <span class="string">&quot;<span class="variable">$username</span>&quot;</span> <span class="variable">$logfile</span>|awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>) + <span class="variable">$coin</span>)</span><br><span class="line">                line=$(grep <span class="string">&quot;<span class="variable">$username</span>&quot;</span> <span class="variable">$logfile</span> -n |awk -F: <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">                sed -i <span class="string">&quot;<span class="variable">$&#123;line&#125;</span>c <span class="variable">$username</span>          <span class="variable">$password</span>               <span class="variable">$surplus</span>&quot;</span> <span class="variable">$logfile</span></span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;å……å€¼æˆåŠŸï¼Œæœ¬æ¬¡å……å€¼é‡‘é¢ä¸º: \033[1;32m ï¿¥<span class="variable">$coin</span> \033[0m&quot;</span></span><br><span class="line">                <span class="built_in">echo</span></span><br><span class="line">                <span class="built_in">break</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">echo</span></span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;\e[1;31må‚æ•°ä¸åˆæ³•ï¼Œè¯·é‡æ–°è¾“å…¥ï¼ï¼ï¼\e[0m&quot;</span></span><br><span class="line">                <span class="built_in">echo</span></span><br><span class="line">                <span class="built_in">continue</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">            pay</span><br><span class="line">        ;;</span><br><span class="line">        *)</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">        <span class="built_in">echo</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">bill</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    price=null</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;---------\t\tæ‚¨çš„è´¦å•\t\t---------&quot;</span></span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="variable">$&#123;array[@]&#125;</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$a</span>&quot;</span> = <span class="string">&quot;æœˆäº®ç§å­&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">            price=666</span><br><span class="line">        <span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$a</span>&quot;</span> = <span class="string">&quot;å¯’å†°å®å‰‘&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">            price=777</span><br><span class="line">        <span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$a</span>&quot;</span> = <span class="string">&quot;æ˜Ÿè¾°çº±è¡£&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">            price=888</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            price=999</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;| <span class="variable">$a</span>  \t\t\t\t\t   ï¿¥<span class="variable">$price</span>|&quot;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;|        \t\t\t\t\t        |&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;| æœ¬æ¬¡æ¶ˆè´¹æ€»è®¡: \t\t\t\t  ï¿¥<span class="variable">$sum</span>|&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;---------\t\tæ„Ÿè°¢è´­ä¹°\t\t---------&quot;</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;æ£€æµ‹åˆ°æ”¯ä»˜æˆåŠŸï¼Œæ˜¯å¦æ˜¾ç¤ºæ‚¨å½“å‰çš„è´¦æˆ·ä½™é¢(y/n): &quot;</span> remainder</span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$remainder</span> <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">yes</span>|y)</span><br><span class="line">        show</span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">show</span></span>()&#123;</span><br><span class="line">    surplus=$(<span class="built_in">expr</span> $(grep <span class="string">&quot;<span class="variable">$username</span>&quot;</span> <span class="variable">$logfile</span>|awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>) - <span class="variable">$sum</span>)</span><br><span class="line">    line=$(grep <span class="string">&quot;<span class="variable">$username</span>&quot;</span> <span class="variable">$logfile</span> -n |awk -F: <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    sed -i <span class="string">&quot;<span class="variable">$&#123;line&#125;</span>c <span class="variable">$username</span><span class="variable">$password</span><span class="variable">$surplus</span>&quot;</span> <span class="variable">$logfile</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;---------\t\tå½“å‰ä½™é¢\t\t---------&quot;</span></span><br><span class="line">    egrep -w <span class="string">&quot;<span class="variable">$username</span>&quot;</span> <span class="variable">$logfile</span>|awk <span class="string">&#x27;&#123;print $0&#125;&#x27;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;---------\t\tå†æ¬¡æ„Ÿè°¢\t\t---------&quot;</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    home</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;äº²äº²,è¾“å…¥æ‚¨çš„æŒ‡ä»¤<span class="variable">$back</span>: &quot;</span> num</span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$num</span> <span class="keyword">in</span></span><br><span class="line">        0)</span><br><span class="line">            home</span><br><span class="line">        ;;</span><br><span class="line">        1)</span><br><span class="line">            new</span><br><span class="line">            shop</span><br><span class="line">        ;;</span><br><span class="line">        2)</span><br><span class="line">            exclusive</span><br><span class="line">        ;;</span><br><span class="line">        3)</span><br><span class="line">            cloud</span><br><span class="line">        ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="built_in">continue</span></span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line">main</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxiblogfoot.png" alt="nanxiblogfoot"></p><iframe frameborder="no" border="0" marginwidth="0" allow = "autoplay" marginheight="0" width=100% height=86 src="//music.163.com/outchain/player?type=2&id=519136840&auto=1&height=66"></iframe><blockquote><p><em><strong>åœ¨è¿™ä¸ªä¸–ç•Œä¸Šï¼Œä¸æ˜¯æ‰€æœ‰åˆç†çš„å’Œç¾å¥½çš„éƒ½èƒ½æŒ‰ç…§è‡ªå·±çš„æ„¿æœ›å­˜åœ¨æˆ–å®ç°ã€‚</strong></em></p><p align="right">â€”â€”è·¯é¥</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;å—æ±çš„äº‘ç«¯å°é“º(Shellç‰ˆ)&lt;/center&gt;&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸƒâ€ƒçªå‘å¥‡æƒ³ï¼Œæ€ä¹ˆæ ·è®©å¤§å®¶å¿«é€Ÿçš„æŒæ¡ç¼–ç¨‹é‡Œé¢çš„åˆ¤æ–­å’Œå¾ªç¯å‘¢ï¼Œç†è®ºçŸ¥è¯†åªæ˜¯åŸºç¡€ï¼Œå…³é”®åœ¨äºè‡ªå·±çš„ä»£ç æ‰‹æ„Ÿå’Œç¼–ç¨‹çš„æ€ç»´ï¼Œæ— ä»–ï¼Œå­¦ä¹ ç¼–ç¨‹æˆ‘ä»¬åªéœ€è¦è®°ä½ä¸€ç‚¹ï¼š&lt;font color=red&gt;&lt;strong&gt;ç™¾ç‚¼æˆç¥&lt;/strong&gt;&lt;/font&gt;ã€‚å…¶ä½™ï¼Œåº•å±‚çš„åŸç†å’Œæ¶æ„æ˜¯æˆ‘ä»¬é«˜çº¬åº¦çš„ç©ºé—´ï¼Œå¤©æ¢¯æ˜¯ä¸å¯åƒ­è¶Šçš„ï¼Œéœ€è¦ä¸€æ­¥ä¸€æ­¥æ”€ç™»ï¼&lt;/p&gt;
&lt;/blockquote&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;åŠŸèƒ½ä»‹ç»&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;font color=&quot;#fc5531&quot;&gt;â–šâ€‚ä»‹ç»â€‚ï¼šå—æ±çš„äº‘ç«¯å°é“ºæš‚æ—¶æš‚æ—¶åªå†™äº†ä¸€ä¸ªæ¿å—ï¼ˆä»Šæ—¥ä¸Šæ–°ï¼‰ï¼Œå…¶ä»–æ¿å—å¤§å®¶å¯è‡ªè¡Œæ‹“å±•ï¼Œæˆ–è€…å—æ±æ”¹å¤©å¯ä»¥å†å®Œå–„ä¸€ä¸‹ï¼Œç›®å‰å®ç°çš„åŠŸèƒ½æœ‰ï¼šèœå•æ˜¾ç¤ºã€å•†å“è´­ä¹°ã€ç”¨æˆ·ç™»å½•éªŒè¯ä¸æ³¨å†Œã€è´¦æˆ·ä½™é¢å……å€¼ä¸æ˜¾ç¤ºã€è´­ç‰©è´¦å•æ‰“å°ã€‚ç»†èŠ‚å¤§å®¶å¯è‡ªè¡Œæµ‹è¯•ï¼Œé‡‘æ— è¶³èµ¤ï¼Œäººæ— å®Œäººï¼Œå¦‚æœ‰Bugï¼Œæ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºåé¦ˆï¼Œæˆ–è€…åˆ†äº«å»ºè®®å“¦~ãƒ¾(â€¢Ï‰â€¢`)o&lt;/font&gt;&lt;/p&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;å®ç°æ•ˆæœ&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/nanxi_shell.gif&quot; alt=&quot;nanxi_shell&quot;&gt;&lt;/p&gt;
&lt;div class=&quot;tips&quot;&gt;
&lt;p&gt;æç¤ºï¼šè„šæœ¬é»˜è®¤ä¼šåˆ›å»ºåˆå§‹ç”¨æˆ· &lt;code&gt;nanxi&lt;/code&gt;  å¯†ç ï¼š&lt;code&gt;nanxi123&lt;/code&gt;ï¼Œå½“ç„¶å¤§å®¶ä¹Ÿå¯ä»¥è‡ªè¡Œæ³¨å†Œè¯•ç©ï¼Œæˆ–è€…æ‹“å±•~&lt;/p&gt;
&lt;/div&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="Shellç¼–ç¨‹" scheme="https://smallflames.github.io/tags/Shell%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Shellè„šæœ¬ç¯‡003</title>
    <link href="https://smallflames.github.io/2024/01/24/Shell%E8%84%9A%E6%9C%AC%E7%AF%87003/"/>
    <id>https://smallflames.github.io/2024/01/24/Shell%E8%84%9A%E6%9C%AC%E7%AF%87003/</id>
    <published>2024-01-24T08:55:47.000Z</published>
    <updated>2024-01-25T11:39:58.472Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Shellè„šæœ¬ç¯‡003</center></h1><table><tr><td bgcolor=#000000><font color="white">è„šæœ¬éœ€æ±‚</font></td></tr></table><font color="#fc5531">â–šâ€‚éœ€æ±‚â€‚ï¼šå†™ä¸€ä¸ªç½‘å¡æ£€æµ‹è„šæœ¬ï¼Œç”¨æ¥ç›‘æµ‹ç½‘å¡çŠ¶æ€æ˜¯å¦æ­£å¸¸ï¼Œå¹¶ä»¥å†…å®¹çš„æ–¹å¼è¾“å‡ºè‡³å±å¹•ã€‚</font><p><font color="#7183ff">â–šâ€‚æç¤ºâ€‚ï¼šç½‘å¡çš„çŠ¶æ€æ­£å¸¸ä¸å¦ï¼Œå¯ä»¥æ£€æµ‹å•ä½æ—¶é—´å†…ç½‘å¡çš„è¿›å‡ºæµé‡æ¥åˆ¤æ–­ã€‚</font></p><table><tr><td bgcolor=#000000><font color="white">å®ç°æ•ˆæœ</font></td></tr></table><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240124165816497.png" alt="image-20240124165816497"></p><span id="more"></span><table><tr><td bgcolor=#000000><font color="white">è„šæœ¬å®ç°</font></td></tr></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author:  nanxi</span></span><br><span class="line"><span class="comment">#Date: 2024-1-24</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ¤æ–­å‘½ä»¤æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="keyword">if</span> ! <span class="built_in">which</span> sar &gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">    yum -y install sysstat &gt; /dev/null</span><br><span class="line">    [ $? -ne 0 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;æŠ±æ­‰ï¼Œsar å‘½ä»¤å®‰è£…å¤±è´¥ï¼Œæ‚¨å¯ä»¥å°è¯•æ‰‹åŠ¨å®‰è£…~&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æœåŠ¡çŠ¶æ€åˆ¤æ–­</span></span><br><span class="line"><span class="function"><span class="title">check_net</span></span>()&#123;</span><br><span class="line">    <span class="comment">#ç›‘æµ‹ç½‘å¡æµé‡</span></span><br><span class="line">    <span class="built_in">echo</span> -ne <span class="string">&quot;ç½‘å¡çŠ¶æ€ç›‘æµ‹ä¸­...\t\t&quot;</span></span><br><span class="line">    sar -n DEV 1 10|awk <span class="string">&#x27;/^Average/&#x27;</span>|grep <span class="string">&#x27;eth0&#x27;</span> &gt; /tmp/eth0.<span class="built_in">log</span></span><br><span class="line">    n1=$(awk <span class="string">&#x27;&#123;print $5&#125;&#x27;</span> /tmp/eth0.<span class="built_in">log</span> | sed <span class="string">&#x27;s/\.//g&#x27;</span>)</span><br><span class="line">    n2=$(awk <span class="string">&#x27;&#123;print $6&#125;&#x27;</span> /tmp/eth0.<span class="built_in">log</span> | sed <span class="string">&#x27;s/\.//g&#x27;</span>)</span><br><span class="line">    <span class="built_in">rm</span> -rf /tmp/eth0.<span class="built_in">log</span></span><br><span class="line">    <span class="comment">#ç›‘æµ‹ç»“æœè¾“å‡º</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$n1</span> = 000 ] &amp;&amp; [ <span class="variable">$n2</span> = 000 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\e[41;37m\033[05mç½‘å¡çŠ¶æ€å¼‚å¸¸\e[0m&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\e[42;37mç½‘å¡çŠ¶æ€æ­£å¸¸\e[0m&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">check</span></span>()&#123;</span><br><span class="line">    count=<span class="variable">$1</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="variable">$count</span> =~ ^[0-9]+$ ]];<span class="keyword">then</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">seq</span> <span class="variable">$count</span>)</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">            check_net</span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$count</span> <span class="keyword">in</span></span><br><span class="line">             loop)</span><br><span class="line">                 <span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line">                 <span class="keyword">do</span></span><br><span class="line">                     <span class="built_in">let</span> i++</span><br><span class="line">                     max=10</span><br><span class="line">                     check_net</span><br><span class="line">                     <span class="keyword">if</span> [ <span class="variable">$i</span> -ge <span class="variable">$max</span> ];<span class="keyword">then</span></span><br><span class="line">                         <span class="built_in">break</span></span><br><span class="line">                     <span class="keyword">fi</span></span><br><span class="line">                 <span class="keyword">done</span></span><br><span class="line">             ;;</span><br><span class="line">             *)</span><br><span class="line">             check_net</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;é»˜è®¤æ‰§è¡Œä¸€æ¬¡ï¼Œæ‚¨å¯ä»¥æŒ‡å®šæ£€æµ‹æ¬¡æ•°: &quot;</span> count</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;------------- å¼€å§‹è¿›è¡Œç½‘å¡æ£€æµ‹ -------------&quot;</span></span><br><span class="line">check <span class="variable">$count</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;---- æœ¬æ¬¡æ£€æµ‹ç»“æŸï¼Œæ„Ÿè°¢æ‚¨ä½¿ç”¨å—æ±çš„è„šæœ¬ ----&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxiblogfoot.png" alt="nanxiblogfoot"></p><blockquote><p><em><strong>äº†è§£é¢å¯¹é€†å¢ƒï¼Œè¿œæ¯”å¦‚ä½•æ¥å—é¡ºå¢ƒé‡è¦å¾—å¤šã€‚</strong></em></p><p align="right">â€”â€”é©¬ä¸Â·èµ›åŠ›æ ¼æ›¼</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Shellè„šæœ¬ç¯‡003&lt;/center&gt;&lt;/h1&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;è„šæœ¬éœ€æ±‚&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;font color=&quot;#fc5531&quot;&gt;â–šâ€‚éœ€æ±‚â€‚ï¼šå†™ä¸€ä¸ªç½‘å¡æ£€æµ‹è„šæœ¬ï¼Œç”¨æ¥ç›‘æµ‹ç½‘å¡çŠ¶æ€æ˜¯å¦æ­£å¸¸ï¼Œå¹¶ä»¥å†…å®¹çš„æ–¹å¼è¾“å‡ºè‡³å±å¹•ã€‚&lt;/font&gt;
&lt;p&gt;&lt;font color=&quot;#7183ff&quot;&gt;â–šâ€‚æç¤ºâ€‚ï¼šç½‘å¡çš„çŠ¶æ€æ­£å¸¸ä¸å¦ï¼Œå¯ä»¥æ£€æµ‹å•ä½æ—¶é—´å†…ç½‘å¡çš„è¿›å‡ºæµé‡æ¥åˆ¤æ–­ã€‚&lt;/font&gt;&lt;/p&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;å®ç°æ•ˆæœ&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240124165816497.png&quot; alt=&quot;image-20240124165816497&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="Shellç¼–ç¨‹" scheme="https://smallflames.github.io/tags/Shell%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Shellè„šæœ¬ç¯‡002</title>
    <link href="https://smallflames.github.io/2024/01/23/Shell%E8%84%9A%E6%9C%AC%E7%AF%87002/"/>
    <id>https://smallflames.github.io/2024/01/23/Shell%E8%84%9A%E6%9C%AC%E7%AF%87002/</id>
    <published>2024-01-23T12:43:03.000Z</published>
    <updated>2024-01-25T11:30:22.278Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Shellè„šæœ¬ç¯‡002</center></h1><table><tr><td bgcolor=#000000><font color="white">è„šæœ¬éœ€æ±‚</font></td></tr></table><font color="#fc5531">â–šâ€‚éœ€æ±‚â€‚ï¼šå†™ä¸€ä¸ªå·¡æ£€è„šæœ¬ï¼Œç”¨æ¥ç›‘æµ‹ç³»ç»Ÿå„é¡¹æœåŠ¡çš„çŠ¶æ€æƒ…å†µï¼Œå¹¶ä»¥å†…å®¹çš„æ–¹å¼è¾“å‡ºè‡³å±å¹•ã€‚</font><table><tr><td bgcolor=#000000><font color="white">å®ç°æ•ˆæœ</font></td></tr></table><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240123215829275.png" alt="image-20240123215829275"></p><span id="more"></span><table><tr><td bgcolor=#000000><font color="white">å®ç°è„šæœ¬</font></td></tr></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author:  nanxi</span></span><br><span class="line"><span class="comment">#Date: 2024-1-23</span></span><br><span class="line"></span><br><span class="line">. /etc/init.d/functions</span><br><span class="line"><span class="comment">#æ£€æŸ¥ä½¿ç”¨å‘½ä»¤æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="function"><span class="title">check_com</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> ! <span class="built_in">which</span> pgrep &gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;æŠ±æ­‰ï¼Œè„šæœ¬æ‰§è¡Œæ‰€éœ€çš„å‘½ä»¤ï¼ˆpgrepï¼‰ä¸å­˜åœ¨ï¼&quot;</span></span><br><span class="line">        <span class="built_in">exit</span>  1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ! <span class="built_in">which</span> ss &gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;æŠ±æ­‰ï¼Œè„šæœ¬æ‰§è¡Œæ‰€éœ€çš„å‘½ä»¤ï¼ˆssï¼‰ä¸å­˜åœ¨ï¼&quot;</span></span><br><span class="line">        <span class="built_in">exit</span>  1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ£€æŸ¥æœåŠ¡è¿›ç¨‹æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="function"><span class="title">check_ps</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> pgrep <span class="variable">$1</span> &gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">return</span> 0</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">return</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ£€æŸ¥ç«¯å£æ˜¯å¦å¤„äºç›‘å¬çŠ¶æ€</span></span><br><span class="line"><span class="function"><span class="title">check_port</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> ss -lnp | grep <span class="string">&quot;:<span class="variable">$1</span> &quot;</span> &gt; /dev/null ;<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">return</span> 0</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">return</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ¤æ–­æœåŠ¡çŠ¶æ€</span></span><br><span class="line"><span class="function"><span class="title">check_srv</span></span>()&#123;</span><br><span class="line">   <span class="keyword">if</span> check_ps <span class="variable">$1</span> &amp;&amp; check_port <span class="variable">$2</span> ;<span class="keyword">then</span></span><br><span class="line">       action <span class="string">&quot;<span class="variable">$1</span> æœåŠ¡çŠ¶æ€&quot;</span> /bin/true</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">       action <span class="string">&quot;<span class="variable">$1</span> æœåŠ¡çŠ¶æ€&quot;</span> /bin/false</span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">check_com</span><br><span class="line">check_srv nginx 80</span><br><span class="line">check_srv sshd 22</span><br><span class="line">check_srv java 8080</span><br><span class="line">check_srv php 9000</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxiblogfoot.png" alt="nanxiblogfoot"></p><blockquote><p><em><strong>å½“äººä»¬æ„Ÿåˆ°è‡ªå·±æ²¡æœ‰èƒ½åŠ›è·å¾—å·¨å¤§çš„æˆåŠŸæ—¶ï¼Œä»–ä»¬ä¼šé„™è§†ä¼Ÿå¤§çš„ç›®æ ‡ã€‚</strong></em></p><p align="right">â€”â€”æ²ƒç»´çº³æ ¼</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Shellè„šæœ¬ç¯‡002&lt;/center&gt;&lt;/h1&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;è„šæœ¬éœ€æ±‚&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;font color=&quot;#fc5531&quot;&gt;â–šâ€‚éœ€æ±‚â€‚ï¼šå†™ä¸€ä¸ªå·¡æ£€è„šæœ¬ï¼Œç”¨æ¥ç›‘æµ‹ç³»ç»Ÿå„é¡¹æœåŠ¡çš„çŠ¶æ€æƒ…å†µï¼Œå¹¶ä»¥å†…å®¹çš„æ–¹å¼è¾“å‡ºè‡³å±å¹•ã€‚&lt;/font&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;å®ç°æ•ˆæœ&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240123215829275.png&quot; alt=&quot;image-20240123215829275&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="Shellç¼–ç¨‹" scheme="https://smallflames.github.io/tags/Shell%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Shellç¼–ç¨‹çŸ¥è¯†è¡¥å……ï¼ˆäºŒï¼‰</title>
    <link href="https://smallflames.github.io/2024/01/23/Shell%E7%BC%96%E7%A8%8B%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <id>https://smallflames.github.io/2024/01/23/Shell%E7%BC%96%E7%A8%8B%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85%EF%BC%88%E4%BA%8C%EF%BC%89/</id>
    <published>2024-01-23T06:38:57.000Z</published>
    <updated>2024-01-23T12:07:11.891Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Shellç¼–ç¨‹åŸºç¡€çŸ¥è¯†è¡¥å……</center></h1><blockquote><p>âœ¨ Shell è¿™ä¸ªå•è¯çš„åŸæ„æ˜¯â€œå¤–å£³â€ï¼Œè·Ÿ kernelï¼ˆå†…æ ¸ï¼‰ç›¸å¯¹åº”ï¼Œæ¯”å–»å†…æ ¸å¤–é¢çš„ä¸€å±‚ï¼Œå³ç”¨æˆ·è·Ÿå†…æ ¸äº¤äº’çš„å¯¹è¯ç•Œé¢ã€‚<br>ğŸ‰ Shell æ˜¯ä¸€ä¸ªç¨‹åºï¼Œæä¾›ä¸€ä¸ªä¸ç”¨æˆ·å¯¹è¯çš„ç¯å¢ƒã€‚è¿™ä¸ªç¯å¢ƒåªæœ‰ä¸€ä¸ªå‘½ä»¤æç¤ºç¬¦ï¼Œè®©ç”¨æˆ·ä»é”®ç›˜è¾“å…¥å‘½ä»¤ï¼Œæ‰€ä»¥åˆç§°ä¸ºå‘½ä»¤è¡Œç¯å¢ƒï¼ˆcommand line interfaceï¼Œç®€å†™ä¸º CLIï¼‰ã€‚<br>ğŸ Shell æ˜¯ä¸€ä¸ªå‘½ä»¤è§£é‡Šå™¨ï¼Œè§£é‡Šç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ã€‚å…¶æ¬¡ï¼ŒShell æ˜¯ä¸€ä¸ªå·¥å…·ç®±ï¼Œæä¾›äº†å„ç§å°å·¥å…·ï¼Œä¾›ç”¨æˆ·æ–¹ä¾¿åœ°ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„åŠŸèƒ½ã€‚</p></blockquote><h1><font color=red>â–šâ€‚<u>01</u>â€‚æ‹“å±•ï¼šechoè¶£å‘³ç©æ³•</font></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   echo  å‘½ä»¤æ¦‚è¿°</span></span><br><span class="line">é»˜è®¤å°†è¾“å…¥çš„å­—ç¬¦ä¸²é€å¾€æ ‡å‡†è¾“å‡ºï¼Œè¾“å‡ºçš„å­—ç¬¦ä¸²é—´ä»¥ç©ºç™½å­—ç¬¦éš”å¼€, å¹¶åœ¨æœ€ååŠ ä¸Šæ¢è¡Œç¬¦ï¼›</span><br><span class="line"><span class="comment">#   echo  å‘½ä»¤è¯­æ³•</span></span><br><span class="line"><span class="built_in">echo</span> ã€é€‰é¡¹å‚æ•°ã€‘ ã€å­—ç¬¦ä¸²ã€‘</span><br><span class="line">-n    <span class="comment">#  å–æ¶ˆè‡ªåŠ¨æ¢è¡Œ</span></span><br><span class="line">-e    <span class="comment">#  æ‰“å¼€åæ–œæ ESCè½¬ä¹‰</span></span><br><span class="line">-E    <span class="comment">#  å–æ¶ˆè½¬ä¹‰ (é»˜è®¤)</span></span><br><span class="line"></span><br><span class="line">å…³äºåæ–œæ çš„è½¬ä¹‰ï¼Œè¯¦ç»†å‚æ•°å¦‚ä¸‹ï¼š</span><br></pre></td></tr></table></figure><span id="more"></span><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240123163236254.png" alt="image-20240123163236254"></p><blockquote><p>---------------------------èƒŒæ™¯é¢œè‰²èŒƒå›´:40-49------------------------<br>[root@localhost ~]# echo -e â€œ\e[40;37mé»‘åº•ç™½å­— \e[0mâ€<br><span style="color:#FFFFFF;"><span style="background-color:black;">é»‘åº•ç™½å­—</span></span><br>[root@localhost ~]# echo -e â€œ\e[41;37mæ·±çº¢ç™½å­— \e[0mâ€<br><span style="color:#FFFFFF;"><span style="background-color:red;">æ·±çº¢ç™½å­—</span></span><br>[root@localhost ~]# echo -e â€œ\e[42;37mç»¿åº•ç™½å­— \e[0mâ€<br><span style="color:#FFFFFF;"><span style="background-color:green;">ç»¿åº•ç™½å­—</span></span><br>[root@localhost ~]# echo -e â€œ\e[43;37mé»„åº•ç™½å­— \e[0mâ€<br><span style="color:#FFFFFF;"><span style="background-color:yellow;">é»„åº•ç™½å­—</span></span><br>[root@localhost ~]# echo -e â€œ\e[44;37mè“åº•ç™½å­— \e[0mâ€<br><span style="color:#FFFFFF;"><span style="background-color:blue;">è“åº•ç™½å­—</span></span><br>[root@localhost ~]# echo -e â€œ\e[45;37mç´«åº•ç™½å­— \e[0mâ€<br><span style="color:#FFFFFF;"><span style="background-color:purple;">ç´«åº•ç™½å­—</span></span><br>[root@localhost ~]# echo -e â€œ\e[46;37mæ·±ç»¿ç™½å­— \e[0mâ€<br><span style="color:#FFFFFF;"><span style="background-color:#003221;">æ·±ç»¿ç™½å­—</span></span><br>[root@localhost ~]# echo -e â€œ\e[47;30mç™½åº•é»‘å­— \e[0mâ€<br><span style="color:#000000;"><span style="background-color:#FFFFFF;">ç™½åº•é»‘å­—</span></span><br>------------------------å­—ä½“é¢œè‰²èŒƒå›´:30-39------------------------<br>[root@localhost ~]# echo -e â€œ\e[1;30mé»‘è‰²å­—ä½“ \e[0mâ€<br><font color="black">é»‘è‰²å­—ä½“</font><br>[root@localhost ~]# echo -e â€œ\e[1;31mçº¢è‰²å­—ä½“ \e[0mâ€<br><font color="red">çº¢è‰²å­—ä½“</font><br>[root@localhost ~]# echo -e â€œ\e[1;32mç»¿è‰²å­—ä½“ \e[0mâ€<br><font color="green">ç»¿è‰²å­—ä½“</font><br>[root@localhost ~]# echo -e â€œ\e[1;33mé»„è‰²å­—ä½“ \e[0mâ€<br><font color="yellow">é»„è‰²å­—ä½“</font><br>[root@localhost ~]# echo -e â€œ\e[1;34mè“è‰²å­—ä½“ \e[0mâ€<br><font color="blue">è“è‰²å­—ä½“</font><br>[root@localhost ~]# echo -e â€œ\e[1;35mç´«è‰²å­—ä½“ \e[0mâ€<br><font color="purple">ç´«è‰²å­—ä½“</font><br>[root@localhost ~]# echo -e â€œ\e[1;36mæ·±ç»¿å­—ä½“ \e[0mâ€<br><font color="#003221">æ·±ç»¿å­—ä½“</font><br>[root@localhost ~]# echo -e â€œ\e[1;37mç™½è‰²å­—ä½“ \e[0mâ€<br><font color="white">ç™½è‰²å­—ä½“</font></p></blockquote><h1><font color=red>â–šâ€‚<u>02</u>â€‚æ‹“å±•ï¼šactionç³»ç»Ÿæ˜¾ç¤º</font></h1><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240123170224054.png" alt="image-20240123170224054"></p><div class="warning"><p><font color=blue><strong>æ³¨æ„ï¼šæœ¬æ¬¡æ¼”ç¤ºä½¿ç”¨çš„æ˜¯CentOS 7.9 ï¼ŒUbantuç‰ˆæœ¬é‡Œé¢å¹¶æ²¡æœ‰/etc/init.d/functionsè¿™ä¸ªç›¸å…³æ–‡ä»¶</strong></font></p></div><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240123171538833.png" alt="image-20240123171538833"></p><h1><font color=red>â–šâ€‚<u>03</u>â€‚æ‹“å±•ï¼šå˜é‡å­ä¸²å¦™ç”¨</font></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root@nanxi:~<span class="comment"># url=www.baidu.com</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $url</span></span><br><span class="line">www.baidu.com</span><br><span class="line"></span><br><span class="line"><span class="comment">#    &quot;#&quot;  è¡¨ç¤ºä»å‰å‘ååŒ¹é…</span></span><br><span class="line">-------------------------------</span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;url#www.&#125;</span></span><br><span class="line">baidu.com</span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;url#*.&#125;</span></span><br><span class="line">baidu.com</span><br><span class="line"><span class="comment">#  ä¸¤ä¸ª#è¡¨ç¤ºè´ªå©ªåŒ¹é…ï¼Œä¸€ç›´åŒ¹é…åˆ°æœ€åä¸€ä¸ª(ç‚¹).</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;url##*.&#125;</span></span><br><span class="line">com</span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;url#*.*.&#125;</span></span><br><span class="line">com</span><br><span class="line"></span><br><span class="line"><span class="comment">#    &quot;%&quot;  è¡¨ç¤ºä»å‰å‘ååŒ¹é…</span></span><br><span class="line">-------------------------------</span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;url%.*&#125;</span></span><br><span class="line">www.baidu</span><br><span class="line"><span class="comment">#  ä¸¤ä¸ª%è¡¨ç¤ºè´ªå©ªåŒ¹é…ï¼Œä¸€ç›´åŒ¹é…åˆ°ç¬¬ä¸€ä¸ª(ç‚¹).</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;url%%.*&#125;</span></span><br><span class="line">www</span><br></pre></td></tr></table></figure><div class="tips"><p><strong>å–å€¼å°æŠ€å·§</strong></p><p>[nanxi@web1 ~]#df -h<br>Filesys  tem      Size  Used Avail Use% Mounted on<br>devtmpfs        911M     0  911M   0% /dev<br>tmpfs           922M     0  922M   0% /dev/shm<br>tmpfs           922M   18M  904M   2% /run<br>tmpfs           922M     0  922M   0% /sys/fs/cgroup<br>/dev/sda3        18G  3.2G   15G  18% /<br>/dev/sda1       197M  110M   88M  56% /boot<br>tmpfs           185M     0  185M   0% /run/user/1000<br>[nanxi@web1 ~]#used_disk=$(df -h |awk â€˜//$/{print $(NF-1)}â€™)<br>[nanxi@web1 ~]#echo $used_disk<br>18%<br>[nanxi@web1 ~]#echo ${used_disk%%}<br>18</p></div><h1><font color=red>â–šâ€‚<u>04</u>â€‚è¡¥å……ï¼šåŒ¹é…æ­£åˆ™åˆ¤æ–­</font></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[nanxi@web1 ~]<span class="comment">#[[ user =~ ^u ]] &amp;&amp; echo æˆç«‹ || echo ä¸æˆç«‹</span></span><br><span class="line">æˆç«‹</span><br><span class="line">[nanxi@web1 ~]<span class="comment"># [[ user =~ r$ ]] &amp;&amp; echo æˆç«‹ || echo ä¸æˆç«‹</span></span><br><span class="line">æˆç«‹</span><br><span class="line">[nanxi@web1 ~]<span class="comment"># [[ user =~ o$ ]] &amp;&amp; echo æˆç«‹ || echo ä¸æˆç«‹</span></span><br><span class="line">ä¸æˆç«‹</span><br><span class="line">[nanxi@web1 ~]<span class="comment"># [[ 100 =~ ^1 ]] &amp;&amp; echo æˆç«‹ || echo ä¸æˆç«‹</span></span><br><span class="line">æˆç«‹</span><br><span class="line">[nanxi@web1 ~]<span class="comment">#[[ 100 =~ ^[0-9] ]] &amp;&amp; echo æˆç«‹ || echo ä¸æˆç«‹</span></span><br><span class="line">æˆç«‹</span><br><span class="line">[nanxi@web1 ~]<span class="comment"># [[ 12343242 =~ ^[0-9]+$ ]] &amp;&amp; echo æˆç«‹ || echo ä¸æˆç«‹</span></span><br><span class="line">æˆç«‹</span><br><span class="line"><span class="comment">#  å¤šä¸ªæ­£åˆ™æ¯”å¯¹ä½¿ç”¨ &amp;&amp; (ä¸)    || (æˆ–)</span></span><br><span class="line">[nanxi@web1 ~]<span class="comment">#[[ 10 -eq 20 &amp;&amp; 200 -gt 100 ]] &amp;&amp; echo æˆç«‹ || echo ä¸æˆç«‹</span></span><br><span class="line">ä¸æˆç«‹</span><br><span class="line">[nanxi@web1 ~]<span class="comment"># [[ 10 -eq 20 || 200 -gt 100 ]] &amp;&amp; echo æˆç«‹ || echo ä¸æˆç«‹</span></span><br><span class="line">æˆç«‹</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   å¤šä¸ªæ•´æ•°æ¯”è¾ƒä½¿ç”¨ -a (and)   -o (or)</span></span><br><span class="line">[nanxi@web1 ~]<span class="comment"># [ 10 -eq 10 -a 100 -gt 20 ] &amp;&amp; echo æˆç«‹ || echo ä¸æˆç«‹</span></span><br><span class="line">æˆç«‹</span><br><span class="line">[nanxi@web1 ~]<span class="comment">#[ 10 -eq 11 -o 100 -gt 20 ] &amp;&amp; echo æˆç«‹ || echo ä¸æˆç«‹</span></span><br><span class="line">æˆç«‹</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxiblogfoot.png" alt="nanxiblogfoot"></p>        <div id="aplayer-YXxqfxoa" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;">            <pre class="aplayer-lrc-content"></pre>        </div>        <script>          var ap = new APlayer({            element: document.getElementById("aplayer-YXxqfxoa"),            narrow: false,            autoplay: true,            showlrc: false,            music: {              title: "Whale (é²¸)",              author: "Jannik",              url: "http://cdn.zzxe.eu.org/music/Whale%20%28%E9%B2%B8%29.m4a",              pic: "https://p2.music.126.net/97-CeOH6aysRsv1TYBA71Q==/109951164727131802.jpg",              lrc: ""            }          });          window.aplayers || (window.aplayers = []);          window.aplayers.push(ap);        </script><blockquote><p><em><strong>ä»¥å¸Œæœ›ä¸ºç”Ÿçš„äººï¼Œå°†ç»é£Ÿè€Œæ­»ã€‚</strong></em></p><p align="right">â€”â€”å¯Œå…°å…‹æ—ï¼ˆç¾å›½ï¼‰</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Shellç¼–ç¨‹åŸºç¡€çŸ¥è¯†è¡¥å……&lt;/center&gt;&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;âœ¨ Shell è¿™ä¸ªå•è¯çš„åŸæ„æ˜¯â€œå¤–å£³â€ï¼Œè·Ÿ kernelï¼ˆå†…æ ¸ï¼‰ç›¸å¯¹åº”ï¼Œæ¯”å–»å†…æ ¸å¤–é¢çš„ä¸€å±‚ï¼Œå³ç”¨æˆ·è·Ÿå†…æ ¸äº¤äº’çš„å¯¹è¯ç•Œé¢ã€‚&lt;br&gt;
ğŸ‰ Shell æ˜¯ä¸€ä¸ªç¨‹åºï¼Œæä¾›ä¸€ä¸ªä¸ç”¨æˆ·å¯¹è¯çš„ç¯å¢ƒã€‚è¿™ä¸ªç¯å¢ƒåªæœ‰ä¸€ä¸ªå‘½ä»¤æç¤ºç¬¦ï¼Œè®©ç”¨æˆ·ä»é”®ç›˜è¾“å…¥å‘½ä»¤ï¼Œæ‰€ä»¥åˆç§°ä¸ºå‘½ä»¤è¡Œç¯å¢ƒï¼ˆcommand line interfaceï¼Œç®€å†™ä¸º CLIï¼‰ã€‚&lt;br&gt;
ğŸ Shell æ˜¯ä¸€ä¸ªå‘½ä»¤è§£é‡Šå™¨ï¼Œè§£é‡Šç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ã€‚å…¶æ¬¡ï¼ŒShell æ˜¯ä¸€ä¸ªå·¥å…·ç®±ï¼Œæä¾›äº†å„ç§å°å·¥å…·ï¼Œä¾›ç”¨æˆ·æ–¹ä¾¿åœ°ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;&lt;font color=red&gt;â–šâ€‚&lt;u&gt;01&lt;/u&gt;â€‚æ‹“å±•ï¼šechoè¶£å‘³ç©æ³•&lt;/font&gt;&lt;/h1&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#   echo  å‘½ä»¤æ¦‚è¿°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;é»˜è®¤å°†è¾“å…¥çš„å­—ç¬¦ä¸²é€å¾€æ ‡å‡†è¾“å‡ºï¼Œè¾“å‡ºçš„å­—ç¬¦ä¸²é—´ä»¥ç©ºç™½å­—ç¬¦éš”å¼€, å¹¶åœ¨æœ€ååŠ ä¸Šæ¢è¡Œç¬¦ï¼›&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#   echo  å‘½ä»¤è¯­æ³•&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; ã€é€‰é¡¹å‚æ•°ã€‘ ã€å­—ç¬¦ä¸²ã€‘&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-n    &lt;span class=&quot;comment&quot;&gt;#  å–æ¶ˆè‡ªåŠ¨æ¢è¡Œ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-e    &lt;span class=&quot;comment&quot;&gt;#  æ‰“å¼€åæ–œæ ESCè½¬ä¹‰&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-E    &lt;span class=&quot;comment&quot;&gt;#  å–æ¶ˆè½¬ä¹‰ (é»˜è®¤)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;å…³äºåæ–œæ çš„è½¬ä¹‰ï¼Œè¯¦ç»†å‚æ•°å¦‚ä¸‹ï¼š&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="Shellç¼–ç¨‹" scheme="https://smallflames.github.io/tags/Shell%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>JumpServerå¼€æºå ¡å’æœº</title>
    <link href="https://smallflames.github.io/2024/01/22/JumpServer%E7%AE%80%E8%BF%B0/"/>
    <id>https://smallflames.github.io/2024/01/22/JumpServer%E7%AE%80%E8%BF%B0/</id>
    <published>2024-01-22T12:48:23.000Z</published>
    <updated>2024-01-23T11:54:03.795Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>JumpServerç®€è¿°</center></h1><h1>ä¸€ã€JumpServerä»‹ç»</h1><p>â€ƒâ€ƒJumpServerå¼€æºå ¡å’æœºæ˜¯ä¸€æ¬¾è¿ç»´å®‰å…¨å®¡è®¡ç³»ç»Ÿäº§å“ï¼Œæä¾›èº«ä»½éªŒè¯ã€æˆæƒæ§åˆ¶ã€è´¦å·ç®¡ç†ã€å®‰å…¨å®¡è®¡ç­‰åŠŸèƒ½æ”¯æŒï¼Œå¸®åŠ©ä¼ä¸šå¿«é€Ÿæ„å»ºè¿ç»´å®‰å…¨å®¡è®¡èƒ½åŠ›ã€‚åº•å±‚åŒæ ·ä½¿ç”¨ansibleç®¡ç†å…¶ä»–æœåŠ¡ä¸»æœºï¼Œä½†æ˜¯å¯¹äºä¼ä¸šè¿ç»´äººå‘˜æ¥è¯´ï¼Œæˆ‘ä»¬æœ€å¸¸ç”¨çš„ä¾¿æ˜¯å®ƒçš„ç®¡ç†ã€ç›‘å¯Ÿå’Œå®¡è®¡åŠŸèƒ½ã€‚</p><p><img src="https://docs.jumpserver.org/zh/v3/img/index_02.png" alt="jumpserver.org)"></p><span id="more"></span><h1>äºŒã€JumpServerå®‰è£…</h1><p>â€ƒâ€ƒå…³äºè½¯ä»¶çš„å®‰è£…ï¼Œå—æ±çš„ä¹ æƒ¯æ˜¯æ— è®ºWindowsè¿˜æ˜¯Linuxå®‰è£…è½¯ä»¶å‡åœ¨å®˜ç½‘è¿›è¡Œï¼ˆ<a href="https://www.jumpserver.org/">JumpServerå®˜ç½‘åœ°å€</a>ï¼‰ï¼Œå› ä¸ºå®˜ç½‘çš„èµ„æºæ˜¯å®æ—¶æ›´æ–°çš„ï¼Œä¼šä¸åœçš„å¯¹å‡ºç°çš„bugè¿›è¡Œä¿®å¤ï¼Œè¿™èƒ½ä¸ºæˆ‘ä»¬é¿å…å¾ˆå¤šä¸å¿…è¦çš„éº»çƒ¦ï¼Œè€Œä¸”å®˜ç½‘ä¸€èˆ¬æƒ…å†µä¸‹å‡æä¾›å¸®åŠ©æ‰‹å†Œæˆ–è€…æˆ‘ä»¬ç§°å®˜æ–¹æ–‡æ¡£ï¼Œä¼šå¤§å¤§çš„æé«˜æˆ‘ä»¬å¯¹è½¯ä»¶çš„ä½¿ç”¨æ•ˆç‡ã€‚<a href="https://docs.jumpserver.org/zh/v3/">JumpServerå®˜æ–¹æ–‡æ¡£åœ°å€</a></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240122212330586.png" alt="image-20240122212330586"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸€é”®åœ¨çº¿å®‰è£…ï¼Œé»˜è®¤æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œç‰¹æ®Šéœ€æ±‚å¯æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£</span></span><br><span class="line"><span class="comment"># å®‰è£…æ—¶æ³¨æ„æœåŠ¡å™¨é…ç½®å°½å¯èƒ½é«˜ä¸€äº›ï¼Œå®˜æ–¹ä¹Ÿæœ‰å…³äºç¡¬ä»¶é…ç½®çš„ç®€å•è¯´æ˜ï¼Œè‡ªå·±æµ‹è¯•çš„è¯2æ ¸4Gå³å¯</span></span><br><span class="line">curl -sSL https://resource.fit2cloud.com/jumpserver/jumpserver/releases/latest/download/quick_start.sh | bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…è¿‡ç¨‹å¯èƒ½æ¯”è¾ƒç¼“æ…¢ï¼Œè¯·è€å¿ƒç­‰å¾…~</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240123190345095.png" alt="nanxijunmpserver"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ä¸‹è½½åˆ°/optï¼Œcd /opt/jumpserver-installer-v3.10.2</span></span><br><span class="line"><span class="comment"># å®‰è£…å®Œæˆåä¼šæœ‰å¾ˆå¤šçš„æç¤ºï¼Œæ¯”å¦‚æœåŠ¡ç®¡ç†æ–¹å¼ã€webè®¿é—®åœ°å€ã€dockerè¿è¡Œä¿¡æ¯â€¦â€¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨æˆåŠŸåï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—®ç™»å½• JumpServer</span></span><br><span class="line">webé¡µé¢åœ°å€: http://&lt;JumpServeræœåŠ¡å™¨IPåœ°å€&gt;:&lt;æœåŠ¡è¿è¡Œç«¯å£&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·å¯†ç </span></span><br><span class="line">-----------------</span><br><span class="line">ç”¨æˆ·å: admin</span><br><span class="line">å¯†  ç : admin</span><br><span class="line">-----------------</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240123190926279.png" alt="image-20240123190926279"></p><h1>ä¸‰ã€jumpServerç•Œé¢</h1><p><img src="https://docs.jumpserver.org/zh/v3/img/online_install_01.png" alt="jumpserverweb)"></p><div class="warning"><p>â€ƒâ€ƒ<font color=red><strong>æ³¨æ„âš ï¸ ï¼šåˆšåˆšå®‰è£…å¥½JumpServerå¹¶è¿›è¡Œç¬¬ä¸€æ¬¡å¯åŠ¨åï¼Œå¯èƒ½æ— æ³•è®¿é—®JumpServerçš„webé¡µé¢ï¼Œæ˜¾ç¤ºçº¢è‰²çš„502é”™è¯¯ï¼Œä¸è¦ç€æ€¥ï¼Œæ­¤æ—¶å¯èƒ½æ˜¯cpuè´Ÿè½½è¿‡é«˜å¯¼è‡´çš„ï¼Œç­‰å¾…cpuè´Ÿè½½é™ä¸‹æ¥ä¹‹åå³å¯æ­£å¸¸è®¿é—®ã€‚</strong></font></p></div><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/Snipaste_2024-01-23_19-24-48.png" alt="Snipaste_2024-01-23_19-24-48"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/Snipaste_2024-01-23_19-30-21.png" alt="Snipaste_2024-01-23_19-30-21"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxiblogfoot.png" alt="nanxiblogfoot"></p><iframe frameborder="no" border="0" marginwidth="0" allow = "autoplay" marginheight="0" width=100% height=86 src="//music.163.com/outchain/player?type=2&id=479598964&auto=1&height=66"></iframe><blockquote><p><em><strong>å¤§å¤šæ•°äººå¤±å»å·¥ä½œï¼Œæ˜¯å› ä¸ºè¿™äº›å·¥ä½œæŠ«ç€&quot;è¾›å‹¤&quot;çš„å¤–è¡£ã€‚</strong></em></p><p align="right">â€”â€”çˆ±è¿ªç”Ÿ</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;JumpServerç®€è¿°&lt;/center&gt;&lt;/h1&gt;
&lt;h1&gt;ä¸€ã€JumpServerä»‹ç»&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒJumpServerå¼€æºå ¡å’æœºæ˜¯ä¸€æ¬¾è¿ç»´å®‰å…¨å®¡è®¡ç³»ç»Ÿäº§å“ï¼Œæä¾›èº«ä»½éªŒè¯ã€æˆæƒæ§åˆ¶ã€è´¦å·ç®¡ç†ã€å®‰å…¨å®¡è®¡ç­‰åŠŸèƒ½æ”¯æŒï¼Œå¸®åŠ©ä¼ä¸šå¿«é€Ÿæ„å»ºè¿ç»´å®‰å…¨å®¡è®¡èƒ½åŠ›ã€‚åº•å±‚åŒæ ·ä½¿ç”¨ansibleç®¡ç†å…¶ä»–æœåŠ¡ä¸»æœºï¼Œä½†æ˜¯å¯¹äºä¼ä¸šè¿ç»´äººå‘˜æ¥è¯´ï¼Œæˆ‘ä»¬æœ€å¸¸ç”¨çš„ä¾¿æ˜¯å®ƒçš„ç®¡ç†ã€ç›‘å¯Ÿå’Œå®¡è®¡åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://docs.jumpserver.org/zh/v3/img/index_02.png&quot; alt=&quot;jumpserver.org)&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="è½¯ä»¶åº”ç”¨" scheme="https://smallflames.github.io/tags/%E8%BD%AF%E4%BB%B6%E5%BA%94%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>Shellç¼–ç¨‹çŸ¥è¯†è¡¥å……ï¼ˆä¸€ï¼‰</title>
    <link href="https://smallflames.github.io/2024/01/22/Shell%E7%BC%96%E7%A8%8B%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>https://smallflames.github.io/2024/01/22/Shell%E7%BC%96%E7%A8%8B%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85%EF%BC%88%E4%B8%80%EF%BC%89/</id>
    <published>2024-01-22T08:46:42.000Z</published>
    <updated>2024-01-23T07:02:12.318Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Shellç¼–ç¨‹åŸºç¡€çŸ¥è¯†è¡¥å……</center></h1><h1>ä¸€ã€æ‰§è¡Œè„šæœ¬çš„æ–¹å¼</h1><p>1ï¸âƒ£  æŒ‡å®šè§£é‡Šå™¨æ‰§è¡Œ --------&gt;  <code>/bin/bash nanxi.sh</code>  &amp;  <code>sh nanxi.sh</code>  é»˜è®¤è§£é‡Šå™¨å³ä¸º/bin/bash</p><p>2ï¸âƒ£  ä½¿ç”¨è·¯å¾„æ‰§è¡Œï¼ˆéœ€è¦æ‰§è¡Œæƒé™+xï¼‰----&gt; <code>./nanxi.sh</code>  &amp;   <code>/scripts/nanxi.sh</code>  ä¸¤ç§æ–¹å¼å‡å¯</p><p>3ï¸âƒ£  å‘½ä»¤è°ƒç”¨æ‰§è¡Œ   -------------------------&gt;  <code>source /scripts/nanxi.sh</code>   &amp;  <code>.  nanxi.sh</code></p><div class="warning"><p><font color=red><strong>åŒºåˆ«ï¼šæ–¹å¼1ï¸âƒ£å’Œæ–¹å¼2ï¸âƒ£æ‰§è¡Œè„šæœ¬è°ƒç”¨çš„æ˜¯å­shellï¼Œè€Œæ–¹å¼3ï¸âƒ£æ‰§è¡Œè„šæœ¬è°ƒç”¨çš„æ˜¯å½“å‰shell</strong></font></p></div><h1>äºŒã€ç¯å¢ƒå˜é‡çš„æ‰§è¡Œé¡ºåº</h1><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240122182252168.png" alt="image-20240122182252168"></p><span id="more"></span><h1>ä¸‰ã€å®šä¹‰å˜é‡ï¼ˆç‰¹ä¾‹ï¼‰</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ—¶é—´æ˜¯å›ºå®šçš„</span></span><br><span class="line">root@nanxi:~<span class="comment"># time=$(date +%F-%H-%M-%S)</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $time</span></span><br><span class="line">2024-01-22-10-10-14</span><br><span class="line">root@nanxi:~<span class="comment"># echo $time</span></span><br><span class="line">2024-01-22-10-10-14</span><br><span class="line"><span class="comment"># æ—¶é—´æ˜¯ä¸å›ºå®š</span></span><br><span class="line">root@nanxi:~<span class="comment"># time=&quot;date +%F-%H-%M-%S&quot;</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $time</span></span><br><span class="line"><span class="built_in">date</span> +%F-%H-%M-%S</span><br><span class="line">root@nanxi:~<span class="comment"># $time</span></span><br><span class="line">2024-01-22-10-10-39</span><br><span class="line">root@nanxi:~<span class="comment"># $time</span></span><br><span class="line">2024-01-22-10-10-40</span><br><span class="line">root@nanxi:~<span class="comment"># $time</span></span><br><span class="line">2024-01-22-10-10-41</span><br></pre></td></tr></table></figure><h1>å››ã€Shellæ ¸å¿ƒä½ç½®å˜é‡</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$0</span>      <span class="comment"># è¡¨ç¤ºShellè„šæœ¬çš„åç§°</span></span><br><span class="line"><span class="variable">$n</span>      <span class="comment"># è¡¨ç¤ºShellè„šæœ¬å¼•ç”¨çš„ç¬¬nä¸ªå‚æ•° ä»$1å¼€å§‹è¡¨ç¤ºè„šæœ¬çš„ç¬¬1ä¸ªå‚æ•° $&#123;10&#125; $&#123;11&#125;</span></span><br><span class="line"><span class="variable">$#</span>      <span class="comment"># è¡¨ç¤ºShellè„šæœ¬ä¼ å‚çš„ä¸ªæ•°</span></span><br><span class="line">$?      <span class="comment"># è¡¨ç¤ºä¸Šä¸€ä¸ªå‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œ0è¡¨ç¤ºæˆåŠŸï¼Œé0è¡¨ç¤ºå¤±è´¥</span></span><br><span class="line"></span><br><span class="line">$$      <span class="comment"># è¡¨ç¤ºæœ¬æ¬¡æ‰§è¡Œè„šæœ¬çš„è¿›ç¨‹PIDå·ï¼Œè„šæœ¬å†…ä½¿ç”¨</span></span><br><span class="line">$!      <span class="comment"># è¡¨ç¤ºä¸Šä¸€æ¬¡æ‰§è¡Œè„šæœ¬çš„è¿›ç¨‹PIDå·ï¼Œä¸€èˆ¬è°ƒè¯•è„šæœ¬æ—¶ä½¿ç”¨</span></span><br><span class="line">$*      <span class="comment"># è¡¨ç¤ºæ‰€æœ‰å‚æ•°ï¼Œåœ¨å¾ªç¯ä½“ä¸­åŠ åŒå¼•å·è¡¨ç¤ºå°†åŸå‚æ•°ä½œä¸ºä¸€ä¸ªå‚æ•°è¾“å‡º</span></span><br><span class="line"><span class="variable">$@</span>      <span class="comment"># è¡¨ç¤ºæ‰€æœ‰å‚æ•°ï¼Œåœ¨å¾ªç¯ä½“ä¸­åŠ åŒå¼•å·è¡¨ç¤ºä»¥åŸå‚æ•°ä¸ªæ•°ä¾æ¬¡è¾“å‡º</span></span><br><span class="line"><span class="variable">$_</span>      <span class="comment"># è¡¨ç¤ºä¸Šä¸€æ¡å‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•°</span></span><br></pre></td></tr></table></figure><h1>äº”ã€è„šæœ¬ä¼ å‚æ–¹å¼</h1><h2 id="1ã€ç›´æ¥ä¼ å‚">1ã€ç›´æ¥ä¼ å‚</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@nanxi:~<span class="comment"># cat nanxi.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$1</span></span><br><span class="line">root@nanxi:~<span class="comment"># source nanxi.sh nanxi</span></span><br><span class="line">nanxi</span><br></pre></td></tr></table></figure><h2 id="2ã€èµ‹å€¼ä¼ å‚">2ã€èµ‹å€¼ä¼ å‚</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@nanxi:~<span class="comment"># cat nanxi.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">name=<span class="variable">$1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;I love <span class="variable">$name</span>&quot;</span></span><br><span class="line">root@nanxi:~<span class="comment"># source nanxi.sh nanxi</span></span><br><span class="line">I love nanxi</span><br></pre></td></tr></table></figure><h2 id="3ã€readè¯»å…¥">3ã€readè¯»å…¥</h2><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240122185148924.png" alt="image-20240122185148924"></p><div class='spoiler collapsed'>    <div class='spoiler-title'>        readå‘½ä»¤ç®€è¿°    </div>    <div class='spoiler-content'>        <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  ä½¿ç”¨æ–¹å¼ï¼š</span></span><br><span class="line"><span class="built_in">read</span> ã€é€‰é¡¹ã€‘ ã€å˜é‡åã€‘(éå›ºå®šå¯é€‰)</span><br><span class="line"><span class="comment">#  å‚æ•°é€‰é¡¹</span></span><br><span class="line">-p æç¤ºä¿¡æ¯  <span class="comment">#ç­‰å¾…readè¾“å…¥æ—¶ï¼Œè¾“å‡ºæç¤ºä¿¡æ¯;</span></span><br><span class="line">-t ç§’ æ•°     <span class="comment">#readå‘½ä»¤ä¼šä¸€ç›´ç­‰å¾…ç”¨æˆ·è¾“å…¥ï¼Œä½¿ç”¨æ­¤é€‰é¡¹å¯ä»¥æŒ‡å®šç­‰å¾…æ—¶é—´;</span></span><br><span class="line">-n å­—ç¬¦æ•°    <span class="comment">#readå‘½ä»¤åªæ¥å—æŒ‡å®šçš„å­—ç¬¦æ•°é‡ï¼Œç„¶åå°±ä¼šæ‰§è¡Œ;</span></span><br><span class="line">-s éšè—è¾“å…¥  <span class="comment">#éšè—è¾“å…¥å†…å®¹ï¼Œé€‚ç”¨äºæœºå¯†ä¿¡æ¯çš„è¾“å…¥;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  readä½¿ç”¨æ¡ˆä¾‹ </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">read</span> -t 5 -p <span class="string">&quot;Enter your name : &quot;</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;hello <span class="variable">$name</span>, welcome to BeiJing&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;sorry, Output timeout, please execute the command again !&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;------------------&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">read</span> -s -t 5 -p <span class="string">&quot;please enter your password : &quot;</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;status : $? , Ok&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;sorry, Output timeout, please execute the command again !&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><div class="warning"><p><font color=red><strong>æ³¨æ„ï¼šreadè¯»å–çš„å‚æ•°ï¼Œä¸èƒ½å†ç”¨$nçš„æ–¹å¼è¿›è¡Œè°ƒç”¨ï¼ï¼ï¼</strong></font></p></div>    </div></div><h1>å…­ã€å˜é‡çš„å­—ä¸²</h1><h2 id="1ã€å­—ç¬¦ä¸²åˆ‡ç‰‡">1ã€å­—ç¬¦ä¸²åˆ‡ç‰‡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@nanxi:~<span class="comment"># name=&quot;nanxi i love you&quot;</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $name</span></span><br><span class="line">nanxi i love you</span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;name:0:5&#125;</span></span><br><span class="line">nanxi</span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;name:8:-4&#125;</span></span><br><span class="line">love</span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;name:12:15&#125;</span></span><br><span class="line">you</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@nanxi:~<span class="comment"># name=&quot;nanxi i love you&quot;</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;name&#125; | cut -c 1-5,8-16</span></span><br><span class="line">nanxi love you</span><br></pre></td></tr></table></figure><div class="tips"><p><strong>cutå‘½ä»¤çš„ç®€å•ä»‹ç»</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">åŸºæœ¬è¯­æ³•ï¼š cut [é€‰é¡¹å‚æ•°]  filename</span><br><span class="line"></span><br><span class="line">é€‰é¡¹ä¸å‚æ•°ï¼š</span><br><span class="line">-dï¼šåˆ†éš”ç¬¦ï¼ŒæŒ‰ç…§æŒ‡å®šåˆ†éš”ç¬¦åˆ†å‰²åˆ—ã€‚ä¸ -f ä¸€èµ·ä½¿ç”¨</span><br><span class="line">-fï¼šä¾æ® -d çš„åˆ†éš”å­—ç¬¦å°†ä¸€æ®µä¿¡æ¯åˆ†å‰²æˆä¸ºæ•°æ®µï¼Œç”¨ -f å–å‡ºç¬¬å‡ æ®µçš„æ„æ€ï¼ˆåˆ—å·ï¼Œæå–ç¬¬å‡ åˆ—ï¼‰</span><br><span class="line">-cï¼šä»¥å­—ç¬¦ (characters) çš„å•ä½å–å‡ºå›ºå®šå­—ç¬¦åŒºé—´</span><br><span class="line">-bï¼šä»¥å­—èŠ‚ä¸ºå•ä½è¿›è¡Œåˆ†å‰²</span><br></pre></td></tr></table></figure><p><em>æ³¨æ„âš ï¸ï¼š å¦‚æœæ–‡ä»¶é‡Œé¢çš„æŸäº›åŸŸæ˜¯ç”±<strong>è‹¥å¹²ä¸ªç©ºæ ¼æ¥é—´éš”çš„</strong>ï¼Œé‚£ä¹ˆç”¨cutå°±æœ‰ç‚¹éº»çƒ¦äº†ï¼Œå› ä¸º<strong>cutåªæ“…é•¿å¤„ç†â€œä»¥ä¸€ä¸ªå­—ç¬¦é—´éš”â€çš„æ–‡æœ¬å†…å®¹</strong>ã€‚</em></p></div><h2 id="2ã€å˜é‡é•¿åº¦ç»Ÿè®¡">2ã€å˜é‡é•¿åº¦ç»Ÿè®¡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@nanxi:~<span class="comment"># echo nanxi | wc -L</span></span><br><span class="line">5</span><br><span class="line">root@nanxi:~<span class="comment"># expr length &quot;nanxi&quot;</span></span><br><span class="line">5</span><br><span class="line">root@nanxi:~<span class="comment"># echo nanxi | awk &#x27;&#123;print length&#125;&#x27;</span></span><br><span class="line">5</span><br><span class="line">root@nanxi:~<span class="comment"># name=nanxi</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;#name&#125;</span></span><br><span class="line">5</span><br></pre></td></tr></table></figure><div class='spoiler collapsed'>    <div class='spoiler-title'>        wcå‘½ä»¤å›é¡¾    </div>    <div class='spoiler-content'>        <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  å‘½ä»¤ä½¿ç”¨</span></span><br><span class="line"><span class="built_in">wc</span> [OPTION]... [FILE]...</span><br><span class="line"><span class="comment">#  å¸¸ç”¨å‚æ•°</span></span><br><span class="line">-l , --lines : æ˜¾ç¤ºè¡Œæ•°ï¼›</span><br><span class="line">-w , --words : æ˜¾ç¤ºå­—æ•°ï¼›</span><br><span class="line">-m , --chars : æ˜¾ç¤ºå­—ç¬¦æ•°ï¼›</span><br><span class="line">-c , --bytes : æ˜¾ç¤ºå­—èŠ‚æ•°ï¼›</span><br><span class="line">-L , --max-line-length : æ˜¾ç¤ºæœ€é•¿è¡Œçš„é•¿åº¦ï¼›</span><br></pre></td></tr></table></figure>    </div></div><h2 id="3ã€ç»Ÿè®¡å­—ç¬¦ä¸²é•¿åº¦å°äº3çš„å¹¶è¾“å‡ºåˆ°å±å¹•">3ã€ç»Ÿè®¡å­—ç¬¦ä¸²é•¿åº¦å°äº3çš„å¹¶è¾“å‡ºåˆ°å±å¹•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root@nanxi:~<span class="comment"># vim select.sh</span></span><br><span class="line">root@nanxi:~<span class="comment"># cat select.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> I am nanxi and i love you</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    [ <span class="variable">$&#123;#i&#125;</span> -lt 3 ] &amp;&amp; <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">root@nanxi:~<span class="comment"># source select.sh</span></span><br><span class="line">I</span><br><span class="line">am</span><br><span class="line">i</span><br><span class="line"></span><br><span class="line">root@nanxi:~<span class="comment"># echo I am nanxi I am 18 |xargs -n1|awk &#x27;&#123;if(length&lt;3)print&#125;&#x27;I</span></span><br><span class="line">am</span><br><span class="line">I</span><br><span class="line">am</span><br><span class="line">18</span><br><span class="line"></span><br><span class="line">root@nanxi:~<span class="comment"># echo I am nanxi I am 18 |xargs -n1|awk &#x27;&#123;for(i=1;i&lt;=NF;i++)if(length($i)&lt;3)print $i&#125;&#x27;</span></span><br><span class="line">I</span><br><span class="line">am</span><br><span class="line">I</span><br><span class="line">am</span><br><span class="line">18</span><br></pre></td></tr></table></figure><h1>ä¸ƒã€åˆ¤æ–­è¡¨è¾¾å¼</h1><h2 id="1ã€æ–‡ä»¶æ¯”è¾ƒè¿ç®—ç¬¦">1ã€æ–‡ä»¶æ¯”è¾ƒè¿ç®—ç¬¦</h2><table><thead><tr><th style="text-align:left">è¡¨è¾¾å¼</th><th style="text-align:left">è¯´æ˜</th><th style="text-align:left">æ¡ˆä¾‹</th></tr></thead><tbody><tr><td style="text-align:left">-e filename</td><td style="text-align:left">å¦‚æœfilenameå­˜åœ¨ï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€“e /etc/hosts ]</td></tr><tr><td style="text-align:left">-d filename</td><td style="text-align:left">å¦‚æœfilenameä¸ºç›®å½•ï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€“e /etc ]</td></tr><tr><td style="text-align:left">-f filename</td><td style="text-align:left">å¦‚æœfilenameä¸ºå¸¸è§„æ–‡ä»¶ï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€“f /usr/bin/grep]</td></tr><tr><td style="text-align:left">-L filename</td><td style="text-align:left">å¦‚æœfilenameä¸ºç¬¦å·é“¾æ¥ï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€“L /usr/bin/grep]</td></tr><tr><td style="text-align:left">-r filename</td><td style="text-align:left">å¦‚æœfilenameå¯è¯»ï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€“r /etc/hosts ]</td></tr><tr><td style="text-align:left">-w filename</td><td style="text-align:left">å¦‚æœfilenameå¯å†™ï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€“w /etc/hosts ]</td></tr><tr><td style="text-align:left">-x filename</td><td style="text-align:left">å¦‚æœfilenameå¯æ‰§è¡Œï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€“x /etc/hosts ]</td></tr><tr><td style="text-align:left">filename1 â€“nt filename2</td><td style="text-align:left">å¦‚æœfilename1æ¯”filename2æ–°ï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[/usr/test/file1.txt â€“nt /usr/test/file2.txt]</td></tr><tr><td style="text-align:left">filename1 â€“ot filename2</td><td style="text-align:left">å¦‚æœfilename1æ¯”filename2æ—§ï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[/usr/test/file1.txt â€“ot /usr/test/file2.txt]</td></tr></tbody></table><h2 id="2ã€å­—ç¬¦ä¸²æ¯”è¾ƒè¿ç®—ç¬¦">2ã€å­—ç¬¦ä¸²æ¯”è¾ƒè¿ç®—ç¬¦</h2><table><thead><tr><th style="text-align:left">è¡¨è¾¾å¼</th><th style="text-align:left">è¯´æ˜</th><th style="text-align:left">æ¡ˆä¾‹</th></tr></thead><tbody><tr><td style="text-align:left">-z string</td><td style="text-align:left">å¦‚æœstringé•¿åº¦ä¸º0,åˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€“z â€œ$varâ€]</td></tr><tr><td style="text-align:left">-n string</td><td style="text-align:left">å¦‚æœstringé•¿åº¦é0,åˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€“n â€œ$varâ€]</td></tr><tr><td style="text-align:left">str1=str2</td><td style="text-align:left">å¦‚æœstr1ä¸str2ç›¸åŒï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€œ$varâ€ = â€hello worldâ€]</td></tr><tr><td style="text-align:left">str1!=str2</td><td style="text-align:left">å¦‚æœstr1ä¸str2ä¸ç›¸åŒï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€$varâ€œ != â€hello worldâ€œ]</td></tr></tbody></table><h2 id="3ã€ç®—æœ¯æ¯”è¾ƒè¿ç®—ç¬¦">3ã€ç®—æœ¯æ¯”è¾ƒè¿ç®—ç¬¦</h2><table><thead><tr><th style="text-align:left">è¡¨è¾¾å¼</th><th style="text-align:left">è¯´æ˜</th><th style="text-align:left">æ¡ˆä¾‹</th></tr></thead><tbody><tr><td style="text-align:left">num1-eq num2</td><td style="text-align:left">ç­‰äº</td><td style="text-align:left">[ 6 -eq $num ]</td></tr><tr><td style="text-align:left">num1-ne num2</td><td style="text-align:left">ä¸ç­‰äº</td><td style="text-align:left">[ 6 -ne $num ]</td></tr><tr><td style="text-align:left">num1-lt num2</td><td style="text-align:left">å°äº</td><td style="text-align:left">[ 6 -lt $num ]</td></tr><tr><td style="text-align:left">num1-le num2</td><td style="text-align:left">å°äºç­‰äº</td><td style="text-align:left">[ 6 -le $num ]</td></tr><tr><td style="text-align:left">num1-gt num2</td><td style="text-align:left">å¤§äº</td><td style="text-align:left">[ 6 -gt $num ]</td></tr><tr><td style="text-align:left">num1-ge num2</td><td style="text-align:left">å¤§äºç­‰äº</td><td style="text-align:left">[ 6 -ge $num ]</td></tr></tbody></table><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxiblogfoota.png" alt="nanxiblogfoota"></p><iframe frameborder="no" border="0" marginwidth="0" allow = "autoplay" marginheight="0" width=100% height=86 src="//music.163.com/outchain/player?type=2&id=1488212875&auto=1&height=66"></iframe><blockquote><p><em><strong>è‡ªç”±æ˜¯ä¸Šå¸èµç»™äººç±»çš„æœ€å¤§çš„å¹¸ç¦ä¹‹ä¸€ã€‚</strong></em></p><p align="right">â€”â€”å¡ä¸‡ææ–¯</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Shellç¼–ç¨‹åŸºç¡€çŸ¥è¯†è¡¥å……&lt;/center&gt;&lt;/h1&gt;
&lt;h1&gt;ä¸€ã€æ‰§è¡Œè„šæœ¬çš„æ–¹å¼&lt;/h1&gt;
&lt;p&gt;1ï¸âƒ£  æŒ‡å®šè§£é‡Šå™¨æ‰§è¡Œ --------&amp;gt;  &lt;code&gt;/bin/bash nanxi.sh&lt;/code&gt;  &amp;amp;  &lt;code&gt;sh nanxi.sh&lt;/code&gt;  é»˜è®¤è§£é‡Šå™¨å³ä¸º/bin/bash&lt;/p&gt;
&lt;p&gt;2ï¸âƒ£  ä½¿ç”¨è·¯å¾„æ‰§è¡Œï¼ˆéœ€è¦æ‰§è¡Œæƒé™+xï¼‰----&amp;gt; &lt;code&gt;./nanxi.sh&lt;/code&gt;  &amp;amp;   &lt;code&gt;/scripts/nanxi.sh&lt;/code&gt;  ä¸¤ç§æ–¹å¼å‡å¯&lt;/p&gt;
&lt;p&gt;3ï¸âƒ£  å‘½ä»¤è°ƒç”¨æ‰§è¡Œ   -------------------------&amp;gt;  &lt;code&gt;source /scripts/nanxi.sh&lt;/code&gt;   &amp;amp;  &lt;code&gt;.  nanxi.sh&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;warning&quot;&gt;
&lt;p&gt;&lt;font color=red&gt;&lt;strong&gt;åŒºåˆ«ï¼šæ–¹å¼1ï¸âƒ£å’Œæ–¹å¼2ï¸âƒ£æ‰§è¡Œè„šæœ¬è°ƒç”¨çš„æ˜¯å­shellï¼Œè€Œæ–¹å¼3ï¸âƒ£æ‰§è¡Œè„šæœ¬è°ƒç”¨çš„æ˜¯å½“å‰shell&lt;/strong&gt;&lt;/font&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;h1&gt;äºŒã€ç¯å¢ƒå˜é‡çš„æ‰§è¡Œé¡ºåº&lt;/h1&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240122182252168.png&quot; alt=&quot;image-20240122182252168&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="Shellç¼–ç¨‹" scheme="https://smallflames.github.io/tags/Shell%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Ansibleä¸€é”®éƒ¨ç½²å®ä¾‹ï¼ˆä¸‰ï¼‰</title>
    <link href="https://smallflames.github.io/2024/01/21/Ansible%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E5%AE%9E%E4%BE%8B%EF%BC%88%E4%B8%89%EF%BC%89/"/>
    <id>https://smallflames.github.io/2024/01/21/Ansible%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E5%AE%9E%E4%BE%8B%EF%BC%88%E4%B8%89%EF%BC%89/</id>
    <published>2024-01-21T10:36:01.000Z</published>
    <updated>2024-01-21T11:35:17.643Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Ansibleä¸€é”®éƒ¨ç½²å®ä¾‹ï¼ˆä¸‰ï¼‰</center></h1><table><tr><td bgcolor=#000000><font color="white">ä¸šåŠ¡éƒ¨ç½²ä»£ç </font></td></tr></table><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wordpressä¸šåŠ¡éƒ¨ç½²</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/wordpress</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">wordpress.conf</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">wordpress.sql</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">wordpress.tar.gz</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">6</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/wordpress</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for wordpress</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">remove</span> <span class="string">nginx</span> <span class="string">default.conf</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">rm</span> <span class="string">-rf</span> <span class="string">/etc/nginx/conf.d/default.conf</span> <span class="string">warn=false</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">wordpress</span> <span class="string">nginx</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">wordpress.conf</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/nginx/conf.d</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">web</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">wordpress</span> <span class="string">code</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/code/wordpress</span></span><br><span class="line">    <span class="attr">owner:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Extract</span> <span class="string">wordpress.tar.gz</span> <span class="string">into</span> <span class="string">web</span> <span class="string">/code</span></span><br><span class="line">  <span class="attr">unarchive:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">wordpress.tar.gz</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/code/wordpress</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Modify</span> <span class="string">directory</span> <span class="string">permissions</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">chown</span> <span class="string">-R</span> <span class="string">www.www</span> <span class="string">/code</span> <span class="string">warn=false</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sent</span> <span class="string">wordpress.sql</span> <span class="string">to</span> <span class="string">db</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">wordpress.sql</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/tmp</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">import</span> <span class="string">wordpress.sql</span></span><br><span class="line">  <span class="attr">mysql_db:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">all</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">import</span></span><br><span class="line">    <span class="attr">target:</span> <span class="string">/tmp/wordpress.sql</span></span><br><span class="line">  <span class="attr">register:</span> <span class="string">result</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">nginx</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">mariadb</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">mariadb</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mount</span> <span class="string">dir</span> <span class="string">to</span> <span class="string">nfs1</span></span><br><span class="line">  <span class="attr">mount:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.31</span><span class="string">:/data/wordpress</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/code/wordpress/wp-content/uploads</span></span><br><span class="line">    <span class="attr">fstype:</span> <span class="string">nfs</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">mounted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><span id="more"></span><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kodä¸šåŠ¡éƒ¨ç½²</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/kod</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">kod.conf</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">kod.sql</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">kod.tar.gz</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">6</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/kod</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for kod</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">remove</span> <span class="string">nginx</span> <span class="string">default.conf</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">rm</span> <span class="string">-rf</span> <span class="string">/etc/nginx/conf.d/default.conf</span> <span class="string">warn=false</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">kod</span> <span class="string">nginx</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">kod.conf</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/nginx/conf.d</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">web</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">kod</span> <span class="string">code</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/code/kod</span></span><br><span class="line">    <span class="attr">owner:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Extract</span> <span class="string">kod.tar.gz</span> <span class="string">into</span> <span class="string">web</span> <span class="string">/code</span></span><br><span class="line">  <span class="attr">unarchive:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">kod.tar.gz</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/code/kod</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Modify</span> <span class="string">directory</span> <span class="string">permissions</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">chown</span> <span class="string">-R</span> <span class="string">www.www</span> <span class="string">/code</span> <span class="string">warn=false</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sent</span> <span class="string">kod.sql</span> <span class="string">to</span> <span class="string">db</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">kod.sql</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/tmp</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">import</span> <span class="string">kod.sql</span></span><br><span class="line">  <span class="attr">mysql_db:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">all</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">import</span></span><br><span class="line">    <span class="attr">target:</span> <span class="string">/tmp/kod.sql</span></span><br><span class="line">  <span class="attr">register:</span> <span class="string">result</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">nginx</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">mariadb</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">mariadb</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mount</span> <span class="string">dir</span> <span class="string">to</span> <span class="string">nfs1</span></span><br><span class="line">  <span class="attr">mount:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.31</span><span class="string">:/data/kod</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/code/kod/data/files</span></span><br><span class="line">    <span class="attr">fstype:</span> <span class="string">nfs</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">mounted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># éƒ¨ç½²tomcatæœåŠ¡</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/tomcat</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">context.xml</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">jdk.rpm</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">redis-data-cache.properties</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">tomcat.service</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">tomcat_session.tar.gz</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">tomcat.tar.gz</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">9</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/tomcat</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for tomcat</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sent</span> <span class="string">jdk.rpm</span> <span class="string">and</span> <span class="string">tomcat.service</span> <span class="string">to</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/tmp</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">jdk.rpm</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tomcat.service</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">java</span> <span class="string">environment</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">yum</span> <span class="string">-y</span> <span class="string">localinstall</span> <span class="string">/tmp/jdk.rpm</span> <span class="string">warn=false</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">systemctl</span> <span class="string">for</span> <span class="string">tomcat</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">tomcat.service</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/usr/lib/systemd/system</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">soft</span> <span class="string">dir</span> <span class="string">for</span> <span class="string">tomcat</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/soft</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Extract</span> <span class="string">tomcat.tar.gz</span> <span class="string">into</span> <span class="string">web</span> <span class="string">/soft</span></span><br><span class="line">  <span class="attr">unarchive:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">tomcat.tar.gz</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/soft</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">tomcat</span> <span class="string">link</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">/soft/apache-tomcat-9.0.84</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/soft/tomcat</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">link</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Extract</span> <span class="string">tomcat_session.tar.gz</span> <span class="string">into</span> <span class="string">web</span> <span class="string">tomcat</span> <span class="string">for</span> <span class="string">session</span> <span class="string">share</span></span><br><span class="line">  <span class="attr">unarchive:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">tomcat_session.tar.gz</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/soft/tomcat/lib</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cp</span> <span class="string">redis-data-cache.properties</span> <span class="string">and</span> <span class="string">context.xml</span> <span class="string">to</span> <span class="string">tomcat</span> <span class="string">for</span> <span class="string">session</span> <span class="string">share</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/soft/tomcat/conf</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">redis-data-cache.properties</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">context.xml</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">reload</span> <span class="string">by</span> <span class="string">systemctl</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">systemctl</span> <span class="string">daemon-reload</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">systemctl</span> <span class="string">restart</span> <span class="string">tomcat</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">systemctl</span> <span class="string">enable</span> <span class="string">tomcat</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">remove</span> <span class="string">remains</span> <span class="string">for</span> <span class="string">tomcat</span></span><br><span class="line">  <span class="attr">shell:</span>  <span class="string">rm</span> <span class="string">-rf</span> <span class="string">/tmp/jdk.rpm</span> <span class="string">/tmp/sys_tomcat</span> <span class="string">warn=false</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># zrlogæœåŠ¡éƒ¨ç½²</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/zrlog</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">server.xml</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">zrlog.sql</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">zrlog.tar.gz</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">6</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/zrlog</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for zrlog</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">zrlog</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">server.xml</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/soft/tomcat/conf</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">zrlog</span> <span class="string">code</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/code/zrlog/ROOT</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sent</span> <span class="string">zrlog.sql</span> <span class="string">to</span> <span class="string">db</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">zrlog.sql</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/tmp</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">import</span> <span class="string">zrlog.sql</span></span><br><span class="line">  <span class="attr">mysql_db:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">all</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">import</span></span><br><span class="line">    <span class="attr">target:</span> <span class="string">/tmp/zrlog.sql</span></span><br><span class="line">  <span class="attr">register:</span> <span class="string">result</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">mariadb</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">mariadb</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Extract</span> <span class="string">zrlog.tar.gz</span> <span class="string">into</span> <span class="string">web</span> <span class="string">/code/zrlog/ROOT</span></span><br><span class="line">  <span class="attr">unarchive:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">zrlog.tar.gz</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/code/zrlog/ROOT</span></span><br><span class="line">  <span class="attr">ignore_errors:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">tomcat</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">systemctl</span> <span class="string">restart</span> <span class="string">tomcat</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mount</span> <span class="string">dir</span> <span class="string">to</span> <span class="string">nfs1</span></span><br><span class="line">  <span class="attr">mount:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.31</span><span class="string">:/data/zrlog</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/code/zrlog/ROOT/attached</span></span><br><span class="line">    <span class="attr">fstype:</span> <span class="string">nfs</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">mounted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># phpmyadminéƒ¨ç½²</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/phpadmin</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">admin.conf</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">phpadmin.tar.gz</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">5</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/phpadmin</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for phpadmin</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">remove</span> <span class="string">nginx</span> <span class="string">default.conf</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">rm</span> <span class="string">-rf</span> <span class="string">/etc/nginx/conf.d/default.conf</span> <span class="string">warn=false</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">admin</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">admin.conf</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/nginx/conf.d</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">admin</span> <span class="string">code</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/code/phpadmin</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Extract</span> <span class="string">phpadmin.tar.gz</span> <span class="string">into</span> <span class="string">web</span> <span class="string">code_dir</span></span><br><span class="line">  <span class="attr">unarchive:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">phpadmin.tar.gz</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/code/phpadmin</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Modify</span> <span class="string">directory</span> <span class="string">permissions</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">chown</span> <span class="string">-R</span> <span class="string">www.www</span> <span class="string">/code</span> <span class="string">warn=false</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><table><tr><td bgcolor=#000000><font color="white">æœåŠ¡éƒ¨ç½²ä»£ç </font></td></tr></table><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è´Ÿè½½å‡è¡¡é…ç½®</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/lb_nginx</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">proxy.conf</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">proxy_params</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">5</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/lb_nginx</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for lb_nginx</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">remove</span> <span class="string">nginx</span> <span class="string">default.conf</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">rm</span> <span class="string">-rf</span> <span class="string">/etc/nginx/conf.d/default.conf</span> <span class="string">warn=false</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Reverse</span> <span class="string">proxy</span> <span class="string">proxy_params</span> <span class="string">and</span> <span class="string">Proxy</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.src &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.dest &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">src:</span> <span class="string">proxy_params</span>,<span class="attr">dest:</span> <span class="string">/etc/nginx</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">src:</span> <span class="string">proxy.conf</span>,<span class="attr">dest:</span> <span class="string">/etc/nginx/conf.d</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Restart</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è´Ÿè½½å‡è¡¡é«˜å¯ç”¨</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/keepalived</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">keep_nginxcheck.sh</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">keepalived.conf.j2</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">5</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/keepalived</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for keepalived</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Istall</span> <span class="string">keepalived</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">keepalived</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">shell</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/script</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Sent</span> <span class="string">nginx</span> <span class="string">check</span> <span class="string">shell</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">keep_nginxcheck.sh</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/script</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">&#x27;0755&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">keepalived</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">keepalived.conf.j2</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/keepalived/keepalived.conf</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="string">Restart</span> <span class="string">keepalived</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Start</span> <span class="string">keepalived</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">keepalived</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…¨ç½‘å®šæ—¶å¤‡ä»½</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/backup</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">backup.sh</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">tasks</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span> <span class="string">directories,</span> <span class="number">2</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/backup</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for backup</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">shell</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/script/autobackup</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match</span> <span class="string">&quot;backup&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Sent</span> <span class="string">backup.sh</span> <span class="string">all</span> <span class="string">except</span> <span class="string">backup</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">backup.sh</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/script/autobackup</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">&#x27;0755&#x27;</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match</span> <span class="string">&quot;backup&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Write</span> <span class="string">in</span> <span class="string">cron</span> <span class="string">tasks</span> <span class="string">for</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">cron:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.name&#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">minute:</span> <span class="string">&quot;*/5&quot;</span></span><br><span class="line">    <span class="comment">#hour: &quot;02&quot;</span></span><br><span class="line">    <span class="attr">job:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.job &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&quot;Code scheduled backup&quot;</span>,<span class="attr">job:</span> <span class="string">/bin/bash</span> <span class="string">/script/autobackup/backup.sh</span> <span class="string">/code</span> <span class="string">&gt;</span> <span class="string">/dev/null</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&quot;Nginx scheduled backup&quot;</span>,<span class="attr">job:</span> <span class="string">/bin/bash</span> <span class="string">/script/autobackup/backup.sh</span> <span class="string">/etc/nginx</span> <span class="string">&gt;</span> <span class="string">/dev/null</span> &#125;</span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Write</span> <span class="string">in</span> <span class="string">cron</span> <span class="string">tasks</span> <span class="string">for</span> <span class="string">lb</span></span><br><span class="line">  <span class="attr">cron:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;Nginx scheduled backup&quot;</span></span><br><span class="line">    <span class="attr">minute:</span> <span class="string">&quot;*/5&quot;</span></span><br><span class="line">    <span class="comment">#hour: &quot;02&quot;</span></span><br><span class="line">    <span class="attr">job:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/bin/bash</span> <span class="string">/script/autobackup/backup.sh</span> <span class="string">/etc/nginx</span> <span class="string">&gt;</span> <span class="string">/dev/null</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Write</span> <span class="string">in</span> <span class="string">cron</span> <span class="string">tasks</span> <span class="string">for</span> <span class="string">nfs</span></span><br><span class="line">  <span class="attr">cron:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;Data share scheduled backup&quot;</span></span><br><span class="line">    <span class="attr">minute:</span> <span class="string">&quot;*/5&quot;</span></span><br><span class="line">    <span class="comment">#hour: &quot;02&quot;</span></span><br><span class="line">    <span class="attr">job:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/bin/bash</span> <span class="string">/script/autobackup/backup.sh</span> <span class="string">/data</span> <span class="string">&gt;</span> <span class="string">/dev/null</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Write</span> <span class="string">in</span> <span class="string">cron</span> <span class="string">tasks</span> <span class="string">for</span> <span class="string">db</span></span><br><span class="line">  <span class="attr">cron:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.name &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">minute:</span> <span class="string">&quot;*/5&quot;</span></span><br><span class="line">    <span class="comment">#hour: &quot;02&quot;</span></span><br><span class="line">    <span class="attr">job:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.job &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&quot;Mysql conf scheduled backup&quot;</span>,<span class="attr">job:</span> <span class="string">/bin/bash</span> <span class="string">/script/autobackup/backup.sh</span> <span class="string">/etc/my.cnf.d</span> <span class="string">&gt;</span> <span class="string">/dev/null</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&quot;Mysql file scheduled backup&quot;</span>,<span class="attr">job:</span> <span class="string">/bin/bash</span> <span class="string">/script/autobackup/backup.sh</span> <span class="string">/var/lib/mysql</span> <span class="string">&gt;</span> <span class="string">/dev/null</span> &#125;</span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®https</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/https</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">proxy.conf</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">server.crt</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">server.key</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">6</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/https</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for https</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">ssl_key</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/nginx/ssl_key</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Key</span> <span class="string">distribution</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/nginx/ssl_key</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">server.crt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">server.key</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Modifying</span> <span class="string">agent</span> <span class="string">configuration</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">proxy.conf</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/nginx/conf.d</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="string">Restart</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Modifying</span> <span class="string">web</span> <span class="string">configuration</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.path &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">regexp:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.regex &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">line:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.line &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">path:</span> <span class="string">/etc/nginx/conf.d/wordpress.conf</span>,<span class="attr">regex:</span> <span class="string">&#x27;^#fastcgi_param&#x27;</span>,<span class="attr">line:</span> <span class="string">&quot;fastcgi_param HTTPS on;&quot;</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">path:</span> <span class="string">/etc/nginx/conf.d/admin.conf</span>,<span class="attr">regex:</span> <span class="string">&#x27;^#fastcgi_param&#x27;</span>,<span class="attr">line:</span> <span class="string">&quot;fastcgi_param HTTPS on;&quot;</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">path:</span> <span class="string">/etc/nginx/conf.d/kod.conf</span>,<span class="attr">regex:</span> <span class="string">&#x27;^#fastcgi_param&#x27;</span>,<span class="attr">line:</span> <span class="string">&quot;fastcgi_param HTTPS on;&quot;</span> &#125;</span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Restart</span> <span class="string">web</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">port</span> <span class="number">443</span> <span class="string">for</span> <span class="string">tomcat</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/soft/tomcat/conf/server.xml</span></span><br><span class="line">    <span class="attr">regexp:</span> <span class="string">&#x27;redirectPort=&quot;8443&quot;&#x27;</span></span><br><span class="line">    <span class="attr">line:</span> <span class="string">&#x27; redirectPort=&quot;443&quot; proxyPort=&quot;443&quot; scheme=&quot;https&quot; secure=&quot;true&quot; SSLEnabled=&quot;true&quot; &#x27;</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®é˜²ç«å¢™ç­–ç•¥</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/iptables</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">templates</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">iptables_strategy.j2</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span> <span class="string">directories,</span> <span class="number">2</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/iptables</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for iptables</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Stop</span> <span class="string">local</span> <span class="string">firewalld</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">firewalld</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">stopped</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Prohibit</span> <span class="string">self</span> <span class="string">start</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">systemctl</span> <span class="string">disable</span> <span class="string">firewalld</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">iptables-services</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">iptables-services</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Start</span> <span class="string">iptables</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">iptables.service</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Insert</span> <span class="string">configuration</span> <span class="string">in</span> <span class="string">rc.local</span></span><br><span class="line">  <span class="attr">blockinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/rc.d/rc.local</span></span><br><span class="line">    <span class="attr">block:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      modprobe ip_tables</span></span><br><span class="line"><span class="string">      modprobe iptable_filter</span></span><br><span class="line"><span class="string">      modprobe iptable_nat</span></span><br><span class="line"><span class="string">      modprobe ip_contrack</span></span><br><span class="line"><span class="string">      modprobe ip_conntrack_ftp</span></span><br><span class="line"><span class="string">      modprobe ip_nat_ftp</span></span><br><span class="line"><span class="string">      modprobe ipt_state</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Execute</span> <span class="string">permission</span> <span class="string">for</span> <span class="string">rc.local</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">chmod</span> <span class="number">0755</span> <span class="string">/etc/rc.d/rc.local</span> <span class="string">warn=false</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Sent</span> <span class="string">iptables_strategy</span> <span class="string">to</span> <span class="string">lb</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">iptables_strategy.j2</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/tmp/iptables_strategy</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Import</span> <span class="string">iptables_strategy</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">iptables-restore</span> <span class="string">&lt;</span> <span class="string">/tmp/iptables_strategy</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Remove</span> <span class="string">/tmp/iptables_strategy</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">rm</span> <span class="string">-rf</span> <span class="string">/tmp/iptables_strategy</span> <span class="string">warn=false</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å†…éƒ¨æœåŠ¡å™¨è®¿é—®å…¬ç½‘</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/access_net</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">tasks</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span> <span class="string">directory,</span> <span class="number">1</span> <span class="string">file</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/access_net</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for access_net</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Modifying</span> <span class="string">eth1</span> <span class="string">network</span> <span class="string">configuration</span></span><br><span class="line">  <span class="attr">blockinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/sysconfig/network-scripts/ifcfg-eth1</span></span><br><span class="line">    <span class="attr">block:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      GATEWAY=172.16.1.6</span></span><br><span class="line"><span class="string"></span>  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Restart</span> <span class="string">the</span> <span class="string">network</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">systemctl</span> <span class="string">restart</span> <span class="string">network</span> <span class="string">warn=false</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">switch</span> <span class="string">on</span> <span class="string">kernel</span> <span class="string">forward</span></span><br><span class="line">  <span class="attr">blockinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/sysctl.conf</span></span><br><span class="line">    <span class="attr">block:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      net.ipv4.ip_forward = 1</span></span><br><span class="line"><span class="string"></span>  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">load</span> <span class="string">configuration</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">sysctl</span> <span class="string">-p</span> <span class="string">warn=false</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#- name: switch off eth0</span></span><br><span class="line"><span class="comment">#  shell: ifdown eth0 warn=false</span></span><br><span class="line"><span class="comment">#  when: ansible_hostname is not match &quot;lb&quot;</span></span><br><span class="line"><span class="comment">#- name: Modifying eth0 network configuration</span></span><br><span class="line"><span class="comment">#  lineinfile:</span></span><br><span class="line"><span class="comment">#    path: /etc/sysconfig/network-scripts/ifcfg-eth0</span></span><br><span class="line"><span class="comment">#    regexp: &#x27;^ONBOOT&#x27;</span></span><br><span class="line"><span class="comment">#    line: &#x27;ONBOOT=yes&#x27;</span></span><br><span class="line"><span class="comment">#  when: ansible_hostname is not match &quot;lb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ—¶é—´æœåŠ¡å™¨é…ç½®</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/ntpdate</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">tasks</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span> <span class="string">directories,</span> <span class="number">2</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/ntpdate</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for ntpdata</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">ntp</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">ntp</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">cron</span> <span class="string">task</span> <span class="string">in</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">cron:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;TimeSync as Server&quot;</span></span><br><span class="line">    <span class="attr">minute:</span> <span class="string">&quot;*/10&quot;</span></span><br><span class="line">    <span class="attr">job:</span> <span class="string">&quot;/usr/sbin/ntpdate ntp1.aliyun.com &amp;&amp; hwclock -w &gt; /dev/null&quot;</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Modifying</span> <span class="string">configure</span> <span class="string">for</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">blockinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/ntp.conf</span></span><br><span class="line">    <span class="attr">block:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      SYNC_HWCLOCK=yes</span></span><br><span class="line"><span class="string"></span>  <span class="attr">notify:</span> <span class="string">Restart</span> <span class="string">ntpd</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Remove</span> <span class="string">server</span> <span class="string">on</span> <span class="string">client</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/ntp.conf</span></span><br><span class="line">    <span class="attr">regexp:</span> <span class="string">&#x27;^server&#x27;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">absent</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Modifying</span> <span class="string">configure</span> <span class="string">for</span> <span class="string">client</span></span><br><span class="line">  <span class="attr">blockinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/ntp.conf</span></span><br><span class="line">    <span class="attr">block:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      server 172.16.1.32 prefer</span></span><br><span class="line"><span class="string">      server 172.16.1.31</span></span><br><span class="line"><span class="string"></span>  <span class="attr">notify:</span> <span class="string">Restart</span> <span class="string">ntpd</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Start</span> <span class="string">ntpd</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">ntpd</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">cron</span> <span class="string">task</span> <span class="string">in</span> <span class="string">client</span></span><br><span class="line">  <span class="attr">cron:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;TimeSync as Server&quot;</span></span><br><span class="line">    <span class="attr">minute:</span> <span class="string">&quot;*/10&quot;</span></span><br><span class="line">    <span class="attr">job:</span> <span class="string">&quot;/usr/sbin/ntpdate 172.16.1.32 &amp;&amp; hwclock -w &gt; /dev/null&quot;</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Ansibleä¸€é”®éƒ¨ç½²å®ä¾‹ï¼ˆä¸‰ï¼‰&lt;/center&gt;&lt;/h1&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;ä¸šåŠ¡éƒ¨ç½²ä»£ç &lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;figure class=&quot;highlight yaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# wordpressä¸šåŠ¡éƒ¨ç½²&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;string&quot;&gt;root@ansible&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;~/roles/wordpress&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;#tree&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;files&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;â”‚&lt;/span&gt;Â Â  &lt;span class=&quot;string&quot;&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress.conf&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;â”‚&lt;/span&gt;Â Â  &lt;span class=&quot;string&quot;&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress.sql&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;â”‚&lt;/span&gt;Â Â  &lt;span class=&quot;string&quot;&gt;â””â”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress.tar.gz&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;handlers&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;â”‚&lt;/span&gt;Â Â  &lt;span class=&quot;string&quot;&gt;â””â”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;main.yml&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;tasks&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;â”‚&lt;/span&gt;Â Â  &lt;span class=&quot;string&quot;&gt;â””â”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;main.yml&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;templates&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;â””â”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;vars&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;â””â”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;main.yml&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;directories,&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;files&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;string&quot;&gt;root@ansible&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;~/roles/wordpress&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;#cat tasks/main.yml&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;---&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# tasks file for wordpress&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;remove&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;nginx&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;default.conf&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;shell:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;-rf&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/etc/nginx/conf.d/default.conf&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;warn=false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;web&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;configure&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;nginx&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;server&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;copy:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;src:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress.conf&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;dest:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/etc/nginx/conf.d&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;notify:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;restart&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;web&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;nginx&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;web&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;code&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;dir&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;file:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;path:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/code/wordpress&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;owner:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;www&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;group:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;www&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;state:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;directory&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;web&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;Extract&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress.tar.gz&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;into&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;web&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/code&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;unarchive:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;src:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress.tar.gz&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;dest:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/code/wordpress&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;web&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;Modify&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;directory&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;permissions&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;shell:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;chown&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;-R&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;www.www&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/code&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;warn=false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;web&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;sent&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress.sql&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;db&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;copy:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;src:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress.sql&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;dest:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/tmp&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;db&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress.sql&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;mysql_db:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;all&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;state:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;import&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;target:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/tmp/wordpress.sql&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;register:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;result&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;db&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;restart&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;nginx&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;systemd:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;nginx&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;state:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;restarted&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;web&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;restart&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;mariadb&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;systemd:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;mariadb&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;state:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;restarted&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;db&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;mount&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;dir&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;nfs1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;mount:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;src:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;172.16&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.31&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;:/data/wordpress&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;path:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/code/wordpress/wp-content/uploads&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;fstype:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;nfs&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;state:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;mounted&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;web&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="æœåŠ¡æ¶æ„" scheme="https://smallflames.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Ansibleä¸€é”®éƒ¨ç½²å®ä¾‹ï¼ˆäºŒï¼‰</title>
    <link href="https://smallflames.github.io/2024/01/21/Ansible%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E5%AE%9E%E4%BE%8B%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <id>https://smallflames.github.io/2024/01/21/Ansible%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E5%AE%9E%E4%BE%8B%EF%BC%88%E4%BA%8C%EF%BC%89/</id>
    <published>2024-01-21T10:35:40.000Z</published>
    <updated>2024-01-21T11:35:06.680Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Ansibleä¸€é”®éƒ¨ç½²å®ä¾‹ï¼ˆäºŒï¼‰</center></h1><table><tr><td bgcolor=#000000><font color="white">åŸºæœ¬ç¯å¢ƒå‡†å¤‡</font></td></tr></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…å¯†é’¥åˆ†å‘</span></span><br><span class="line">[root@ansible ~/roles]<span class="comment">#cat ssh.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">key=<span class="string">&quot;/root/.ssh/id_rsa.pub&quot;</span></span><br><span class="line">pass=<span class="string">&quot;å¯†ç &quot;</span></span><br><span class="line">nodeip=<span class="string">&quot;ipfile&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> ip</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    sshpass -p <span class="variable">$pass</span> ssh-copy-id -i <span class="variable">$key</span> <span class="variable">$ip</span> -o StrictHostKeyChecking=no &amp;&gt; /dev/null &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;ip&#125;</span> sshkey is success.&quot;</span></span><br><span class="line"><span class="keyword">done</span> &lt; <span class="variable">$nodeip</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ipfile</span></span><br><span class="line">[root@ansible ~/roles]<span class="comment">#cat ipfile</span></span><br><span class="line">172.16.1.5</span><br><span class="line">172.16.1.6</span><br><span class="line">172.16.1.7</span><br><span class="line">172.16.1.8</span><br><span class="line">172.16.1.9</span><br><span class="line">172.16.1.51</span><br><span class="line">172.16.1.31</span><br><span class="line">172.16.1.32</span><br><span class="line">172.16.1.41</span><br><span class="line"></span><br><span class="line"><span class="comment"># hosts</span></span><br><span class="line">[root@ansible ~/roles]<span class="comment">#cat hosts</span></span><br><span class="line">[web]</span><br><span class="line">172.16.1.7</span><br><span class="line">172.16.1.8</span><br><span class="line">172.16.1.9</span><br><span class="line">[nfs]</span><br><span class="line">172.16.1.31</span><br><span class="line">172.16.1.32</span><br><span class="line">[db]</span><br><span class="line">172.16.1.51</span><br><span class="line">[lb]</span><br><span class="line">172.16.1.5</span><br><span class="line">172.16.1.6</span><br><span class="line">[backup]</span><br><span class="line">172.16.1.41</span><br></pre></td></tr></table></figure><span id="more"></span><table><tr><td bgcolor=#000000><font color="white">å…¨å±€éƒ¨ç½²æ–‡ä»¶</font></td></tr></table><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles</span>]<span class="comment">#cat site.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">The</span> <span class="string">configuration</span> <span class="string">of</span> <span class="string">this</span> <span class="string">script</span> <span class="string">is</span> <span class="string">as</span> <span class="string">follows</span></span><br><span class="line">  <span class="attr">roles:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">basic</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">basic</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">local_repo</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">local_repo</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">rsync</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">rsync</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">nfs</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">nfs</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">(ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span><span class="string">)</span> <span class="string">or</span> <span class="string">(ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span><span class="string">)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">php</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">php</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">mysql</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">mysql</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">sersync</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">sersync</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">global_nginx</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">global_nginx</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">(ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span><span class="string">)</span> <span class="string">or</span> <span class="string">(ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span><span class="string">)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">wordpress</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">wordpress</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">kod</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">kod</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">tomcat</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">tomcat</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">zrlog</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">zrlog</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">phpadmin</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">phpadmin</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">lb_nginx</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">lb_nginx</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">keepalived</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">keepalived</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">backup</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">backup</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">https</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">https</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">(ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span><span class="string">)</span> <span class="string">or</span> <span class="string">(ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span><span class="string">)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">iptables</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">iptables</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">access_net</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">access_net</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">ntpdate</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">ntpdate</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><table><tr><td bgcolor=#000000><font color="white">åŸºç¡€ä¼˜åŒ–é¡¹</font></td></tr></table><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸ºå„é¡¹æœåŠ¡ç»Ÿä¸€ç”¨æˆ·å‡†å¤‡</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/basic</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nified</span> <span class="string">Users</span> <span class="string">create</span> <span class="string">www</span> <span class="string">group</span></span><br><span class="line">  <span class="attr">group:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">gid:</span> <span class="number">666</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">www</span> <span class="string">user</span></span><br><span class="line">  <span class="attr">user:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">uid:</span> <span class="number">666</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">create_home:</span> <span class="literal">false</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><table><tr><td bgcolor=#000000><font color="white">æœåŠ¡ç¯å¢ƒæ­å»º</font></td></tr></table><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®æœ¬åœ°YUMä»“åº“</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/local_repo</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">soft.repo</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">tasks</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span> <span class="string">directories,</span> <span class="number">2</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/local_repo</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for local_repo</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">repo</span> <span class="string">dir</span> <span class="string">for</span> <span class="string">backup</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/repo</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Mv</span> <span class="string">repo</span> <span class="string">to</span> <span class="string">backupdir</span> <span class="string">/repo</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">mv</span> <span class="string">/etc/yum.repos.d/*</span> <span class="string">/repo</span> <span class="string">warn=false</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">local</span> <span class="string">yum</span> <span class="string">repo</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">soft.repo</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/yum.repos.d</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#- name: Install yum-plugin-priorities</span></span><br><span class="line"><span class="comment">#  yum:</span></span><br><span class="line"><span class="comment">#    name: yum-plugin-priorities</span></span><br><span class="line"><span class="comment">#    state: present</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#- name: Mv repo to backupdir /repo</span></span><br><span class="line"><span class="comment">#  shell: mv /repo/* /etc/yum.repos.d warn=false</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…é…ç½®rsyncæœåŠ¡</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/rsync</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">rsyncd.conf</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">4</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/rsync</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for rsync</span></span><br><span class="line"><span class="comment"># backupä¸ºæœåŠ¡ç«¯ï¼Œå…¶ä½™å…¨éƒ¨ä¸ºå®¢æˆ·ç«¯</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">rsync</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">rsync</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">rsync</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">rsyncd.conf</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;backup&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">backup</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">    <span class="attr">owner:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">www</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/backup/lb</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/backup/web</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/backup/nfs</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/backup/msq</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;backup&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">passwd</span> <span class="string">file</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">content:</span> <span class="string">rsync_backup:nanxi</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/rsync.passwd</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="number">0600</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">rsync</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;backup&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">rsync</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">rsyncd</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;backup&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">rsync</span> <span class="string">client</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">content:</span> <span class="string">nanxi</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/rsync.pass</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="number">0600</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match</span> <span class="string">&quot;backup&quot;</span></span><br><span class="line"><span class="comment"># nfs2ä¸ºæœåŠ¡ç«¯ï¼Œnfs1ä¸ºå®¢æˆ·ç«¯</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs2</span> <span class="string">configure</span> <span class="string">rsync</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">rsyncd.conf</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs2</span> <span class="string">create</span> <span class="string">backup</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/backup/nfs</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">    <span class="attr">owner:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">www</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs2</span> <span class="string">create</span> <span class="string">passwd</span> <span class="string">file</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">content:</span> <span class="string">rsync_backup:nanxi</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/rsync.passwd</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="number">0600</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">rsync</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">rsyncd</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs2</span> <span class="string">start</span> <span class="string">rsync</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">rsyncd</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…nfsæœåŠ¡</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/nfs</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">exports.j2</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">4</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/nfs</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for nfs</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">nfs</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nfs-utils</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">nfs</span> <span class="string">share</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/data/&#123;&#123;</span> <span class="string">item</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">owner:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">wordpress</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kod</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">zrlog</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">phpadmin</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">nfs</span> <span class="string">servser</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">exports.j2</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/exports</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">nfs</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">nfs</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">rpcbind</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">nfs-server</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line">  </span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…é…ç½®PHPæœåŠ¡</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/php</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">php.tar.gz</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">4</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/php</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for php</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Extract</span> <span class="string">php.tar.gz</span> <span class="string">into</span> <span class="string">web</span> <span class="string">/tmp</span></span><br><span class="line">  <span class="attr">unarchive:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">php.tar.gz</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/tmp</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">php</span> <span class="string">into</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">yum</span> <span class="string">-y</span> <span class="string">localinstall</span> <span class="string">/tmp/*.rpm</span> <span class="string">warn=false</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">remove</span> <span class="string">php.*.rpm</span> <span class="string">in</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">rm</span> <span class="string">-rf</span> <span class="string">/tmp/*.rpm</span> <span class="string">warn=false</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">php</span> <span class="string">start</span> <span class="string">user</span> <span class="string">and</span> <span class="string">prepare</span> <span class="string">for</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/php-fpm.d/www.conf</span></span><br><span class="line">    <span class="attr">regexp:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.regex &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">line:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.line &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">php-fpm</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">regex:</span> <span class="string">&#x27;^user&#x27;</span>,<span class="attr">line:</span> <span class="string">user</span> <span class="string">=</span> <span class="string">www</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">regex:</span> <span class="string">&#x27;^group&#x27;</span>,<span class="attr">line:</span> <span class="string">group</span> <span class="string">=</span> <span class="string">www</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">regex:</span> <span class="string">&#x27;^php_value\[session.save_handler\]&#x27;</span>,<span class="attr">line:</span> <span class="string">&quot;;php_value[session.save_handler] = files&quot;</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">regex:</span> <span class="string">&#x27;^php_value\[session.save_path\]&#x27;</span>,<span class="attr">line:</span> <span class="string">&quot;;php_value[session.save_path] = /var/lib/php/session&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">php</span> <span class="string">for</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/php.ini</span></span><br><span class="line">    <span class="attr">regexp:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.regex &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">line:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.line &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">php-fpm</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">regex:</span> <span class="string">&#x27;^session\.save_handler&#x27;</span>,<span class="attr">line:</span> <span class="string">session.save_handler</span> <span class="string">=</span> <span class="string">redis</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">regex:</span> <span class="string">&#x27;^session\.save_path&#x27;</span>,<span class="attr">line:</span> <span class="string">&#x27;session.save_path = &quot;tcp://172.16.1.51:6379&quot;&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">php-fpm</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">php-fpm</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…æ•°æ®åº“ã€redisåŠä¾èµ–</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/mysql</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">3</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/mysql</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for mysql</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">mariadb</span> <span class="string">Server</span> <span class="string">redis</span> <span class="string">and</span> <span class="string">dependent</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">mariadb-server</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">MySQL-python</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">/etc/redis.conf</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/redis.conf</span></span><br><span class="line">    <span class="attr">regexp:</span> <span class="string">&#x27;^bind&#x27;</span></span><br><span class="line">    <span class="attr">line:</span> <span class="string">bind</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.51</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Start</span> <span class="string">mysql</span> <span class="string">and</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">mariadb</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸ºnfsé…ç½®sersyncæœåŠ¡</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/sersync</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">confxml.xml</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">sersync2</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">templates</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span> <span class="string">directories,</span> <span class="number">3</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/sersync</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for sersync</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Cteate</span> <span class="string">sersync</span> <span class="string">dir</span> <span class="string">in</span> <span class="string">nfs1</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/sersync</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Sent</span> <span class="string">sersync</span> <span class="string">to</span> <span class="string">nfs1</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/sersync</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">&#x27;0755&#x27;</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">confxml.xml</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">sersync2</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Modify</span> <span class="string">backup</span> <span class="string">module</span> <span class="string">in</span> <span class="string">nfs2</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/rsyncd.conf</span></span><br><span class="line">    <span class="attr">regexp:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.regex &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">line:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.line &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">regex:</span> <span class="string">&#x27;^\[backup\]&#x27;</span>,<span class="attr">line:</span> <span class="string">&quot;[data]&quot;</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">regex:</span> <span class="string">&#x27;^path&#x27;</span>,<span class="attr">line:</span> <span class="string">path</span> <span class="string">=</span> <span class="string">/data</span> &#125;</span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Restart</span> <span class="string">rsync</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">rsyncd</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Start</span> <span class="string">sersync</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">shell:</span></span><br><span class="line">    <span class="attr">cmd:</span> <span class="string">/etc/sersync/sersync2</span> <span class="string">-dro</span> <span class="string">/etc/sersync/confxml.xml</span></span><br><span class="line">  <span class="attr">ignore_errors:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®å®˜æ–¹nginxæœåŠ¡</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/global_nginx</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">3</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/global_nginx</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for nginx</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">nginx</span> <span class="string">official</span> <span class="string">yum</span></span><br><span class="line">  <span class="attr">yum_repository:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx-stable</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">nginx</span> <span class="string">yum</span> <span class="string">repo</span></span><br><span class="line">    <span class="attr">baseurl:</span> <span class="string">http://nginx.org/packages/centos/$releasever/$basearch/</span></span><br><span class="line">    <span class="attr">gpgcheck:</span> <span class="literal">no</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">official</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">unified</span> <span class="string">users</span> <span class="string">by</span> <span class="string">www</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/nginx/nginx.conf</span></span><br><span class="line">    <span class="attr">regexp:</span> <span class="string">&#x27;^user&#x27;</span></span><br><span class="line">    <span class="attr">line:</span> <span class="string">user</span> <span class="string">www;</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Start</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Ansibleä¸€é”®éƒ¨ç½²å®ä¾‹ï¼ˆäºŒï¼‰&lt;/center&gt;&lt;/h1&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;åŸºæœ¬ç¯å¢ƒå‡†å¤‡&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# å…å¯†é’¥åˆ†å‘&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ansible ~/roles]&lt;span class=&quot;comment&quot;&gt;#cat ssh.sh&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;key=&lt;span class=&quot;string&quot;&gt;&amp;quot;/root/.ssh/id_rsa.pub&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pass=&lt;span class=&quot;string&quot;&gt;&amp;quot;å¯†ç &amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nodeip=&lt;span class=&quot;string&quot;&gt;&amp;quot;ipfile&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;read&lt;/span&gt; ip&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sshpass -p &lt;span class=&quot;variable&quot;&gt;$pass&lt;/span&gt; ssh-copy-id -i &lt;span class=&quot;variable&quot;&gt;$key&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$ip&lt;/span&gt; -o StrictHostKeyChecking=no &amp;amp;&amp;gt; /dev/null &amp;amp;&amp;amp; &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;&lt;span class=&quot;variable&quot;&gt;$&amp;#123;ip&amp;#125;&lt;/span&gt; sshkey is success.&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;done&lt;/span&gt; &amp;lt; &lt;span class=&quot;variable&quot;&gt;$nodeip&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# ipfile&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ansible ~/roles]&lt;span class=&quot;comment&quot;&gt;#cat ipfile&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# hosts&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ansible ~/roles]&lt;span class=&quot;comment&quot;&gt;#cat hosts&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[web]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[nfs]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[db]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[lb]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[backup]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.41&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="æœåŠ¡æ¶æ„" scheme="https://smallflames.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Ansibleä¸€é”®éƒ¨ç½²å®ä¾‹ï¼ˆä¸€ï¼‰</title>
    <link href="https://smallflames.github.io/2024/01/21/Ansible%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E5%AE%9E%E4%BE%8B%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>https://smallflames.github.io/2024/01/21/Ansible%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E5%AE%9E%E4%BE%8B%EF%BC%88%E4%B8%80%EF%BC%89/</id>
    <published>2024-01-21T09:25:32.000Z</published>
    <updated>2024-01-21T15:04:35.484Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Ansibleä¸€é”®éƒ¨ç½²å®ä¾‹ï¼ˆä¸€ï¼‰</center></h1><p>â€ƒâ€ƒæˆ‘ä»¬ä»Šå¤©è¦ç”¨Ansibleå®ç°ä¸€é”®éƒ¨ç½²çš„æ¡†æ¶å¤§è‡´å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240121173432410.png" alt="image-20240121173432410"></p><p>â€ƒâ€ƒå—æ±åœ¨è¿™é‡Œå¯¹æœ¬æ¬¡æ¡†æ¶åšä¸€ä¸ªç®€å•çš„ä»‹ç»ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„æ¶æ„ï¼Œè™½ç„¶å¯èƒ½ä¸å¦‚å®é™…åº”ç”¨ä¸­çš„å¤æ‚ï¼Œä½†æ˜¯éº»é›€è™½å°ï¼Œäº¦äº”è„ä¿±å…¨ã€‚ä»ç”¨æˆ·è§’åº¦æ¥çœ‹ï¼Œå½“æˆ‘ä»¬çš„ç”¨æˆ·è®¿é—®æˆ‘ä»¬å…¬å¸çš„ç½‘ç«™æ—¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¼šç»ç”±DNSæ™ºèƒ½è°ƒåº¦ç³»ç»Ÿç»™ç”¨æˆ·è¿”å›è·ç¦»ç”¨æˆ·åœ°åŸŸè·ç¦»æœ€è¿‘çš„æœåŠ¡å™¨åœ°å€ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„CDNæœåŠ¡å™¨ï¼Œå®ƒä¼šé»˜è®¤å­˜å‚¨æˆ‘ä»¬webæœåŠ¡ä¸ŠåŸºæœ¬æ‰€æœ‰çš„é™æ€èµ„æºï¼ˆæˆ–åŠ¨æ€å†…å®¹ã€æµåª’ä½“æ–‡ä»¶ï¼‰ä»¥æé«˜ç”¨æˆ·çš„è®¿é—®ä½“éªŒï¼Œå¦‚æœCDNä¸Šæ²¡æœ‰ç”¨æˆ·æ‰€è¯·æ±‚çš„èµ„æºï¼Œæ­¤æ—¶ä¼šå‡ºç°å›æºã€‚<span id="more"></span>å½“æˆ‘ä»¬çš„ç”¨æˆ·ç›´æ¥è®¿é—®æºç«™çš„æ—¶å€™ï¼Œä¼šç»ç”±æˆ‘ä»¬å‰ç«¯çš„ç½‘ç»œé˜²ç«å¢™è¿‡æ»¤éæ³•æµé‡ï¼Œç„¶ä¼šåˆ°è¾¾æˆ‘ä»¬çš„è´Ÿè½½ï¼Œæœ¬æ¬¡æ¶æ„ä¸­æˆ‘ä»¬ä½¿ç”¨ä¸¤å°æœåŠ¡å™¨åº”ç”¨NGINXä½œä¸ºè´Ÿè½½å‡è¡¡ï¼Œå¹¶åœ¨ä¸¤å°æœåŠ¡å™¨ä¹‹é—´é€šè¿‡keepalivedå®ç°é«˜å¯ç”¨ã€‚è¯·æ±‚ç»ç”±è´Ÿè½½å‡è¡¡çš„è°ƒåº¦ç®—æ³•åè½¬å‘è‡³æˆ‘ä»¬çœŸå®çš„webæœåŠ¡å™¨ï¼Œè¿™é‡ŒwebæœåŠ¡å™¨åœ¨å®é™…ä¸­åŸºæœ¬éƒ½æ˜¯å¤šèŠ‚ç‚¹çš„ï¼Œæˆ‘ä»¬ç§°ä¹‹é›†ç¾¤ï¼Œå—æ±è¿™é‡Œä½¿ç”¨ä¸‰å°æœåŠ¡å™¨æ¥è¿›è¡Œæ¨¡æ‹Ÿã€‚webç«¯çš„é™æ€æ–‡ä»¶ç”±åç«¯çš„ä¸¤å°NFSæœåŠ¡å™¨å­˜å‚¨ï¼Œä»–ä»¬ä¹‹é—´çš„æ•°æ®å®æ—¶åŒæ­¥çš„ï¼Œå¹¶ä¸”å…·å¤‡é«˜å¯ç”¨ï¼Œä»¥é¿å…å•ç‚¹æ•…éšœï¼ŒåŒæ—¶å‰ç«¯æ‰€äº§ç”Ÿçš„ä¸šåŠ¡æ•°æ®æ•°æ®åº“æ–‡ä»¶éƒ½ä¼šå­˜æ”¾åœ¨åç«¯çš„æ•°æ®åº“ã€‚æœ€åä¸ä¸šåŠ¡ç›´æ¥ç›¸å…³çš„æœåŠ¡å™¨ï¼ˆæœ¬æ­¤æ¶æ„ä¸­æœ‰8å°ï¼‰å‡ä¼šå®šæ—¶å°†é‡è¦æ–‡ä»¶å¤‡ä»½è‡³backupæœåŠ¡å™¨ã€‚ä»è¿ç»´ç®¡ç†äººå‘˜çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬ä¼šç»ç”±VPNè¿›å…¥å…¬å¸çš„jumpserveræœåŠ¡å™¨ï¼ˆç›´æ¥è¶Šè¿‡ç”¨æˆ·è·¯å¾„çš„é˜²ç«å¢™è¿›å…¥å†…éƒ¨ï¼‰ï¼Œåº•å±‚é€šè¿‡Ansibleè‡ªåŠ¨åŒ–ç®¡ç†å·¥å…·æ¥å¯¹å…¬å¸çš„æœåŠ¡å™¨è¿›è¡Œç®¡ç†ï¼Œç›‘æ§å’Œç»´æŠ¤ã€‚ä¸ºäº†æé«˜è„šæœ¬å®‰è£…æœåŠ¡çš„æ‰§è¡Œæ•ˆç‡ï¼Œæˆ‘ä»¬é¢å¤–æ­å»ºäº†ä¸€ä¸ªæœ¬åœ°ä»“åº“ä¸ºæä¾›å†…éƒ¨å±€åŸŸç½‘å®‰è£…æœåŠ¡ä½¿ç”¨ã€‚</p><p>â€ƒâ€ƒï¼ˆå—æ±å¹¶æ²¡æœ‰å®ç°æ¶æ„å†…çš„æ‰€æœ‰åŠŸèƒ½ï¼Œæœ¬æ¬¡å±•ç¤ºåªä¸ºå¸®åŠ©å¤§å®¶æé«˜å¯¹Ansibleè‡ªåŠ¨åŒ–ç®¡ç†å·¥å…·çš„åº”ç”¨ï¼‰è¯¦ç»†Playbookè§’è‰²åˆ†å¸ƒå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240121182411299.png" alt="image-20240121182411299"></p><p>â€ƒâ€ƒæ¥ä¸‹æ¥å—æ±ä¼šç”¨å‡ ç¯‡æ–‡ç« ä¾æ¬¡å¼€æ”¾æºç å±•ç¤ºï¼Œå¤§å®¶ä»…ä¾›å‚è€ƒï¼Œå¯è‡ªè¡Œå®è·µç»ƒä¹ â€¦â€¦</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Ansibleä¸€é”®éƒ¨ç½²å®ä¾‹ï¼ˆä¸€ï¼‰&lt;/center&gt;&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒæˆ‘ä»¬ä»Šå¤©è¦ç”¨Ansibleå®ç°ä¸€é”®éƒ¨ç½²çš„æ¡†æ¶å¤§è‡´å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240121173432410.png&quot; alt=&quot;image-20240121173432410&quot;&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒå—æ±åœ¨è¿™é‡Œå¯¹æœ¬æ¬¡æ¡†æ¶åšä¸€ä¸ªç®€å•çš„ä»‹ç»ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„æ¶æ„ï¼Œè™½ç„¶å¯èƒ½ä¸å¦‚å®é™…åº”ç”¨ä¸­çš„å¤æ‚ï¼Œä½†æ˜¯éº»é›€è™½å°ï¼Œäº¦äº”è„ä¿±å…¨ã€‚ä»ç”¨æˆ·è§’åº¦æ¥çœ‹ï¼Œå½“æˆ‘ä»¬çš„ç”¨æˆ·è®¿é—®æˆ‘ä»¬å…¬å¸çš„ç½‘ç«™æ—¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¼šç»ç”±DNSæ™ºèƒ½è°ƒåº¦ç³»ç»Ÿç»™ç”¨æˆ·è¿”å›è·ç¦»ç”¨æˆ·åœ°åŸŸè·ç¦»æœ€è¿‘çš„æœåŠ¡å™¨åœ°å€ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„CDNæœåŠ¡å™¨ï¼Œå®ƒä¼šé»˜è®¤å­˜å‚¨æˆ‘ä»¬webæœåŠ¡ä¸ŠåŸºæœ¬æ‰€æœ‰çš„é™æ€èµ„æºï¼ˆæˆ–åŠ¨æ€å†…å®¹ã€æµåª’ä½“æ–‡ä»¶ï¼‰ä»¥æé«˜ç”¨æˆ·çš„è®¿é—®ä½“éªŒï¼Œå¦‚æœCDNä¸Šæ²¡æœ‰ç”¨æˆ·æ‰€è¯·æ±‚çš„èµ„æºï¼Œæ­¤æ—¶ä¼šå‡ºç°å›æºã€‚</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="æœåŠ¡æ¶æ„" scheme="https://smallflames.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Ansible Jinja2æ¨¡æ¿</title>
    <link href="https://smallflames.github.io/2024/01/04/Jinja2%E6%A8%A1%E6%9D%BF/"/>
    <id>https://smallflames.github.io/2024/01/04/Jinja2%E6%A8%A1%E6%9D%BF/</id>
    <published>2024-01-04T12:49:49.000Z</published>
    <updated>2024-01-04T13:22:34.674Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Ansible Jinja2æ¨¡æ¿</center></h1><p>â€ƒâ€ƒå¦‚æœæˆ‘ä»¬çš„éœ€æ±‚æ˜¯åœ¨100å°ä¸»æœºä¸Šå®‰è£…nginxï¼Œæ¯å°nginxçš„ç«¯å£éƒ½ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬å¦‚ä½•è§£å†³å‘¢ï¼Ÿå¾ˆæ£˜æ‰‹çš„é—®é¢˜ï¼Œä½†æ˜¯jinja2å¯ä»¥ï¼ŒAnsibleé€šå¸¸ä¼šä½¿ç”¨jinja2æ¨¡æ¿æ¥ä¿®æ”¹è¢«ç®¡ç†ä¸»æœºçš„é…ç½®æ–‡ä»¶ï¼Œå°¤å…¶åœ¨æ‰¹é‡ä¿®æ”¹å¤šå°ä¸»æœºçš„é…ç½®æ–‡ä»¶æ—¶ï¼Œå¾ˆä¾¿æ·ã€‚Jinja2æ–‡ä»¶åç¼€é€šå¸¸ä¸º.j2ï¼Œæ˜¯ä¸€ä¸ªé‡Œé¢åŒ…å«å˜é‡çš„æ¨¡æ¿æ–‡ä»¶ï¼Œä½¿ç”¨templateæ¨¡å—è°ƒç”¨ã€‚<font color="gray"><em>ï¼ˆtemplateæ¨¡å—å’Œcopyæ¨¡å—ä¸€æ ·ï¼Œéƒ½æ˜¯å°†æ–‡ä»¶å¤åˆ¶åˆ°è¿œç«¯ä¸»æœºä¸Šå»ï¼ŒåŒºåˆ«åœ¨äºtemplateæ¨¡å—å¯ä»¥è·å–åˆ°æ–‡ä»¶ä¸­çš„å˜é‡ï¼Œè€Œcopyåˆ™æ˜¯åŸå°ä¸åŠ¨çš„æŠŠæ–‡ä»¶å†…å®¹å¤åˆ¶è¿‡å»ï¼‰</em></font></p><span id="more"></span><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible ~]#cat keepalived.j2</span><br><span class="line">global_defs &#123;</span><br><span class="line">    router_id &#123;&#123; ansible_fqdn &#125;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">&#123;% if ansible_fqdn == &quot;web01&quot; %&#125;</span><br><span class="line">    state MASTER</span><br><span class="line">    priority 150</span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    state BACKUP</span><br><span class="line">    priority 100</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 50</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;         </span><br><span class="line">        1.1.1.1</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104211506521.png" alt="image-20240104211506521"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104211849054.png" alt="image-20240104211849054"></p><blockquote><p>Ansibleå…è®¸jinja2æ¨¡æ¿ä¸­ä½¿ç”¨æ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯ï¼Œä½†æ˜¯ä¸å…è®¸åœ¨playbookä¸­ä½¿ç”¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¾ªç¯è¡¨è¾¾å¼</span></span><br><span class="line">&#123;% <span class="keyword">for</span> i <span class="keyword">in</span> EXPR %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¡ä»¶åˆ¤æ–­</span></span><br><span class="line">&#123;% <span class="keyword">if</span> EXPR %&#125;</span><br><span class="line">&#123;% <span class="keyword">elif</span> EXPR %&#125;</span><br><span class="line">&#123;% <span class="keyword">else</span> %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨é‡Š</span></span><br><span class="line">&#123;<span class="comment"># COMMENT #&#125;</span></span><br></pre></td></tr></table></figure></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Ansible Jinja2æ¨¡æ¿&lt;/center&gt;&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒå¦‚æœæˆ‘ä»¬çš„éœ€æ±‚æ˜¯åœ¨100å°ä¸»æœºä¸Šå®‰è£…nginxï¼Œæ¯å°nginxçš„ç«¯å£éƒ½ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬å¦‚ä½•è§£å†³å‘¢ï¼Ÿå¾ˆæ£˜æ‰‹çš„é—®é¢˜ï¼Œä½†æ˜¯jinja2å¯ä»¥ï¼ŒAnsibleé€šå¸¸ä¼šä½¿ç”¨jinja2æ¨¡æ¿æ¥ä¿®æ”¹è¢«ç®¡ç†ä¸»æœºçš„é…ç½®æ–‡ä»¶ï¼Œå°¤å…¶åœ¨æ‰¹é‡ä¿®æ”¹å¤šå°ä¸»æœºçš„é…ç½®æ–‡ä»¶æ—¶ï¼Œå¾ˆä¾¿æ·ã€‚Jinja2æ–‡ä»¶åç¼€é€šå¸¸ä¸º.j2ï¼Œæ˜¯ä¸€ä¸ªé‡Œé¢åŒ…å«å˜é‡çš„æ¨¡æ¿æ–‡ä»¶ï¼Œä½¿ç”¨templateæ¨¡å—è°ƒç”¨ã€‚&lt;font color=&quot;gray&quot;&gt;&lt;em&gt;ï¼ˆtemplateæ¨¡å—å’Œcopyæ¨¡å—ä¸€æ ·ï¼Œéƒ½æ˜¯å°†æ–‡ä»¶å¤åˆ¶åˆ°è¿œç«¯ä¸»æœºä¸Šå»ï¼ŒåŒºåˆ«åœ¨äºtemplateæ¨¡å—å¯ä»¥è·å–åˆ°æ–‡ä»¶ä¸­çš„å˜é‡ï¼Œè€Œcopyåˆ™æ˜¯åŸå°ä¸åŠ¨çš„æŠŠæ–‡ä»¶å†…å®¹å¤åˆ¶è¿‡å»ï¼‰&lt;/em&gt;&lt;/font&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="æœåŠ¡æ¶æ„" scheme="https://smallflames.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Ansibleæµç¨‹æ§åˆ¶</title>
    <link href="https://smallflames.github.io/2024/01/04/Ansible%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/"/>
    <id>https://smallflames.github.io/2024/01/04/Ansible%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/</id>
    <published>2024-01-04T10:42:51.000Z</published>
    <updated>2024-01-04T12:37:44.110Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Ansibleæµç¨‹æ§åˆ¶</center></h1><p>â€ƒâ€ƒä¸ç®¡æ˜¯shellè¿˜æ˜¯å„å¤§ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæµç¨‹æ§åˆ¶ã€æ¡ä»¶åˆ¤æ–­ã€å¾ªç¯è¿™äº›éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨Ansibleçš„è¿‡ç¨‹ä¸­ï¼Œæ¡ä»¶åˆ¤æ–­çš„ä½¿ç”¨é¢‘ç‡åŒæ ·æå…¶çš„é«˜ï¼Œæ˜¯æˆ‘ä»¬å¿…é¡»æŒæ¡çš„æŠ€èƒ½ã€‚</p><h2 id="ä¸€ã€whenåˆ¤æ–­">ä¸€ã€whenåˆ¤æ–­</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webs</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span>  <span class="string">when</span> <span class="string">ceshi</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">htop</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">tree</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">==</span> <span class="string">&quot;web01&quot;</span>   <span class="comment">### å½“ä¸»æœºåä¸ºweb01æ—¶æ‰§è¡Œæœ¬æ¡ä»»åŠ¡</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104191250989.png" alt="image-20240104191250989"></p><span id="more"></span><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">whenåˆ¤æ–­è¯­æ³•:</span><br><span class="line">when: ansible_hostname == <span class="string">&quot;web01&quot;</span>        <span class="comment"># å®Œå…¨åŒ¹é…</span></span><br><span class="line">when: ansible_hostname != <span class="string">&quot;web01&quot;</span>     <span class="comment"># å–å,å½“ä¸»æœºåä¸ä¸ºweb01æ—¶ä½¿ç”¨</span></span><br><span class="line">when: ansible_hostname is not match <span class="string">&quot;web01&quot;</span> <span class="comment"># åŒä¸Š</span></span><br><span class="line">when: ansible_hostname is match <span class="string">&quot;web&quot;</span>    <span class="comment"># åŒ¹é…ä¸»æœºååŒ…å«webçš„å®¢æˆ·ç«¯</span></span><br><span class="line">when: ansible_hostname is search <span class="string">&quot;web&quot;</span>   <span class="comment"># æœç´¢ä¸»æœºååŒ…å«webçš„å®¢æˆ·ç«¯</span></span><br><span class="line"> </span><br><span class="line">when: ansible_default_ipv4.address is  match <span class="string">&quot;10.0.0.7&quot;</span>  <span class="comment"># åŒ¹é…IPåœ°å€</span></span><br><span class="line">when: (ansible_default_ipv4.address is  match <span class="string">&quot;10.0.0.7&quot;</span>) or (ansible_hostname == <span class="string">&quot;web02&quot;</span>)      <span class="comment"># æˆ–è€…</span></span><br><span class="line">(ansible_default_ipv4.address is  match <span class="string">&quot;10.0.0.7&quot;</span>) and (ansible_hostname == <span class="string">&quot;web02&quot;</span>) <span class="comment"># å¹¶ä¸”</span></span><br><span class="line">when:  <span class="comment"># å¹¶ä¸”å…³ç³»</span></span><br><span class="line">  - ansible_default_ipv4.address is  match <span class="string">&quot;10.0.0.7&quot;</span> </span><br><span class="line">  - ansible_hostname == <span class="string">&quot;web02&quot;</span></span><br><span class="line">when: ansible_facts.distribution_major_version &gt; <span class="string">&quot;6&quot;</span>  <span class="comment"># ä½¿ç”¨æ•°å­—è¿›è¡Œåˆ¤æ–­æ¯”è¾ƒ</span></span><br></pre></td></tr></table></figure><p>æ¡ˆä¾‹. æ ¹æ®nginxçš„è¿”å›ç»“æœæ¥åˆ¤æ–­æ˜¯å¦é‡å¯nginx</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webs</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">install</span> <span class="string">web</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span> <span class="string">offical</span> <span class="string">yum</span></span><br><span class="line">      <span class="attr">yum_repository:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">nginx</span> <span class="string">stable</span> <span class="string">repo</span></span><br><span class="line">        <span class="attr">gpgcheck:</span> <span class="literal">no</span></span><br><span class="line">        <span class="attr">baseurl:</span> <span class="string">http://nginx.org/packages/centos/$releasever/$basearch/</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configer</span> <span class="string">nginx.conf</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./nginx.conf</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/nginx/nginx.conf</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">check</span> <span class="string">nginx</span> <span class="string">syntax</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">nginx</span> <span class="string">-t</span></span><br><span class="line">      <span class="attr">register:</span> <span class="string">result</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">      <span class="attr">when:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">result</span> <span class="string">is</span> <span class="string">search</span> <span class="string">&quot;ok&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">ansible_hostname</span> <span class="string">==</span> <span class="string">&quot;web01&quot;</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104192956127.png" alt="image-20240104192956127"></p><h2 id="äºŒã€å­—å…¸å¾ªç¯">äºŒã€å­—å…¸å¾ªç¯</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### æ³¨æ„ï¼šitemæ˜¯å›ºå®šçš„å˜é‡åç§°ï¼Œä¸èƒ½è‡ªå®šä¹‰</span></span><br><span class="line"><span class="comment">### æœ‰äº†itemå˜é‡ï¼Œæˆ‘ä»¬å°±å¯ä»¥å­—å…¸å¾ªç¯ä¸€æ¬¡å®‰è£…å¤šä¸ªæœåŠ¡,æœ‰å¾ˆé«˜çš„å¯æ‹“å±•æ€§</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webs</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span>  <span class="string">loop</span> <span class="string">ceshi</span></span><br><span class="line">      <span class="attr">file:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.name &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.owner &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.group &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.mode &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">touch</span></span><br><span class="line">      <span class="attr">loop:</span></span><br><span class="line">        <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="number">1.</span><span class="string">txt</span>,<span class="attr">owner:</span> <span class="string">root</span>,<span class="attr">group:</span> <span class="string">root</span>,<span class="attr">mode:</span> <span class="string">&#x27;0666&#x27;</span> &#125;</span><br><span class="line">        <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="number">2.</span><span class="string">txt</span>,<span class="attr">owner:</span> <span class="string">www</span>,<span class="attr">group:</span> <span class="string">www</span>,<span class="attr">mode:</span> <span class="string">&#x27;0600&#x27;</span> &#125;</span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">==</span> <span class="string">&quot;web01&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104194111250.png" alt="image-20240104194111250"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@web01 ~]<span class="comment">#ll</span></span><br><span class="line">total 0</span><br><span class="line">-rw-rw-rw- 1 root root 0 Jan  4 19:40 1.txt</span><br><span class="line">-rw------- 1 www  www  0 Jan  4 19:40 2.txt</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€handlersäº‹ä»¶è§¦å‘æ¨¡å—">ä¸‰ã€handlersäº‹ä»¶è§¦å‘æ¨¡å—</h2><p><strong>åŒæ ·ä»¥å®‰è£…nginxä¸ºä¾‹ï¼Œæ ¹æ®é…ç½®æ–‡ä»¶æ˜¯å¦ä¿®æ”¹æ¥è§¦å‘æ˜¯å¦é‡å¯nginx</strong></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104200922643.png" alt="image-20240104200922643"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104200156161.png" alt="image-20240104200156161"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104200053928.png" alt="image-20240104200053928"></p><div class="warning"><p><strong>handlersæ¨¡å—ä½¿ç”¨æ³¨æ„äº‹é¡¹</strong></p><ol><li class="lvl-3">æ— è®ºå¤šå°‘ä¸ªtaské€šçŸ¥äº†ç›¸åŒçš„handlersï¼Œhandlersä»…ä¼šåœ¨æ‰€æœ‰tasksç»“æŸåè¿è¡Œä¸€æ¬¡ï¼›</li><li class="lvl-3">handlersåªæœ‰åœ¨å…¶æ‰€åœ¨çš„ä»»åŠ¡è¢«æ‰§è¡Œæ—¶ï¼Œæ‰ä¼šè¢«è¿è¡Œï¼›</li><li class="lvl-3">handlersåªä¼šåœ¨æ¯ä¸€ä¸ªplayçš„æœ«å°¾è¿è¡Œä¸€æ¬¡ï¼Œæƒ³åœ¨ä¸€ä¸ªplaybookä¸­é—´è¿è¡Œhandlersï¼Œåˆ™éœ€è¦ä½¿ç”¨metaæ¨¡å—æ¥å®ç°ï¼Œå¦‚ï¼š <code>-meta: flush_handlers</code> ï¼›</li><li class="lvl-3">ä¸èƒ½ä½¿ç”¨handlersæ›¿ä»£tasksï¼Œhandlerså’Œtasksæ˜¯åŒçº§çš„ï¼Œåœ¨handlersä¸‹å†™çš„ä»»åŠ¡åªç”¨è¢«è°ƒç”¨æ‰èƒ½è¿è¡Œ</li></ol></div><h2 id="å››ã€playbookæ–‡ä»¶å¤ç”¨">å››ã€playbookæ–‡ä»¶å¤ç”¨</h2><blockquote><p>ä¸€ä¸ªyamlæ–‡ä»¶æ‰§è¡Œï¼ˆå¼•ç”¨ï¼‰å¤šä¸ªpalybook</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@ansible</span> <span class="string">~</span>]<span class="comment"># cat site.yml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webs</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">include_tasks:</span> <span class="string">install_nginx.yml</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">==</span> <span class="string">&quot;web01&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">include_tasks:</span> <span class="string">install_nfs.yml</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">==</span> <span class="string">&quot;web02&quot;</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~</span>]<span class="comment"># cat install_nginx.yml </span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">Nginx</span> <span class="string">Server</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~</span>]<span class="comment"># cat install_nfs.yml </span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">nfs</span> <span class="string">Server</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nfs-utils</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br></pre></td></tr></table></figure></blockquote><div class='spoiler collapsed'>    <div class='spoiler-title'>        Playbookä»»åŠ¡æ ‡ç­¾    </div>    <div class='spoiler-content'>        <p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104203741222.png" alt="image-20240104203741222"></p>    </div></div><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Ansibleæµç¨‹æ§åˆ¶&lt;/center&gt;&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒä¸ç®¡æ˜¯shellè¿˜æ˜¯å„å¤§ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæµç¨‹æ§åˆ¶ã€æ¡ä»¶åˆ¤æ–­ã€å¾ªç¯è¿™äº›éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨Ansibleçš„è¿‡ç¨‹ä¸­ï¼Œæ¡ä»¶åˆ¤æ–­çš„ä½¿ç”¨é¢‘ç‡åŒæ ·æå…¶çš„é«˜ï¼Œæ˜¯æˆ‘ä»¬å¿…é¡»æŒæ¡çš„æŠ€èƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä¸€ã€whenåˆ¤æ–­&quot;&gt;ä¸€ã€whenåˆ¤æ–­&lt;/h2&gt;
&lt;figure class=&quot;highlight yaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;hosts:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;webs&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;tasks:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt;  &lt;span class=&quot;string&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ceshi&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;yum:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;htop&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;tree&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;state:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;present&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;web01&amp;quot;&lt;/span&gt;   &lt;span class=&quot;comment&quot;&gt;### å½“ä¸»æœºåä¸ºweb01æ—¶æ‰§è¡Œæœ¬æ¡ä»»åŠ¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104191250989.png&quot; alt=&quot;image-20240104191250989&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="æœåŠ¡æ¶æ„" scheme="https://smallflames.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Ansibleå˜é‡å®šä¹‰</title>
    <link href="https://smallflames.github.io/2024/01/03/Ansible%E5%8F%98%E9%87%8F%E5%AE%9A%E4%B9%89/"/>
    <id>https://smallflames.github.io/2024/01/03/Ansible%E5%8F%98%E9%87%8F%E5%AE%9A%E4%B9%89/</id>
    <published>2024-01-03T10:29:22.000Z</published>
    <updated>2024-01-04T10:38:06.483Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Ansibleå˜é‡</center></h1><h2 id="ä¸€ã€åœ¨å‘½ä»¤è¡Œä¸­å®šä¹‰å˜é‡">ä¸€ã€åœ¨å‘½ä»¤è¡Œä¸­å®šä¹‰å˜é‡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible ~]<span class="comment">#ansible webs -a &#x27;echo &#123;&#123; a &#125;&#125;å—æ±&#123;&#123; b &#125;&#125;&#x27; -e &#x27;a=æ¬¢è¿æ¥åˆ°&#x27; -e &#x27;b=çš„ä¸ªäººä¸–ç•Œ&#x27;</span></span><br><span class="line">192.168.10.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">æ¬¢è¿æ¥åˆ°å—æ±çš„ä¸ªäººä¸–ç•Œ</span><br><span class="line">192.168.10.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">æ¬¢è¿æ¥åˆ°å—æ±çš„ä¸ªäººä¸–ç•Œ</span><br></pre></td></tr></table></figure><h2 id="äºŒã€åœ¨playä¸­å®šä¹‰å˜é‡">äºŒã€åœ¨playä¸­å®šä¹‰å˜é‡</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.7</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">packages:</span> <span class="string">htop</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> &#123;&#123; <span class="string">packages</span> &#125;&#125;</span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; packages &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240103190009022.png" alt="image-20240103190009022"></p><span id="more"></span><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240103190951093.png" alt="image-20240103190951093"></p><div class='spoiler collapsed'>    <div class='spoiler-title'>        å°†å•ç‹¬å˜é‡å†™å…¥ä¸€ä¸ªyamlæ ¼å¼æ–‡ä»¶åœ¨playä¸­å¼•ç”¨    </div>    <div class='spoiler-content'>        <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible ~]<span class="comment"># cat vars.yml </span></span><br><span class="line">pk1: lrzsz</span><br><span class="line">pk2: wget</span><br><span class="line">pk3: tree</span><br><span class="line">[root@ansible ~]<span class="comment"># cat vars1.yml </span></span><br><span class="line">pk4: cowsay</span><br><span class="line"></span><br><span class="line">[root@ansible ~]<span class="comment"># cat ceshi.yml</span></span><br><span class="line">- hosts: webs</span><br><span class="line">  vars_files: </span><br><span class="line">    - vars.yml</span><br><span class="line">    - vars1.yml</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Install packsges</span><br><span class="line">      yum:</span><br><span class="line">        name: </span><br><span class="line">          - <span class="string">&quot;&#123;&#123; pk1 &#125;&#125;&quot;</span></span><br><span class="line">          - <span class="string">&quot;&#123;&#123; pk4 &#125;&#125;&quot;</span></span><br><span class="line">        state: present</span><br></pre></td></tr></table></figure>    </div></div><h2 id="ä¸‰ã€åœ¨ä¸»æœºèµ„äº§ä¸­å®šä¹‰å˜é‡">ä¸‰ã€åœ¨ä¸»æœºèµ„äº§ä¸­å®šä¹‰å˜é‡</h2><h3 id="1ã€ä¸»æœºå˜é‡">1ã€ä¸»æœºå˜é‡</h3><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240103191838871.png" alt="image-20240103191838871"></p><h3 id="2ã€ä¸»æœºç»„å˜é‡">2ã€ä¸»æœºç»„å˜é‡</h3><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240103192548782.png" alt="image-20240103192548782"></p><div class="success"><p><strong><center>å˜é‡å®šä¹‰çš„ä¼˜å…ˆçº§ï¼šå‘½ä»¤è¡Œå˜é‡&gt;playä¸­çš„å˜é‡&gt;ä¸»æœºå˜é‡&gt;ä¸»æœºç»„å˜é‡</center></strong></p></div><h2 id="å››ã€å®˜æ–¹æ¨èæ–¹å¼å®šä¹‰å˜é‡">å››ã€å®˜æ–¹æ¨èæ–¹å¼å®šä¹‰å˜é‡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">1.å®šä¹‰å˜é‡ ç»™ç»„å®šä¹‰å˜é‡</span><br><span class="line">[root@ansible ~]<span class="comment"># mkdir group_vars</span></span><br><span class="line">[root@ansible ~]<span class="comment"># cat group_vars/webs.yml</span></span><br><span class="line">pk1: wget</span><br><span class="line">pk2: tree</span><br><span class="line">2.è°ƒç”¨å˜é‡</span><br><span class="line">[root@ansible ~]<span class="comment"># cat ceshi.yml</span></span><br><span class="line">- hosts: webs</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Install packsges</span><br><span class="line">      yum:</span><br><span class="line">        name: </span><br><span class="line">          - <span class="string">&quot;&#123;&#123; pk1 &#125;&#125;&quot;</span></span><br><span class="line">          - <span class="string">&quot;&#123;&#123; pk2 &#125;&#125;&quot;</span></span><br><span class="line">        state: present</span><br><span class="line"></span><br><span class="line">å•å°å®šä¹‰å˜é‡ï¼š</span><br><span class="line">1.å®šä¹‰å˜é‡</span><br><span class="line">[root@ansible ~]<span class="comment"># mkdir host_vars</span></span><br><span class="line">[root@ansible ~]<span class="comment"># cat host_vars/192.168.10.8.yml</span></span><br><span class="line">pk1: wget</span><br><span class="line">pk2: tree </span><br><span class="line"></span><br><span class="line">2.è°ƒç”¨å˜é‡</span><br><span class="line">[root@ansible ~]<span class="comment"># cat ceshi.yml </span></span><br><span class="line">- hosts: webs</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Install packsges</span><br><span class="line">      yum:</span><br><span class="line">        name: </span><br><span class="line">          - <span class="string">&quot;&#123;&#123; pk1 &#125;&#125;&quot;</span></span><br><span class="line">          - <span class="string">&quot;&#123;&#123; pk2 &#125;&#125;&quot;</span></span><br><span class="line">        state: present</span><br></pre></td></tr></table></figure><h2 id="äº”ã€ä½¿ç”¨å˜é‡åˆ›å»ºæ–‡ä»¶">äº”ã€ä½¿ç”¨å˜é‡åˆ›å»ºæ–‡ä»¶</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">æ¡ˆä¾‹.ä½¿ç”¨å˜é‡åˆ›å»ºä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~</span>]<span class="comment"># cat ceshi.yml </span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.7</span></span><br><span class="line">  <span class="attr">vars:</span> </span><br><span class="line">     <span class="bullet">-</span> <span class="attr">ip:</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.7</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">web01</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">packsges</span></span><br><span class="line">      <span class="attr">file:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/root/&#123;&#123;</span> <span class="string">host</span> <span class="string">&#125;&#125;_&#123;&#123;</span> <span class="string">ip</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line"></span><br><span class="line"><span class="string">æ¡ˆä¾‹.ä½¿ç”¨ansibleçš„å†…ç½®å˜é‡</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~</span>]<span class="comment"># cat ceshi.yml </span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.7</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">packsges</span></span><br><span class="line">      <span class="attr">file:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/root/&#123;&#123;</span> <span class="string">ansible_hostname</span> <span class="string">&#125;&#125;_&#123;&#123;</span> <span class="string">ansible_default_ipv4.address</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">directory</span></span><br></pre></td></tr></table></figure><h2 id="å…­ã€å˜é‡æ³¨å†Œ">å…­ã€å˜é‡æ³¨å†Œ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å½“æˆ‘ä»¬ä½¿ç”¨ansibleæ—¶ï¼Œæƒ³è¦æ˜¾ç¤ºå‘½ä»¤è¿”å›çš„ç»“æœï¼Œå°±å¯ä»¥ä½¿ç”¨å˜é‡æ³¨å†Œçš„æ–¹å¼</span></span><br><span class="line">- hosts: 192.168.10.7</span><br><span class="line">  tasks:</span><br><span class="line">    - name: ceshi vars register</span><br><span class="line">      shell: <span class="built_in">ls</span> -l /</span><br><span class="line">      register: ll                   <span class="comment">#   å®šä¹‰å˜é‡æ³¨å†Œ åç§°è‡ªå®šä¹‰  </span></span><br><span class="line">      </span><br><span class="line">    - name: <span class="built_in">print</span> list</span><br><span class="line">      debug:</span><br><span class="line">        msg: <span class="string">&quot;&#123;&#123; ll.stdout_lines &#125;&#125;&quot;</span> <span class="comment">#   è°ƒç”¨å˜é‡ï¼Œå¹¶æŒ‡å®šè¾“å‡ºç‰¹å®šå­—æ®µ</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104183013626.png" alt="image-20240104183013626"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Ansibleå˜é‡&lt;/center&gt;&lt;/h1&gt;
&lt;h2 id=&quot;ä¸€ã€åœ¨å‘½ä»¤è¡Œä¸­å®šä¹‰å˜é‡&quot;&gt;ä¸€ã€åœ¨å‘½ä»¤è¡Œä¸­å®šä¹‰å˜é‡&lt;/h2&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@ansible ~]&lt;span class=&quot;comment&quot;&gt;#ansible webs -a &amp;#x27;echo &amp;#123;&amp;#123; a &amp;#125;&amp;#125;å—æ±&amp;#123;&amp;#123; b &amp;#125;&amp;#125;&amp;#x27; -e &amp;#x27;a=æ¬¢è¿æ¥åˆ°&amp;#x27; -e &amp;#x27;b=çš„ä¸ªäººä¸–ç•Œ&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;192.168.10.8 | CHANGED | rc=0 &amp;gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;æ¬¢è¿æ¥åˆ°å—æ±çš„ä¸ªäººä¸–ç•Œ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;192.168.10.7 | CHANGED | rc=0 &amp;gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;æ¬¢è¿æ¥åˆ°å—æ±çš„ä¸ªäººä¸–ç•Œ&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;äºŒã€åœ¨playä¸­å®šä¹‰å˜é‡&quot;&gt;äºŒã€åœ¨playä¸­å®šä¹‰å˜é‡&lt;/h2&gt;
&lt;figure class=&quot;highlight yaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;---&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;hosts:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.10&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.7&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;vars:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;packages:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;htop&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;tasks:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;install&lt;/span&gt; &amp;#123;&amp;#123; &lt;span class=&quot;string&quot;&gt;packages&lt;/span&gt; &amp;#125;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;yum:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;&lt;span class=&quot;template-variable&quot;&gt;&amp;#123;&amp;#123; packages &amp;#125;&amp;#125;&lt;/span&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;state:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;present&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240103190009022.png&quot; alt=&quot;image-20240103190009022&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="æœåŠ¡æ¶æ„" scheme="https://smallflames.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Ansible-playbookç®€è¿°</title>
    <link href="https://smallflames.github.io/2024/01/03/Ansible-playbook%E7%AE%80%E8%BF%B0/"/>
    <id>https://smallflames.github.io/2024/01/03/Ansible-playbook%E7%AE%80%E8%BF%B0/</id>
    <published>2024-01-03T09:45:06.000Z</published>
    <updated>2024-01-03T11:50:51.475Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Ansible-playbookç®€è¿°</center></h1><p>â€ƒâ€ƒå¦‚æœæˆ‘ä»¬ad-hocçœ‹æˆæ˜¯å•æ¡çš„shellï¼Œé‚£ä¹ˆplaybookå°±æ˜¯ç±»ä¼¼shellè„šæœ¬çš„å­˜åœ¨ï¼Œè™½ç„¶å®ƒæ¯”ä¸ä¸Šshellè„šæœ¬çš„ä¾¿æ·å’Œå¯ç”¨æ€§ï¼Œä½†å®ƒåœ¨è‡ªåŠ¨åŒ–è¿ç»´ä¸­ç»å¯¹æ˜¯æŠŠåˆ©å™¨ï¼Œå¯¹äºæ‰¹é‡åŒ–ä¸»æœºç®¡ç†playbookæ˜¯æˆ‘ä»¬å¿…é¡»æŒæ¡å¹¶ç²¾é€šçš„ï¼Œå› ä¸ºå®ƒå¯ä»¥å……åˆ†å‘æŒ¥ansibleçš„å¼ºå¤§ï¼ï¼ï¼</p><p>â€ƒâ€ƒAnsible-playbookçš„ä¹¦å†™éµå¾ªymlè¯­è¨€æ ¼å¼ï¼Œå¹¶ä»¥ansibleçš„æ¨¡å—ä¸ºåŸºç¡€ï¼Œä»è€Œå®ç°å¯¹å¤æ‚æŒ‡ä»¤çš„ç¼–æ’åº”ç”¨ï¼Œå¦‚ä»¥ä¸‹çš„playbookä¹¦å†™ï¼Œå®ç°äº†å¯¹rsyncæœåŠ¡çš„éƒ¨ç½²ï¼ŒåŒæ ·çš„å®ƒå¯ä»¥åº”ç”¨åˆ°æ›´å¤šçš„ä¸»æœºæˆ–è€…é›†ç¾¤â€¦â€¦</p><span id="more"></span><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸»æœºèµ„äº§å¦‚ä¸‹</span></span><br><span class="line">[webs]</span><br><span class="line">192.168.10.7</span><br><span class="line">192.168.10.8</span><br><span class="line">[backups]</span><br><span class="line">192.168.10.41</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">all</span> <span class="string">software</span> <span class="string">prepare</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">rsync</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">rsync</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">www</span> <span class="string">group</span></span><br><span class="line">      <span class="attr">group:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">www</span></span><br><span class="line">        <span class="attr">gid:</span> <span class="number">666</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">www</span> <span class="string">user</span></span><br><span class="line">      <span class="attr">user:</span> </span><br><span class="line">        <span class="attr">name:</span> <span class="string">www</span></span><br><span class="line">        <span class="attr">uid:</span> <span class="number">666</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">www</span></span><br><span class="line">        <span class="attr">shell:</span> <span class="string">/sbin/nologin</span></span><br><span class="line">        <span class="attr">create_home:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">backups</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">configure</span> <span class="string">backup</span> <span class="string">rsync-server</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mkdir</span> <span class="string">/backup</span></span><br><span class="line">      <span class="attr">file:</span> </span><br><span class="line">        <span class="attr">path:</span> <span class="string">/backup</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">www</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">www</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">rsync</span></span><br><span class="line">      <span class="attr">copy:</span> </span><br><span class="line">        <span class="attr">src:</span> <span class="string">rsyncd.conf</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">passwd</span> <span class="string">file</span></span><br><span class="line">      <span class="attr">copy:</span> </span><br><span class="line">        <span class="attr">content:</span> <span class="string">rsync_backup:nanxi</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/rsync.passwd</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0600</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webs</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">configure</span> <span class="string">webs</span> <span class="string">rssync-client</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">rsync.pass</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">content:</span> <span class="string">nanxi</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/rsync.pass</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0600</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">start</span> <span class="string">rsync</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">rsyncd</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">rsyncd</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Ansible-playbookç®€è¿°&lt;/center&gt;&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒå¦‚æœæˆ‘ä»¬ad-hocçœ‹æˆæ˜¯å•æ¡çš„shellï¼Œé‚£ä¹ˆplaybookå°±æ˜¯ç±»ä¼¼shellè„šæœ¬çš„å­˜åœ¨ï¼Œè™½ç„¶å®ƒæ¯”ä¸ä¸Šshellè„šæœ¬çš„ä¾¿æ·å’Œå¯ç”¨æ€§ï¼Œä½†å®ƒåœ¨è‡ªåŠ¨åŒ–è¿ç»´ä¸­ç»å¯¹æ˜¯æŠŠåˆ©å™¨ï¼Œå¯¹äºæ‰¹é‡åŒ–ä¸»æœºç®¡ç†playbookæ˜¯æˆ‘ä»¬å¿…é¡»æŒæ¡å¹¶ç²¾é€šçš„ï¼Œå› ä¸ºå®ƒå¯ä»¥å……åˆ†å‘æŒ¥ansibleçš„å¼ºå¤§ï¼ï¼ï¼&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒAnsible-playbookçš„ä¹¦å†™éµå¾ªymlè¯­è¨€æ ¼å¼ï¼Œå¹¶ä»¥ansibleçš„æ¨¡å—ä¸ºåŸºç¡€ï¼Œä»è€Œå®ç°å¯¹å¤æ‚æŒ‡ä»¤çš„ç¼–æ’åº”ç”¨ï¼Œå¦‚ä»¥ä¸‹çš„playbookä¹¦å†™ï¼Œå®ç°äº†å¯¹rsyncæœåŠ¡çš„éƒ¨ç½²ï¼ŒåŒæ ·çš„å®ƒå¯ä»¥åº”ç”¨åˆ°æ›´å¤šçš„ä¸»æœºæˆ–è€…é›†ç¾¤â€¦â€¦&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="æœåŠ¡æ¶æ„" scheme="https://smallflames.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·Ansible</title>
    <link href="https://smallflames.github.io/2024/01/02/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7Ansible/"/>
    <id>https://smallflames.github.io/2024/01/02/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7Ansible/</id>
    <published>2024-01-02T12:18:48.000Z</published>
    <updated>2024-01-03T10:15:49.838Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·Ansibleç®€è¿°</center></h1><p>â€ƒâ€ƒ<code>ad-hoc</code>ä¸´æ—¶å‘½ä»¤ï¼Œæ‰§è¡Œå®Œå³ç»“æŸï¼Œå¹¶ä¸ä¼šä¿å­˜ï¼Œå¸¸ç”¨äºå•æ¡å‘½ä»¤çš„æ‰§è¡Œï¼Œå¦‚æœæ¶‰åŠåˆ°å¤æ‚çš„ç®¡ç†æ“ä½œï¼Œä¸”å¯èƒ½éœ€è¦æŒä¹…åŒ–ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨<code>playbook</code>ã€‚<code>PlayBook</code> åŠŸèƒ½æ¯” <code>ad-hoc</code> æ›´å…¨ï¼Œæ˜¯å¯¹ <code>ad-hoc</code> çš„ä¸€ç§ç¼–æ’ï¼Œèƒ½å¾ˆå¥½çš„æ§åˆ¶å…ˆåæ‰§è¡Œé¡ºåºï¼Œä»¥åŠä¾èµ–å…³ç³»ï¼Œè€Œä¸”è¯­æ³•å±•ç°æ›´åŠ çš„ç›´è§‚ã€‚ä½†æ˜¯æœ¬èŠ‚æˆ‘ä»¬ä»…å±•ç¤ºåŸºç¡€çš„Ansibleè¯­æ³•å’ŒåŸºæœ¬ä½¿ç”¨æ¨¡å—ã€‚</p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240103180947088.png" alt="image-20240103180947088"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240102213135360.png" alt="image-20240102213135360"></p><span id="more"></span><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum      <span class="comment">#  ç”¨æ¥å®‰è£…æœåŠ¡ï¼›</span></span><br><span class="line">         egï¼šansible web -i hosts -m yum -a <span class="string">&quot;name=httpd state=present&quot;</span></span><br><span class="line">         state ï¼špresentã€absentã€late</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">copy     <span class="comment">#   æ¨é€æ–‡ä»¶æ¨¡å—</span></span><br><span class="line">         egï¼šansible web -i hosts -m copy -a <span class="string">&quot;src=/etc/passwd dest=/tmp/nanxi.txt&quot;</span></span><br><span class="line">        ï¼ˆbackup=<span class="built_in">yes</span> æ¨é€å‰æ ¡éªŒMD5ï¼Œè‹¥ä¸åŒåˆ™å¤‡ä»½ï¼‰</span><br><span class="line">        </span><br><span class="line">         egï¼šansible web -m copy -a <span class="string">&quot;content=&#x27;nanxi&#x27; dest=/tmp/nanxi.txt&quot;</span></span><br><span class="line">         <span class="comment">#ç›´æ¥æ‰¹é‡åœ¨è¢«ç®¡ç†ç«¯æ–‡ä»¶ä¸­æ·»åŠ å†…å®¹ã€å…¶ä»–å±æ€§è¿˜æœ‰ownerã€groupã€mode</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file     <span class="comment">#   æ–‡ä»¶ç®¡ç†æ¨¡å—</span></span><br><span class="line">         egï¼šansible web -m file -a <span class="string">&quot;path=/tmp/nanxi state=touch&quot;</span></span><br><span class="line">         state ï¼š<span class="built_in">touch</span>ã€directoryã€<span class="built_in">link</span>ã€hardã€absentã€ownerã€groupã€mode</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get_url  <span class="comment">#   ç½‘ç»œèµ„æºä¸‹è½½æ¨¡å—</span></span><br><span class="line">         egï¼šansible web -m get_url -a <span class="string">&#x27;url=https://mirrors.aliyun.comâ€¦â€¦  dest=/tmp&#x27;</span> </span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemd  <span class="comment">#   æœåŠ¡ç®¡ç†æ¨¡å—</span></span><br><span class="line">         egï¼šansible web -m systemd -a <span class="string">&quot;name=nginx state=started enabled=yes&quot;</span></span><br><span class="line">         state ï¼šstartedã€stoppedã€restartedã€reloaded</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cron     <span class="comment">#   å®šæ—¶ä»»åŠ¡æ¨¡å—</span></span><br><span class="line">         egï¼šansible web -m cron -a <span class="string">&#x27;name=ceshi minute=*/5 job=&quot;/bin/sh /server/scripts/test.sh&quot;&#x27;</span></span><br><span class="line">         egï¼šansible web -m cron -a <span class="string">&#x27;name=ceshi state=absent&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mount    <span class="comment">#   ç£ç›˜æŒ‚è½½æ¨¡å—</span></span><br><span class="line">         egï¼šansible web -m mount -a <span class="string">&quot;src=172.16.1.31:/data path=/data fstype=nfs state=present&quot;</span></span><br><span class="line">         stateï¼špresentã€mountedã€unmountedã€absent</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user     <span class="comment">#   ç”¨æˆ·ç®¡ç†æ¨¡å—</span></span><br><span class="line">         egï¼šansible web -m user -a <span class="string">&quot;name=nanxi uid=888 group=888 shell=/sbin/nologin create_home=false&quot;</span></span><br><span class="line"></span><br><span class="line">group    <span class="comment">#   egï¼šansible web -m group -a &quot;name=oldboy gid=888&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum_repository <span class="comment">#  ä¿®æ”¹yumä»“åº“ï¼Œç”¨å®˜æ–¹ä»“åº“å®‰è£…è½¯ä»¶æ—¶ä½¿ç”¨</span></span><br><span class="line">         egï¼šansible web -m yum_repository -a <span class="string">&#x27;name=nginx description=nginx_official_repo baseurl= https://download...&#x27;</span></span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·Ansibleç®€è¿°&lt;/center&gt;&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒ&lt;code&gt;ad-hoc&lt;/code&gt;ä¸´æ—¶å‘½ä»¤ï¼Œæ‰§è¡Œå®Œå³ç»“æŸï¼Œå¹¶ä¸ä¼šä¿å­˜ï¼Œå¸¸ç”¨äºå•æ¡å‘½ä»¤çš„æ‰§è¡Œï¼Œå¦‚æœæ¶‰åŠåˆ°å¤æ‚çš„ç®¡ç†æ“ä½œï¼Œä¸”å¯èƒ½éœ€è¦æŒä¹…åŒ–ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨&lt;code&gt;playbook&lt;/code&gt;ã€‚&lt;code&gt;PlayBook&lt;/code&gt; åŠŸèƒ½æ¯” &lt;code&gt;ad-hoc&lt;/code&gt; æ›´å…¨ï¼Œæ˜¯å¯¹ &lt;code&gt;ad-hoc&lt;/code&gt; çš„ä¸€ç§ç¼–æ’ï¼Œèƒ½å¾ˆå¥½çš„æ§åˆ¶å…ˆåæ‰§è¡Œé¡ºåºï¼Œä»¥åŠä¾èµ–å…³ç³»ï¼Œè€Œä¸”è¯­æ³•å±•ç°æ›´åŠ çš„ç›´è§‚ã€‚ä½†æ˜¯æœ¬èŠ‚æˆ‘ä»¬ä»…å±•ç¤ºåŸºç¡€çš„Ansibleè¯­æ³•å’ŒåŸºæœ¬ä½¿ç”¨æ¨¡å—ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240103180947088.png&quot; alt=&quot;image-20240103180947088&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240102213135360.png&quot; alt=&quot;image-20240102213135360&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="æœåŠ¡æ¶æ„" scheme="https://smallflames.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Tomcatå…¥é—¨ç¯‡</title>
    <link href="https://smallflames.github.io/2023/12/25/Tomcat%E5%85%A5%E9%97%A8%E7%AF%87/"/>
    <id>https://smallflames.github.io/2023/12/25/Tomcat%E5%85%A5%E9%97%A8%E7%AF%87/</id>
    <published>2023-12-25T12:37:02.000Z</published>
    <updated>2023-12-25T15:00:52.233Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Tomcatå…¥é—¨ç¯‡</center></h1><h2 id="ä¸€ã€Tomcatç¯å¢ƒå‡†å¤‡å’Œå®‰è£…">ä¸€ã€Tomcatç¯å¢ƒå‡†å¤‡å’Œå®‰è£…</h2><p>â€ƒâ€ƒ<mark>Tomcatæ˜¯åŸºäºJAVAå¼€å‘çš„WEBæœåŠ¡ï¼Œä¸»è¦ç”¨æ¥è§£æJAVAä»£ç </mark>ã€‚Nginxä»…æ”¯æŒé™æ€èµ„æºè§£æï¼Œè€ŒTomcatæ”¯æŒè§£æJavaå¼€å‘çš„WEBåº”ç”¨ï¼Œè¿˜æ”¯æŒè§£æé™æ€èµ„æºï¼ˆæ•ˆç‡ä¸é«˜ï¼‰ï¼Œ<mark>Nginxé€‚åˆåšå‰ç«¯è´Ÿè½½å‡è¡¡ï¼ŒTomcaté€‚åˆåšåç«¯åº”ç”¨æœåŠ¡å¤„ç†</mark>ï¼Œé€šå¸¸æƒ…å†µä¼ä¸šä¼šä½¿ç”¨Nginx+Tomcatç»“åˆï¼ŒNginxå¤„ç†é™æ€èµ„æºï¼ŒTomcatå¤„ç†åŠ¨æ€èµ„æºã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### javaç¯å¢ƒå®‰è£…</span></span><br><span class="line">yum -y install java  <span class="comment">### æˆ–è€…æˆ‘ä»¬å¯ä»¥ç›´æ¥å»å®˜ç½‘ä¸‹è½½jdkå·¥å…·åŒ…ï¼Œé€šå¸¸é€‰æ‹©1.8ç‰ˆæœ¬ï¼Œç™¾å¹´è€å­—å·å“ˆå“ˆå“ˆå“ˆå“ˆ~ å—æ±é€‰æ‹©çš„æ˜¯å®‰è£…jdk</span></span><br><span class="line"><span class="comment">#è¿™æ˜¯å®˜ç½‘çš„ç‰ˆæœ¬é€‰æ‹©åœ°å€ï¼šhttps://docs.oracle.com/javase/8/docs/technotes/guides/install/linux_jdk.html</span></span><br><span class="line">[root@web1 ~]<span class="comment">#rpm -qa |grep jdk</span></span><br><span class="line">jdk1.8-1.8.0_341-fcs.x86_64</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### å®‰è£…tomcatè½¯ä»¶</span></span><br><span class="line"><span class="comment"># tomcatå®˜ç½‘åœ°å€ï¼šhttps://tomcat.apache.org/  è®¤å‡†è¿™åªå°å…¬çŒ«å“¦~</span></span><br><span class="line">[root@web1 ~]<span class="comment">#mkdir /soft</span></span><br><span class="line"><span class="comment"># åœ¨æ–°å»ºçš„ç›®å½•é‡Œä¸‹è½½tomcatæœåŠ¡ï¼Œè§£å‹åå¯ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€å®‰è£…ï¼Œå¼€ç®±å³ç”¨</span></span><br><span class="line">[root@web1 /soft]<span class="comment">#wget https://dlcdn.apache.org/tomcat/lltomcat-9/v9.0.84/bin/apache-tomcat-9.0.84.tar.gz</span></span><br><span class="line">...</span><br><span class="line"><span class="comment"># ä¸ºtomcatåˆ›å»ºè½¯ä»¶é“¾æ¥ï¼Œç›®çš„åœ¨äºä¿ç•™ç‰ˆæœ¬ä¿¡æ¯çš„åŒæ—¶æ–¹ä¾¿ä½¿ç”¨ï¼Œå…¶æ¬¡æ–¹ä¾¿ä»¥åæ•…éšœæ—¶çš„ç‰ˆæœ¬å›é€€</span></span><br><span class="line">[root@web1 /soft]<span class="comment">#ln -s apache-tomcat-9.0.84/ tomcat</span></span><br><span class="line">[root@web1 /soft]<span class="comment">#ll</span></span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x 9 root root 220 Dec 25 16:13 apache-tomcat-9.0.84</span><br><span class="line">lrwxrwxrwx 1 root root  27 Dec 25 16:15 tomcat -&gt; /soft/apache-tomcat-9.0.84/</span><br></pre></td></tr></table></figure><span id="more"></span><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### tomcatä½¿ç”¨</span></span><br><span class="line">[root@web1 ~]<span class="comment">#/soft/tomcat/bin/startup.sh    # å¯åŠ¨tomcatæœåŠ¡åé»˜è®¤8080ç«¯å£</span></span><br><span class="line">[root@web1 ~]<span class="comment">#/soft/tomcat/bin/shutdown.sh # åœæ­¢tomcat     é»˜è®¤8005ç«¯å£</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### å°†tomcatæœåŠ¡äº¤ç»™systemctlç®¡ç†</span></span><br><span class="line"><span class="built_in">cat</span> &gt;/usr/lib/systemd/system/tomcat.service&lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Apache Tomcat Server</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/soft/tomcat/bin/startup.sh</span><br><span class="line">ExecStop=/soft/tomcat/bin/shutdown.sh</span><br><span class="line">ExecRestart=/soft/tomcat/bin/shutdown.sh  &amp;&amp; sleep2  &amp;&amp; /soft/tomcat/bin/startup.sh</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"><span class="comment"># ä»¥ä¸Šæˆ‘ä»¬ç”¨åˆ°çš„æ˜¯è¾“å‡ºé‡å®šå‘ï¼ŒEOFä¸ºè¯­å¥å—æ ‡ç­¾ï¼Œæ ‡è¯†æŠŠä¸‹é¢è¯­å¥å—å†…å®¹äº¤ç»™å‰é¢çš„å‘½ä»¤æ‰§è¡Œï¼Œè¿™ä¸ªæ–¹å¼åœ¨è„šæœ¬ä¸­ï¼Œç»å¸¸ä½¿ç”¨ï¼Œå°¤å…¶å¸¸åœ¨è¿œç¨‹æœåŠ¡å™¨è¿è¡Œæœ¬åœ°è„šæœ¬æ—¶ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line">[root@web1 ~]<span class="comment">#systemctl daemon-reload</span></span><br><span class="line">[root@web1 ~]<span class="comment">#systemctl enable  tomcat</span></span><br></pre></td></tr></table></figure><h2 id="äºŒã€tomcaté…ç½®æ–‡ä»¶ç®€è¿°">äºŒã€tomcaté…ç½®æ–‡ä»¶ç®€è¿°</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tomcatè½¯ä»¶ç›®å½•ç»“æ„ï¼š</span><br><span class="line"></span><br><span class="line">bin      ---ä¸»è¦åŒ…å«å¯åŠ¨å’Œå…³é—­tomcatçš„è„šæœ¬ï¼ˆå¯åœjavaè„šæœ¬ä¾èµ–jaråŒ…æ–‡ä»¶ï¼‰</span><br><span class="line">conf  ---tomcaté…ç½®æ–‡ä»¶çš„ç›®å½•(ç«™ç‚¹é…ç½®ï¼šserver.xml)</span><br><span class="line">lib      ---tomcatè¿è¡Œæ—¶éœ€è¦åŠ è½½çš„jaråŒ…</span><br><span class="line">logs  ---tomcatæ—¥å¿—å­˜æ”¾ä½ç½®</span><br><span class="line">temp  ---tomcatä¸´æ—¶å­˜æ”¾æ–‡ä»¶è·¯å¾„</span><br><span class="line">webapps  ---tomcaté»˜è®¤ç«™ç‚¹ç›®å½•</span><br><span class="line">work  ---tomcatè¿è¡Œæ—¶äº§ç”Ÿçš„ç¼“å­˜æ–‡ä»¶ï¼Œå°½é‡ä¸è¦è½»æ˜“æ¸…æ¥šï¼Œå¯èƒ½ä¼šä¸¢å¤±é…ç½®</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231225213941114.png" alt="image-20231225213941114"></p><p>â€ƒâ€ƒç”¨æˆ·å‘å‡ºä¸€ä¸ªè¯·æ±‚ï¼Œå¦‚<a href="http://nanxi.com:8080/index.jsp">http://nanxi.com:8080/index.jsp</a> Connectorå‘ç°æ˜¯http/1.1åè®®ï¼Œè€Œä¸”è¿˜æ˜¯8080ç«¯å£ï¼Œäºæ˜¯å°±æŠŠè¯·æ±‚æ¥æ”¶åäº¤ç»™ç¬¦åˆæ¡ä»¶çš„Engineï¼ŒEngineé€šè¿‡è¯·æ±‚ä¸­çš„ä¸»æœºånanxi.comæŸ¥æ‰¾æ»¡è¶³æ¡ä»¶çš„è™šæ‹Ÿä¸»æœº(Host)ï¼Œæ‰¾åˆ°åå°±å»æ­¤è™šæ‹Ÿä¸»æœºæŒ‡å®šçš„appBaseï¼ˆä»£ç å­˜æ”¾çš„ç›®å½•ï¼‰æœ€åå°†è§£æäº§ç”Ÿçš„ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚</p><div class='spoiler collapsed'>    <div class='spoiler-title'>        å¼€å¯tomcatå¯è§†åŒ–ç®¡ç†é¡µé¢    </div>    <div class='spoiler-content'>        <p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231225214742363.png" alt="image-20231225214742363"></p><p>1ï¸âƒ£   <code>vim /soft/tomcat/conf/tomcat-users.xml</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&lt;role rolename=<span class="string">&quot;manager-gui&quot;</span>/&gt;</span><br><span class="line">&lt;role rolename=<span class="string">&quot;admin-gui&quot;</span>/&gt;</span><br><span class="line">&lt;user username=<span class="string">&quot;nanxi&quot;</span> password=<span class="string">&quot;123&quot;</span> roles=<span class="string">&quot;manager-gui,admin-gui&quot;</span>/&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/tomcat-users&gt;</span><br></pre></td></tr></table></figure><p>2ï¸âƒ£   <code>vim /soft/tomcat/webapps/host-manager/META-INF/context.xml</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">### ä¿®æ”¹valueå€¼å…è®¸æ‰€æœ‰IPè®¿é—®</span></span><br><span class="line">&lt;Valve className=<span class="string">&quot;org.apache.catalina.valves.RemoteAddrValve&quot;</span></span><br><span class="line">         allow=<span class="string">&quot;\d+\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1&quot;</span> /&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>3ï¸âƒ£   <code>vim /soft/tomcat/webapps/manager/META-INF/context.xml</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">### ä¿®æ”¹valueå€¼å…è®¸æ‰€æœ‰IPè®¿é—®</span></span><br><span class="line">&lt;Valve className=<span class="string">&quot;org.apache.catalina.valves.RemoteAddrValve&quot;</span></span><br><span class="line">       allow=<span class="string">&quot;\d+\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1&quot;</span> /&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>4ï¸âƒ£   <code>systemctl restart tomcat</code>  é‡å¯tomcatæœåŠ¡ï¼›</p>    </div></div><h2 id="ä¸‰ã€ä½¿ç”¨Tomcatéƒ¨ç½²zrlogäº§å“">ä¸‰ã€ä½¿ç”¨Tomcatéƒ¨ç½²zrlogäº§å“</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### å®šä¹‰è™šæ‹Ÿä¸»æœº</span></span><br><span class="line">&lt;Host name=<span class="string">&quot;zrlog.nanxi.com&quot;</span>  appBase=<span class="string">&quot;/code/zrlog&quot;</span></span><br><span class="line">    unpackWARs=<span class="string">&quot;true&quot;</span> autoDeploy=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">&lt;Valve className=<span class="string">&quot;org.apache.catalina.valves.AccessLogValve&quot;</span> directory=<span class="string">&quot;logs&quot;</span></span><br><span class="line">       prefix=<span class="string">&quot;zrlog.nanxi.com_access&quot;</span> suffix=<span class="string">&quot;.log&quot;</span></span><br><span class="line">       pattern=<span class="string">&quot;%h %l %u %t &amp;quot;%r&amp;quot; %s %b&quot;</span> /&gt;</span><br><span class="line">&lt;/Host&gt;</span><br><span class="line"><span class="comment">### åˆ›å»ºèµ„æºç›®å½•</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Tomcatå…¥é—¨ç¯‡&lt;/center&gt;&lt;/h1&gt;
&lt;h2 id=&quot;ä¸€ã€Tomcatç¯å¢ƒå‡†å¤‡å’Œå®‰è£…&quot;&gt;ä¸€ã€Tomcatç¯å¢ƒå‡†å¤‡å’Œå®‰è£…&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒ&lt;mark&gt;Tomcatæ˜¯åŸºäºJAVAå¼€å‘çš„WEBæœåŠ¡ï¼Œä¸»è¦ç”¨æ¥è§£æJAVAä»£ç &lt;/mark&gt;ã€‚Nginxä»…æ”¯æŒé™æ€èµ„æºè§£æï¼Œè€ŒTomcatæ”¯æŒè§£æJavaå¼€å‘çš„WEBåº”ç”¨ï¼Œè¿˜æ”¯æŒè§£æé™æ€èµ„æºï¼ˆæ•ˆç‡ä¸é«˜ï¼‰ï¼Œ&lt;mark&gt;Nginxé€‚åˆåšå‰ç«¯è´Ÿè½½å‡è¡¡ï¼ŒTomcaté€‚åˆåšåç«¯åº”ç”¨æœåŠ¡å¤„ç†&lt;/mark&gt;ï¼Œé€šå¸¸æƒ…å†µä¼ä¸šä¼šä½¿ç”¨Nginx+Tomcatç»“åˆï¼ŒNginxå¤„ç†é™æ€èµ„æºï¼ŒTomcatå¤„ç†åŠ¨æ€èµ„æºã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;### javaç¯å¢ƒå®‰è£…&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum -y install java  &lt;span class=&quot;comment&quot;&gt;### æˆ–è€…æˆ‘ä»¬å¯ä»¥ç›´æ¥å»å®˜ç½‘ä¸‹è½½jdkå·¥å…·åŒ…ï¼Œé€šå¸¸é€‰æ‹©1.8ç‰ˆæœ¬ï¼Œç™¾å¹´è€å­—å·å“ˆå“ˆå“ˆå“ˆå“ˆ~ å—æ±é€‰æ‹©çš„æ˜¯å®‰è£…jdk&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#è¿™æ˜¯å®˜ç½‘çš„ç‰ˆæœ¬é€‰æ‹©åœ°å€ï¼šhttps://docs.oracle.com/javase/8/docs/technotes/guides/install/linux_jdk.html&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@web1 ~]&lt;span class=&quot;comment&quot;&gt;#rpm -qa |grep jdk&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;jdk1.8-1.8.0_341-fcs.x86_64&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;### å®‰è£…tomcatè½¯ä»¶&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# tomcatå®˜ç½‘åœ°å€ï¼šhttps://tomcat.apache.org/  è®¤å‡†è¿™åªå°å…¬çŒ«å“¦~&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@web1 ~]&lt;span class=&quot;comment&quot;&gt;#mkdir /soft&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# åœ¨æ–°å»ºçš„ç›®å½•é‡Œä¸‹è½½tomcatæœåŠ¡ï¼Œè§£å‹åå¯ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€å®‰è£…ï¼Œå¼€ç®±å³ç”¨&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@web1 /soft]&lt;span class=&quot;comment&quot;&gt;#wget https://dlcdn.apache.org/tomcat/lltomcat-9/v9.0.84/bin/apache-tomcat-9.0.84.tar.gz&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# ä¸ºtomcatåˆ›å»ºè½¯ä»¶é“¾æ¥ï¼Œç›®çš„åœ¨äºä¿ç•™ç‰ˆæœ¬ä¿¡æ¯çš„åŒæ—¶æ–¹ä¾¿ä½¿ç”¨ï¼Œå…¶æ¬¡æ–¹ä¾¿ä»¥åæ•…éšœæ—¶çš„ç‰ˆæœ¬å›é€€&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@web1 /soft]&lt;span class=&quot;comment&quot;&gt;#ln -s apache-tomcat-9.0.84/ tomcat&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@web1 /soft]&lt;span class=&quot;comment&quot;&gt;#ll&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;total 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;drwxr-xr-x 9 root root 220 Dec 25 16:13 apache-tomcat-9.0.84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;lrwxrwxrwx 1 root root  27 Dec 25 16:15 tomcat -&amp;gt; /soft/apache-tomcat-9.0.84/&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="æœåŠ¡æ¶æ„" scheme="https://smallflames.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Nginxæ€§èƒ½ä¼˜åŒ–</title>
    <link href="https://smallflames.github.io/2023/12/22/Nginx%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    <id>https://smallflames.github.io/2023/12/22/Nginx%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/</id>
    <published>2023-12-22T07:32:10.000Z</published>
    <updated>2023-12-22T10:47:15.216Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Nginxæ€§èƒ½ä¼˜åŒ–</center></h1><h2 id="ä¸€ã€æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°">ä¸€ã€æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°</h2><p>â€ƒâ€ƒåšäº‹æœ‰åšäº‹çš„åŸåˆ™ï¼Œè§£å†³é—®é¢˜æœ‰è§£å†³é—®é¢˜çš„æ–¹æ³•ï¼Œé‚£æˆ‘ä»¬åœ¨åšæ€§èƒ½ä¼˜åŒ–å·¥ä½œä¹‹å‰ä¹ŸåŒæ ·è¦æœ‰è‡ªå·±çš„é€»è¾‘ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦åšä¼˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦é‡ç‚¹è€ƒè™‘å“ªäº›æ–¹é¢ï¼Œå’Œäº†è§£å“ªäº›æ–¹é¢å‘¢ï¼Ÿåœ¨å—æ±çœ‹æ¥ï¼Œä¸€åˆ‡ä¼˜åŒ–å·¥ä½œçš„ç›®çš„å°±æ˜¯åŸºäºä¸šåŠ¡ç¨³å®šå®‰å…¨çš„å‰æä¸‹å°½å¯èƒ½çš„æé«˜ç”¨æˆ·çš„è®¿é—®ä½“éªŒã€‚</p><p>â€ƒâ€ƒ1ã€é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£å½“å‰ç³»ç»Ÿçš„ç»“æ„å’Œç“¶é¢ˆï¼Œå½“æˆ‘ä»¬çš„è„‘è¢‹é‡Œå­˜åœ¨ä¸€ä¸ªæ˜ç¡®çš„ä¸šåŠ¡æ¡†æ¶é€»è¾‘æ—¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯¹äºå°±ä¼šæœ‰ä¸€ä¸ªæ˜ç¡®çš„æ–¹å‘ã€‚æ¯”å¦‚äº†è§£æˆ‘ä»¬å…¬å¸å½“å‰ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆï¼Œè¿è¡Œçš„æ˜¯ä»€ä¹ˆä¸šåŠ¡ï¼Œéƒ½æœ‰å“ªäº›æœåŠ¡ï¼Œäº†è§£æ¯ä¸ªæœåŠ¡æœ€å¤§å¯æ”¯æ’‘å¤šå°‘å¹¶å‘ï¼Œèƒ½æ”¯æŒå¤šå°‘qpsï¼ˆæ¯ç§’æŸ¥è¯¢ç‡ï¼‰çš„è®¿é—®è¯·æ±‚ï¼Œè¿™ç»„ç³»ç»Ÿçš„æœ€é«˜ç“¶é¢ˆåœ¨å“ªé‡Œï¼Ÿ<font color="gray"><em>ï¼ˆæˆ‘ä»¬å¦‚ä½•è¯„å®šæˆ‘ä»¬ç³»ç»Ÿçš„ç“¶é¢ˆå‘¢ï¼Œä¾‹å¦‚ä½¿ç”¨topæŸ¥çœ‹ç³»ç»Ÿçš„CPUè´Ÿè½½ã€å†…å­˜ä½¿ç”¨ç‡ã€æ€»å¾—è¿è¡Œè¿›ç¨‹ç­‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ—¥å¿—å»åˆ†æè¯·æ±‚çš„æƒ…å†µï¼Œä¹Ÿå¯ä»¥é€šè¿‡æˆ‘ä»¬å‰é¢ä»‹ç»åˆ°çš„stub_statiusæ¨¡å—æŸ¥çœ‹å½“å‰çš„è¿æ¥æƒ…å†µï¼Œå¯¹çº¿ä¸Šçš„ä¸šåŠ¡è¿›è¡Œå‹åŠ›æµ‹è¯•ã€ä½å³°æœŸã€‘ï¼Œå»äº†è§£å½“å‰è¿™å¥—ç³»ç»Ÿèƒ½æ‰¿æ‹…å¤šå°‘çš„è¯·æ±‚å’Œå¹¶å‘ï¼Œåšå¥½å“åº”çš„è¯„ä¼°ã€‚è¿™ä¸ªæ˜¯æˆ‘ä»¬åšæ€§èƒ½ä¼˜åŒ–æœ€å…ˆè€ƒè™‘çš„åœ°æ–¹ã€‚ï¼‰</em></font></p><p>â€ƒâ€ƒ2ã€äº†è§£ä¸šåŠ¡æ¨¡å¼ã€‚æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸ºä¸šåŠ¡æœåŠ¡çš„ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯æé«˜ä¸šåŠ¡èƒ½åŠ›ã€‚æˆ‘ä»¬éœ€è¦äº†è§£æ¯ä¸ªä¸šåŠ¡æ¥å£çš„ç±»å‹ï¼Œæ¯”å¦‚ï¼šç”µå•†ç½‘ç«™ä¸­çš„æŠ¢è´­æ¨¡å¼ï¼Œè¿™ç§æƒ…å†µä¸‹é¢ï¼Œå¹³æ—¶æ²¡ä»€ä¹ˆæµé‡ï¼Œä½†åˆ°äº†æŠ¢è´­æ—¶é—´æµé‡ä¼šçªå¢ã€‚æˆ‘ä»¬è¿˜éœ€è¦äº†è§£ç³»ç»Ÿå±‚æ¬¡åŒ–çš„ç»“æ„ï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬ä½¿ç”¨nginxåšçš„æ˜¯ä»£ç†ã€è¿˜æ˜¯åŠ¨é™åˆ†ç¦»ã€è¿˜æ˜¯åç«¯ç›´æ¥æœåŠ¡ç”¨æˆ·ï¼Œæˆ‘ä»¬è¦å¯¹æ¯ä¸€å±‚åšå¥½ç›¸åº”çš„æ¢³ç†ï¼Œä»¥ä¾¿æ›´å¥½çš„æœåŠ¡ä¸šåŠ¡ã€‚</p><p>â€ƒâ€ƒ3ã€æ€§èƒ½ä¸å®‰å…¨ã€‚é€šå¸¸ä¼šæœ‰è¿™æ ·ä¸€ä¸ªæƒ…å†µï¼Œæˆ‘ä»¬å¾€å¾€æ³¨é‡äº†æ€§èƒ½ï¼Œä½†æ˜¯å¿½ç•¥äº†å®‰å…¨ï¼Œå¾€å¾€è¿‡äºæ³¨é‡å®‰å…¨ï¼Œå¯¹æ€§èƒ½åˆä¼šäº§ç”Ÿå½±å“ã€‚æ¯”å¦‚ï¼šæˆ‘ä»¬åœ¨è®¾è®¡é˜²ç«å¢™åŠŸèƒ½æ—¶ï¼Œæ£€æµ‹è¿‡äºä¸¥å¯†ï¼Œè¿™æ ·å°±ä¼šç»™æ€§èƒ½å¸¦æ¥å½±å“ã€‚é‚£ä¹ˆå¦‚æœå¯¹äºæ€§èƒ½å®Œå…¨è¿½æ±‚ï¼Œå´ä¸é¡¾æœåŠ¡çš„å®‰å…¨ï¼Œä¹Ÿä¼šé€ æˆå¾ˆå¤§çš„éšæ‚£ã€‚æˆ‘ä»¬éœ€è¦è¯„ä¼°å¥½ä¸¤è€…çš„å…³ç³»ï¼ŒæŠŠæ¡å¥½ä¸¤è€…çš„å­°é‡å­°è½»ã€‚ä»¥åŠæ•´ä½“çš„ç›¸å…³æ€§ï¼Œæƒè¡¡å¥½å¯¹åº”çš„ç‚¹ã€‚</p><h2 id="äºŒã€å‹åŠ›æµ‹è¯•å·¥å…·">äºŒã€å‹åŠ›æµ‹è¯•å·¥å…·</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@web1 ~]<span class="comment">#yum -y install httpd-tools</span></span><br><span class="line">[root@web1 ~]<span class="comment">#ab -k -c100 -n1000 http://nanxi.com/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### -n è¦æ‰§è¡Œçš„è¯·æ±‚æ•°  -c è¯·æ±‚çš„å¹¶å‘æ•°  -k æ˜¯å¦å¼€å¯é•¿è¿æ¥</span></span><br></pre></td></tr></table></figure><p>â€ƒâ€ƒæˆ‘ä»¬å¯ä»¥å…ˆä»¥è‡ªå·±çš„é™æ€ç½‘é¡µä¸ºä¾‹ï¼ˆç°åœ¨å¾ˆå¤šçš„ç½‘ç«™åŸºæœ¬éƒ½ä¼šè®¾ç½®å±è”½å¤–ç•Œå‹æµ‹ï¼‰ï¼Œæ¥åšä¸€ä¸ªå°æµ‹è¯•ï¼š</p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231222163408848.png" alt="image-20231222163408848"></p><span id="more"></span><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">[root@web1 ~]<span class="comment">#ab -k -c100 -n1000 http://nanxi.com/</span></span><br><span class="line">This is ApacheBench, Version 2.3 &lt;<span class="variable">$Revision</span>: 1430300 $&gt;</span><br><span class="line">Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</span><br><span class="line">Licensed to The Apache Software Foundation, http://www.apache.org/</span><br><span class="line"></span><br><span class="line">Benchmarking nanxi.com (be patient)</span><br><span class="line">Completed 100 requests</span><br><span class="line">Completed 200 requests</span><br><span class="line">Completed 300 requests</span><br><span class="line">Completed 400 requests</span><br><span class="line">Completed 500 requests</span><br><span class="line">Completed 600 requests</span><br><span class="line">Completed 700 requests</span><br><span class="line">Completed 800 requests</span><br><span class="line">Completed 900 requests</span><br><span class="line">Completed 1000 requests</span><br><span class="line">Finished 1000 requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Server Software:        Apache/2.4.6   <span class="comment">#æµ‹è¯•æœåŠ¡å™¨çš„åå­—</span></span><br><span class="line">Server Hostname:        nanxi.com      <span class="comment">#è¯·æ±‚çš„URLä¸»æœºå</span></span><br><span class="line">Server Port:            80             <span class="comment">#è¯·æ±‚ç«¯å£</span></span><br><span class="line"></span><br><span class="line">Document Path:          /              <span class="comment">#è¯·æ±‚è·¯å¾„</span></span><br><span class="line">Document Length:        9344 bytes     <span class="comment">#HTTPå“åº”æ•°æ®çš„æ­£æ–‡é•¿åº¦</span></span><br><span class="line"></span><br><span class="line">Concurrency Level:      100            <span class="comment">#å¹¶å‘ç”¨æˆ·æ•°ï¼Œæˆ‘ä»¬è®¾ç½®çš„å‚æ•°</span></span><br><span class="line">Time taken <span class="keyword">for</span> tests:   26.822 seconds <span class="comment">#æ‰€æœ‰è¿™äº›è¯·æ±‚è¢«å¤„ç†å®Œæˆæ‰€èŠ±è´¹çš„æ€»æ—¶é—´ å•ä½ç§’</span></span><br><span class="line">Complete requests:      1000           <span class="comment">#æ€»è¯·æ±‚æ•°é‡ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬è®¾ç½®çš„å‚æ•°ä¹‹ä¸€</span></span><br><span class="line">Failed requests:        51             <span class="comment">#è¡¨ç¤ºå¤±è´¥çš„è¯·æ±‚æ•°é‡</span></span><br><span class="line">   (Connect: 0, Receive: 0, Length: 51, Exceptions: 0)</span><br><span class="line">Write errors:           0</span><br><span class="line">Keep-Alive requests:    952</span><br><span class="line">Total transferred:      9392739 bytes  <span class="comment">#æ‰€æœ‰è¯·æ±‚çš„å“åº”æ•°æ®é•¿åº¦æ€»å’Œï¼ŒåŒ…æ‹¬æ¯ä¸ªHTTPå“åº”æ•°æ®çš„å¤´ä¿¡æ¯å’Œæ­£æ–‡æ•°æ®çš„é•¿åº¦</span></span><br><span class="line">HTML transferred:       9089389 bytes  <span class="comment">#æ‰€æœ‰è¯·æ±‚çš„å“åº”æ•°æ®ä¸­æ­£æ–‡æ•°æ®çš„æ€»å’Œï¼Œä¹Ÿå°±æ˜¯å‡å»äº†Total transferredä¸­HTTPå“åº”æ•°æ®ä¸­çš„å¤´ä¿¡æ¯çš„é•¿åº¦</span></span><br><span class="line">Requests per second:    37.28 [<span class="comment">#/sec] (mean)  #ååé‡  æ€»è¯·æ±‚æ•°/å¤„ç†å®Œæˆè¿™äº›è¯·æ±‚æ•°æ‰€èŠ±è´¹çš„æ—¶é—´</span></span><br><span class="line">Time per request:       2682.194 [ms] (mean)  <span class="comment">#ç”¨æˆ·å¹³å‡è¯·æ±‚ç­‰å¾…æ—¶é—´ï¼Œå¤„ç†å®Œæˆæ‰€æœ‰è¯·æ±‚æ•°æ‰€èŠ±è´¹çš„æ—¶é—´/ï¼ˆæ€»è¯·æ±‚æ•°/å¹¶å‘ç”¨æˆ·æ•°ï¼‰     </span></span><br><span class="line">Time per request:       26.822 [ms] (mean, across all concurrent requests) <span class="comment">#æœåŠ¡å™¨å¹³å‡è¯·æ±‚ç­‰å¾…æ—¶é—´</span></span><br><span class="line">Transfer rate:          341.98 [Kbytes/sec] received</span><br><span class="line"></span><br><span class="line">Connection Times (ms)</span><br><span class="line">              min  mean[+/-sd] median   max</span><br><span class="line">Connect:        0   28  86.2      0     678</span><br><span class="line">Processing:     0 2529 2167.9   1760   13955</span><br><span class="line">Waiting:        0  887 1525.8    408    7873</span><br><span class="line">Total:          0 2557 2198.7   1770   14148</span><br><span class="line"></span><br><span class="line">Percentage of the requests served within a certain time (ms)</span><br><span class="line">  50%   1770</span><br><span class="line">  66%   3120</span><br><span class="line">  75%   3949</span><br><span class="line">  80%   4334</span><br><span class="line">  90%   5290</span><br><span class="line">  95%   7506</span><br><span class="line">  98%   8587</span><br><span class="line">  99%   8860</span><br><span class="line"> 100%  14148 (longest request)</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€æ€§èƒ½ä¼˜åŒ–">ä¸‰ã€æ€§èƒ½ä¼˜åŒ–</h2><h3 id="1ã€ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–">1ã€ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–</h3><p>â€ƒâ€ƒæ–‡ä»¶å¥æŸ„ï¼ŒLinuxä¸€åˆ‡çš†æ–‡ä»¶ï¼Œæ–‡ä»¶å¥æŸ„å¯ä»¥ç†è§£ä¸ºå°±æ˜¯ä¸€ä¸ªç´¢å¼•ï¼Œæ–‡ä»¶å¥æŸ„ä¼šéšç€æˆ‘ä»¬è¿›ç¨‹çš„è°ƒç”¨é¢‘ç¹å¢åŠ ï¼Œç³»ç»Ÿé»˜è®¤æ–‡ä»¶å¥æŸ„æ˜¯æœ‰é™åˆ¶çš„ï¼Œä¸èƒ½è®©ä¸€ä¸ªè¿›ç¨‹æ— é™çš„è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é™åˆ¶æ¯ä¸ªè¿›ç¨‹å’Œæ¯ä¸ªæœåŠ¡ä½¿ç”¨å¤šå¤§çš„æ–‡ä»¶å¥æŸ„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@lb01 ~]<span class="comment"># vim /etc/security/limits.conf</span></span><br><span class="line"></span><br><span class="line">1ã€ç³»ç»Ÿå…¨å±€æ€§ä¿®æ”¹ã€‚</span><br><span class="line"><span class="comment"># * ä»£è¡¨æ‰€æœ‰ç”¨æˆ·</span></span><br><span class="line">* soft nofile 25535</span><br><span class="line">* hard nofile 25535</span><br><span class="line"></span><br><span class="line">2.ç”¨æˆ·å±€éƒ¨æ€§ä¿®æ”¹</span><br><span class="line"><span class="comment">#é’ˆå¯¹rootç”¨æˆ·ï¼Œsoftä»…æé†’ï¼Œhardé™åˆ¶ï¼Œnofileæ‰“å¼€æœ€å¤§æ–‡ä»¶æ•°</span></span><br><span class="line">root soft nofile 65535</span><br><span class="line">root hard nofile 65535</span><br><span class="line"></span><br><span class="line">3.è¿›ç¨‹å±€éƒ¨æ€§ä¿®æ”¹</span><br><span class="line"><span class="comment">#é’ˆå¯¹nginxè¿›ç¨‹ï¼Œnginxè‡ªå¸¦é…ç½®</span></span><br><span class="line">worker_rlimit_nofile 30000</span><br><span class="line"></span><br><span class="line">4.è°ƒæ•´å†…æ ¸å‚æ•°ï¼šè®©time_waitçŠ¶æ€é‡ç”¨(ç«¯å£é‡ç”¨)[flag]</span><br><span class="line">[root@web01 ROOT]<span class="comment"># vim /etc/sysctl.conf</span></span><br><span class="line">net.ipv4.tcp_tw_reuse = 1     <span class="comment"># å¼€å¯ç«¯å£å¤ç”¨</span></span><br><span class="line">net.ipv4.tcp_timestamps = 0   <span class="comment"># ç¦ç”¨æ—¶é—´æˆ³</span></span><br><span class="line">[root@web01 ROOT]<span class="comment"># sysctl -p    #å¯ä»¥æŸ¥çœ‹æˆ‘ä»¬æ·»åŠ çš„å†…æ ¸å‚æ•°</span></span><br><span class="line">[root@web01 ROOT]<span class="comment"># sysctl -a    #å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å†…æ ¸å‚æ•°</span></span><br></pre></td></tr></table></figure><p>â€ƒâ€ƒåœ¨é«˜å¹¶å‘çŸ­è¿æ¥çš„TCPæœåŠ¡å™¨ä¸Šï¼Œå½“æœåŠ¡å™¨å¤„ç†å®Œè¯·æ±‚åç«‹åˆ»ä¸»åŠ¨æ­£å¸¸å…³é—­è¿æ¥ã€‚è¿™ä¸ªåœºæ™¯ä¸‹ä¼šå‡ºç°å¤§é‡socketå¤„äºTIME_WAITçŠ¶æ€ã€‚å¦‚æœå®¢æˆ·ç«¯çš„å¹¶å‘é‡æŒç»­å¾ˆé«˜ï¼Œæ­¤æ—¶éƒ¨åˆ†å®¢æˆ·ç«¯å°±ä¼šæ˜¾ç¤ºè¿æ¥ä¸ä¸Šã€‚</p><p>â€ƒâ€ƒä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å…³æ³¨è¿™ä¸ªé«˜å¹¶å‘çŸ­è¿æ¥å‘¢ï¼Ÿ<strong>é«˜å¹¶å‘å¯ä»¥è®©æœåŠ¡å™¨åœ¨çŸ­æ—¶é—´èŒƒå›´å†…åŒæ—¶å ç”¨å¤§é‡ç«¯å£</strong>ï¼Œè€Œç«¯å£æœ‰ä¸ª0~65535çš„èŒƒå›´ï¼Œå¹¶ä¸æ˜¯å¾ˆå¤šï¼Œé™¤å»ç³»ç»Ÿå’Œå…¶ä»–æœåŠ¡è¦ç”¨çš„ï¼Œå‰©ä¸‹çš„å°±æ›´å°‘äº†ã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼ŒçŸ­è¿æ¥è¡¨ç¤º<strong>ä¸šåŠ¡å¤„ç†+ä¼ è¾“æ•°æ®çš„æ—¶é—´è¿œè¿œå°äº TIMEWAITè¶…æ—¶çš„æ—¶é—´</strong>çš„è¿æ¥ã€‚æ¯”å¦‚å–ä¸€ä¸ªwebé¡µé¢,1ç§’é’Ÿçš„httpçŸ­è¿æ¥å¤„ç†å®Œä¸šåŠ¡ï¼Œåœ¨å…³é—­è¿æ¥ä¹‹åï¼Œè¿™ä¸ªä¸šåŠ¡ç”¨è¿‡çš„ç«¯å£ä¼šåœç•™åœ¨TIMEWAITçŠ¶æ€å‡ åˆ†é’Ÿï¼Œè€Œè¿™å‡ åˆ†é’Ÿï¼Œå…¶ä»–HTTPè¯·æ±‚æ¥ä¸´çš„æ—¶å€™æ˜¯æ— æ³•å ç”¨æ­¤ç«¯å£çš„ã€‚ã€‚å•ç”¨è¿™ä¸ªä¸šåŠ¡è®¡ç®—æœåŠ¡å™¨çš„åˆ©ç”¨ç‡ä¼šå‘ç°ï¼ŒæœåŠ¡å™¨å¹²æ­£ç»äº‹çš„æ—¶é—´å’Œç«¯å£ï¼ˆèµ„æºï¼‰è¢«æŒ‚ç€æ— æ³•è¢«ä½¿ç”¨çš„æ—¶é—´çš„æ¯”ä¾‹æ˜¯ 1ï¼šå‡ ç™¾ï¼ŒæœåŠ¡å™¨èµ„æºä¸¥é‡æµªè´¹ã€‚ï¼ˆ<font color="red">åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œä¸€èˆ¬é•¿è¿æ¥å¯¹åº”çš„ä¸šåŠ¡çš„å¹¶å‘é‡å¹¶ä¸ä¼šå¾ˆé«˜ã€‚</font>ï¼‰</p><h3 id="2ã€ä»£ç†æœåŠ¡ä¼˜åŒ–">2ã€ä»£ç†æœåŠ¡ä¼˜åŒ–</h3><p>â€ƒâ€ƒé€šå¸¸nginxä½œä¸ºä»£ç†æœåŠ¡ï¼Œè´Ÿè´£è½¬å‘ç”¨æˆ·çš„è¯·æ±‚ï¼Œé‚£ä¹ˆåœ¨è½¬å‘çš„è¿‡ç¨‹ä¸­å»ºè®®å¼€å¯HTTPé•¿è¿æ¥ï¼Œç”¨äºå‡å°‘æ¡æ‰‹æ¬¡æ•°ï¼Œé™ä½æœåŠ¡å™¨æŸè€—ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server 127.0.0.1:8080;</span><br><span class="line">    keepalive 16;   <span class="comment">#é•¿è¿æ¥</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    location /http/ &#123;</span><br><span class="line">        proxy_pass http://backend;</span><br><span class="line">        proxy_http_version 1.1;         <span class="comment">#å¯¹äºhttpåè®®åº”è¯¥æŒ‡å®šä¸º1.1</span></span><br><span class="line">        proxy_set_header Connection <span class="string">&quot;&quot;</span>; <span class="comment">#æ¸…é™¤â€œconnectionâ€å¤´å­—æ®µ</span></span><br><span class="line">        proxy_next_upstream error <span class="built_in">timeout</span> http_500 http_502 http_503 http_504;  <span class="comment">#å¹³æ»‘è¿‡æ¸¡</span></span><br><span class="line">        proxy_set_header Host <span class="variable">$http_host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwared-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_connect_timeout 30s;      <span class="comment"># ä»£ç†è¿æ¥webè¶…æ—¶æ—¶é—´</span></span><br><span class="line">        proxy_read_timeout 60s;         <span class="comment"># ä»£ç†ç­‰å¾…webå“åº”è¶…æ—¶æ—¶é—´</span></span><br><span class="line">        proxy_send_timeout 60s;         <span class="comment"># webå›ä¼ æ•°æ®è‡³ä»£ç†è¶…æ—¶æ—¶é—´</span></span><br><span class="line">        proxy_buffering on;             <span class="comment"># å¼€å¯ä»£ç†ç¼“å†²åŒº,webå›ä¼ æ•°æ®è‡³ç¼“å†²åŒº,ä»£ç†è¾¹æ”¶è¾¹ä¼ è¿”å›ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">        proxy_buffer_size 32k;          <span class="comment"># ä»£ç†æ¥æ”¶webå“åº”çš„å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°</span></span><br><span class="line">        proxy_buffers 4 128k;           <span class="comment"># ç¼“å†²ä»£ç†æ¥æ”¶å•ä¸ªé•¿è¿æ¥å†…åŒ…å«çš„webå“åº”çš„æ•°é‡å’Œå¤§å°</span></span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€ƒâ€ƒå¯¹äºfastcgiæœåŠ¡å™¨ï¼Œéœ€è¦è®¾ç½®fastcgi_keep_connä»¥ä¾¿ä¿æŒé•¿è¿æ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">upstream fastcgi_backend &#123;</span><br><span class="line">    server 127.0.0.1:9000;</span><br><span class="line">    keepalive 8;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    location /fastcgi/ &#123;</span><br><span class="line">        fastcgi_pass fastcgi_backend;</span><br><span class="line">        fastcgi_param  SCRIPT_FILENAME  $document_root<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">        fastcgi_keep_conn on;   </span><br><span class="line">        fastcgi_connect_timeout 60s;</span><br><span class="line">        include fastcgi_params;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€ƒâ€ƒscgiå’Œuwsgiåè®®æ²¡æœ‰ä¿æŒè¿æ¥çš„æ¦‚å¿µï¼Œä½†æ— è®ºæ˜¯proxyã€fastcgiã€uwsgiåè®®éƒ½æœ‰cacheç¼“å­˜çš„åŠŸèƒ½ï¼Œå¼€å¯åå¯åŠ é€Ÿç½‘ç«™è®¿é—®çš„æ•ˆç‡ï¼ˆå–å†³ç¡¬ä»¶ï¼‰ã€‚</p><h3 id="3ã€é™æ€èµ„æºä¼˜åŒ–">3ã€é™æ€èµ„æºä¼˜åŒ–</h3><p>â€ƒâ€ƒé™æ€èµ„æºæŒ‡çš„æ˜¯éWEBæœåŠ¡å™¨ç«¯è¿è¡Œå¤„ç†è€Œç”Ÿæˆçš„æ–‡ä»¶ï¼š</p><table><thead><tr><th>é™æ€èµ„æºç±»å‹</th><th>ç§ç±»</th></tr></thead><tbody><tr><td>æµè§ˆå™¨æ¸²æŸ“</td><td>HTMLã€CSSã€JSâ€¦</td></tr><tr><td>å›¾ç‰‡æ–‡ä»¶</td><td>JPEGã€GIFã€PNGâ€¦</td></tr><tr><td>è§†é¢‘æ–‡ä»¶</td><td>FLVã€Mp4ã€AVIâ€¦</td></tr><tr><td>å…¶ä»–æ–‡ä»¶</td><td>TXTã€DOCã€PDFâ€¦</td></tr></tbody></table><p>â€ƒâ€ƒæµè§ˆå™¨ç¼“å­˜è®¾ç½®ç”¨äºæé«˜ç½‘ç«™æ€§èƒ½ï¼Œå°¤å…¶æ˜¯æ–°é—»ç½‘ç«™ï¼Œå›¾ç‰‡ä¸€æ—¦å‘å¸ƒï¼Œæ”¹åŠ¨çš„å¯èƒ½æ˜¯éå¸¸å°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸Œæœ›èƒ½å¦ç”¨æˆ·è®¿é—®ä¸€æ¬¡åï¼Œå›¾ç‰‡ç¼“å­˜åœ¨ç”¨æˆ·çš„æµè§ˆå™¨é•¿æ—¶é—´ç¼“å­˜ã€‚ æµè§ˆå™¨æ˜¯æœ‰è‡ªå·±çš„ç¼“å­˜æœºåˆ¶ï¼Œä»–æ˜¯åŸºäºHTTPåè®®ç¼“å­˜æœºåˆ¶æ¥å®ç°çš„ï¼Œåœ¨HTTPåè®®ä¸­æœ‰å¾ˆå¤šå¤´ä¿¡æ¯ï¼Œé‚£ä¹ˆå®ç°æµè§ˆå™¨çš„ç¼“å­˜å°±éœ€è¦ä¾èµ–ç‰¹æ®Šçš„å¤´ä¿¡æ¯æ¥ä¸æœåŠ¡å™¨è¿›è¡Œç‰¹æ®Šçš„éªŒè¯ï¼Œå¦‚Expiresï¼ˆhttp/1.0ï¼‰ï¼›Cache-controlï¼ˆhttp/1.1ï¼‰</p><p>â€ƒâ€ƒæµè§ˆå™¨ç¼“å­˜è¿‡æœŸæ ¡éªŒæœºåˆ¶ï¼š</p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/5e71e775f6d5ff1bcc000003.png" alt="bcc"></p><blockquote><p>1ã€æµè§ˆå™¨è¯·æ±‚æœåŠ¡å™¨ä¼šå…ˆè¿›è¡ŒExpiresã€Cache-Controlçš„æ£€æŸ¥ï¼Œæ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœæ²¡æœ‰è¿‡æœŸåˆ™ç›´æ¥ä»ç¼“å­˜æ–‡ä»¶ä¸­è¯»å–ã€‚<br>2ã€å¦‚æœç¼“å­˜è¿‡æœŸé¦–å…ˆæ£€æŸ¥æ˜¯å¦å­˜åœ¨etagï¼Œå¦‚æœå­˜åœ¨é‚£ä¹ˆå®¢æˆ·ç«¯ä¼šå‘webæœåŠ¡å™¨è¯·æ±‚If-None-Matchï¼Œä¸etagå€¼è¿›è¡Œæ¯”å¯¹ï¼Œæœ‰æœåŠ¡å™¨å†³ç­–è¿”å›200è¿˜æ˜¯304ã€‚<br>3ã€å¦‚æœetagä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œlast-Modifiedæ£€æŸ¥ï¼Œå®¢æˆ·ç«¯ä¼šå‘webæœåŠ¡å™¨è¯·æ±‚if-Modified-Sinceï¼Œä¸last-Modifiedè¿›è¡Œæ¯”å¯¹ï¼Œæœ‰æœåŠ¡å™¨å†³ç­–è¿”å›200è¿˜æ˜¯304ã€‚</p><p>Last-Modifiedï¼šæœåŠ¡å™¨ä¸Šæ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´<br>Etagï¼šæ–‡ä»¶æ ‡è¯†<br>Expiresï¼šæœ¬åœ°ç¼“å­˜ç›®å½•ä¸­ï¼Œæ–‡ä»¶è¿‡æœŸçš„æ—¶é—´ï¼ˆç”±æœåŠ¡å™¨æŒ‡å®šå…·ä½“çš„æ—¶é—´ï¼‰<br>Cache-controlï¼šæœ¬åœ°ç¼“å­˜ç›®å½•ä¸­ï¼Œæ–‡ä»¶è¿‡æœŸçš„æ—¶é—´ï¼ˆç”±æœåŠ¡å™¨æŒ‡å®šè¿‡æœŸçš„é—´éš”æ—¶é—´ï¼Œç”±äºæµè§ˆå™¨æ ¹æ®é—´éš”ç”Ÿæˆå…·ä½“çš„æ—¶é—´ï¼‰</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### é…ç½®é™æ€èµ„æºç¼“å­˜åœºæ™¯</span></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name nanxi.com;</span><br><span class="line"></span><br><span class="line">    location ~ .*\.(jpg|gif|png)$ &#123;</span><br><span class="line">        expires      7d;</span><br><span class="line">    &#125;</span><br><span class="line">    location ~ .*\.(js|css)$ &#123;</span><br><span class="line">        expires      30d;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">### å¦‚æœå¼€å‘ä»£ç æ²¡æœ‰æ­£å¼ä¸Šçº¿ï¼Œå¸Œæœ›é™æ€æ–‡ä»¶ä¸è¢«ç¼“å­˜</span></span><br><span class="line"><span class="comment"># å–æ¶ˆjsã€cssã€htmlç­‰é™æ€æ–‡ä»¶ç¼“å­˜</span></span><br><span class="line">location ~ .*\.(js|css|html)$ &#123;</span><br><span class="line">    add_header Cache-Control no-store;</span><br><span class="line">    add_header Pragma no-cache;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€ƒâ€ƒæ–‡ä»¶è¯»å–é«˜æ•ˆsendfileï¼Œå¦‚ä¸‹å›¾</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Syntax: sendfile on | off;</span><br><span class="line">Default: sendfile off;</span><br><span class="line">Context: http, server, location, <span class="keyword">if</span> <span class="keyword">in</span> location</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231222173037014.png" alt="image-20231222173037014"></p><p>â€ƒâ€ƒå°†å¤šä¸ªåŒ…ä¸€æ¬¡å‘é€ï¼Œç”¨äºæå‡ç½‘ç»œä¼ è¾“æ•ˆç‡ï¼Œå¤§æ–‡ä»¶æ¨èæ‰“å¼€ï¼Œéœ€è¦å¼€å¯sendfileæ‰è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Syntax: tcp_nopush on | off;</span><br><span class="line">Default: tcp_nopush off;</span><br><span class="line">Context: http, server, location</span><br></pre></td></tr></table></figure><p>â€ƒâ€ƒæé«˜ç½‘ç»œä¼ è¾“å®æ—¶æ€§ï¼Œéœ€è¦å¼€å¯keepaliveï¼Œæ¥ä¸€ä¸ªåŒ…å‘ä¸€ä¸ªåŒ…ä¸ç­‰å¾…è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Syntax: tcp_nodelay on | off;</span><br><span class="line">Default: tcpnodelay off;</span><br><span class="line">Context: http, server, location</span><br></pre></td></tr></table></figure><p>â€ƒâ€ƒ<strong>é™æ€èµ„æºå‹ç¼©  â˜…â˜…â˜…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location ~ .*\.(jpg|png|gif) &#123;</span><br><span class="line">    root /code/images;</span><br><span class="line">    <span class="comment">#gzip on;           ### gzipä¼ è¾“å‹ç¼©ï¼Œä¼ è¾“å‰å‹ç¼©ï¼Œä¼ è¾“åè§£å‹</span></span><br><span class="line">    <span class="comment">#gzip_types image/jpeg image/gif image/png;   ### æŒ‡å®šgzipå‹ç¼©å“ªäº›ç±»å‹çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">#gzip_comp_level 2;   ### æŒ‡å®šgzipå‹ç¼©æ¯”ç‡ï¼ŒåŠ å¿«ä¼ è¾“ï¼Œä½†å‹ç¼©æœ¬èº«æ¯”è¾ƒè€—è´¹æœåŠ¡å™¨æ€§èƒ½</span></span><br><span class="line">    <span class="comment">#gzip_http_version 1.1;    ### gzipå‹ç¼©åè®®ç‰ˆæœ¬</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€ƒâ€ƒæ³¨æ„ï¼šgzipå¯¹äºå‹ç¼©å›¾ç‰‡çš„æ¯”ç‡ä¸å¤ªæ˜æ˜¾ï¼Œä½†å¯¹äºæ–‡ä»¶çš„å‹ç¼©ï¼Œ655Kå¯ä»¥å‹ç¼©åˆ°153Kå‹ç¼©çš„æ¯”ç‡å¾ˆé«˜ã€‚</p><h2 id="å››ã€é˜²æ­¢èµ„æºç›—é“¾">å››ã€é˜²æ­¢èµ„æºç›—é“¾</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Syntax: valid_referers none | blocked | server_name | string ...;</span><br><span class="line">Default: -;</span><br><span class="line">Context: server, location</span><br><span class="line"></span><br><span class="line"><span class="comment">#none: refereræ¥æºå¤´éƒ¨ä¸ºç©ºçš„æƒ…å†µ</span></span><br><span class="line"><span class="comment">#blocked: refereræ¥æºå¤´éƒ¨ä¸ä¸ºç©ºï¼Œè¿™äº›éƒ½ä¸ä»¥http://æˆ–è€…https://å¼€å¤´</span></span><br><span class="line"><span class="comment">#server_name: æ¥æºå¤´éƒ¨ä¿¡æ¯åŒ…å«å½“å‰åŸŸåï¼Œå¯ä»¥æ­£åˆ™åŒ¹é…</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">location ~ .*\.(jpg|png|gif) &#123;</span><br><span class="line">         root /var/www/wordpress/wp-content/extra/;</span><br><span class="line">         valid_referers none blocked *.nanxi.com;</span><br><span class="line">         <span class="keyword">if</span> ( <span class="variable">$invalid_referer</span> ) &#123;</span><br><span class="line">            <span class="built_in">return</span> 403;   <span class="comment">### æˆ–è€…å¯ä»¥è·³è½¬åˆ°è‡ªå·±æå‰ä¸ºç›—é“¾å‡†å¤‡çš„é¡µé¢</span></span><br><span class="line">            <span class="comment"># rewrite ^(.*)$ /daolian.png break; </span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231222174825738.png" alt="image-20231222174825738"></p><p>â€ƒâ€ƒå½“ç„¶è¿™ç§é˜²æŠ¤å¹¶ä¸èƒ½ç™¾åˆ†ç™¾ä¿è¯èµ„æºä¸è¢«ç›—é“¾ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤æ¥ä¿®æ”¹æ¥æºçš„referä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¼ªé€ åè®®å¤´è®¿é—®ï¼Œå› ä¸ºå¤§å¤šæ—¶å€™æˆ‘ä»¬ä¸ä¼šç¦æ­¢æœç´¢å¼•æ“ç›—é“¾ï¼Œæˆ‘ä»¬åè€Œéœ€è¦ä»–ä»¬æ”¶å½•æˆ‘ä»¬çš„ä¿¡æ¯ã€‚</span></span><br><span class="line">curl -e <span class="string">&quot;https://www.baidu.com&quot;</span> -I http://test.nanxi.com/Picture/nanxi.jpg</span><br></pre></td></tr></table></figure><h2 id="äº”ã€CPUäº²å’Œé…ç½®">äº”ã€CPUäº²å’Œé…ç½®</h2><p>â€ƒâ€ƒCPUäº²å’Œï¼ˆaffinityï¼‰å‡å°‘è¿›ç¨‹ä¹‹é—´ä¸æ–­é¢‘ç¹åˆ‡æ¢ï¼Œå‡å°‘æ€§èƒ½æŸè€—ï¼Œå…¶å®ç°åŸç†æ˜¯å»ºCPUæ ¸å¿ƒå’ŒNginxå·¥ä½œè¿›ç¨‹ç»‘å®šæ–¹å¼ï¼ŒæŠŠæ¯ä¸ªworkerè¿›ç¨‹å›ºå®šåˆ°å¯¹åº”çš„cpuä¸Šæ‰§è¡Œï¼Œå‡å°‘åˆ‡æ¢CPUçš„cache missï¼Œè·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### æ ¸å¿ƒæ¨¡å—ä¸­é…ç½®</span></span><br><span class="line">worker_processes  auto;</span><br><span class="line">worker_cpu_affinity auto; <span class="comment"># è‡ªåŠ¨ç»‘å®šcpuæ ¸å¿ƒï¼Œé¿å…cache miss</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231222181928976.png" alt="image-20231222181928976"></p><div class='spoiler collapsed'>    <div class='spoiler-title'>        é€šç”¨ä¼˜åŒ–é…ç½®    </div>    <div class='spoiler-content'>        <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">user www;                   <span class="comment"># nginxè¿›ç¨‹å¯åŠ¨ç”¨æˆ·</span></span><br><span class="line">worker_processes auto;      <span class="comment">#ä¸cpuæ ¸å¿ƒä¸€è‡´å³å¯</span></span><br><span class="line">worker_cpu_affinity auto;   <span class="comment"># cpuäº²å’Œ</span></span><br><span class="line"></span><br><span class="line">error_log /var/log/nginx/error.log warn;    <span class="comment"># é”™è¯¯æ—¥å¿—</span></span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line">worker_rlimit_nofile 35535;     <span class="comment">#æ¯ä¸ªworkèƒ½æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè°ƒæ•´è‡³1wä»¥ä¸Š,è´Ÿè·è¾ƒé«˜å»ºè®®2-3w</span></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    use epoll;                  <span class="comment"># ä½¿ç”¨epollé«˜æ•ˆç½‘ç»œæ¨¡å‹ nginxé»˜è®¤å°±æ˜¯epollæ¨¡å‹</span></span><br><span class="line">    worker_connections 10240;   <span class="comment"># é™åˆ¶æ¯ä¸ªè¿›ç¨‹èƒ½å¤„ç†å¤šå°‘ä¸ªè¿æ¥ï¼Œ10240x[cpuæ ¸å¿ƒ]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include             mime.types;</span><br><span class="line">    default_type        application/octet-stream;</span><br><span class="line">    charset utf-8;      <span class="comment"># ç»Ÿä¸€ä½¿ç”¨utf-8å­—ç¬¦é›†</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å®šä¹‰æ—¥å¿—æ ¼å¼</span></span><br><span class="line">    log_format  main  <span class="string">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#å®šä¹‰jsonæ—¥å¿—æ ¼å¼              </span></span><br><span class="line">    log_format json_access <span class="string">&#x27;&#123;&quot;@timestamp&quot;:&quot;$time_iso8601&quot;,&#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;host&quot;:&quot;$server_addr&quot;,&#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;clientip&quot;:&quot;$remote_addr&quot;,&#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;size&quot;:$body_bytes_sent,&#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;responsetime&quot;:$request_time,&#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;upstreamtime&quot;:&quot;$upstream_response_time&quot;,&#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;upstreamhost&quot;:&quot;$upstream_addr&quot;,&#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;http_host&quot;:&quot;$host&quot;,&#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;url&quot;:&quot;$uri&quot;,&#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;domain&quot;:&quot;$host&quot;,&#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;xff&quot;:&quot;$http_x_forwarded_for&quot;,&#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;referer&quot;:&quot;$http_referer&quot;,&#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;status&quot;:&quot;$status&quot;&#125;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;    <span class="comment"># è®¿é—®æ—¥å¿—</span></span><br><span class="line"></span><br><span class="line">    server_tokens off;  <span class="comment"># ç¦æ­¢æµè§ˆå™¨æ˜¾ç¤ºnginxç‰ˆæœ¬å·</span></span><br><span class="line">    client_max_body_size 200m;  <span class="comment"># æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶è°ƒæ•´</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ–‡ä»¶é«˜æ•ˆä¼ è¾“ï¼Œé™æ€èµ„æºæœåŠ¡å™¨å»ºè®®æ‰“å¼€</span></span><br><span class="line">    sendfile            on;</span><br><span class="line">    tcp_nopush          on;</span><br><span class="line">    <span class="comment"># æ–‡ä»¶å®æ—¶ä¼ è¾“ï¼ŒåŠ¨æ€èµ„æºæœåŠ¡å»ºè®®æ‰“å¼€,éœ€è¦æ‰“å¼€keepalive</span></span><br><span class="line">    tcp_nodelay         on;</span><br><span class="line">    keepalive_timeout   65;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Gzip å‹ç¼©</span></span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_disable <span class="string">&quot;MSIE [1-6]\.&quot;</span>;    <span class="comment">#é’ˆå¯¹IEæµè§ˆå™¨ä¸è¿›è¡Œå‹ç¼©</span></span><br><span class="line">    gzip_http_version 1.1;</span><br><span class="line">    gzip_comp_level 2;      <span class="comment">#å‹ç¼©çº§åˆ«</span></span><br><span class="line">    gzip_buffers 16 8k;     <span class="comment">#å‹ç¼©çš„ç¼“å†²åŒº</span></span><br><span class="line">    gzip_min_length 1024;   <span class="comment">#æ–‡ä»¶å¤§äº1024å­—èŠ‚æ‰è¿›è¡Œå‹ç¼©ï¼Œé»˜è®¤å€¼20</span></span><br><span class="line">    gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript image/jpeg;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è™šæ‹Ÿä¸»æœº</span></span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231222184038687.png" alt="image-20231222184038687"></p>    </div></div><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Nginxæ€§èƒ½ä¼˜åŒ–&lt;/center&gt;&lt;/h1&gt;
&lt;h2 id=&quot;ä¸€ã€æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°&quot;&gt;ä¸€ã€æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒåšäº‹æœ‰åšäº‹çš„åŸåˆ™ï¼Œè§£å†³é—®é¢˜æœ‰è§£å†³é—®é¢˜çš„æ–¹æ³•ï¼Œé‚£æˆ‘ä»¬åœ¨åšæ€§èƒ½ä¼˜åŒ–å·¥ä½œä¹‹å‰ä¹ŸåŒæ ·è¦æœ‰è‡ªå·±çš„é€»è¾‘ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦åšä¼˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦é‡ç‚¹è€ƒè™‘å“ªäº›æ–¹é¢ï¼Œå’Œäº†è§£å“ªäº›æ–¹é¢å‘¢ï¼Ÿåœ¨å—æ±çœ‹æ¥ï¼Œä¸€åˆ‡ä¼˜åŒ–å·¥ä½œçš„ç›®çš„å°±æ˜¯åŸºäºä¸šåŠ¡ç¨³å®šå®‰å…¨çš„å‰æä¸‹å°½å¯èƒ½çš„æé«˜ç”¨æˆ·çš„è®¿é—®ä½“éªŒã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒ1ã€é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£å½“å‰ç³»ç»Ÿçš„ç»“æ„å’Œç“¶é¢ˆï¼Œå½“æˆ‘ä»¬çš„è„‘è¢‹é‡Œå­˜åœ¨ä¸€ä¸ªæ˜ç¡®çš„ä¸šåŠ¡æ¡†æ¶é€»è¾‘æ—¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯¹äºå°±ä¼šæœ‰ä¸€ä¸ªæ˜ç¡®çš„æ–¹å‘ã€‚æ¯”å¦‚äº†è§£æˆ‘ä»¬å…¬å¸å½“å‰ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆï¼Œè¿è¡Œçš„æ˜¯ä»€ä¹ˆä¸šåŠ¡ï¼Œéƒ½æœ‰å“ªäº›æœåŠ¡ï¼Œäº†è§£æ¯ä¸ªæœåŠ¡æœ€å¤§å¯æ”¯æ’‘å¤šå°‘å¹¶å‘ï¼Œèƒ½æ”¯æŒå¤šå°‘qpsï¼ˆæ¯ç§’æŸ¥è¯¢ç‡ï¼‰çš„è®¿é—®è¯·æ±‚ï¼Œè¿™ç»„ç³»ç»Ÿçš„æœ€é«˜ç“¶é¢ˆåœ¨å“ªé‡Œï¼Ÿ&lt;font color=&quot;gray&quot;&gt;&lt;em&gt;ï¼ˆæˆ‘ä»¬å¦‚ä½•è¯„å®šæˆ‘ä»¬ç³»ç»Ÿçš„ç“¶é¢ˆå‘¢ï¼Œä¾‹å¦‚ä½¿ç”¨topæŸ¥çœ‹ç³»ç»Ÿçš„CPUè´Ÿè½½ã€å†…å­˜ä½¿ç”¨ç‡ã€æ€»å¾—è¿è¡Œè¿›ç¨‹ç­‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ—¥å¿—å»åˆ†æè¯·æ±‚çš„æƒ…å†µï¼Œä¹Ÿå¯ä»¥é€šè¿‡æˆ‘ä»¬å‰é¢ä»‹ç»åˆ°çš„stub_statiusæ¨¡å—æŸ¥çœ‹å½“å‰çš„è¿æ¥æƒ…å†µï¼Œå¯¹çº¿ä¸Šçš„ä¸šåŠ¡è¿›è¡Œå‹åŠ›æµ‹è¯•ã€ä½å³°æœŸã€‘ï¼Œå»äº†è§£å½“å‰è¿™å¥—ç³»ç»Ÿèƒ½æ‰¿æ‹…å¤šå°‘çš„è¯·æ±‚å’Œå¹¶å‘ï¼Œåšå¥½å“åº”çš„è¯„ä¼°ã€‚è¿™ä¸ªæ˜¯æˆ‘ä»¬åšæ€§èƒ½ä¼˜åŒ–æœ€å…ˆè€ƒè™‘çš„åœ°æ–¹ã€‚ï¼‰&lt;/em&gt;&lt;/font&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒ2ã€äº†è§£ä¸šåŠ¡æ¨¡å¼ã€‚æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸ºä¸šåŠ¡æœåŠ¡çš„ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯æé«˜ä¸šåŠ¡èƒ½åŠ›ã€‚æˆ‘ä»¬éœ€è¦äº†è§£æ¯ä¸ªä¸šåŠ¡æ¥å£çš„ç±»å‹ï¼Œæ¯”å¦‚ï¼šç”µå•†ç½‘ç«™ä¸­çš„æŠ¢è´­æ¨¡å¼ï¼Œè¿™ç§æƒ…å†µä¸‹é¢ï¼Œå¹³æ—¶æ²¡ä»€ä¹ˆæµé‡ï¼Œä½†åˆ°äº†æŠ¢è´­æ—¶é—´æµé‡ä¼šçªå¢ã€‚æˆ‘ä»¬è¿˜éœ€è¦äº†è§£ç³»ç»Ÿå±‚æ¬¡åŒ–çš„ç»“æ„ï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬ä½¿ç”¨nginxåšçš„æ˜¯ä»£ç†ã€è¿˜æ˜¯åŠ¨é™åˆ†ç¦»ã€è¿˜æ˜¯åç«¯ç›´æ¥æœåŠ¡ç”¨æˆ·ï¼Œæˆ‘ä»¬è¦å¯¹æ¯ä¸€å±‚åšå¥½ç›¸åº”çš„æ¢³ç†ï¼Œä»¥ä¾¿æ›´å¥½çš„æœåŠ¡ä¸šåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒ3ã€æ€§èƒ½ä¸å®‰å…¨ã€‚é€šå¸¸ä¼šæœ‰è¿™æ ·ä¸€ä¸ªæƒ…å†µï¼Œæˆ‘ä»¬å¾€å¾€æ³¨é‡äº†æ€§èƒ½ï¼Œä½†æ˜¯å¿½ç•¥äº†å®‰å…¨ï¼Œå¾€å¾€è¿‡äºæ³¨é‡å®‰å…¨ï¼Œå¯¹æ€§èƒ½åˆä¼šäº§ç”Ÿå½±å“ã€‚æ¯”å¦‚ï¼šæˆ‘ä»¬åœ¨è®¾è®¡é˜²ç«å¢™åŠŸèƒ½æ—¶ï¼Œæ£€æµ‹è¿‡äºä¸¥å¯†ï¼Œè¿™æ ·å°±ä¼šç»™æ€§èƒ½å¸¦æ¥å½±å“ã€‚é‚£ä¹ˆå¦‚æœå¯¹äºæ€§èƒ½å®Œå…¨è¿½æ±‚ï¼Œå´ä¸é¡¾æœåŠ¡çš„å®‰å…¨ï¼Œä¹Ÿä¼šé€ æˆå¾ˆå¤§çš„éšæ‚£ã€‚æˆ‘ä»¬éœ€è¦è¯„ä¼°å¥½ä¸¤è€…çš„å…³ç³»ï¼ŒæŠŠæ¡å¥½ä¸¤è€…çš„å­°é‡å­°è½»ã€‚ä»¥åŠæ•´ä½“çš„ç›¸å…³æ€§ï¼Œæƒè¡¡å¥½å¯¹åº”çš„ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id=&quot;äºŒã€å‹åŠ›æµ‹è¯•å·¥å…·&quot;&gt;äºŒã€å‹åŠ›æµ‹è¯•å·¥å…·&lt;/h2&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@web1 ~]&lt;span class=&quot;comment&quot;&gt;#yum -y install httpd-tools&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@web1 ~]&lt;span class=&quot;comment&quot;&gt;#ab -k -c100 -n1000 http://nanxi.com/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;### -n è¦æ‰§è¡Œçš„è¯·æ±‚æ•°  -c è¯·æ±‚çš„å¹¶å‘æ•°  -k æ˜¯å¦å¼€å¯é•¿è¿æ¥&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;â€ƒâ€ƒæˆ‘ä»¬å¯ä»¥å…ˆä»¥è‡ªå·±çš„é™æ€ç½‘é¡µä¸ºä¾‹ï¼ˆç°åœ¨å¾ˆå¤šçš„ç½‘ç«™åŸºæœ¬éƒ½ä¼šè®¾ç½®å±è”½å¤–ç•Œå‹æµ‹ï¼‰ï¼Œæ¥åšä¸€ä¸ªå°æµ‹è¯•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231222163408848.png&quot; alt=&quot;image-20231222163408848&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="æœåŠ¡æ¶æ„" scheme="https://smallflames.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Keepalivedé«˜å¯ç”¨</title>
    <link href="https://smallflames.github.io/2023/12/20/Keepalived%E9%AB%98%E5%8F%AF%E7%94%A8/"/>
    <id>https://smallflames.github.io/2023/12/20/Keepalived%E9%AB%98%E5%8F%AF%E7%94%A8/</id>
    <published>2023-12-20T13:08:46.000Z</published>
    <updated>2023-12-21T14:19:31.763Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Keepalivedé«˜å¯ç”¨</center></h1><h2 id="ä¸€ã€KeepalivedåŸºæœ¬ç®€è¿°">ä¸€ã€KeepalivedåŸºæœ¬ç®€è¿°</h2><p>â€ƒâ€ƒé«˜å¯ç”¨ä¸€èˆ¬æ˜¯æŒ‡<mark>2å°æœºå™¨å¯åŠ¨ç€å®Œå…¨ç›¸åŒçš„ä¸šåŠ¡ç³»ç»Ÿ</mark>ï¼Œå½“æœ‰<mark>ä¸€å°æœºå™¨downæœº</mark>äº†ï¼Œ<mark>å¦å¤–ä¸€å°æœåŠ¡å™¨</mark>å°±èƒ½å¿«é€Ÿçš„æ¥ç®¡ï¼Œè¿™ç§<mark>å¿«é€Ÿæ¥ç®¡</mark>å¯¹äºè®¿é—®çš„ç”¨æˆ·æ˜¯æ— æ„ŸçŸ¥çš„ã€‚é«˜å¯ç”¨çš„å®ç°æ–¹å¼é€šå¸¸æœ‰ä¸¤ç§ï¼š<strong>ç¡¬ä»¶å®ç°é«˜å¯ç”¨ï¼ˆF5ï¼‰ã€è½¯ä»¶å®ç°é«˜å¯ç”¨ï¼ˆKeepalivedï¼‰</strong>ï¼Œæˆ‘ä»¬ä¸»è¦è®²è§£é€šè¿‡Keepalivedå®ç°é«˜å¯ç”¨ã€‚</p><p>â€ƒâ€ƒkeepalivedè½¯ä»¶æ˜¯åŸºäºVRRPåè®®å®ç°çš„ï¼Œä¸»è¦ç”¨äºè§£å†³å•ç‚¹æ•…éšœé—®é¢˜ã€‚</p><p>â€ƒâ€ƒè™šæ‹Ÿè·¯ç”±å†—ä½™åè®®(Virtual Router Redundancy Protocolï¼Œç®€ç§°VRRP)æ˜¯ç”±IETFæå‡ºçš„è§£å†³å±€åŸŸç½‘ä¸­é…ç½®é™æ€ç½‘å…³å‡ºç°å•ç‚¹å¤±æ•ˆç°è±¡çš„è·¯ç”±åè®®ã€‚åˆ©ç”¨VRRPï¼Œä¸€ç»„è·¯ç”±å™¨ï¼ˆåŒä¸€ä¸ªVLANä¸­çš„æ¥å£ï¼‰ååŒå·¥ä½œï¼Œä½†åªè¦ä¸€ä¸ªå¤„äºMasterçŠ¶æ€ï¼Œå¤„äºè¯¥çŠ¶æ€çš„è·¯ç”±å™¨æ¥å£æ‰¿æ‹…å®é™…æ•°æ®æµé‡çš„è½¬å‘ä»»åŠ¡ã€‚åœ¨ä¸€ä¸ªVRRPç»„å†…çš„å¤šä¸ªè·¯ç”±å™¨æ¥å£å…±ç”¨ä¸€ä¸ªè™šæ‹ŸIPåœ°å€ï¼Œè¯¥åœ°å€è¢«ä½œä¸ºå±€åŸŸç½‘å†…æ‰€æœ‰ä¸»æœºçš„ç¼ºçœç½‘å…³åœ°å€ã€‚</p><span id="more"></span><h2 id="äºŒã€Keepalivedé«˜å¯ç”¨å®‰è£…é…ç½®">äºŒã€Keepalivedé«˜å¯ç”¨å®‰è£…é…ç½®</h2><table><thead><tr><th>ä½œç”¨</th><th>IP</th><th style="text-align:left">è§’è‰²</th></tr></thead><tbody><tr><td>VIPï¼ˆè™šæ‹ŸIPï¼‰</td><td>192.168.10.234</td><td style="text-align:left">è™šæ‹ŸIPåœ°å€</td></tr><tr><td>node1</td><td>192.168.10.6</td><td style="text-align:left">Master</td></tr><tr><td>node2</td><td>192.168.10.11</td><td style="text-align:left">Backup</td></tr></tbody></table><p>â€ƒâ€ƒè¯¦ç»†é…ç½®ä»‹ç»å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@lb03 ~]<span class="comment">#yum -y install keepalived</span></span><br><span class="line">[root@lb03 ~]<span class="comment">#systemctl start keepalived</span></span><br><span class="line">[root@lb03 ~]<span class="comment">#systemctl enable keepalived</span></span><br><span class="line">[root@lb03 ~]<span class="comment">#cat /etc/keepalived/keepalived.conf</span></span><br><span class="line">global_defs &#123;</span><br><span class="line">    router_id lb02/lb03     <span class="comment">### æ ‡è®°æœåŠ¡å™¨idå¯è‡ªå®šä¹‰</span></span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP/MASTER     <span class="comment">### èº«ä»½çŠ¶æ€æ ‡è¯†ä¸»/å¤‡ keepalivedé»˜è®¤æ˜¯æŠ¢å æ¨¡å¼ï¼ŒæŠ¢å å¼åªè¦ä¸»è®¾å¤‡çš„keepalivedæœåŠ¡å­˜æ´»ï¼Œä¼šç›´æ¥æŠ¢å è™šæ‹ŸIP</span></span><br><span class="line">    interface eth0          <span class="comment">### ç½‘å¡ç»‘å®šæ¥å£ï¼Œåœ¨ç½‘å¡eth0ä¸Šç”Ÿæˆè™šæ‹ŸIP</span></span><br><span class="line">    virtual_router_id 50    <span class="comment">### å°ç»„æ ‡è¯†idï¼Œä¸¤å°éƒ¨ç½²äº†keepalivedæœåŠ¡çš„ä¸»æœºï¼Œé€šè¿‡è¿™ä¸ªæ ‡è¯†åˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€å°ç»„</span></span><br><span class="line">    <span class="comment">### åŒä¸€å°ç»„çš„ä¸»æœºå¯ä»¥æ¥å—å¯¹æ–¹çš„å¿ƒè·³æŠ¥æ–‡ï¼ˆå¿ƒè·³æŠ¥æ–‡ç”¨æ¥å‘å¯¹æ–¹ç¡®è®¤è‡ªå·±çš„è¿è¡ŒçŠ¶æ€ï¼‰</span></span><br><span class="line">    priority 100            <span class="comment">### ä¼˜å…ˆçº§ï¼ŒåŒä¸€å°ç»„å†…çš„ä¸»æœºä»¥ç¥¨æ•°æœ€ç»ˆå†³å®šä¸»/å¤‡</span></span><br><span class="line">    advert_int 1            <span class="comment">### ç›‘æµ‹é—´éš”æ—¶é—´</span></span><br><span class="line">    <span class="comment"># nopreempt   è®¾ç½®éæŠ¢å å¼ï¼Œä¸»æœåŠ¡å™¨é‡æ–°å­˜æ´»ï¼Œä¸ä¼šè‡ªåŠ¨æŠ¢å è™šæ‹ŸIPï¼Œæ³¨æ„éæŠ¢å å¼çš„ä¸¤å°æœåŠ¡å™¨èº«ä»½æ ‡è¯†å¿…é¡»ä¸€è‡´</span></span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS      <span class="comment">### è®¤è¯æ–¹å¼ï¼Œé€šè¿‡å¯†ç éªŒè¯</span></span><br><span class="line">        auth_pass 1111      <span class="comment">### ä¸»/å¤‡æœåŠ¡å™¨çš„å¯†ç å¿…é¡»ä¿æŒä¸€è‡´ï¼Œå¦åˆ™æ— æ³•æ¥æ”¶å¿ƒè·³æŠ¥æ–‡</span></span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.10.234      <span class="comment">### è™šæ‹ŸIPï¼ˆéƒ¨ç½²keepalivedæœåŠ¡çš„ä¸¤å°æœåŠ¡å™¨ï¼Œè‹¥æœ‰ä¸€å°downæ‰ï¼Œè™šæ‹ŸIPä¼šè‡ªåŠ¨é£˜ç§»è‡³å¦ä¸€å°ï¼‰</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€ƒâ€ƒå®ä¾‹æµ‹è¯•ï¼šï¼ˆæŠ¢å å¼ï¼‰</p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231221203538266.png" alt="image-20231221203538266"></p><p>â€ƒâ€ƒå®ä¾‹æµ‹è¯•ï¼šï¼ˆéæŠ¢å å¼ï¼‰</p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231221210328288.png" alt="image-20231221210328288"></p><h2 id="ä¸‰ã€é«˜å¯ç”¨keepalivedæ•…éšœè„‘è£‚">ä¸‰ã€é«˜å¯ç”¨keepalivedæ•…éšœè„‘è£‚</h2><p>â€ƒâ€ƒå½“ä¸¤å°é«˜å¯ç”¨æœåŠ¡å™¨åœ¨æŒ‡å®šçš„æ—¶é—´å†…ï¼Œæ— æ³•äº’ç›¸æ£€æµ‹åˆ°å¯¹æ–¹å¿ƒè·³è€Œå„è‡ªå¯åŠ¨æ•…éšœè½¬ç§»åŠŸèƒ½ï¼Œå–å¾—äº†èµ„æºä»¥åŠæœåŠ¡çš„æ‰€æœ‰æƒï¼Œè€Œæ­¤æ—¶çš„ä¸¤å°é«˜å¯ç”¨æœåŠ¡å™¨å¯¹éƒ½è¿˜æ´»ç€å¹¶ä½œæ­£å¸¸è¿è¡Œï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´åŒä¸€ä¸ªæœåŠ¡åœ¨ä¸¤ç«¯åŒæ—¶å¯åŠ¨è€Œå‘ç”Ÿå†²çªçš„ä¸¥é‡é—®é¢˜ï¼Œæœ€ä¸¥é‡çš„å°±æ˜¯ä¸¤å°ä¸»æœºåŒæ—¶å ç”¨ä¸€ä¸ªVIPçš„åœ°å€ï¼ˆç±»ä¼¼åŒç«¯å¯¼å…¥æ¦‚å¿µï¼‰ï¼Œå½“ç”¨æˆ·å†™å…¥æ•°æ®çš„æ—¶å€™å¯èƒ½ä¼šåˆ†åˆ«å†™å…¥åˆ°ä¸¤ç«¯ï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨ä¸¤ç«¯çš„æ•°æ®ä¸ä¸€è‡´æˆ–é€ æˆæ•°æ®çš„ä¸¢å¤±ï¼Œè¿™ç§æƒ…å†µå°±ç§°ä¸ºè„‘è£‚ã€‚<em><font color="gray">ï¼ˆè„‘è£‚çš„å¯èƒ½åŸå› ï¼šâ‘ é«˜å¯ç”¨æœåŠ¡å™¨å¯¹ä¹‹é—´å¿ƒè·³çº¿è·¯æ•…éšœï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸çš„é€šä¿¡ã€â‘¡æœåŠ¡å™¨ç½‘çº¿æ¾åŠ¨ç­‰ç½‘ç»œæ•…éšœã€â‘¢æœåŠ¡å™¨ç¡¬ä»¶æ•…éšœå‘ç”ŸæŸåç°è±¡è€Œå´©æºƒã€â‘£ä¸»å¤‡éƒ½å¼€å¯firewalldé˜²ç«å¢™â€¦ï¼‰</font></em> è„‘è£‚çš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¦‚æœå‘ç”Ÿé—¹è£‚ï¼Œåˆ™éšæœºkillæ‰ä¸€å°å³å¯</span></span><br><span class="line"><span class="comment">#åœ¨å¤‡ä¸Šç¼–å†™æ£€æµ‹è„šæœ¬, æµ‹è¯•å¦‚æœèƒ½pingé€šä¸»å¹¶ä¸”å¤‡èŠ‚ç‚¹è¿˜æœ‰VIPçš„è¯åˆ™è®¤ä¸ºäº§ç”Ÿäº†è£‚è„‘</span></span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line">vip=192.168.10.234</span><br><span class="line">lb02_ip=192.168.10.6</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">    ping -c 2 <span class="variable">$lb02_ip</span> &amp;&gt;/dev/null</span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 -a `ip add|grep <span class="string">&quot;<span class="variable">$vip</span>&quot;</span>|<span class="built_in">wc</span> -l` -eq 1 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;this is split brain.warning.&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;this is ok&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="built_in">sleep</span> 5</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="å››ã€é«˜å¯ç”¨keepalivedä¸nginxç»“åˆ">å››ã€é«˜å¯ç”¨keepalivedä¸nginxç»“åˆ</h2><p>â€ƒâ€ƒä¸ºä»€ä¹ˆåŸŸåè§£æåˆ°VIPå°±å¯ä»¥è®¿é—®nginxï¼ŸNginxé»˜è®¤ç›‘å¬åœ¨æ‰€æœ‰çš„IPåœ°å€ä¸Šï¼ŒVIPä¼šé£˜åˆ°ä¸€å°èŠ‚ç‚¹ä¸Šï¼Œç›¸å½“äºé‚£å°nginxå¤šäº†VIPè¿™ä¹ˆä¸€ä¸ªç½‘å¡ï¼Œæ‰€ä»¥å¯ä»¥è®¿é—®åˆ°nginxæ‰€åœ¨æœºå™¨ï¼Œ<strong>ä½†æ˜¯â€¦â€¦å¦‚æœnginxå®•æœºï¼Œä¼šå¯¼è‡´ç”¨æˆ·è¯·æ±‚å¤±è´¥ï¼Œä½†æ˜¯keepalivedæ²¡æœ‰æŒ‚æ‰å°±ä¸ä¼šè¿›è¡Œåˆ‡æ¢ï¼Œæ­¤æ—¶ç”¨æˆ·è®¿é—®å°±ä¼šå‡ºé—®é¢˜</strong>ï¼Œæ‰€ä»¥éœ€è¦ç¼–å†™ä¸€ä¸ªè„šæœ¬æ£€æµ‹Nginxçš„å­˜æ´»çŠ¶æ€ï¼Œå¦‚æœnginxä¸å­˜æ´»åˆ™ä¸»åŠ¨killæ‰keepalivedï¼Œè®©è™šæ‹ŸIPæ¼‚ç§»åˆ°ä¸‹ä¸€å°nginxä»£ç†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">nginxpid=$(ps -C nginx --no-header|<span class="built_in">wc</span> -l)</span><br><span class="line"></span><br><span class="line"><span class="comment">#1.åˆ¤æ–­Nginxæ˜¯å¦å­˜æ´»,å¦‚æœä¸å­˜æ´»åˆ™å°è¯•å¯åŠ¨Nginx</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$nginxpid</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">    systemctl start nginx</span><br><span class="line">    <span class="built_in">sleep</span> 3</span><br><span class="line">    <span class="comment">#2.ç­‰å¾…3ç§’åå†æ¬¡è·å–ä¸€æ¬¡NginxçŠ¶æ€</span></span><br><span class="line">    nginxpid=$(ps -C nginx --no-header|<span class="built_in">wc</span> -l) </span><br><span class="line">    <span class="comment">#3.å†æ¬¡è¿›è¡Œåˆ¤æ–­, å¦‚Nginxè¿˜ä¸å­˜æ´»åˆ™åœæ­¢Keepalived,è®©åœ°å€è¿›è¡Œæ¼‚ç§»,å¹¶é€€å‡ºè„šæœ¬  </span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$nginxpid</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">        systemctl stop keepalived</span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#ç»™è„šæœ¬å¢åŠ æ‰§è¡Œæƒé™</span></span><br><span class="line">[root@lb02 ~]<span class="comment"># chmod +x /root/check_web.sh</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">åœ¨lb02ä¸»æœºçš„keepalivedé…ç½®æ–‡ä»¶ä¸­è°ƒç”¨æ­¤è„š</span><br><span class="line">[root@lb02 ~]<span class="comment"># cat /etc/keepalived/keepalived.conf</span></span><br><span class="line">global_defs &#123;           </span><br><span class="line">    router_id lb02      </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#æ¯5ç§’æ‰§è¡Œä¸€æ¬¡è„šæœ¬ï¼Œè„šæœ¬æ‰§è¡Œå†…å®¹ä¸èƒ½è¶…è¿‡5ç§’ï¼Œå¦åˆ™ä¼šä¸­æ–­å†æ¬¡é‡æ–°æ‰§è¡Œè„šæœ¬</span></span><br><span class="line">vrrp_script check_web &#123;</span><br><span class="line">    script <span class="string">&quot;/root/check_web.sh&quot;</span></span><br><span class="line">    interval 5</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER        </span><br><span class="line">    interface eth0      </span><br><span class="line">    virtual_router_id 50    </span><br><span class="line">    priority 150        </span><br><span class="line">    advert_int 1        </span><br><span class="line">    authentication &#123;    </span><br><span class="line">        auth_type PASS  </span><br><span class="line">        auth_pass 1111  </span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123; </span><br><span class="line">        192.168.10.234    </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#è°ƒç”¨å¹¶è¿è¡Œè„šæœ¬</span></span><br><span class="line">     track_script &#123;</span><br><span class="line">     check_web</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">### æŠ¢å å¼ï¼Œä»…éœ€åœ¨masteré…ç½®å³å¯ã€‚å¦‚æœé…ç½®ä¸ºéæŠ¢å å¼ï¼Œé‚£ä¹ˆéœ€è¦ä¸¤å°æœåŠ¡å™¨éƒ½ä½¿ç”¨è¯¥è„šæœ¬!!!</span></span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Keepalivedé«˜å¯ç”¨&lt;/center&gt;&lt;/h1&gt;
&lt;h2 id=&quot;ä¸€ã€KeepalivedåŸºæœ¬ç®€è¿°&quot;&gt;ä¸€ã€KeepalivedåŸºæœ¬ç®€è¿°&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒé«˜å¯ç”¨ä¸€èˆ¬æ˜¯æŒ‡&lt;mark&gt;2å°æœºå™¨å¯åŠ¨ç€å®Œå…¨ç›¸åŒçš„ä¸šåŠ¡ç³»ç»Ÿ&lt;/mark&gt;ï¼Œå½“æœ‰&lt;mark&gt;ä¸€å°æœºå™¨downæœº&lt;/mark&gt;äº†ï¼Œ&lt;mark&gt;å¦å¤–ä¸€å°æœåŠ¡å™¨&lt;/mark&gt;å°±èƒ½å¿«é€Ÿçš„æ¥ç®¡ï¼Œè¿™ç§&lt;mark&gt;å¿«é€Ÿæ¥ç®¡&lt;/mark&gt;å¯¹äºè®¿é—®çš„ç”¨æˆ·æ˜¯æ— æ„ŸçŸ¥çš„ã€‚é«˜å¯ç”¨çš„å®ç°æ–¹å¼é€šå¸¸æœ‰ä¸¤ç§ï¼š&lt;strong&gt;ç¡¬ä»¶å®ç°é«˜å¯ç”¨ï¼ˆF5ï¼‰ã€è½¯ä»¶å®ç°é«˜å¯ç”¨ï¼ˆKeepalivedï¼‰&lt;/strong&gt;ï¼Œæˆ‘ä»¬ä¸»è¦è®²è§£é€šè¿‡Keepalivedå®ç°é«˜å¯ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒkeepalivedè½¯ä»¶æ˜¯åŸºäºVRRPåè®®å®ç°çš„ï¼Œä¸»è¦ç”¨äºè§£å†³å•ç‚¹æ•…éšœé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒè™šæ‹Ÿè·¯ç”±å†—ä½™åè®®(Virtual Router Redundancy Protocolï¼Œç®€ç§°VRRP)æ˜¯ç”±IETFæå‡ºçš„è§£å†³å±€åŸŸç½‘ä¸­é…ç½®é™æ€ç½‘å…³å‡ºç°å•ç‚¹å¤±æ•ˆç°è±¡çš„è·¯ç”±åè®®ã€‚åˆ©ç”¨VRRPï¼Œä¸€ç»„è·¯ç”±å™¨ï¼ˆåŒä¸€ä¸ªVLANä¸­çš„æ¥å£ï¼‰ååŒå·¥ä½œï¼Œä½†åªè¦ä¸€ä¸ªå¤„äºMasterçŠ¶æ€ï¼Œå¤„äºè¯¥çŠ¶æ€çš„è·¯ç”±å™¨æ¥å£æ‰¿æ‹…å®é™…æ•°æ®æµé‡çš„è½¬å‘ä»»åŠ¡ã€‚åœ¨ä¸€ä¸ªVRRPç»„å†…çš„å¤šä¸ªè·¯ç”±å™¨æ¥å£å…±ç”¨ä¸€ä¸ªè™šæ‹ŸIPåœ°å€ï¼Œè¯¥åœ°å€è¢«ä½œä¸ºå±€åŸŸç½‘å†…æ‰€æœ‰ä¸»æœºçš„ç¼ºçœç½‘å…³åœ°å€ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="æœåŠ¡æ¶æ„" scheme="https://smallflames.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>rewriteé‡å†™å’Œhttpsè·³è½¬</title>
    <link href="https://smallflames.github.io/2023/12/19/rewrite%E9%87%8D%E5%86%99%E5%92%8Chttps%E8%B7%B3%E8%BD%AC/"/>
    <id>https://smallflames.github.io/2023/12/19/rewrite%E9%87%8D%E5%86%99%E5%92%8Chttps%E8%B7%B3%E8%BD%AC/</id>
    <published>2023-12-19T10:38:58.000Z</published>
    <updated>2023-12-20T13:43:52.899Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>rewriteé‡å†™å’Œhttpsè·³è½¬</center></h1><h2 id="ä¸€ã€Nginxå®ç°Rewriteé‡å†™">ä¸€ã€Nginxå®ç°Rewriteé‡å†™</h2><p>â€ƒâ€ƒRewriteä¸»è¦å®ç°urlåœ°å€é‡å†™ï¼Œä»¥åŠé‡å®šå‘ï¼Œå°±æ˜¯æŠŠä¼ å…¥webçš„è¯·æ±‚é‡å®šå‘åˆ°å…¶ä»–urlçš„è¿‡ç¨‹ã€‚ã€</p><h3 id="1ã€Rewriteä½¿ç”¨åœºæ™¯">1ã€Rewriteä½¿ç”¨åœºæ™¯</h3><blockquote><p>1ã€åœ°å€è·³è½¬ï¼Œç”¨æˆ·è®¿é—®www.nanxi.comè¿™ä¸ªURLæ—¶ï¼Œå°†å…¶å®šå‘è‡³ä¸€ä¸ªæ–°çš„åŸŸå <a href="http://m.nanxi.com">m.nanxi.com</a><br>2ã€åè®®è·³è½¬ï¼Œç”¨æˆ·é€šè¿‡httpåè®®è¯·æ±‚ç½‘ç«™æ—¶ï¼Œå°†å…¶é‡æ–°è·³è½¬è‡³httpsåè®®æ–¹å¼<br>3ã€ä¼ªé™æ€ï¼Œå°†åŠ¨æ€é¡µé¢æ˜¾ç¤ºä¸ºé™æ€é¡µé¢æ–¹å¼çš„ä¸€ç§æŠ€æœ¯ï¼Œä¾¿äºæœç´¢å¼•æ“çš„å½•å…¥ï¼ŒåŒæ—¶å‡å°‘åŠ¨æ€URLåœ°å€å¯¹å¤–æš´éœ²è¿‡å¤šçš„å‚æ•°ï¼Œæå‡æ›´é«˜çš„å®‰å…¨æ€§ã€‚<br>4ã€æœç´¢å¼•æ“ï¼ŒSEOä¼˜åŒ–ä¾èµ–äºurlè·¯å¾„ï¼Œå¥½è®°çš„urlä¾¿äºæ”¯æŒæœç´¢å¼•æ“å½•å…¥ã€‚</p></blockquote><h3 id="2ã€Rewriteé…ç½®ç¤ºä¾‹">2ã€Rewriteé…ç½®ç¤ºä¾‹</h3><p>â€ƒâ€ƒrewriteæŒ‡ä»¤æ ¹æ®è¡¨è¾¾å¼æ¥é‡å®šå‘URLï¼Œæˆ–è€…ä¿®æ”¹å­—ç¬¦ä¸²ï¼Œå¯ä»¥åº”ç”¨äºserverï¼Œlocationï¼Œifç¯å¢ƒä¸‹ï¼Œæ¯è¡ŒrewriteæŒ‡ä»¤æœ€åè·Ÿä¸€ä¸ªflagæ ‡è®°ï¼Œæ”¯æŒçš„flagæ ‡è®°æœ‰å¦‚ä¸‹è¡¨æ ¼æ‰€ç¤ºï¼š</p><table><thead><tr><th>flag</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>last</td><td>æœ¬æ¡è§„åˆ™åŒ¹é…å®Œæˆåï¼Œåœæ­¢æœ¬locationåŒ¹é…ï¼Œé‡æ–°ä»¥æœ¬æ¡ç»“æœå‘è¯·æ±‚</td></tr><tr><td>break</td><td>æœ¬æ¡è§„åˆ™åŒ¹é…å®Œæˆåï¼Œåœæ­¢æœ¬locationåŒ¹é…ï¼Œç›´æ¥è¿”å›æœ¬æ¡è¯·æ±‚å†…å®¹</td></tr><tr><td>redirect</td><td>è¿”å›302ä¸´æ—¶é‡å®šå‘ï¼Œåœ°å€æ ä¼šæ˜¾ç¤ºè·³è½¬åçš„åœ°å€ï¼Œæ¯ä¸€æ¬¡è®¿é—®éƒ½ä¼šè®¿é—®æºç«™</td></tr><tr><td>permanent</td><td>è¿”å›301æ°¸ä¹…é‡å®šå‘ï¼Œåœ°å€æ ä¼šæ˜¾ç¤ºè·³è½¬åçš„åœ°å€ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡è®¿é—®æ—¶æ˜¯æºç«™</td></tr></tbody></table><span id="more"></span><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231219192227948.png" alt="image-20231219192227948"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231219191614582.png" alt="image-20231219191614582"></p><p>â€ƒâ€ƒæ³¨æ„ï¼Œç›´æ¥è®¿é—®nanxi.comæ—¶ï¼Œä¼šæ˜¾ç¤º403ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰é…ç½®index.htmlæ–‡ä»¶ã€‚æ²¡æœ‰æ·»åŠ æ ‡è®°æ—¶å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231219192709141.png" alt="image-20231219192709141"></p><p>â€ƒâ€ƒå½“æˆ‘ä»¬åœ¨é…ç½®ä¸­çš„rewriteåé¢æ·»åŠ flagæ ‡è®°æ—¶æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231219194001114.png" alt="image-20231219194001114"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231219194441074.png" alt="image-20231219194441074"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231219195930180.png" alt="image-20231219195930180"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231219201249341.png" alt="image-20231219201249341"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231219202036927.png" alt="image-20231219202036927"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231219202451564.png" alt="image-20231219202451564"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231219203608235.png" alt="image-20231219203608235"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231219204910828.png" alt="image-20231219204910828"></p><div class='spoiler collapsed'>    <div class='spoiler-title'>        Nginxå†…ç½®å‚æ•°    </div>    <div class='spoiler-content'>        <p>$args                                   #è¿™ä¸ªå˜é‡ç­‰äºè¯·æ±‚è¡Œä¸­çš„å‚æ•°ã€‚<br>$content_length                #è¯·æ±‚å¤´ä¸­çš„Content-lengthå­—æ®µã€‚<br>$content_type                   #è¯·æ±‚å¤´ä¸­çš„Content-Typeå­—æ®µã€‚<br>$document_root               #å½“å‰è¯·æ±‚åœ¨rootæŒ‡ä»¤ä¸­æŒ‡å®šçš„å€¼ã€‚<br>$host                                  #è¯·æ±‚ä¸»æœºå¤´å­—æ®µï¼Œå¦åˆ™ä¸ºæœåŠ¡å™¨åç§°ã€‚<br>$http_user_agent             #å®¢æˆ·ç«¯agentä¿¡æ¯<br>$http_cookie                     #å®¢æˆ·ç«¯cookieä¿¡æ¯<br>$limit_rate                         #è¿™ä¸ªå˜é‡å¯ä»¥é™åˆ¶è¿æ¥é€Ÿç‡ã€‚<br>$request_body_file          #å®¢æˆ·ç«¯è¯·æ±‚ä¸»ä½“ä¿¡æ¯çš„ä¸´æ—¶æ–‡ä»¶åã€‚<br>$request_method            #å®¢æˆ·ç«¯è¯·æ±‚çš„åŠ¨ä½œï¼Œé€šå¸¸ä¸ºGETæˆ–POSTã€‚<br>$remote_addr                  #å®¢æˆ·ç«¯çš„IPåœ°å€ã€‚<br>$remote_port                   #å®¢æˆ·ç«¯çš„ç«¯å£ã€‚<br>$remote_user                  #å·²ç»ç»è¿‡Auth Basic ModuleéªŒè¯çš„ç”¨æˆ·åã€‚<br>$request_filename          #å½“å‰è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„ï¼Œç”±rootæˆ–aliasæŒ‡ä»¤ä¸URIè¯·æ±‚ç”Ÿæˆã€‚<br>$query_string                   #ä¸$argsç›¸åŒã€‚<br>$scheme                           #HTTPæ–¹æ³•ï¼ˆå¦‚httpï¼Œhttpsï¼‰ã€‚<br>$server_protocol             #è¯·æ±‚ä½¿ç”¨çš„åè®®ï¼Œé€šå¸¸æ˜¯HTTP/1.0æˆ–HTTP/1.1ã€‚<br>$server_addr                    #æœåŠ¡å™¨åœ°å€ï¼Œåœ¨å®Œæˆä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨åå¯ä»¥ç¡®å®šè¿™ä¸ªå€¼ã€‚<br>$server_name                  #æœåŠ¡å™¨åç§°ã€‚<br>$server_port                    #è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨çš„ç«¯å£å·ã€‚<br>$request_uri                    #åŒ…å«è¯·æ±‚å‚æ•°çš„åŸå§‹URIï¼Œä¸åŒ…å«ä¸»æœºåï¼Œå¦‚ï¼šâ€/foo/bar.php?arg=bazâ€ã€‚<br>$uri                                    #ä¸å¸¦è¯·æ±‚å‚æ•°çš„å½“å‰URIï¼Œ$uriä¸åŒ…å«ä¸»æœºåï¼Œå¦‚â€/foo/bar.htmlâ€ã€‚<br>$document_uri               #ä¸$uriç›¸åŒã€‚</p><p>$X-Forwarded-For:HTTPçš„è¯·æ±‚ç«¯çœŸå®çš„IPï¼Œåªæœ‰åœ¨é€šè¿‡äº†HTTP ä»£ç†æˆ–è€…è´Ÿè½½å‡è¡¡æœåŠ¡å™¨æ—¶æ‰ä¼šæ·»åŠ è¯¥é¡¹ã€‚æ ‡å‡†æ ¼å¼å¦‚ä¸‹ï¼šX-Forwarded-For: client1, proxy1, proxy2</p>    </div></div><h2 id="äºŒã€Ningx-HTTPS-å®è·µ">äºŒã€Ningx HTTPS å®è·µ</h2><p>â€ƒâ€ƒä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨HTTPSï¼Œå› ä¸ºHTTPä¸å®‰å…¨ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨httpç½‘ç«™æ—¶ï¼Œä¼šé­åˆ°åŠ«æŒå’Œç¯¡æ”¹ï¼Œå¦‚æœé‡‡ç”¨httpsåè®®ï¼Œé‚£ä¹ˆæ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯åŠ å¯†çš„ï¼Œæ‰€ä»¥é»‘å®¢æ— æ³•çªƒå–æˆ–è€…ç¯¡æ”¹æ•°æ®æŠ¥æ–‡ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿé¿å…ç½‘ç«™ä¼ è¾“æ—¶ä¿¡æ¯æ³„éœ²ï¼Œæˆ‘ä»¬ç°åœ¨ä½¿ç”¨çš„æ›´å¤šçš„æ˜¯TLSåŠ å¯†åè®®ã€‚</p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231219205244667.png" alt="image-20231219205244667"></p><h3 id="1ã€SSLåŠ å¯†è¿‡ç¨‹">1ã€SSLåŠ å¯†è¿‡ç¨‹</h3><p>â€ƒâ€ƒåœ¨æ•°æ®è¿›è¡ŒåŠ å¯†ä¸è§£å¯†è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•ç¡®å®šåŒæ–¹çš„èº«ä»½ï¼Œæ­¤æ—¶å°±éœ€è¦æœ‰ä¸€ä¸ªæƒå¨æœºæ„æ¥éªŒè¯åŒæ–¹èº«ä»½ï¼Œé‚£ä¹ˆè¿™ä¸ªæƒå¨æœºæ„å°±æ˜¯CAæœºæ„ï¼ŒCAæœºæ„é¢å‘è¯ä¹¦çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231219205556939.png" alt="image-20231219205556939"></p><p>â€ƒâ€ƒæˆ‘ä»¬ç”³è¯·è¯ä¹¦æ—¶éœ€è¦å…ˆå»ç™»è®°æœºæ„è¿›è¡Œèº«ä»½ç™»è®°ï¼Œæˆ‘æ˜¯è°ï¼Œæˆ‘æ˜¯ä»€ä¹ˆå•ä½ï¼Œæˆ‘æ˜¯å¹²å˜›çš„ï¼Œæˆ‘æƒ³åšä»€ä¹ˆï¼Œç„¶åç™»è®°æœºæ„å†é€šè¿‡CSRå‘ç»™CAï¼ŒCAä¸­å¿ƒé€šè¿‡åä¼šç”Ÿæˆä¸€å †å…¬é’¥å’Œç§é’¥ï¼Œå…¬é’¥ä¼šåœ¨CAè¯ä¹¦é“¾ä¸­ä¿å­˜ï¼Œå…¬é’¥å’Œç§é’¥è¯ä¹¦æˆ‘ä»¬æ‹¿åˆ°åï¼Œä¼šå°†å…¶éƒ¨ç½²åœ¨WEBæœåŠ¡å™¨ä¸Šï¼Œå½“æµè§ˆå™¨è®¿é—®æˆ‘ä»¬çš„httpsç«™ç‚¹æ—¶ï¼Œå®ƒä¼šå»è¯·æ±‚æˆ‘ä»¬çš„è¯ä¹¦ï¼ŒNginxè¿™æ ·çš„webæœåŠ¡å™¨ä¼šå°†æˆ‘ä»¬è¯ä¹¦çš„å…¬é’¥å‘ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨ä¼šå»éªŒè¯æˆ‘ä»¬çš„è¯ä¹¦æ˜¯å¦åˆæ³•ã€‚</p><blockquote><p><strong>è¯¦ç»†æµç¨‹</strong></p><p>1ã€æµè§ˆå™¨å‘èµ·å¾€æœåŠ¡å™¨çš„443ç«¯å£å‘èµ·è¯·æ±‚ï¼Œè¯·æ±‚æºå¸¦äº†æµè§ˆå™¨æ”¯æŒçš„åŠ å¯†ç®—æ³•å’Œå“ˆå¸Œç®—æ³•ã€‚<br>2ã€æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œé€‰æ‹©æµè§ˆå™¨æ”¯æŒçš„åŠ å¯†ç®—æ³•å’Œå“ˆå¸Œç®—æ³•ã€‚<br>3ã€æœåŠ¡å™¨ä¸‹å°†æ•°å­—è¯ä¹¦è¿”å›ç»™æµè§ˆå™¨ï¼Œè¿™é‡Œçš„æ•°å­—è¯ä¹¦å¯ä»¥æ˜¯å‘æŸä¸ªå¯é æœºæ„ç”³è¯·çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯è‡ªåˆ¶çš„ã€‚<br>4ã€æµè§ˆå™¨è¿›å…¥æ•°å­—è¯ä¹¦è®¤è¯ç¯èŠ‚ï¼Œè¿™ä¸€éƒ¨åˆ†æ˜¯æµè§ˆå™¨å†…ç½®çš„TLSå®Œæˆçš„ï¼šé¦–å…ˆæµè§ˆå™¨ä¼šä»å†…ç½®çš„è¯ä¹¦åˆ—è¡¨ä¸­ç´¢å¼•ï¼Œæ‰¾åˆ°æœåŠ¡å™¨ä¸‹å‘è¯ä¹¦å¯¹åº”çš„æœºæ„ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œæ­¤æ—¶å°±ä¼šæç¤ºç”¨æˆ·è¯¥è¯ä¹¦æ˜¯ä¸æ˜¯ç”±æƒå¨æœºæ„é¢å‘ï¼Œæ˜¯ä¸å¯ä¿¡ä»»çš„ã€‚å¦‚æœæŸ¥åˆ°äº†å¯¹åº”çš„æœºæ„ï¼Œåˆ™å–å‡ºè¯¥æœºæ„é¢å‘çš„å…¬é’¥ã€‚ç”¨æœºæ„çš„è¯ä¹¦å…¬é’¥è§£å¯†å¾—åˆ°è¯ä¹¦çš„å†…å®¹å’Œè¯ä¹¦ç­¾åï¼Œå†…å®¹åŒ…æ‹¬ç½‘ç«™çš„ç½‘å€ã€ç½‘ç«™çš„å…¬é’¥ã€è¯ä¹¦çš„æœ‰æ•ˆæœŸç­‰ã€‚æµè§ˆå™¨ä¼šå…ˆéªŒè¯è¯ä¹¦ç­¾åçš„åˆæ³•æ€§ï¼ˆéªŒè¯è¿‡ç¨‹ç±»ä¼¼ä¸Šé¢Bobå’ŒSusançš„é€šä¿¡ï¼‰ã€‚ç­¾åé€šè¿‡åï¼Œæµè§ˆå™¨éªŒè¯è¯ä¹¦è®°å½•çš„ç½‘å€æ˜¯å¦å’Œå½“å‰ç½‘å€æ˜¯ä¸€è‡´çš„ï¼Œä¸ä¸€è‡´ä¼šæç¤ºç”¨æˆ·ã€‚å¦‚æœç½‘å€ä¸€è‡´ä¼šæ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸï¼Œè¯ä¹¦è¿‡æœŸäº†ä¹Ÿä¼šæç¤ºç”¨æˆ·ã€‚è¿™äº›éƒ½é€šè¿‡è®¤è¯æ—¶ï¼Œæµè§ˆå™¨å°±å¯ä»¥å®‰å…¨ä½¿ç”¨è¯ä¹¦ä¸­çš„ç½‘ç«™å…¬é’¥äº†ã€‚æµè§ˆå™¨ä¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•°Rï¼Œå¹¶ä½¿ç”¨ç½‘ç«™å…¬é’¥å¯¹Rè¿›è¡ŒåŠ å¯†ã€‚<br>5ã€æµè§ˆå™¨å°†åŠ å¯†çš„Rä¼ é€ç»™æœåŠ¡å™¨ã€‚<br>6ã€æœåŠ¡å™¨ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†å¾—åˆ°Rã€‚<br>7ã€æœåŠ¡å™¨ä»¥Rä¸ºå¯†é’¥ä½¿ç”¨äº†å¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†ç½‘é¡µå†…å®¹å¹¶ä¼ è¾“ç»™æµè§ˆå™¨ã€‚<br>8ã€æµè§ˆå™¨ä»¥Rä¸ºå¯†é’¥ä½¿ç”¨ä¹‹å‰çº¦å®šå¥½çš„è§£å¯†ç®—æ³•è·å–ç½‘é¡µå†…å®¹ã€‚</p></blockquote><p>â€ƒâ€ƒ<strong>ä½¿ç”¨HTTPåè®®æ¨¡æ‹Ÿç½‘ç«™è¢«ç¯¡æ”¹</strong></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231219211323573.png" alt="image-20231219211323573"></p><p>â€ƒâ€ƒæ­¤æ—¶æˆ‘ä»¬æ‰“å¼€å¦ä¸€å°æœåŠ¡å™¨ï¼Œå¯¹192.168.10.200è¿›è¡ŒåŠ«æŒï¼Œè¿™å°æœåŠ¡å™¨ç­‰åŒäºä»£ç†æˆ‘ä»¬å»è®¿é—®ï¼ˆå½“ç„¶ç°å®è¿‡ç¨‹ä¸­æˆ‘ä»¬æ˜¯ä¸çŸ¥é“çš„ï¼‰192.168.10.200è¿™ä¸ªIPï¼Œç„¶åè¿”å›ç»™æˆ‘ä»¬çš„å¯èƒ½æ˜¯å®ƒä¿®æ”¹è¿‡çš„å†…å®¹ï¼</p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231219212959089.png" alt="image-20231219212959089"></p><h3 id="2ã€SSLè¯ä¹¦ç±»å‹ä»‹ç»">2ã€SSLè¯ä¹¦ç±»å‹ä»‹ç»</h3><table><thead><tr><th>å¯¹æ¯”</th><th>åŸŸåå‹ DV</th><th>ä¼ä¸šå‹ OV</th><th>å¢å¼ºå‹ EV</th></tr></thead><tbody><tr><td>ä¸€èˆ¬ç”¨é€”</td><td>ä¸ªäººç«™ç‚¹å’Œåº”ç”¨ï¼›<br /> ç®€å•çš„åŠ å¯†éœ€æ±‚</td><td>ç”µå­å•†åŠ¡ç«™ç‚¹å’Œåº”ç”¨ï¼›<br /> ä¸­å°å‹ä¼ä¸šç«™ç‚¹</td><td>å¤§å‹é‡‘èå¹³å°ï¼›<br /> å¤§å‹ä¼ä¸šå’Œæ”¿åºœæœºæ„ç«™ç‚¹</td></tr><tr><td>å®¡æ ¸å†…å®¹</td><td>åŸŸåæ‰€æœ‰æƒéªŒè¯</td><td>å…¨é¢çš„ä¼ä¸šèº«ä»½éªŒè¯ï¼› <br />åŸŸåæ‰€æœ‰æƒéªŒè¯</td><td>æœ€é«˜ç­‰çº§çš„ä¼ä¸šèº«ä»½éªŒè¯ï¼›<br /> åŸŸåæ‰€æœ‰æƒéªŒè¯</td></tr><tr><td>é¢å‘æ—¶é•¿</td><td>10åˆ†é’Ÿ-24å°æ—¶</td><td>3-5ä¸ªå·¥ä½œæ—¥</td><td>5-7ä¸ªå·¥ä½œæ—¥</td></tr><tr><td>å•æ¬¡ç”³è¯·å¹´é™</td><td>3ä¸ªæœˆ</td><td>1-2å¹´</td><td>1-2å¹´</td></tr><tr><td>èµ”ä»˜ä¿éšœé‡‘</td><td>â€”â€”</td><td>125-175ä¸‡ç¾é‡‘</td><td>150-175ä¸‡ç¾é‡‘</td></tr></tbody></table><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231219213804568.png" alt="image-20231219213804568"></p><blockquote><p>httpsä¸æ”¯æŒç»­è´¹ï¼Œè¯ä¹¦åˆ°æœŸéœ€è¦é‡æ–°ç”³è¯·å¹¶è¿›è¡Œæ›¿æ¢<br>httpsä¸æ”¯æŒä¸‰çº§åŸŸåè§£æï¼Œå¦‚ <a href="http://test.m.nanxi.com">test.m.nanxi.com</a><br>httpsæ˜¾ç¤ºç»¿è‰²ï¼Œè¯´æ˜æ•´ä¸ªç½‘ç«™çš„urléƒ½æ˜¯httpsä¿æŠ¤çš„<br>httpsæ˜¾ç¤ºé»„è‰²ï¼Œå› ä¸ºç½‘ç«™ä»£ç ä¸­åŒ…å«httpçš„ä¸å®‰å…¨é“¾æ¥<br>httpsæ˜¾ç¤ºçº¢è‰²ï¼Œé‚£ä¹ˆè¯ä¹¦æ˜¯å‡çš„æˆ–è€…è¯ä¹¦è¿‡æœŸã€‚</p></blockquote><h3 id="3ã€Nginx-è‡ªç­¾è¯å®ç°HTTPS">3ã€Nginx è‡ªç­¾è¯å®ç°HTTPS</h3><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231219214520781.png" alt="image-20231219214520781"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231219215115983.png" alt="image-20231219215115983"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231219215327225.png" alt="image-20231219215327225"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231219214947233.png" alt="image-20231219214947233"></p><h3 id="4ã€Webé›†ç¾¤å®ç°HTTPS">4ã€Webé›†ç¾¤å®ç°HTTPS</h3><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231220213207285.png" alt="image-20231220213207285"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231220213359427.png" alt="image-20231220213359427"></p><p>æ³¨æ„âš ï¸ ï¼š <mark>è¯ä¹¦åªé…åˆ°è´Ÿè½½å‡è¡¡ä¸Šå³å¯ï¼Œå¦‚æœè´Ÿè½½å‡è¡¡é…ç½®äº†httpsåè®®ï¼Œç›¸åº”çš„webç«¯ä¹Ÿå¿…é¡»æ”¯æŒhttpsåè®®ï¼Œå¦åˆ™é¡µé¢ä¼šå‡ºç°æ— æ ·å¼çš„ç°è±¡ï¼ŒåŒæ ·çš„ï¼Œå¦‚æœwebè®¾ç½®æ”¯æŒhttpsä½†æ˜¯æ²¡æœ‰ä½¿ç”¨è·³è½¬httpsï¼Œä¼šå‡ºç°åŒæ ·çš„æ— æ ·å¼çš„æƒ…å†µï¼Œä¸”è®¿é—®ææ…¢ã€‚</mark>ï¼ˆä¸€æ—¦è®¾ç½®æ”¯æŒhttpsåè®®ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„é¡µé¢éƒ½ä¼šæŒ‰ç…§httpsçš„åŸç†è¿è¡Œï¼Œé»˜è®¤çš„httpåè®®å°†ä¸å†è¢«è¿è¡Œï¼ï¼‰</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;rewriteé‡å†™å’Œhttpsè·³è½¬&lt;/center&gt;&lt;/h1&gt;
&lt;h2 id=&quot;ä¸€ã€Nginxå®ç°Rewriteé‡å†™&quot;&gt;ä¸€ã€Nginxå®ç°Rewriteé‡å†™&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒRewriteä¸»è¦å®ç°urlåœ°å€é‡å†™ï¼Œä»¥åŠé‡å®šå‘ï¼Œå°±æ˜¯æŠŠä¼ å…¥webçš„è¯·æ±‚é‡å®šå‘åˆ°å…¶ä»–urlçš„è¿‡ç¨‹ã€‚ã€&lt;/p&gt;
&lt;h3 id=&quot;1ã€Rewriteä½¿ç”¨åœºæ™¯&quot;&gt;1ã€Rewriteä½¿ç”¨åœºæ™¯&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;1ã€åœ°å€è·³è½¬ï¼Œç”¨æˆ·è®¿é—®www.nanxi.comè¿™ä¸ªURLæ—¶ï¼Œå°†å…¶å®šå‘è‡³ä¸€ä¸ªæ–°çš„åŸŸå &lt;a href=&quot;http://m.nanxi.com&quot;&gt;m.nanxi.com&lt;/a&gt;&lt;br&gt;
2ã€åè®®è·³è½¬ï¼Œç”¨æˆ·é€šè¿‡httpåè®®è¯·æ±‚ç½‘ç«™æ—¶ï¼Œå°†å…¶é‡æ–°è·³è½¬è‡³httpsåè®®æ–¹å¼&lt;br&gt;
3ã€ä¼ªé™æ€ï¼Œå°†åŠ¨æ€é¡µé¢æ˜¾ç¤ºä¸ºé™æ€é¡µé¢æ–¹å¼çš„ä¸€ç§æŠ€æœ¯ï¼Œä¾¿äºæœç´¢å¼•æ“çš„å½•å…¥ï¼ŒåŒæ—¶å‡å°‘åŠ¨æ€URLåœ°å€å¯¹å¤–æš´éœ²è¿‡å¤šçš„å‚æ•°ï¼Œæå‡æ›´é«˜çš„å®‰å…¨æ€§ã€‚&lt;br&gt;
4ã€æœç´¢å¼•æ“ï¼ŒSEOä¼˜åŒ–ä¾èµ–äºurlè·¯å¾„ï¼Œå¥½è®°çš„urlä¾¿äºæ”¯æŒæœç´¢å¼•æ“å½•å…¥ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;2ã€Rewriteé…ç½®ç¤ºä¾‹&quot;&gt;2ã€Rewriteé…ç½®ç¤ºä¾‹&lt;/h3&gt;
&lt;p&gt;â€ƒâ€ƒrewriteæŒ‡ä»¤æ ¹æ®è¡¨è¾¾å¼æ¥é‡å®šå‘URLï¼Œæˆ–è€…ä¿®æ”¹å­—ç¬¦ä¸²ï¼Œå¯ä»¥åº”ç”¨äºserverï¼Œlocationï¼Œifç¯å¢ƒä¸‹ï¼Œæ¯è¡ŒrewriteæŒ‡ä»¤æœ€åè·Ÿä¸€ä¸ªflagæ ‡è®°ï¼Œæ”¯æŒçš„flagæ ‡è®°æœ‰å¦‚ä¸‹è¡¨æ ¼æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;flag&lt;/th&gt;
&lt;th&gt;ä½œç”¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;last&lt;/td&gt;
&lt;td&gt;æœ¬æ¡è§„åˆ™åŒ¹é…å®Œæˆåï¼Œåœæ­¢æœ¬locationåŒ¹é…ï¼Œé‡æ–°ä»¥æœ¬æ¡ç»“æœå‘è¯·æ±‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;break&lt;/td&gt;
&lt;td&gt;æœ¬æ¡è§„åˆ™åŒ¹é…å®Œæˆåï¼Œåœæ­¢æœ¬locationåŒ¹é…ï¼Œç›´æ¥è¿”å›æœ¬æ¡è¯·æ±‚å†…å®¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;redirect&lt;/td&gt;
&lt;td&gt;è¿”å›302ä¸´æ—¶é‡å®šå‘ï¼Œåœ°å€æ ä¼šæ˜¾ç¤ºè·³è½¬åçš„åœ°å€ï¼Œæ¯ä¸€æ¬¡è®¿é—®éƒ½ä¼šè®¿é—®æºç«™&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;permanent&lt;/td&gt;
&lt;td&gt;è¿”å›301æ°¸ä¹…é‡å®šå‘ï¼Œåœ°å€æ ä¼šæ˜¾ç¤ºè·³è½¬åçš„åœ°å€ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡è®¿é—®æ—¶æ˜¯æºç«™&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="æœåŠ¡æ¶æ„" scheme="https://smallflames.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Shellè„šæœ¬ç¯‡001</title>
    <link href="https://smallflames.github.io/2023/12/18/Shell%E8%84%9A%E6%9C%AC%E7%AF%87001/"/>
    <id>https://smallflames.github.io/2023/12/18/Shell%E8%84%9A%E6%9C%AC%E7%AF%87001/</id>
    <published>2023-12-18T12:28:21.000Z</published>
    <updated>2024-01-23T13:57:19.625Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Shellè„šæœ¬ç¯‡001</center></h1><table><tr><td bgcolor=#000000><font color="white">å®ç°æ•ˆæœ</font></td></tr></table><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231218203518420.png" alt="image-20231218203518420"></p><span id="more"></span><table><tr><td bgcolor=#000000><font color="white">å®ç°è„šæœ¬</font></td></tr></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author:   nanxi</span></span><br><span class="line"><span class="comment">#Date: 2023-12-13</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ¤æ–­å‚æ•°æ˜¯å¦æ­£ç¡®</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -ne 1 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;å‚æ•°ä¸ªæ•°é”™è¯¯ï¼ï¼ï¼&quot;</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ¤æ–­æ–‡ä»¶ç›®å½•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="variable">$1</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;æ–‡ä»¶ä¸å­˜åœ¨&#x27;</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">DATE=$(<span class="built_in">date</span> +%y%m%d)</span><br><span class="line">DIR_NAME=$(<span class="built_in">basename</span> <span class="variable">$1</span>)</span><br><span class="line">DIR_PATH=$(<span class="built_in">cd</span> $(<span class="built_in">dirname</span> <span class="variable">$1</span>);<span class="built_in">pwd</span>;)</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="comment">#å®šä¹‰å½’æ¡£æ–‡ä»¶çš„åç§°å’Œç›®å½•</span></span><br><span class="line">NAME=<span class="variable">$&#123;DIR_NAME&#125;</span>_archive_<span class="variable">$DATE</span>.tar.gz</span><br><span class="line"><span class="keyword">if</span> [ ! -d /backup/archive ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /backup/archive</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">FILEPATH=/backup/archive/<span class="variable">$NAME</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¼€å§‹å½’æ¡£æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">echo</span> ---------å¼€å§‹å½’æ¡£æ–‡ä»¶----------</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line">tar -Pzcf <span class="variable">$FILEPATH</span> <span class="variable">$&#123;DIR_PATH&#125;</span>/<span class="variable">$&#123;DIR_NAME&#125;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> å½’æ¡£æˆåŠŸ</span><br><span class="line"><span class="built_in">echo</span> å½’æ¡£çš„æ–‡ä»¶æ˜¯:<span class="variable">$DIR_PATH</span>/<span class="variable">$DIR_NAME</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;å½’æ¡£åçš„ä½ç½®ä¸º:<span class="variable">$FILEPATH</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;å½’æ¡£å¤±è´¥ï¼Œè¯·æ£€æŸ¥ï¼ï¼ï¼&quot;</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> -------------------------------</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Shellè„šæœ¬ç¯‡001&lt;/center&gt;&lt;/h1&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;å®ç°æ•ˆæœ&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231218203518420.png&quot; alt=&quot;image-20231218203518420&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="Shellç¼–ç¨‹" scheme="https://smallflames.github.io/tags/Shell%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>nginxå®ç°åŠ¨é™åˆ†ç¦»</title>
    <link href="https://smallflames.github.io/2023/12/18/nginx%E5%AE%9E%E7%8E%B0%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB/"/>
    <id>https://smallflames.github.io/2023/12/18/nginx%E5%AE%9E%E7%8E%B0%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB/</id>
    <published>2023-12-18T09:43:50.000Z</published>
    <updated>2023-12-18T12:19:49.556Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Nginxå®ç°åŠ¨é™åˆ†ç¦»</center></h1><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231218180340246.png" alt="image-20231218180340246"></p><table><tr><td bgcolor=#000000><font color="white">ç¯å¢ƒå‡†å¤‡</font></td></tr></table><table><thead><tr><th>è§’è‰²</th><th>IPåœ°å€</th></tr></thead><tbody><tr><td>è´Ÿè½½å‡è¡¡ï¼ˆlbï¼‰</td><td>192.168.10.3</td></tr><tr><td>web1ï¼ˆé™æ€èµ„æºï¼‰</td><td>192.168.10.200</td></tr><tr><td>web2ï¼ˆåŠ¨æ€èµ„æºï¼‰</td><td>192.168.10.201</td></tr></tbody></table><table><tr><td bgcolor=#000000><font color="white">å®ç°è¿‡ç¨‹</font></td></tr></table><p>1ï¸âƒ£ web1é…ç½®é™æ€èµ„æºï¼›</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@web1 /etc/nginx/conf.d]<span class="comment">#vim nanxi.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        root /code;</span><br><span class="line">charset utf-8,gbk;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">        index index.html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">[root@web1 /code]<span class="comment">#echo &#x27;&lt;h1&gt;&lt;center&gt;å—æ±666520&lt;/center&gt;&lt;/h1&gt;&#x27; &gt;index.html</span></span><br></pre></td></tr></table></figure><span id="more"></span><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231218182450047.png" alt="image-20231218182450047"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231218183337107.png" alt="image-20231218183337107"></p><p>2ï¸âƒ£ web2é…ç½®ä¸€ä¸ªåŠ¨æ€èµ„æºï¼›</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@web2 ~]<span class="comment">#yum -y install tomcat</span></span><br><span class="line">...</span><br><span class="line">[root@web2 ~]<span class="comment">#yum -y install java</span></span><br><span class="line">...</span><br><span class="line">[root@web2 ~]<span class="comment">#mkdir /usr/share/tomcat/webapps/ROOT</span></span><br><span class="line">[root@web2 /usr/share/tomcat/webapps/ROOT]<span class="comment">#cat java_test.jsp</span></span><br><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> import=<span class="string">&quot;java.util.*&quot;</span> pageEncoding=<span class="string">&quot;utf-8&quot;</span>%&gt;</span><br><span class="line">&lt;HTML&gt;</span><br><span class="line">    &lt;HEAD&gt;</span><br><span class="line">        &lt;TITLE&gt;nanxi JSP Page&lt;/TITLE&gt;</span><br><span class="line">    &lt;/HEAD&gt;</span><br><span class="line">    &lt;BODY&gt;</span><br><span class="line">        &lt;%</span><br><span class="line">            Random rand = new Random();</span><br><span class="line">            out.println(<span class="string">&quot;&lt;h1&gt;æ˜¾ç¤ºéšæœºæ•°:&lt;h1&gt;&quot;</span>);</span><br><span class="line">            out.println(rand.nextInt(99)+100);</span><br><span class="line">        %&gt;</span><br><span class="line">    &lt;/BODY&gt;</span><br><span class="line">&lt;/HTML&gt;</span><br><span class="line">æµ‹è¯•è®¿é—®å¦‚ä¸‹ï¼Œ8080ä¸ºtomcatçš„é»˜è®¤ç«¯å£</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231218184749984.png" alt="image-20231218184749984"></p><p>3ï¸âƒ£ é›†æˆè‡³è´Ÿè½½å‡è¡¡ï¼›ï¼ˆæµ‹è¯•æ—¶è®°å¾—ä¿®æ”¹hostsæ–‡ä»¶ï¼‰</p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231218185513220.png" alt="image-20231218185513220"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231218192640980.png" alt="image-20231218192640980"></p><p>æœ€åé›†æˆæ˜¾ç¤ºçš„æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231218192730094.png" alt="image-20231218192730094"></p><div class="tips"><p><strong>Nginxèµ„æºåˆ†ç¦»çŸ¥è¯†è¡¥å……</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@lb /code]#mkdir android</span><br><span class="line">[root@lb /code]#mkdir iphone</span><br><span class="line">[root@lb /code]#mkdir pc</span><br><span class="line">[root@lb /code]#echo &quot;æˆ‘æ˜¯å®‰å“é¡µé¢&quot; &gt; /code/android/index.html</span><br><span class="line">[root@lb /code]#echo &quot;æˆ‘æ˜¯iphoneé¡µé¢&quot; &gt; /code/iphone/index.html</span><br><span class="line">[root@lb /code]#echo &quot;æˆ‘æ˜¯ç”µè„‘é¡µé¢&quot; &gt; /code/pc/index.html</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231218194228518.png" alt="image-20231218194228518"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231218195944060.png" alt="image-20231218195944060"></p><p>å®ç°æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231218200416983.png" alt="image-20231218200416983"></p><p>å®é™…ä¼ä¸šä¸­ä¸ä¼šåˆ†çš„é‚£ä¹ˆæ¸…æ¥šï¼Œä»£ç èµ„æºä¸€èˆ¬åªåˆ†ç§»åŠ¨ç«¯å’ŒPCç«¯ï¼›</p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231218200957554.png" alt="image-20231218200957554"></p></div><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Nginxå®ç°åŠ¨é™åˆ†ç¦»&lt;/center&gt;&lt;/h1&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20231218180340246.png&quot; alt=&quot;image-20231218180340246&quot;&gt;&lt;/p&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;ç¯å¢ƒå‡†å¤‡&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è§’è‰²&lt;/th&gt;
&lt;th&gt;IPåœ°å€&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;è´Ÿè½½å‡è¡¡ï¼ˆlbï¼‰&lt;/td&gt;
&lt;td&gt;192.168.10.3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;web1ï¼ˆé™æ€èµ„æºï¼‰&lt;/td&gt;
&lt;td&gt;192.168.10.200&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;web2ï¼ˆåŠ¨æ€èµ„æºï¼‰&lt;/td&gt;
&lt;td&gt;192.168.10.201&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;å®ç°è¿‡ç¨‹&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;1ï¸âƒ£ web1é…ç½®é™æ€èµ„æºï¼›&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@web1 /etc/nginx/conf.d]&lt;span class=&quot;comment&quot;&gt;#vim nanxi.conf&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        listen 80;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        root /code;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		charset utf-8,gbk;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        location / &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        index index.html;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@web1 /code]&lt;span class=&quot;comment&quot;&gt;#echo &amp;#x27;&amp;lt;h1&amp;gt;&amp;lt;center&amp;gt;å—æ±666520&amp;lt;/center&amp;gt;&amp;lt;/h1&amp;gt;&amp;#x27; &amp;gt;index.html&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="æœåŠ¡æ¶æ„" scheme="https://smallflames.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
</feed>
