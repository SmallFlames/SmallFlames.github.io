<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å—æ±</title>
  
  <subtitle>å‹‡æ•¢çš„å»åšä½ è®¤ä¸ºæ­£ç¡®çš„äº‹æƒ…ï¼</subtitle>
  <link href="https://smallflames.github.io/atom.xml" rel="self"/>
  
  <link href="https://smallflames.github.io/"/>
  <updated>2024-03-11T01:17:35.251Z</updated>
  <id>https://smallflames.github.io/</id>
  
  <author>
    <name>Xia Zheng</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Dockerfileåˆ¶ä½œé•œåƒ</title>
    <link href="https://smallflames.github.io/2024/03/05/Dockerfile%E5%88%B6%E4%BD%9C%E9%95%9C%E5%83%8F/"/>
    <id>https://smallflames.github.io/2024/03/05/Dockerfile%E5%88%B6%E4%BD%9C%E9%95%9C%E5%83%8F/</id>
    <published>2024-03-05T13:42:21.000Z</published>
    <updated>2024-03-11T01:17:35.251Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Dockerfileåˆ¶ä½œé•œåƒ</center></h1><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/docker-architecture.webp" alt="Docker Architecture diagram"></p><h2 id="ä¸€ã€Dockerfileå¸¸ç”¨æŒ‡ä»¤">ä¸€ã€Dockerfileå¸¸ç”¨æŒ‡ä»¤</h2><table><thead><tr><th>æŒ‡ä»¤</th><th>é‡Šä¹‰</th></tr></thead><tbody><tr><td>FROM</td><td>æŒ‡å®šåŸºç¡€é•œåƒï¼Œå¿…é¡»æ”¾åœ¨é¦–è¡Œã€‚(æ³¨æ„ï¼Œscratchæ˜¯ä¿ç•™å­—ï¼Œå¹¶ä¸æ˜¯é•œåƒï¼å¦‚æœä½¿ç”¨äº†è¯¥å…³é”®å­—è¡¨ç¤ºä¸ä¾èµ–äºä»»ä½•é•œåƒ) &amp;&amp; è°ƒç”¨åŸºç¡€é•œåƒè§¦å‘å™¨ï¼ˆONBUILDï¼‰ã€‚</td></tr><tr><td>ONBUILD</td><td>åŸºç¡€é•œåƒè§¦å‘å™¨ã€‚å½“é•œåƒç”¨ä½œå¦ä¸€ä¸ªæ„å»ºçš„åŸºç¡€æ—¶è§¦å‘ã€‚åé¢å¯ä»¥è·Ÿå…¶ä»–çš„é•œåƒæŒ‡ä»¤è¿è¡Œï¼Œæ‰€ä»¥å½“æˆ‘ä»¬åŸºäºä»–äººé•œåƒæ„å»ºæ–°é•œåƒæ—¶ä¸ºå®‰å…¨è€ƒè™‘åº”å½“ç‰¹åˆ«æ³¨æ„åŸºç¡€é•œåƒæ˜¯å¦æœ‰ä¸å®‰å…¨çš„ONBUILDæŒ‡ä»¤ã€‚</td></tr><tr><td>MAINTAINER</td><td>ç®¡ç†è€…ï¼ˆç»´æŠ¤è€…ï¼‰æ ‡è¯†ï¼Œç”¨äºå£°æ˜ä½œè€…çš„ä¿¡æ¯ã€‚ï¼ˆ<mark>å·²å¼ƒç”¨</mark>ï¼‰</td></tr><tr><td>LABEL</td><td>ä¸ºé•œåƒæ‰“æ ‡ç­¾ã€‚åŸºäºKEY=VALUEæ–¹å¼æ‰“æ ‡ç­¾ã€‚</td></tr><tr><td>USER</td><td>æŒ‡å®šå®¹å™¨çš„è¿è¡Œç”¨æˆ·ï¼Œè‹¥ä¸æŒ‡å®šï¼Œé»˜è®¤ä¸ºrootç”¨æˆ·ï¼Œä¸€äº›æœåŠ¡å¯èƒ½ä¼šç”¨åˆ°ï¼Œæ¯”å¦‚ESæœåŠ¡â€¦</td></tr><tr><td>RUN</td><td>åœ¨å®¹å™¨ä¸­è¿è¡ŒæŒ‡ä»¤ã€‚</td></tr><tr><td>WORKDIR</td><td>æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œå½“ç”¨æˆ·è¿æ¥åˆ°å®¹å™¨æ—¶ï¼Œå°±é»˜è®¤åœ¨è¯¥ç›®å½•ï¼Œè‹¥ä¸æŒ‡å®šï¼Œåˆ™é»˜è®¤åœ¨&quot;/&quot;è·¯å¾„ã€‚</td></tr><tr><td>VOLUME</td><td>å¯¹å®¹å™¨çš„æŒ‡å®šè·¯å¾„ç”Ÿæˆéšæœºå­˜å‚¨å·ã€‚</td></tr><tr><td>COPY</td><td>å°†å®¿ä¸»æœºçš„æ–‡ä»¶æ‹·è´åˆ°å®¹å™¨ä¸­ã€‚å¦‚æœå®¹å™¨ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»ºã€‚</td></tr><tr><td>ADD</td><td>ä¸COPYä½œç”¨ä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨è§£å‹taråŒ…æ–‡ä»¶å¹¶åˆ é™¤æºæ–‡ä»¶ã€‚</td></tr><tr><td>ENV</td><td>å°†å˜é‡ä¼ é€’ç»™å®¹å™¨ï¼Œå®¹å™¨è¿è¡Œæ—¶ä¼šæœ‰è¯¥å˜é‡ã€‚åœ¨å®¹å™¨å¯åŠ¨æˆ–åˆ›å»ºæ—¶å¯ä»¥ä½¿ç”¨-e,â€“envé€‰é¡¹æ›¿æ¢é»˜è®¤å€¼ã€‚</td></tr><tr><td>ARG</td><td>åœ¨ç¼–è¯‘é˜¶æ®µç”Ÿæ•ˆçš„å˜é‡ã€‚å®¹å™¨è¿è¡Œæ—¶ä¸ä¼šå­˜åœ¨è¯¥å˜é‡ï¼åœ¨ç¼–è¯‘çš„æ—¶å€™å¯ä»¥ä½¿ç”¨&quot;â€“build-arg&quot;é€‰é¡¹æ›¿æ¢é»˜è®¤å€¼ã€‚</td></tr><tr><td>EXPOSE</td><td>æš´éœ²å®¹å™¨å†…ç«¯å£ï¼Œå¤–éƒ¨ä½¿ç”¨éšæœºç«¯å£æ˜ å°„æ—¶ï¼Œå¯ä»¥æš´éœ²æ­¤å¤„å®šä¹‰çš„æœåŠ¡ç«¯å£ï¼Œé€šå¸¸å»ºè®®æš´éœ²çš„ç«¯å£å’ŒæœåŠ¡æœ‰å…³ã€‚ç”¨æˆ·å¯åŠ¨å®¹å™¨æ—¶ä½¿ç”¨&quot;-P&quot;æ—¶ä¼šä¸ºå®¹å™¨æš´éœ²çš„ç«¯å£è‡ªåŠ¨åšæ˜ å°„</td></tr><tr><td>CMD</td><td>å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œæˆ‘ä»¬åœ¨åˆ¶ä½œå®¹å™¨æ—¶ï¼Œé€šå¸¸ä¼šåœ¨æ­¤å¤„é˜»å¡ç»ˆç«¯ã€‚</td></tr><tr><td>ENTRYPOINT</td><td>åŒCMDï¼Œå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œä½†æ˜¯æ­¤å¤„å¯ä¼ å…¥å‚æ•°ï¼Œå¯åŠ¨æŒ‡ä»¤å¯èƒ½å› å‚æ•°äº§ç”Ÿå˜åŒ–ã€‚</td></tr><tr><td>HEALTHCHECK</td><td>å®¹å™¨å¥åº·æ£€æŸ¥ã€‚</td></tr><tr><td>SHELL</td><td>è°ƒç”¨ç³»ç»Ÿå‘½ä»¤çš„shellã€‚è¿™å¯¹Windowså¾ˆæœ‰ç”¨ï¼ŒLinuxæ— éœ€ä½¿ç”¨ï¼Œé»˜è®¤å°±æ˜¯linuxçš„shellã€‚</td></tr></tbody></table><p>::: warnning</p><p>â€ƒâ€ƒ<strong>ç›¸ä¼¼æŒ‡ä»¤åŒºåˆ†</strong><br>â€ƒâ€ƒ1ï¸âƒ£   <strong>COPYå’ŒADDï¼š</strong> COPYç”¨äºå°†å®¿ä¸»æœºæ–‡ä»¶æ‹·è´è‡³å®¹å™¨ï¼Œæˆ–è€…åœ¨å¤šé˜¶æ®µæ„å»ºæ—¶ç”¨äºå°†ä¸Šä¸€æ„å»ºé˜¶æ®µçš„æ–‡ä»¶æ‹·è´è‡³æœ¬é˜¶æ®µæ„å»ºã€‚ADDæŒ‡ä»¤åŒæ ·å¯ç”¨äºæ‹·è´æ–‡ä»¶ï¼Œä½†æ˜¯è¯¥æŒ‡ä»¤å¯ä»¥è‡ªåŠ¨è§£å‹taråŒ…ï¼Œå¹¶åˆ é™¤æºæ–‡ä»¶ã€‚</p><p>â€ƒâ€ƒ2ï¸âƒ£   <strong>ARGå’ŒENVï¼š</strong>  ARGæŒ‡ä»¤å’ŒENVæŒ‡ä»¤çš„ä½œç”¨åŸŸä¸åŒï¼ŒARGæŒ‡ä»¤æŒ‡å®šçš„ä¾¿ä»¤ä»…åœ¨é•œåƒæ„å»ºæ—¶èµ·ä½œç”¨ï¼Œé•œåƒæ„å»ºå®Œæˆç”Ÿå‘½å‘¨æœŸå³ç»“æŸã€‚ENVæŒ‡ä»¤å°†ç¯å¢ƒå˜é‡ <code>&lt;key&gt;</code> è®¾ç½®ä¸ºå€¼ <code>&lt;value&gt;</code>å°†åœ¨æ„å»ºé˜¶æ®µçš„æ‰€æœ‰åç»­æŒ‡ä»¤çš„ç¯å¢ƒä¸­ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥åœ¨è®¸å¤šæŒ‡ä»¤ä¸­å†…è”æ›¿æ¢ã€‚</p><p>â€ƒâ€ƒ3ï¸âƒ£   <strong>CMDå’ŒENTRYPOINTï¼š</strong>  CMDæŒ‡ä»¤è®¾ç½®ä»é•œåƒè¿è¡Œå®¹å™¨æ—¶å›ºå®šè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚Dockerfileä¸­åªèƒ½æœ‰ä¸€æ¡ <code>CMD</code> æŒ‡ä»¤ã€‚å¦‚æœæ‚¨åˆ—å‡ºå¤šä¸ª <code>CMD</code> ï¼Œåˆ™åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚å¦‚æœç”¨æˆ·ä¸º <code>docker run</code> æŒ‡å®šå‚æ•°ï¼Œé‚£ä¹ˆä»–ä»¬å°†è¦†ç›– <code>CMD</code> ä¸­æŒ‡å®šçš„é»˜è®¤å€¼ã€‚ENTRYPOINTæŒ‡ä»¤è®¾ç½®ä»é•œåƒè¿è¡Œå®¹å™¨æ—¶è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œä½†ç”¨æˆ·å¯ä»¥ä¸ºè¯¥æŒ‡ä»¤ä¼ é€’å‚æ•°ï¼Œè‹¥CMDæŒ‡ä»¤å’ŒENTRYPOINTæŒ‡ä»¤åŒæ—¶ä½¿ç”¨åˆ™CMDæŒ‡ä»¤å°†ä½œä¸ºENTRYPOINTæŒ‡ä»¤çš„å‚æ•°ä¼ é€’ã€‚</p><p>:::</p><h2 id="äºŒã€Dockerfileåˆ¶ä½œé•œåƒ">äºŒã€Dockerfileåˆ¶ä½œé•œåƒ</h2><p>1ï¸âƒ£   åˆ›å»ºDockerfileæ–‡ä»¶ã€‚ æ ¹æ®ä¸ªäººä¹ æƒ¯è€Œè¨€ï¼Œä¸€èˆ¬ä¸ºäº†æ–‡ä»¶çš„å¯è¯»æ€§ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªç©ºç›®å½•ï¼Œå¹¶åœ¨ç›®å½•ä¸‹åˆ›å»ºDockerfileæ–‡ä»¶ï¼Œï¼ˆçº¦å®šä¿—æˆæˆ‘ä»¬ä¸€èˆ¬å°±ä»¥Dockerfileä¸ºåï¼Œç¼–è¯‘æ—¶ä¹Ÿä¼šè‡ªåŠ¨å¯»æ‰¾è¿™ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå¯è‡ªå®šä¹‰æ–‡ä»¶åï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨ç¼–è¯‘æ–‡ä»¶æ—¶éœ€ç”¨  <code>-f</code>  æŒ‡å®šéœ€ç¼–è¯‘æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œè‡ªå®šä¹‰æ–‡ä»¶åè¯­ä¹‰æ··ä¹±å®¹æ˜“å¯¼è‡´æ–‡ä»¶é”™è½ï¼Œä¸å»ºè®®ï¼ï¼‰</p><p>2ï¸âƒ£   å‡†å¤‡åˆ¶ä½œé•œåƒçš„èµ„æºæ–‡ä»¶ã€‚ï¼ˆæˆ‘ä»¬åˆ¶ä½œé•œåƒéœ€è¦çš„å‹ç¼©åŒ…ã€æºç æ–‡ä»¶ã€é…ç½®æ–‡ä»¶ç­‰ç­‰ï¼‰</p><p>3ï¸âƒ£   ç¼–å†™Dockerfileæ–‡ä»¶ã€‚ï¼ˆä»¥alpineä¸ºåŸºç¡€é•œåƒæ‰“åŒ…åˆ¶ä½œæ¸¸æˆé•œåƒä¸ºä¾‹ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@nanxi ~/nanxi]<span class="comment"># tree -L 1</span></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ build.sh</span><br><span class="line">â”œâ”€â”€ default.conf</span><br><span class="line">â”œâ”€â”€ Dockerfile</span><br><span class="line">â””â”€â”€ game.tar.gz</span><br><span class="line"></span><br><span class="line">[root@nanxi ~]<span class="comment"># cat Dockerfile</span></span><br><span class="line">FROM alpine</span><br><span class="line"></span><br><span class="line">MAINTAINER nanxi alrex66608@163.com</span><br><span class="line"></span><br><span class="line">LABEL auther=<span class="string">&quot;nanxi&quot;</span> \</span><br><span class="line">      email=<span class="string">&quot;alrex66608@163.com&quot;</span> \</span><br><span class="line">      blog=https://zzxe.eu.org</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">VOLUME /code/game</span><br><span class="line"></span><br><span class="line">RUN sed -i <span class="string">&#x27;s/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g&#x27;</span> /etc/apk/repositories &amp;&amp; \</span><br><span class="line">    apk update &amp;&amp; apk add nginx &amp;&amp; <span class="built_in">rm</span> -rf /var/cache/* &amp;&amp; <span class="built_in">mkdir</span> -p /code/game</span><br><span class="line"></span><br><span class="line">COPY default.conf /etc/nginx/http.d/default.conf</span><br><span class="line">ADD game.tar.gz /code/game</span><br><span class="line"></span><br><span class="line">CMD [<span class="string">&quot;nginx&quot;</span>,<span class="string">&quot;-g&quot;</span>,<span class="string">&quot;daemon off;&quot;</span>]</span><br></pre></td></tr></table></figure><p>4ï¸âƒ£   ç¼–è¯‘Dockerfileæ–‡ä»¶ç”Ÿæˆé•œåƒ</p><p>ä½¿ç”¨<code>docker build -t &lt;é•œåƒå&gt;:&lt;ç‰ˆæœ¬å·&gt; .</code> ç¼–è¯‘æ–‡ä»¶ç”Ÿæˆé•œåƒï¼Œæˆ–ä½¿ç”¨shellè„šæœ¬è°ƒç”¨dockerå‘½ä»¤è¿›è¡Œç¼–è¯‘</p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240305223411353.png" alt="image-20240305223411353"></p><p>5ï¸âƒ£   å¯åŠ¨ä¸€ä¸ªå®¹å™¨å¹¶æµ‹è¯•è®¿é—®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@nanxi ~/nanxi/01-nanxi-game]<span class="comment"># docker run -dP nanxi_game:v1.0</span></span><br><span class="line">ac6fb3594b726a9d7a75a74d8d6273f08aa823bcd9bd62ef0f64635cd9c37f58</span><br><span class="line"></span><br><span class="line">[root@nanxi ~/nanxi]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE             COMMAND                  CREATED             STATUS             PORTS                                     NAMES</span><br><span class="line">ac6fb3594b72   nanxi_game:v1.0   <span class="string">&quot;nginx -g &#x27;daemon ofâ€¦&quot;</span>   About an hour ago   Up About an hour   0.0.0.0:32770-&gt;80/tcp, :::32770-&gt;80/tcp   intelligent_wu</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@nanxi ~/nanxi]<span class="comment"># docker inspect -f &#x27;æ­£åœ¨è¿è¡Œå®¹å™¨: &#123;&#123;.Name&#125;&#125; | å®¹å™¨IPåœ°å€ä¸º: &#123;&#123;.NetworkSettings.IPAddress&#125;&#125; | å®¹å™¨è¿›ç¨‹å·: &#123;&#123;.State.Pid&#125;&#125; | æŒ‚è½½ç‚¹: &#123;&#123;range .Mounts&#125;&#125;&#123;&#123;.Source&#125;&#125;&#123;&#123;end&#125;&#125;&#x27; $(docker ps -q)</span></span><br><span class="line">æ­£åœ¨è¿è¡Œå®¹å™¨: /intelligent_wu | å®¹å™¨IPåœ°å€ä¸º: 172.20.7.2 | å®¹å™¨è¿›ç¨‹å·: 111403 | æŒ‚è½½ç‚¹: /var/lib/docker/volumes/1f3cdca6af933cc8779ccbc4e84c64ff64866e352fb9001f6fa0a0df88b85f8</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240305223846010.png" alt="image-20240305223846010"></p><h2 id="ä¸‰ã€Dockerfileä¼˜åŒ–æ€è·¯">ä¸‰ã€Dockerfileä¼˜åŒ–æ€è·¯</h2><h3 id="1ã€ä»ç¼–è¯‘é€Ÿåº¦ä¸Šè¯´">1ã€ä»ç¼–è¯‘é€Ÿåº¦ä¸Šè¯´</h3><p>â‘   æŒ‡å®šçš„åŸºç¡€é•œåƒå»ºè®®æ˜¯æœ¬åœ°å­˜åœ¨çš„æˆ–è€…æ˜¯å›½å†…çš„é•œåƒï¼›â‘¡  å°†ä¸‹è½½æºä¿®æ”¹ä¸ºå›½å†…çš„è½¯ä»¶æºï¼›â‘¢  å°½é‡åˆ©ç”¨Dockerfileæ„å»ºçš„é•œåƒç¼“å­˜æŠ€æœ¯ï¼ˆå°†ä¸ç»å¸¸ä¿®æ”¹çš„æŒ‡ä»¤å¾€å‰æ”¾ï¼Œå¦‚ï¼šFROM ã€MAINTAINERã€LABELã€EXPOSEã€WORKDIRã€VOLUMEâ€¦ å°†ç»å¸¸ä¿®æ”¹çš„æŒ‡ä»¤å¾€åæ”¾ï¼Œå¦‚ï¼šRUNã€COPYã€ADDã€CMDã€ENTRYPOINTâ€¦ï¼‰â‘£  ä½¿ç”¨&quot;.dockerignore&quot;ï¼Œå¿½ç•¥æˆ‘ä»¬ä¸éœ€è¦å‚ä¸ç¼–è¯‘çš„æ–‡ä»¶ï¼ˆå¦‚ä¸å¿½ç•¥ï¼Œåˆ™ç¼–è¯‘å‰ä¼šå½“å‰æ–‡ä»¶å¤¹æ‰€æœ‰æ–‡ä»¶ä¼ é€’ç»™docker deamonè¿›ç¨‹ï¼Œä½†æˆ‘ä»¬çœŸæ­£ç¼–è¯‘æ—¶ç”¨ä¸åˆ°è¿™äº›ä¸åˆ¶ä½œé•œåƒä¸ç›¸å…³çš„æ–‡ä»¶ã€‚ï¼‰</p><h3 id="2ã€ä»é•œåƒä½“ç§¯ä¸Šè¯´">2ã€ä»é•œåƒä½“ç§¯ä¸Šè¯´</h3><p>â‘   åˆ é™¤æ— ç”¨çš„ç¼“å­˜ï¼›â‘¡å¸è½½æ— ç”¨çš„è½¯ä»¶ï¼›â‘¢    ä½¿ç”¨è¾ƒå°çš„åŸºç¡€é•œåƒï¼Œæ¯”å¦‚å°†centosåŸºç¡€ç¯å¢ƒæ”¹ä¸ºUbuntuæˆ–è€…alpineé•œåƒã€‚</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="Docker" scheme="https://smallflames.github.io/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>Ubantuæ­å»ºå†…ç½‘ä»“åº“</title>
    <link href="https://smallflames.github.io/2024/02/21/Ubantu%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91%E4%BB%93%E5%BA%93/"/>
    <id>https://smallflames.github.io/2024/02/21/Ubantu%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91%E4%BB%93%E5%BA%93/</id>
    <published>2024-02-21T15:30:55.000Z</published>
    <updated>2024-03-07T08:47:22.152Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Ubantuæ­å»ºå†…ç½‘ä»“åº“</center></h1><blockquote><p>âœ¨ UbuntuåŸºäºDebianå‘è¡Œç‰ˆå’ŒGNOMEæ¡Œé¢ç¯å¢ƒï¼Œä¸Debiançš„ä¸åŒåœ¨äºå®ƒæ¯6ä¸ªæœˆä¼šå‘å¸ƒä¸€ä¸ªæ–°ç‰ˆæœ¬ã€‚Ubuntuçš„ç›®æ ‡åœ¨äºä¸ºä¸€èˆ¬ç”¨æˆ·æä¾›ä¸€ä¸ªæœ€æ–°çš„ã€åŒæ—¶åˆç›¸å½“ç¨³å®šçš„ä¸»è¦ç”±è‡ªç”±è½¯ä»¶æ„å»ºè€Œæˆçš„æ“ä½œç³»ç»Ÿã€‚<br>ğŸ‰ Shell æ˜¯ä¸€ä¸ªç¨‹åºï¼Œæä¾›ä¸€ä¸ªä¸ç”¨æˆ·å¯¹è¯çš„ç¯å¢ƒã€‚è¿™ä¸ªç¯å¢ƒåªæœ‰ä¸€ä¸ªå‘½ä»¤æç¤ºç¬¦ï¼Œè®©ç”¨æˆ·ä»é”®ç›˜è¾“å…¥å‘½ä»¤ï¼Œæ‰€ä»¥åˆç§°ä¸ºå‘½ä»¤è¡Œç¯å¢ƒï¼ˆcommand line interfaceï¼Œç®€å†™ä¸º CLIï¼‰ã€‚</p></blockquote><h2 id="font-color-red-â–š-u-Step-01-u-ï¼šæ­å»ºæœ¬åœ°æºä»“åº“-font"><font color=red>â–šâ€‚<u>Step 01</u>â€‚ï¼šæ­å»ºæœ¬åœ°æºä»“åº“</font></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">apt clean </span><br><span class="line">apt -y install -d nginx  ä¸¾ä¾‹</span><br><span class="line"><span class="comment"># /var/cache/apt/archives # debåŒ…çš„ä½ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> /root/ceshi</span><br><span class="line"><span class="built_in">mv</span> /var/cache/apt/archives/*.deb /root/ceshi</span><br><span class="line"></span><br><span class="line">apt -y install dpkg-dev  (ç”Ÿæˆæºæ‰€éœ€å·¥å…·)</span><br><span class="line"><span class="built_in">cd</span> /root/ceshi</span><br><span class="line">apt-ftparchive packages . &gt; Packages  <span class="comment"># å®‰è£…åŒ…ä¿¡æ¯éƒ½è¯»å–åˆ° Packages</span></span><br><span class="line">apt-ftparchive release . &gt; Release</span><br><span class="line"><span class="comment"># dpkg-scanpackages ./packages | gzip -9c &gt; Packages.gz</span></span><br><span class="line"><span class="comment"># gpg --clearsign -o InRelease Release  # ç”Ÿæˆ Release çš„æ˜æ–‡ç­¾åæ–‡ä»¶</span></span><br><span class="line"><span class="comment"># gpg -ab -o Release.gpg Release        # ç”Ÿæˆ Release çš„æ–‡æœ¬åˆ†ç¦»ç­¾åæ–‡ä»¶</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240221115118994.png" alt="image-20240221115118994"></p><h2 id="font-color-red-â–š-u-Step-02-u-ï¼šåˆ›å»ºå†…ç½‘æºæœåŠ¡å™¨-font"><font color=red>â–šâ€‚<u>Step 02</u>â€‚ï¼šåˆ›å»ºå†…ç½‘æºæœåŠ¡å™¨</font></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">apt -y install nginx</span><br><span class="line"><span class="comment"># é»˜è®¤é…ç½®æ–‡ä»¶è·¯å¾„ /etc/nginx/sites-available/default</span></span><br><span class="line"><span class="comment"># é»˜è®¤é¦–é¡µæ–‡ä»¶å­˜æ”¾è·¯å¾„ /var/www/html</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> /var/www/html/ceshi</span><br><span class="line"><span class="built_in">cp</span> -r /root/ceshi /var/www/html</span><br><span class="line">vim /etc/nginx/sites-available/default</span><br><span class="line">...</span><br><span class="line">location /ceshi &#123;</span><br><span class="line">    <span class="built_in">alias</span> /var/www/html/ceshi;</span><br><span class="line">    autoindex on;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">systemctl restart nginx</span><br><span class="line">systemctl <span class="built_in">enable</span> nginx</span><br><span class="line"></span><br><span class="line">ss -nlt | grep <span class="string">&quot;80&quot;</span></span><br><span class="line">å¯ä»¥å…ˆæµ‹è¯•è®¿é—®ä¸€ä¸‹</span><br><span class="line">http://192.168.10.94/ceshi/</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240221115415513.png" alt="image-20240221115415513"></p><h2 id="font-color-red-â–š-u-Step-03-u-ï¼šé…ç½®å¹¶ä½¿ç”¨å†…ç½‘æº-font"><font color=red>â–šâ€‚<u>Step 03</u>â€‚ï¼šé…ç½®å¹¶ä½¿ç”¨å†…ç½‘æº</font></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨aptæº(åœ¨éœ€è¦ä½¿ç”¨å†…ç½‘æºçš„ubuntuä¸Šæ“ä½œ)</span><br><span class="line"><span class="built_in">mv</span> /etc/apt/sources.list /etc/apt/sources.list.bak</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb [trusted=yes] http://192.168.10.94/ceshi/   ./&quot;</span> &gt; /etc/apt/sources.list</span><br><span class="line"></span><br><span class="line">[root@elk93 ~]<span class="comment"># apt update</span></span><br><span class="line">Ign:1 http://192.168.10.94/ceshi ./ InRelease</span><br><span class="line">Get:2 http://192.168.10.94/ceshi ./ Release [816 B]</span><br><span class="line">Ign:3 http://192.168.10.94/ceshi ./ Release.gpg</span><br><span class="line">Get:4 http://192.168.10.94/ceshi ./ Packages [8,056 B]</span><br><span class="line">Fetched 8,872 B <span class="keyword">in</span> 0s (66.5 kB/s)</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree</span><br><span class="line">Reading state information... Done</span><br><span class="line">All packages are up to <span class="built_in">date</span>.</span><br><span class="line"></span><br><span class="line">[root@elk93 /etc/apt]<span class="comment"># apt install tree</span></span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree</span><br><span class="line">Reading state information... Done</span><br><span class="line"></span><br><span class="line">No apt package <span class="string">&quot;tree&quot;</span>, but there is a snap with that name.</span><br><span class="line">Try <span class="string">&quot;snap install tree&quot;</span></span><br><span class="line"></span><br><span class="line">E: Unable to locate package tree</span><br><span class="line"></span><br><span class="line">apt install -y &lt;packages&gt;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240221111314481.png" alt="image-20240221111314481"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxiblogfoot.png" alt="nanxiblogfoot"></p>        <div id="aplayer-rlVuoxSA" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;">            <pre class="aplayer-lrc-content"></pre>        </div>        <script>          var ap = new APlayer({            element: document.getElementById("aplayer-rlVuoxSA"),            narrow: false,            autoplay: true,            showlrc: false,            music: {              title: "Whale (é²¸)",              author: "Jannik",              url: "http://cdn.zzxe.eu.org/music/Whale%20%28%E9%B2%B8%29.m4a",              pic: "https://p2.music.126.net/97-CeOH6aysRsv1TYBA71Q==/109951164727131802.jpg",              lrc: ""            }          });          window.aplayers || (window.aplayers = []);          window.aplayers.push(ap);        </script><blockquote><p><em><strong>ä»¥å¸Œæœ›ä¸ºç”Ÿçš„äººï¼Œå°†ç»é£Ÿè€Œæ­»ã€‚</strong></em></p><p align="right">â€”â€”å¯Œå…°å…‹æ—ï¼ˆç¾å›½ï¼‰</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="Docker" scheme="https://smallflames.github.io/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins and SonarQube</title>
    <link href="https://smallflames.github.io/2024/01/30/Jenkins_and_SonarQube/"/>
    <id>https://smallflames.github.io/2024/01/30/Jenkins_and_SonarQube/</id>
    <published>2024-01-30T13:24:54.000Z</published>
    <updated>2024-01-30T13:27:40.427Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Jenkins and SonarQube</center></h1><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="è½¯ä»¶åº”ç”¨" scheme="https://smallflames.github.io/tags/%E8%BD%AF%E4%BB%B6%E5%BA%94%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>GitåŠgitlabä½¿ç”¨ç®€è¿°</title>
    <link href="https://smallflames.github.io/2024/01/29/Git%E5%8F%8Agitlab%E4%BD%BF%E7%94%A8%E7%AE%80%E8%BF%B0/"/>
    <id>https://smallflames.github.io/2024/01/29/Git%E5%8F%8Agitlab%E4%BD%BF%E7%94%A8%E7%AE%80%E8%BF%B0/</id>
    <published>2024-01-29T10:47:09.000Z</published>
    <updated>2024-01-30T13:11:51.338Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>GitåŠgitlabä½¿ç”¨ç®€è¿°</center></h1><blockquote><p>ğŸ„ å®˜ç½‘ä»‹ç»ï¼šGitæ˜¯ä¸€ä¸ªè‡ªç”±å’Œå¼€æºçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œæ—¨åœ¨å¿«é€Ÿå’Œé«˜æ•ˆåœ°å¤„ç†ä»å°å‹åˆ°å¤§å‹çš„æ‰€æœ‰é¡¹ç›®ã€‚Gitç®€å•æ˜“å­¦ï¼Œå ç”¨ç©ºé—´å°ï¼Œæ€§èƒ½å¿«å¦‚é—ªç”µã€‚å®ƒæ¯”Subversionã€CVSã€Perforceå’ŒClearCaseç­‰SCMå·¥å…·æ›´æœ‰ä¼˜åŠ¿ï¼Œå…·æœ‰å»‰ä»·çš„æœ¬åœ°åˆ†æ”¯ã€æ–¹ä¾¿çš„ç™»å°åŒºå’Œå¤šä¸ªå·¥ä½œæµç­‰ç‰¹æ€§ã€‚</p></blockquote><h2 id="font-color-red-â–š-u-01-u-ç®€è¿°ï¼šGitçš„ä½¿ç”¨è¦ç‚¹-font"><font color=red>â–šâ€‚<u>01</u>â€‚ç®€è¿°ï¼šGitçš„ä½¿ç”¨è¦ç‚¹</font></h2><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240129192325464.png" alt="image-20240129192325464"></p><div class="tips"><p>ä¸€èˆ¬linuxç³»ç»Ÿä¼šè‡ªå¸¦ç”±gitå·¥å…·ï¼Œå¦‚æœæ²¡æœ‰éœ€è‡ªè¡Œä¸‹è½½å®‰è£…ï¼Œ<code>yum -y install git</code></p></div><span id="more"></span><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  GitåŸºæœ¬ä¿¡æ¯é…ç½®</span></span><br><span class="line">git config â€“-global user.name <span class="string">&quot;nanxi&quot;</span>               <span class="comment">### é…ç½®Gitä½¿ç”¨ç”¨æˆ·</span></span><br><span class="line">git config â€“-global user.email <span class="string">&quot;xxxxxxxxxx@xxx.com&quot;</span> <span class="comment">### é…ç½®Gitä½¿ç”¨é‚®ç®±</span></span><br><span class="line">git config â€“-global color.ui <span class="literal">true</span>                   <span class="comment">### å¼€å¯è¯­æ³•é«˜äº®</span></span><br><span class="line"><span class="comment">#  æŸ¥çœ‹Gité…ç½®ä¿¡æ¯</span></span><br><span class="line">git --version        <span class="comment">### æŸ¥çœ‹gitç‰ˆæœ¬</span></span><br><span class="line">git config --list    <span class="comment">### æŸ¥çœ‹gité…ç½®</span></span><br><span class="line">git remote           <span class="comment">### æŸ¥çœ‹è¿œç¨‹ä»“åº“å</span></span><br><span class="line">git remote -v        <span class="comment">### æŸ¥çœ‹è¿œç¨‹ä»“åº“è¯¦ç»†ä¿¡æ¯</span></span><br></pre></td></tr></table></figure><div class="warning"><p><strong>å…³äºå·¥ä½œç›®å½• .git éšè—æ–‡ä»¶ä»‹ç»ï¼š</strong></p><table><thead><tr><th>æ–‡ä»¶æˆ–ç›®å½•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>branches</td><td>åˆ†æ”¯ç›®å½•</td></tr><tr><td>config</td><td>å®šä¹‰é¡¹ç›®ç‰¹æœ‰çš„é…ç½®é€‰é¡¹</td></tr><tr><td>description</td><td>ä»…ä¾›git webç¨‹åºä½¿ç”¨</td></tr><tr><td>HEAD</td><td>æŒ‡ç¤ºå½“å‰çš„åˆ†æ”¯</td></tr><tr><td>hooks</td><td>åŒ…å«gité’©å­æ–‡ä»¶</td></tr><tr><td>info</td><td>åŒ…å«ä¸€ä¸ªå…¨å±€æ’é™¤æ–‡ä»¶(excludeæ–‡ä»¶)</td></tr><tr><td>objects</td><td>å­˜æ”¾æ‰€æœ‰æ•°æ®å†…å®¹ï¼Œæœ‰infoå’Œpackä¸¤ä¸ªå­æ–‡ä»¶å¤¹</td></tr><tr><td>refs</td><td>å­˜æ”¾æŒ‡å‘æ•°æ®(åˆ†æ”¯)çš„æäº¤å¯¹è±¡çš„æŒ‡é’ˆ</td></tr><tr><td>index</td><td>ä¿å­˜æš‚å­˜åŒºä¿¡æ¯ï¼Œåœ¨æ‰§è¡Œgit initçš„æ—¶å€™ï¼Œè¿™ä¸ªæ–‡ä»¶è¿˜æ²¡æœ‰</td></tr></tbody></table><center><font color=red> æ³¨æ„ï¼šå·¥ä½œç›®å½•çš„ .git æ–‡ä»¶ä¸èƒ½è½»æ˜“åˆ é™¤ï¼ï¼ï¼ </font></center></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æ­¥éª¤ç®€è¿°ï¼š</span><br><span class="line">1ã€é…ç½®gitåŸºæœ¬ä¿¡æ¯:  ç”¨æˆ·å é‚®ç®±</span><br><span class="line">2ã€åˆå§‹åŒ–ä»“åº“:    <span class="built_in">mkdir</span> nanxi &amp;&amp; git init nanxi</span><br><span class="line">3ã€æ·»åŠ è¿œç¨‹ä»“åº“:  git remote add origin(ä»“åº“åå­—å¯è‡ªå®šä¹‰) ä»“åº“åœ°å€</span><br><span class="line">4ã€åœ¨æœ¬åœ°å·¥ä½œç›®å½•å¼€å‘ï¼Œç„¶åæäº¤è‡³æœ¬åœ°ä»“åº“</span><br><span class="line">5ã€ä»£ç å¼€å‘å®Œæˆåæäº¤è‡³è¿œç¨‹ä»“åº“ git push -u origin(ä»“åº“åå­—) master(è¿œç¨‹ä»£ç åˆ†æ”¯) </span><br></pre></td></tr></table></figure><div class='spoiler collapsed'>    <div class='spoiler-title'>        Gitå‘½ä»¤äº†è§£    </div>    <div class='spoiler-content'>        <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">git init [<span class="built_in">dir</span> &amp; . ] (åˆå§‹åŒ– git å·¥ä½œç›®å½•)</span><br><span class="line">git config --global user.name <span class="string">&quot;nanxi&quot;</span> (é…ç½®gitç”¨æˆ·)</span><br><span class="line">git config --global user.email <span class="string">&quot;nanxi@mail.com&quot;</span> (é…ç½®gitç”¨æˆ·é‚®ç®±)</span><br><span class="line">git config --global color.ui <span class="literal">true</span> (å¼€å¯é«˜äº®æ˜¾ç¤º)</span><br><span class="line">git config --list (æŸ¥çœ‹gité…ç½®)</span><br><span class="line">git status (æŸ¥çœ‹å·¥ä½œç›®å½•çš„æ–‡ä»¶çŠ¶æ€)</span><br><span class="line">git add [filename &amp; . ] (å°†æ–‡ä»¶æäº¤åˆ°æš‚å­˜åŒºåŸŸ)</span><br><span class="line">git <span class="built_in">rm</span> --cached [file]  (å°†æ–‡ä»¶æ’¤å‡ºæš‚å­˜åŒº) </span><br><span class="line">git <span class="built_in">rm</span> -f [file] (ä»æš‚å­˜åŒºåŸŸåŒå·¥ä½œåŒºåŸŸä¸€åŒåˆ é™¤æ–‡ä»¶)</span><br><span class="line">git commit -m <span class="string">&quot;æè¿°ä¿¡æ¯&quot;</span> (å°†æ–‡ä»¶æäº¤åˆ°æœ¬åœ°ä»“åº“)</span><br><span class="line">git <span class="built_in">rm</span>        (åˆ é™¤æ–‡ä»¶)</span><br><span class="line">git <span class="built_in">mv</span> filename1 filename (åŒæ—¶ä¿®æ”¹å·¥ä½œåŒºåŸŸå’Œæš‚å­˜åŒºåŸŸçš„æ–‡ä»¶åç§°)</span><br><span class="line">git <span class="built_in">log</span>       (æŸ¥çœ‹å†å²æäº¤)  </span><br><span class="line">git <span class="built_in">log</span> --oneline (æ˜¾ç¤ºç®€ç•¥å†å²æäº¤)  </span><br><span class="line">git <span class="built_in">log</span> --oneline --decoreate(æ˜¾ç¤ºç®€ç•¥å†å²æäº¤å’Œå½“å‰æŒ‡é’ˆ)</span><br><span class="line">git diff         (å·¥ä½œç›®å½•è·Ÿæš‚å­˜åŒºæ–‡ä»¶å¯¹æ¯”)  </span><br><span class="line">git diff --cached(æš‚å­˜åŒºå’Œæœ¬åœ°ä»“åº“æ–‡ä»¶å¯¹æ¯”)</span><br><span class="line">git checkout -- [file] (å°†æš‚å­˜åŒºæ–‡ä»¶è¦†ç›–æœ¬åœ°å·¥ä½œç›®å½•æ–‡ä»¶)</span><br><span class="line">git tag -a v2.0 dbead4c -m <span class="string">&quot;version v2.0&quot;</span> (å°†æŸæ¬¡æäº¤æ‰“ä¸ºæ ‡ç­¾)</span><br><span class="line">git reset --hard c3cd410 (ç‰ˆæœ¬å›æ»šè‡³ c3cd410 )</span><br><span class="line">git reflog  (æŸ¥çœ‹æ‰€æœ‰çš„å†å²æäº¤)</span><br><span class="line">git branch  (æŸ¥çœ‹åˆ†æ”¯æƒ…å†µ) </span><br><span class="line">git branch dev  (åˆ›å»ºåˆ†æ”¯dev)</span><br><span class="line">git checkout dev(åˆ‡æ¢åˆ†æ”¯åˆ°dev æ–°ç‰ˆæœ¬å¯ç”¨ git switch dev)</span><br><span class="line">git merge dev   (åœ¨ç›®æ ‡åˆ†æ”¯åˆå¹¶æºåˆ†æ”¯dev)</span><br><span class="line">git branch -d dev (åˆ é™¤åˆ†æ”¯dev)</span><br></pre></td></tr></table></figure>    </div></div><h2 id="font-color-red-â–š-u-02-u-ç®€è¿°ï¼šGitlabçš„å®‰è£…åŠä½¿ç”¨-font"><font color=red>â–šâ€‚<u>02</u>â€‚ç®€è¿°ï¼šGitlabçš„å®‰è£…åŠä½¿ç”¨</font></h2><p>1ï¸âƒ£   è½¯ä»¶å®‰è£…ï¼Œgitlabçš„å®˜ç½‘æºåœ¨å›½å¤–ï¼Œè®¿é—®å—é™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å›½å†…æƒå¨çš„é•œåƒç«™ä¸‹è½½ <a href="https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/">gitlabç¤¾åŒºç‰ˆ</a></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240129214935952.png" alt="image-20240129214935952"></p><p>2ï¸âƒ£   å®‰è£…åˆ°linuxåï¼Œä¿®æ”¹urlé…ç½®ï¼Œç„¶åé‡å¯é…ç½®å³å¯ï¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/gitlab/gitlab.rb             <span class="comment">#  gitlab é…ç½®æ–‡ä»¶</span></span><br><span class="line">external_url <span class="string">&#x27;http://192.168.10.200&#x27;</span>  <span class="comment">#  æ›´æ”¹urlåœ°å€ä¸ºæœ¬æœºIPåœ°å€æˆ–åŸŸå</span></span><br><span class="line">gitlab-ctl reconfigure                <span class="comment">#  æ›´æ”¹é…ç½®æ–‡ä»¶åéœ€é‡æ–°é…ç½®</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/8B5C60B2C7185D5EE25BA445542DBFF8.png" alt="8B5C60B2C7185D5EE25BA445542DBFF8"></p><p>3ï¸âƒ£   é€šè¿‡webé¡µé¢è®¿é—®gitlabï¼Œå¹¶è¿›è¡Œæ“ä½œç®¡ç†ï¼›</p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240129215940556.png" alt="image-20240129215940556"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240129220939686.png" alt="image-20240129220939686"></p><p>æ¥ä¸‹æ¥åˆåˆ°äº†ç•Œé¢ç®¡ç†æ–¹å¼ï¼Œå¤§å®¶å¯è‡ªè¡Œå°è¯•æ‘¸ç´¢å“¦~ gitlabçš„æ¢ç´¢ä¹‹è·¯å—æ±å·²ä¸ºæ‚¨æ‰“å¼€ï¼ŒåŠ æ²¹ ğŸ‘¨â€ğŸš€</p><div class="warning"><p><strong>ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¼šå…ˆåˆ›å»ºç”¨æˆ·ç»„ï¼Œåœ¨ç”¨æˆ·ç»„ä¸‹åˆ›å»ºé¡¹ç›®ï¼Œä¸ºä¿è¯ä»£ç å®‰å…¨ï¼Œé¡¹ç›®åªå¯¹ç›¸å…³ç”¨æˆ·ç»„å¼€æ”¾ï¼Œæ–°ç”¨æˆ·åˆ›å»ºå®Œæˆåç”±ç®¡ç†å‘˜å°†å…¶åˆ†é…è‡³ç›¸åº”çš„ç”¨æˆ·ç»„ï¼Œä»¥è·å¾—ç›¸åº”çš„ä»£ç æŸ¥çœ‹å’Œæ¨é€æƒé™ï¼ˆåœ¨ä»£ç æ‹‰å–åŒæ­¥æˆ–æ¨é€è¿‡ç¨‹ä¸­ï¼Œä¸ºå‡å…ç¹ççš„å·¥ä½œæ­¥éª¤ï¼Œæˆ‘ä»¬ä¸€èˆ¬é‡‡ç”¨å…å¯†é’¥ç™»å½•ï¼Œè¿™ç‚¹åœ¨å„å¤§ä»£ç ç®¡ç†å¹³å°éƒ½æ˜¯å¦‚æ­¤å“¦~ï¼‰</strong></p></div><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxiblogfoot.png" alt="nanxiblogfoot"></p><iframe frameborder="no" border="0" marginwidth="0" allow = "autoplay" marginheight="0" width=100% height=86 src="//music.163.com/outchain/player?type=2&id=2110291360&auto=1&height=66"></iframe><blockquote><p><em><strong>å¦‚æœé”™è¿‡å¤ªé˜³æ—¶ä½ æµäº†æ³ªï¼Œé‚£ä¹ˆä½ ä¹Ÿè¦é”™è¿‡ç¾¤æ˜Ÿã€‚</strong></em></p><p align="right">â€”â€”æ³°æˆˆå°”</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;GitåŠgitlabä½¿ç”¨ç®€è¿°&lt;/center&gt;&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ„ å®˜ç½‘ä»‹ç»ï¼šGitæ˜¯ä¸€ä¸ªè‡ªç”±å’Œå¼€æºçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œæ—¨åœ¨å¿«é€Ÿå’Œé«˜æ•ˆåœ°å¤„ç†ä»å°å‹åˆ°å¤§å‹çš„æ‰€æœ‰é¡¹ç›®ã€‚Gitç®€å•æ˜“å­¦ï¼Œå ç”¨ç©ºé—´å°ï¼Œæ€§èƒ½å¿«å¦‚é—ªç”µã€‚å®ƒæ¯”Subversionã€CVSã€Perforceå’ŒClearCaseç­‰SCMå·¥å…·æ›´æœ‰ä¼˜åŠ¿ï¼Œå…·æœ‰å»‰ä»·çš„æœ¬åœ°åˆ†æ”¯ã€æ–¹ä¾¿çš„ç™»å°åŒºå’Œå¤šä¸ªå·¥ä½œæµç­‰ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;font-color-red-â–š-u-01-u-ç®€è¿°ï¼šGitçš„ä½¿ç”¨è¦ç‚¹-font&quot;&gt;&lt;font color=red&gt;â–šâ€‚&lt;u&gt;01&lt;/u&gt;â€‚ç®€è¿°ï¼šGitçš„ä½¿ç”¨è¦ç‚¹&lt;/font&gt;&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240129192325464.png&quot; alt=&quot;image-20240129192325464&quot;&gt;&lt;/p&gt;
&lt;div class=&quot;tips&quot;&gt;
&lt;p&gt;ä¸€èˆ¬linuxç³»ç»Ÿä¼šè‡ªå¸¦ç”±gitå·¥å…·ï¼Œå¦‚æœæ²¡æœ‰éœ€è‡ªè¡Œä¸‹è½½å®‰è£…ï¼Œ&lt;code&gt;yum -y install git&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="è½¯ä»¶åº”ç”¨" scheme="https://smallflames.github.io/tags/%E8%BD%AF%E4%BB%B6%E5%BA%94%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>Shellè„šæœ¬ç¯‡006</title>
    <link href="https://smallflames.github.io/2024/01/28/Shell%E8%84%9A%E6%9C%AC%E7%AF%87006/"/>
    <id>https://smallflames.github.io/2024/01/28/Shell%E8%84%9A%E6%9C%AC%E7%AF%87006/</id>
    <published>2024-01-28T10:45:09.000Z</published>
    <updated>2024-01-28T11:06:59.711Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Shellè„šæœ¬ç¯‡006</center></h1><table><tr><td bgcolor=#000000><font color="white">è„šæœ¬éœ€æ±‚</font></td></tr></table><font color="#fc5531">â–šâ€‚éœ€æ±‚â€‚ï¼šå†™ä¸€ä¸ªè„šæœ¬å®ç°æ‰¹é‡å…å¯†é’¥åˆ†å‘ã€‚</font><table><tr><td bgcolor=#000000><font color="white">å®ç°æ•ˆæœ</font></td></tr></table><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240128184852368.png" alt="image-20240128184852368"></p><span id="more"></span><table><tr><td bgcolor=#000000><font color="white">å®ç°è„šæœ¬</font></td></tr></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Author nanxi</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Date 2024-1-28</span></span><br><span class="line"></span><br><span class="line">sshkey=~/.ssh/id_rsa</span><br><span class="line">if [ ! -f $sshkey ];then</span><br><span class="line">    ssh-keygen -P &quot;&quot; -f $sshkey &gt;/dev/null</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if ! which expect&gt;/dev/null;then</span><br><span class="line">    echo &quot;æ£€æµ‹åˆ°è„šæœ¬è¿è¡Œéœ€è¦çš„äº¤äº’å·¥å…·ä¸å­˜åœ¨ï¼Œæ­£åœ¨è¿›è¡Œå®‰è£…...&quot;</span><br><span class="line">    yum -y install expect &gt;/dev/null</span><br><span class="line">    [ $? -ne 0 ] &amp;&amp; echo &quot;expectäº¤äº’å·¥å…·å®‰è£…å¤±è´¥ï¼Œè¯·æ‚¨å°è¯•æ‰‹åŠ¨å®‰è£…~&quot; &amp;&amp; exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">while read line</span><br><span class="line">do</span><br><span class="line">    ip=$(echo $line |awk &#x27;&#123;print $1&#125;&#x27;)</span><br><span class="line">    pass=$(echo $line |awk &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">    if ping -c1 -w1 $ip&gt;/dev/null;then</span><br><span class="line">    /usr/bin/expect &lt;&lt;-EOF</span><br><span class="line">         spawn ssh-copy-id $ip -f</span><br><span class="line">         expect &#123;</span><br><span class="line">            &quot;yes/no&quot; &#123;send &quot;yes\r&quot;;exp_continue&#125;</span><br><span class="line">            &quot;password&quot; &#123;send &quot;$pass\n&quot;&#125;</span><br><span class="line">         &#125;</span><br><span class="line">         expect eof</span><br><span class="line">EOF</span><br><span class="line">    let i++</span><br><span class="line">    else</span><br><span class="line">        echo -e &quot;\e[1;31m$ip çš„æœºå™¨å¯†é’¥åˆ†å‘å¼‚å¸¸ï¼Œè¯·æ‚¨å‰å¾€ç¡®ä¿ä¸»æœºçŠ¶æ€æ­£å¸¸ï¼ï¼ï¼\e[0m&quot;</span><br><span class="line">    fi</span><br><span class="line">done &lt;&lt; &quot;END&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## IPåœ°å€ å¯†ç </span></span></span><br><span class="line">192.168.10.2 1</span><br><span class="line">192.168.10.3 1</span><br><span class="line">192.168.10.201 1</span><br><span class="line">END</span><br><span class="line">echo &quot;$i å°æœºå™¨å¯†é’¥å·²åˆ†å‘æˆåŠŸï¼Œæ¥ä¸‹æ¥æ‚¨å¯ä»¥é€šè¿‡sshå…å¯†é’¥ç™»å½•ç»ˆç«¯&quot;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxiblogfoot.png" alt="nanxiblogfoot"></p><iframe frameborder="no" border="0" marginwidth="0" allow = "autoplay" marginheight="0" width=100% height=86 src="//music.163.com/outchain/player?type=2&id=1382592811&auto=1&height=66"></iframe><blockquote><p><em><strong>æ‰€è°“å®‰å®ï¼Œå°±æ˜¯åœ¨æˆ‘è¿½æ±‚è‡ªå·±æ‰€æƒ³è¦çš„ç”Ÿæ´»çš„æ—¶å€™ï¼Œèƒ½ä¸å‘ä¸äº¢åœ°ä¸€è¾¹å¤±å»ï¼Œä¸€è¾¹å¯»æ‰¾ã€‚</strong></em></p><p align="right">â€”â€”ã€Šè¢«å¡ä½çš„ç”Ÿæ´»ã€‹</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Shellè„šæœ¬ç¯‡006&lt;/center&gt;&lt;/h1&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;è„šæœ¬éœ€æ±‚&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;font color=&quot;#fc5531&quot;&gt;â–šâ€‚éœ€æ±‚â€‚ï¼šå†™ä¸€ä¸ªè„šæœ¬å®ç°æ‰¹é‡å…å¯†é’¥åˆ†å‘ã€‚&lt;/font&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;å®ç°æ•ˆæœ&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240128184852368.png&quot; alt=&quot;image-20240128184852368&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="Shellç¼–ç¨‹" scheme="https://smallflames.github.io/tags/Shell%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Shellè„šæœ¬ç¯‡005</title>
    <link href="https://smallflames.github.io/2024/01/28/Shell%E8%84%9A%E6%9C%AC%E7%AF%87005/"/>
    <id>https://smallflames.github.io/2024/01/28/Shell%E8%84%9A%E6%9C%AC%E7%AF%87005/</id>
    <published>2024-01-28T06:48:18.000Z</published>
    <updated>2024-01-28T11:07:18.104Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Shellè„šæœ¬ç¯‡005</center></h1><table><tr><td bgcolor=#000000><font color="white">è„šæœ¬éœ€æ±‚</font></td></tr></table><font color="#fc5531">â–šâ€‚éœ€æ±‚â€‚ï¼šå†™ä¸€ä¸ªè„šæœ¬æ£€æµ‹CPUä½¿ç”¨æƒ…å†µï¼Œå½“ä½¿ç”¨CPUä½¿ç”¨ç‡å¤§äº90%å³æŠ¥è­¦ã€‚</font><table><tr><td bgcolor=#000000><font color="white">å®ç°æ•ˆæœ</font></td></tr></table><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240128161507444.png" alt="image-20240128161507444"></p><span id="more"></span><table><tr><td bgcolor=#000000><font color="white">å®ç°è„šæœ¬</font></td></tr></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###  vim /etc/mail.rc</span></span><br><span class="line"><span class="built_in">set</span> from=xxxxxxxxxx@qq.com</span><br><span class="line"><span class="built_in">set</span> smtp=smtps://smtp.qq.com:465</span><br><span class="line"><span class="built_in">set</span> smtp-auth-user=xxxxxxxxxx@qq.com</span><br><span class="line"><span class="built_in">set</span> smtp-auth-password=/æœåŠ¡æˆæƒç </span><br><span class="line"><span class="built_in">set</span> smtp-auth=login</span><br><span class="line"><span class="built_in">set</span> ssl-verify=ignore</span><br><span class="line"><span class="built_in">set</span> nss-config-dir=/etc/pki/nssdb/</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Author nanxi</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Date 2024-1-28</span></span><br><span class="line"></span><br><span class="line">sentmail()&#123;</span><br><span class="line">mail -s &quot;CPUä½¿ç”¨å‘Šè­¦&quot; 3213138337@qq.com &lt;&lt;EOT</span><br><span class="line">CPUä½¿ç”¨ç‡è¶…è¿‡90%ï¼Œè¯·æ‚¨æ³¨æ„æœåŠ¡å¼‚å¸¸ï¼Œå¹¶è¿›è¡ŒåŠæ—¶å¤„ç†ï¼ï¼</span><br><span class="line">EOT</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">while true</span><br><span class="line">do</span><br><span class="line">    used=$(expr 100 - $(top -bn1 | awk -F &quot;ni,&quot; &#x27;/%Cpu/&#123;print $2&#125;&#x27;|cut -d &quot;.&quot; -f1|sed &quot;s/ //&quot;))</span><br><span class="line">    if [ $used -gt 90 ];then</span><br><span class="line">        sentmail</span><br><span class="line">    fi</span><br><span class="line">    sleep 10</span><br><span class="line">done</span><br></pre></td></tr></table></figure><div class="warning"><p>æ³¨æ„ï¼šæ£€æµ‹æ—¶é—´ç”±è‡ªå·±çš„åœºæ™¯è€Œå®šï¼Œå®šæ—¶ä»»åŠ¡çš„æœ€å°å¤„ç†æ—¶é—´æ˜¯1åˆ†é’Ÿï¼Œå¦‚æœæ‚¨å¯ä»¥æ¥å—1åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œé‚£ä¹ˆå®šæ—¶ä»»åŠ¡æ˜¯ä¸€ä¸ªéå¸¸å®Œç¾çš„é€‰æ‹©ï¼Œå¦‚æœæ‚¨æ¥å—ä¸äº†1åˆ†é’Ÿçš„æ—¶é—´é—´éš”ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦ç”¨è„šæœ¬å»çªç ´é™åˆ¶ï¼</p></div><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxiblogfoot.png" alt="nanxiblogfoot"></p><iframe frameborder="no" border="0" marginwidth="0" allow = "autoplay" marginheight="0" width=100% height=86 src="//music.163.com/outchain/player?type=2&id=507585217&auto=1&height=66"></iframe><blockquote><p><em><strong>ä¸è¦å‚å¤´ä¸§æ°”,å³ä½¿å¤±å»ä¸€åˆ‡,æ˜å¤©ä»åœ¨ä½ çš„æ‰‹é‡Œã€‚</strong></em></p><p align="right">â€”â€”ç‹å°”å¾·</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Shellè„šæœ¬ç¯‡005&lt;/center&gt;&lt;/h1&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;è„šæœ¬éœ€æ±‚&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;font color=&quot;#fc5531&quot;&gt;â–šâ€‚éœ€æ±‚â€‚ï¼šå†™ä¸€ä¸ªè„šæœ¬æ£€æµ‹CPUä½¿ç”¨æƒ…å†µï¼Œå½“ä½¿ç”¨CPUä½¿ç”¨ç‡å¤§äº90%å³æŠ¥è­¦ã€‚&lt;/font&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;å®ç°æ•ˆæœ&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240128161507444.png&quot; alt=&quot;image-20240128161507444&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="Shellç¼–ç¨‹" scheme="https://smallflames.github.io/tags/Shell%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Shellè„šæœ¬ç¯‡004</title>
    <link href="https://smallflames.github.io/2024/01/27/Shell%E8%84%9A%E6%9C%AC%E7%AF%87004/"/>
    <id>https://smallflames.github.io/2024/01/27/Shell%E8%84%9A%E6%9C%AC%E7%AF%87004/</id>
    <published>2024-01-27T11:07:53.000Z</published>
    <updated>2024-01-28T11:07:35.353Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Shellè„šæœ¬ç¯‡004</center></h1><table><tr><td bgcolor=#000000><font color="white">è„šæœ¬éœ€æ±‚</font></td></tr></table><font color="#fc5531">â–šâ€‚éœ€æ±‚â€‚ï¼šå†™ä¸€ä¸ªè„šæœ¬åå‘ç ´è§£ç”±éšæœºæ•°ç”Ÿæˆçš„MD5å€¼ã€‚</font><table><tr><td bgcolor=#000000><font color="white">å®ç°æ•ˆæœ</font></td></tr></table><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240127191533426.png" alt="image-20240127191533426"></p><span id="more"></span><table><tr><td bgcolor=#000000><font color="white">å®ç°è„šæœ¬</font></td></tr></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author nanxi</span></span><br><span class="line"><span class="comment">#Date 2024-1-27</span></span><br><span class="line"></span><br><span class="line">file=/tmp/.decipher.log</span><br><span class="line"><span class="function"><span class="title">prepare</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(echo 0 |md5sum)</span> 0&quot;</span> &gt;&gt;<span class="variable">$file</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">seq</span> 32767)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">     <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(echo $i |md5sum)</span> <span class="variable">$i</span>&quot;</span> &gt;&gt;<span class="variable">$file</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> [ -f <span class="variable">$file</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="keyword">if</span> [ $(<span class="built_in">wc</span> -l <span class="variable">$file</span> |awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>) -ne 32768 ];<span class="keyword">then</span></span><br><span class="line">        &gt;<span class="variable">$file</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;é¦–æ¬¡ä½¿ç”¨æœ¬è„šæœ¬å¯èƒ½éœ€è¦1åˆ†ç§å·¦å³ï¼Œè¯·æ‚¨è€å¿ƒç­‰å¾…ä¸€ä¸‹å“¦~&quot;</span></span><br><span class="line">        prepare</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">touch</span> <span class="variable">$file</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;é¦–æ¬¡ä½¿ç”¨æœ¬è„šæœ¬å¯èƒ½éœ€è¦1åˆ†ç§å·¦å³ï¼Œè¯·æ‚¨è€å¿ƒç­‰å¾…ä¸€ä¸‹å“¦~&quot;</span></span><br><span class="line">    prepare</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;è¯·è¾“å…¥æ‚¨è¦ç ´è¯‘çš„MD5å€¼(nä¸ºé€€å‡º): &quot;</span> md5</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$md5</span> =~ ^[0-z]+$ ]];<span class="keyword">then</span></span><br><span class="line">     <span class="keyword">case</span> <span class="variable">$md5</span> <span class="keyword">in</span></span><br><span class="line">     no|n)</span><br><span class="line">        <span class="built_in">exit</span></span><br><span class="line">    ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="keyword">if</span> grep <span class="string">&quot;<span class="variable">$md5</span>&quot;</span> <span class="variable">$file</span> &gt;/dev/null;<span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> æœ¬æ¬¡ç ´è¯‘ç»“æœä¸º: $(grep <span class="string">&quot;<span class="variable">$md5</span>&quot;</span> <span class="variable">$file</span> |awk <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;æŠ±æ­‰ï¼Œæœ¬æ¬¡ç ´è¯‘å¤±è´¥ï¼Œæ‚¨å¯é‡æ–°å°è¯•å…¶ä»–å€¼å“¦~&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\e[1;31mè­¦å‘Š: æ‚¨è¾“å…¥çš„å‚æ•°å€¼ä¸åˆæ³•ï¼ï¼ï¼\e[0m&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxiblogfoot.png" alt="nanxiblogfoot"></p><iframe frameborder="no" border="0" marginwidth="0" allow = "autoplay" marginheight="0" width=100% height=86  src="//music.163.com/outchain/player?type=2&id=1906301400&auto=1&height=66"></iframe><blockquote><p><em><strong>äººç”Ÿä¸å°±æ˜¯è¿™æ ·,å“ªæ€•é›¨é›ªéœéœä¹Ÿè¦å»è¿½å¯»é˜³å…‰ã€‚</strong></em></p><p align="right">â€”â€”äººæ°‘æ—¥æŠ¥</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Shellè„šæœ¬ç¯‡004&lt;/center&gt;&lt;/h1&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;è„šæœ¬éœ€æ±‚&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;font color=&quot;#fc5531&quot;&gt;â–šâ€‚éœ€æ±‚â€‚ï¼šå†™ä¸€ä¸ªè„šæœ¬åå‘ç ´è§£ç”±éšæœºæ•°ç”Ÿæˆçš„MD5å€¼ã€‚&lt;/font&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;å®ç°æ•ˆæœ&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240127191533426.png&quot; alt=&quot;image-20240127191533426&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="Shellç¼–ç¨‹" scheme="https://smallflames.github.io/tags/Shell%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Shellç¼–ç¨‹çŸ¥è¯†è¡¥å……ï¼ˆå››ï¼‰</title>
    <link href="https://smallflames.github.io/2024/01/26/Shell%E7%BC%96%E7%A8%8B%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85%EF%BC%88%E5%9B%9B%EF%BC%89/"/>
    <id>https://smallflames.github.io/2024/01/26/Shell%E7%BC%96%E7%A8%8B%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85%EF%BC%88%E5%9B%9B%EF%BC%89/</id>
    <published>2024-01-26T07:33:08.000Z</published>
    <updated>2024-01-27T08:52:42.030Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Shellç¼–ç¨‹åŸºç¡€çŸ¥è¯†è¡¥å……</center></h1><h2 id="font-color-red-â–š-u-01-u-è¡¥å……ï¼šæ™®é€šæ•°ç»„å’Œå…³è”æ•°ç»„-font"><font color=red>â–šâ€‚<u>01</u>â€‚è¡¥å……ï¼šæ™®é€šæ•°ç»„å’Œå…³è”æ•°ç»„</font></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  æ™®é€šæ•°ç»„ç¤ºä¾‹</span></span><br><span class="line">[root@ceshi ~]<span class="comment">#a=(a b c d)</span></span><br><span class="line">[root@ceshi ~]<span class="comment">#echo $&#123;a[*]&#125;</span></span><br><span class="line">a b c d</span><br><span class="line">[root@ceshi ~]<span class="comment">#echo $&#123;a[@]&#125;</span></span><br><span class="line">a b c d</span><br><span class="line">[root@ceshi ~]<span class="comment">#echo $&#123;!a[@]&#125;</span></span><br><span class="line">0 1 2 3</span><br><span class="line">[root@ceshi ~]<span class="comment">#echo $&#123;!a[*]&#125;</span></span><br><span class="line">0 1 2 3</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   å…³è”æ•°ç»„ç¤ºä¾‹</span></span><br><span class="line">[root@ceshi ~]<span class="comment">#unset a</span></span><br><span class="line">[root@ceshi ~]<span class="comment">#declare -A a</span></span><br><span class="line">[root@ceshi ~]<span class="comment">#a[a]=1</span></span><br><span class="line">[root@ceshi ~]<span class="comment">#a[b]=2</span></span><br><span class="line">[root@ceshi ~]<span class="comment">#a[c]=3</span></span><br><span class="line">[root@ceshi ~]<span class="comment">#echo $&#123;a[*]&#125;</span></span><br><span class="line">1 2 3</span><br><span class="line">[root@ceshi ~]<span class="comment">#echo $&#123;a[@]&#125;</span></span><br><span class="line">1 2 3</span><br><span class="line">[root@ceshi ~]<span class="comment">#echo $&#123;!a[@]&#125;</span></span><br><span class="line">a b c</span><br><span class="line">[root@ceshi ~]<span class="comment">#echo $&#123;!a[*]&#125;</span></span><br><span class="line">a b c</span><br><span class="line">-----------------------------------</span><br><span class="line">[root@ceshi ~]<span class="comment">#unset a</span></span><br><span class="line">[root@ceshi ~]<span class="comment">#declare -A a</span></span><br><span class="line">[root@ceshi ~]<span class="comment">#a=([nanxi]=&quot;i&quot; [love]=&quot;love&quot; [you]=&quot;you&quot;)</span></span><br><span class="line">[root@ceshi ~]<span class="comment">#echo $&#123;a[*]&#125;</span></span><br><span class="line">you love i</span><br><span class="line">[root@ceshi ~]<span class="comment">#echo $&#123;!a[*]&#125;</span></span><br><span class="line">you love nanxi</span><br></pre></td></tr></table></figure><div class="warning"><p>shellä¸­çš„æ™®é€šæ•°ç»„å’ŒCçš„ä¸€ç»´æ•°ç»„ä¸€æ ·ï¼Œä½†æ˜¯å…³è”æ•°ç»„æœ‰æ‰€ä¸åŒï¼Œå…³è”æ•°ç»„å¯ä»¥ç”¨ä»»æ„çš„æ–‡æœ¬ä½œä¸ºæ•°ç»„ç´¢å¼•ï¼Œè€Œæ™®é€šæ•°ç»„ä¸­çš„ç´¢å¼•éƒ½æ˜¯æ•´æ•°ï¼Œä¸”å…³è”æ•°ç»„ä½¿ç”¨ä¹‹å‰éœ€è¦å£°æ˜ï¼š<code>declare -A ass_array</code></p></div><span id="more"></span><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240127160621720.png" alt="image-20240127160621720"></p><h2 id="font-color-red-â–š-u-02-u-è¡¥å……ï¼šShellä¸­å˜é‡çš„ä½¿ç”¨-font"><font color=red>â–šâ€‚<u>02</u>â€‚è¡¥å……ï¼šShellä¸­å˜é‡çš„ä½¿ç”¨</font></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@ceshi ~]<span class="comment">#sh ceshi.sh</span></span><br><span class="line">libai</span><br><span class="line">nanxi</span><br><span class="line">nanxi</span><br><span class="line">[root@ceshi ~]<span class="comment">#cat ceshi.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">name=nanxi</span><br><span class="line"><span class="function"><span class="title">fun1</span></span>()&#123;</span><br><span class="line"><span class="comment">### localå£°åçš„å˜é‡åªåœ¨æœ¬å‡½æ•°ï¼ˆfun1ï¼‰ä¸­ç”Ÿæ•ˆï¼Œå…¶ä»–å‡½æ•°ä¸ç”Ÿæ•ˆ</span></span><br><span class="line">    <span class="built_in">local</span> name=libai</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$name</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">fun2</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$name</span></span><br><span class="line">&#125;</span><br><span class="line">fun1</span><br><span class="line">fun2</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$name</span></span><br></pre></td></tr></table></figure><h2 id="font-color-red-â–š-u-03-u-æé†’ï¼šå…³äºå˜é‡å’Œå‡½æ•°è°ƒç”¨-font"><font color=red>â–šâ€‚<u>03</u>â€‚æé†’ï¼šå…³äºå˜é‡å’Œå‡½æ•°è°ƒç”¨</font></h2><div class="warning"><p>æ³¨æ„âš ï¸ ï¼š å‡½æ•°ä¸è°ƒç”¨ä¸æ‰§è¡Œï¼Œå˜é‡å®šä¹‰æ—¶ï¼ˆè§£é‡Šå™¨æ”¶åˆ°å˜é‡å®šä¹‰çš„æŒ‡ä»¤ï¼‰å³æ‰§è¡Œï¼å˜é‡å’Œå‡½æ•°ä¸€æ—¦å®šä¹‰ï¼Œåœ¨æ­¤shellä¸­ä¼šä¸€ç›´ç”Ÿæ•ˆï¼Œå¦‚ï¼š<code>. /etc/init.d/funtouns</code> æ˜¯ç”¨å½“å‰shellæ‰§è¡Œè°ƒç”¨ï¼Œå½“å‰shellæ²¡æœ‰é€€å‡ºï¼Œåˆ™é‡Œé¢çš„å‡½æ•°å˜é‡å®šä¹‰å°±ä¼šä¸€ç›´èµ·ä½œç”¨ï¼Œæ‰€ä»¥æ— è®ºæˆ‘ä»¬æƒ³è°ƒç”¨å‡ æ¬¡actionå‡½æ•°ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨actionå‡½æ•°ä¹‹å‰å…ˆè°ƒç”¨<code>. /etc/init.d/funtouns</code>å¹¶ä¿æŒç¯å¢ƒä¸€ç›´ç”Ÿæ•ˆã€‚</p></div><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxiblogfoot.png" alt="nanxiblogfoot"></p><iframe frameborder="no" border="0" marginwidth="0" allow = "autoplay" marginheight="0" width=100% height=86 src="//music.163.com/outchain/player?type=2&id=1381084455&auto=1&height=66"></iframe><blockquote><p><em><strong>å…¶å®äººè·Ÿæ ‘æ˜¯ä¸€æ ·çš„ï¼Œè¶Šæ˜¯å‘å¾€é«˜å¤„çš„é˜³å…‰ï¼Œæ ¹å°±è¶Šè¦æ·±å…¥é»‘æš—çš„åœ°åº•ã€‚</strong></em></p><p align="right">â€”â€”å°¼é‡‡</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Shellç¼–ç¨‹åŸºç¡€çŸ¥è¯†è¡¥å……&lt;/center&gt;&lt;/h1&gt;
&lt;h2 id=&quot;font-color-red-â–š-u-01-u-è¡¥å……ï¼šæ™®é€šæ•°ç»„å’Œå…³è”æ•°ç»„-font&quot;&gt;&lt;font color=red&gt;â–šâ€‚&lt;u&gt;01&lt;/u&gt;â€‚è¡¥å……ï¼šæ™®é€šæ•°ç»„å’Œå…³è”æ•°ç»„&lt;/font&gt;&lt;/h2&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#  æ™®é€šæ•°ç»„ç¤ºä¾‹&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ceshi ~]&lt;span class=&quot;comment&quot;&gt;#a=(a b c d)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ceshi ~]&lt;span class=&quot;comment&quot;&gt;#echo $&amp;#123;a[*]&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;a b c d&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ceshi ~]&lt;span class=&quot;comment&quot;&gt;#echo $&amp;#123;a[@]&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;a b c d&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ceshi ~]&lt;span class=&quot;comment&quot;&gt;#echo $&amp;#123;!a[@]&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0 1 2 3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ceshi ~]&lt;span class=&quot;comment&quot;&gt;#echo $&amp;#123;!a[*]&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;0 1 2 3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#   å…³è”æ•°ç»„ç¤ºä¾‹&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ceshi ~]&lt;span class=&quot;comment&quot;&gt;#unset a&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ceshi ~]&lt;span class=&quot;comment&quot;&gt;#declare -A a&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ceshi ~]&lt;span class=&quot;comment&quot;&gt;#a[a]=1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ceshi ~]&lt;span class=&quot;comment&quot;&gt;#a[b]=2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ceshi ~]&lt;span class=&quot;comment&quot;&gt;#a[c]=3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ceshi ~]&lt;span class=&quot;comment&quot;&gt;#echo $&amp;#123;a[*]&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1 2 3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ceshi ~]&lt;span class=&quot;comment&quot;&gt;#echo $&amp;#123;a[@]&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1 2 3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ceshi ~]&lt;span class=&quot;comment&quot;&gt;#echo $&amp;#123;!a[@]&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;a b c&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ceshi ~]&lt;span class=&quot;comment&quot;&gt;#echo $&amp;#123;!a[*]&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;a b c&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-----------------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ceshi ~]&lt;span class=&quot;comment&quot;&gt;#unset a&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ceshi ~]&lt;span class=&quot;comment&quot;&gt;#declare -A a&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ceshi ~]&lt;span class=&quot;comment&quot;&gt;#a=([nanxi]=&amp;quot;i&amp;quot; [love]=&amp;quot;love&amp;quot; [you]=&amp;quot;you&amp;quot;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ceshi ~]&lt;span class=&quot;comment&quot;&gt;#echo $&amp;#123;a[*]&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;you love i&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ceshi ~]&lt;span class=&quot;comment&quot;&gt;#echo $&amp;#123;!a[*]&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;you love nanxi&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;div class=&quot;warning&quot;&gt;
&lt;p&gt;shellä¸­çš„æ™®é€šæ•°ç»„å’ŒCçš„ä¸€ç»´æ•°ç»„ä¸€æ ·ï¼Œä½†æ˜¯å…³è”æ•°ç»„æœ‰æ‰€ä¸åŒï¼Œå…³è”æ•°ç»„å¯ä»¥ç”¨ä»»æ„çš„æ–‡æœ¬ä½œä¸ºæ•°ç»„ç´¢å¼•ï¼Œè€Œæ™®é€šæ•°ç»„ä¸­çš„ç´¢å¼•éƒ½æ˜¯æ•´æ•°ï¼Œä¸”å…³è”æ•°ç»„ä½¿ç”¨ä¹‹å‰éœ€è¦å£°æ˜ï¼š&lt;code&gt;declare -A ass_array&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="Shellç¼–ç¨‹" scheme="https://smallflames.github.io/tags/Shell%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Shellç¼–ç¨‹çŸ¥è¯†è¡¥å……ï¼ˆä¸‰ï¼‰</title>
    <link href="https://smallflames.github.io/2024/01/25/Shell%E7%BC%96%E7%A8%8B%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85%EF%BC%88%E4%B8%89%EF%BC%89/"/>
    <id>https://smallflames.github.io/2024/01/25/Shell%E7%BC%96%E7%A8%8B%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85%EF%BC%88%E4%B8%89%EF%BC%89/</id>
    <published>2024-01-25T11:24:57.000Z</published>
    <updated>2024-01-26T07:39:42.448Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Shellç¼–ç¨‹åŸºç¡€çŸ¥è¯†è¡¥å……</center></h1><blockquote><p>ğŸŸ  sedæ›¿æ¢æ–‡æœ¬ä¸­æŸè¡Œçš„æŸä¸ªå­—ç¬¦  <code>sed -i '/^admin/s/100/22/' nanxi.txt</code> æŠŠnanxi.txtä¸­ä»¥adminå¼€å¤´çš„è¡Œé‡Œé¢çš„100æ›¿æ¢æˆ22ã€‚</p></blockquote><h2 id="ä¸€ã€whileè¯»å–æ–‡æœ¬">ä¸€ã€whileè¯»å–æ–‡æœ¬</h2><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240125205335929.png" alt="image-20240125205335929"></p><span id="more"></span><h2 id="äºŒã€æ•°å€¼è®¡ç®—">äºŒã€æ•°å€¼è®¡ç®—</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   expr åªæ”¯æŒæ•´æ•°è¿ç®—</span></span><br><span class="line">root@nanxi:~<span class="comment"># expr 1 + 1</span></span><br><span class="line">2</span><br><span class="line">root@nanxi:~<span class="comment"># expr 21 - 1</span></span><br><span class="line">20</span><br><span class="line">root@nanxi:~<span class="comment"># expr 21 \* 2</span></span><br><span class="line">42</span><br><span class="line">root@nanxi:~<span class="comment"># expr 21 / 2</span></span><br><span class="line">10</span><br><span class="line">root@nanxi:~<span class="comment"># expr 22 / 2</span></span><br><span class="line">11</span><br><span class="line">root@nanxi:~<span class="comment"># expr 22 % 2</span></span><br><span class="line">0</span><br><span class="line">-------------------------------</span><br><span class="line"><span class="comment">#   $(()) åªæ”¯æŒæ•´æ•°è¿ç®—æ•ˆç‡æœ€é«˜</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $((2+4))</span></span><br><span class="line">6</span><br><span class="line">root@nanxi:~<span class="comment"># echo $((4-2))</span></span><br><span class="line">2</span><br><span class="line">root@nanxi:~<span class="comment"># echo $((2*4))</span></span><br><span class="line">8</span><br><span class="line">root@nanxi:~<span class="comment"># echo $((2/4))</span></span><br><span class="line">0</span><br><span class="line">root@nanxi:~<span class="comment"># echo $((4/2))</span></span><br><span class="line">2</span><br><span class="line">root@nanxi:~<span class="comment"># echo $((4%2))</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">-------------------------------</span><br><span class="line"><span class="comment">#   $[] åªæ”¯æŒæ•´æ•°è¿ç®—</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $[10+10]</span></span><br><span class="line">20</span><br><span class="line">root@nanxi:~<span class="comment"># echo $[10-10]</span></span><br><span class="line">0</span><br><span class="line">root@nanxi:~<span class="comment"># echo $[10*10]</span></span><br><span class="line">100</span><br><span class="line">root@nanxi:~<span class="comment"># echo $[10/10]</span></span><br><span class="line">1</span><br><span class="line">root@nanxi:~<span class="comment"># echo $[10%10]</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">-------------------------------</span><br><span class="line"><span class="comment">#   letè¿ç®—(å¿…é¡»é€šè¿‡å˜é‡æ‰èƒ½è®¡ç®—)</span></span><br><span class="line">root@nanxi:~<span class="comment"># let 1+1</span></span><br><span class="line">root@nanxi:~<span class="comment"># let n=1+1</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $n</span></span><br><span class="line">2</span><br><span class="line">root@nanxi:~<span class="comment"># let n=2*3</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $n</span></span><br><span class="line">6</span><br><span class="line">root@nanxi:~<span class="comment"># let n=2/1</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $n</span></span><br><span class="line">2</span><br><span class="line">root@nanxi:~<span class="comment"># let n=2-1</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $n</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">-------------------------------</span><br><span class="line"><span class="comment">#   bcå‘½ä»¤</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo 1+1*2-1*3|bc</span></span><br><span class="line">0</span><br><span class="line">root@nanxi:~<span class="comment"># echo 3+(1+1)*2-1*3|bc</span></span><br><span class="line">4</span><br><span class="line"></span><br><span class="line">æˆ–è€…ä½¿ç”¨awkâ€¦â€¦</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€å·§ç”¨seqå‘½ä»¤">ä¸‰ã€å·§ç”¨seqå‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   ä½¿ç”¨æ–¹æ³•</span></span><br><span class="line">1. <span class="built_in">seq</span> + é€‰é¡¹ + å°¾æ•°ï¼ˆé»˜è®¤è¾“å‡ºä»1å¼€å§‹çš„æ•´æ•°ï¼‰</span><br><span class="line">2. <span class="built_in">seq</span> + é€‰é¡¹ + é¦–æ•° + å°¾æ•°</span><br><span class="line">3. <span class="built_in">seq</span> + é€‰é¡¹ + é¦–æ•° + å¢é‡ + å°¾æ•°</span><br><span class="line"></span><br><span class="line">-f, --format=FORMAT      use <span class="built_in">printf</span> style floating-point FORMAT</span><br><span class="line">-s, --separator=STRING   use STRING to separate numbers (default: \n)</span><br><span class="line">-w, --equal-width        equalize width by padding with leading zeroes</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   å®ä¾‹</span></span><br><span class="line">root@nanxi:~<span class="comment"># seq 5</span></span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">root@nanxi:~<span class="comment"># seq -s + 5</span></span><br><span class="line">1+2+3+4+5</span><br><span class="line">root@nanxi:~<span class="comment"># seq -s &#x27;&#x27; 5</span></span><br><span class="line">12345</span><br><span class="line">root@nanxi:~<span class="comment"># seq -s &#x27; &#x27; 5</span></span><br><span class="line">1 2 3 4 5</span><br><span class="line">root@nanxi:~<span class="comment"># seq -f &quot;%2g&quot; 8 12</span></span><br><span class="line"> 8</span><br><span class="line"> 9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">root@nanxi:~<span class="comment"># seq -f &quot;%02g&quot; 8 12</span></span><br><span class="line">08</span><br><span class="line">09</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">root@nanxi:~<span class="comment"># seq -s &#x27; &#x27; -f &quot;%02g&quot; 8 12</span></span><br><span class="line">08 09 10 11 12</span><br><span class="line">root@nanxi:~<span class="comment"># seq -f &quot;nanxi%02g&quot; 8 12</span></span><br><span class="line">nanxi08</span><br><span class="line">nanxi09</span><br><span class="line">nanxi10</span><br><span class="line">nanxi11</span><br><span class="line">nanxi12</span><br><span class="line">root@nanxi:~<span class="comment"># seq -f &quot;%.2f&quot; 9 11</span></span><br><span class="line">9.00</span><br><span class="line">10.00</span><br><span class="line">11.00</span><br><span class="line">root@nanxi:~<span class="comment"># seq -w 2 2 10</span></span><br><span class="line">02</span><br><span class="line">04</span><br><span class="line">06</span><br><span class="line">08</span><br><span class="line">10</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   ä»1åŠ åˆ°100</span></span><br><span class="line">root@nanxi:~<span class="comment"># seq -s + 100|bc</span></span><br><span class="line">5050</span><br><span class="line"></span><br><span class="line"><span class="comment">#   æ‰¹é‡åˆ›å»ºåˆ é™¤ç”¨æˆ·</span></span><br><span class="line">[root@ceshi ~]<span class="comment">#seq -f &#x27;useradd nanxi%g&#x27; 5|bash</span></span><br><span class="line">[root@ceshi ~]<span class="comment">#seq -f &#x27;userdel -r nanxi%g&#x27; 5|bash</span></span><br><span class="line"></span><br><span class="line">å¦™ç”¨æœ‰å¾ˆå¤šå“¦â€¦â€¦</span><br></pre></td></tr></table></figure><h2 id="å››ã€waitå‘½ä»¤">å››ã€waitå‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   waitå‘½ä»¤è¡¨ç¤ºç­‰å¾…ï¼Œè„šæœ¬é‡Œé¢çš„waitè¡¨ç¤ºç­‰å¾…ä¸Šé¢æ‰€æœ‰å‘½ä»¤æ‰§è¡Œçš„è¿›ç¨‹ç»“æŸåæ–¹å¯ç»§ç»­</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">seq</span> 254`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">ip=10.0.0.<span class="variable">$i</span></span><br><span class="line">ping -c1 -W1 <span class="variable">$ip</span> &amp;&gt;/dev/null</span><br><span class="line">[ $? -eq 0 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$ip</span> åœ¨çº¿&quot;</span></span><br><span class="line">&#125; &amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"><span class="built_in">echo</span> <span class="keyword">done</span>............</span><br></pre></td></tr></table></figure><h2 id="äº”ã€trapå‘½ä»¤">äº”ã€trapå‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   trapå‘½ä»¤çš„ä½¿ç”¨</span></span><br><span class="line"><span class="comment">#   ä½¿ç”¨æ–¹æ³•: trap [command] [signal]</span></span><br><span class="line"></span><br><span class="line">[root@ceshi ~]<span class="comment">#trap -l</span></span><br><span class="line"> 1) SIGHUP 2) SIGINT 3) SIGQUIT 4) SIGILL 5) SIGTRAP</span><br><span class="line"> 6) SIGABRT 7) SIGBUS 8) SIGFPE 9) SIGKILL10) SIGUSR1</span><br><span class="line">11) SIGSEGV12) SIGUSR213) SIGPIPE14) SIGALRM15) SIGTERM</span><br><span class="line">16) SIGSTKFLT17) SIGCHLD18) SIGCONT19) SIGSTOP20) SIGTSTP</span><br><span class="line">21) SIGTTIN22) SIGTTOU23) SIGURG24) SIGXCPU25) SIGXFSZ</span><br><span class="line">26) SIGVTALRM27) SIGPROF28) SIGWINCH29) SIGIO30) SIGPWR</span><br><span class="line">31) SIGSYS34) SIGRTMIN35) SIGRTMIN+136) SIGRTMIN+237) SIGRTMIN+3</span><br><span class="line">38) SIGRTMIN+439) SIGRTMIN+540) SIGRTMIN+641) SIGRTMIN+742) SIGRTMIN+8</span><br><span class="line">43) SIGRTMIN+944) SIGRTMIN+1045) SIGRTMIN+1146) SIGRTMIN+1247) SIGRTMIN+13</span><br><span class="line">48) SIGRTMIN+1449) SIGRTMIN+1550) SIGRTMAX-1451) SIGRTMAX-1352) SIGRTMAX-12</span><br><span class="line">53) SIGRTMAX-1154) SIGRTMAX-1055) SIGRTMAX-956) SIGRTMAX-857) SIGRTMAX-7</span><br><span class="line">58) SIGRTMAX-659) SIGRTMAX-560) SIGRTMAX-461) SIGRTMAX-362) SIGRTMAX-2</span><br><span class="line">63) SIGRTMAX-164) SIGRTMAX</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨æ–¹å¼å¦‚ä¸‹</span><br><span class="line">1ã€  <span class="built_in">trap</span> <span class="string">&quot;commands&quot;</span> signal-list</span><br><span class="line"><span class="comment"># å½“è„šæœ¬æ”¶åˆ°signal-listæ¸…å•å†…åˆ—å‡ºçš„ä¿¡å·æ—¶ï¼Œtrapå‘½ä»¤æ‰§è¡ŒåŒå¼•å·ä¸­çš„å‘½ä»¤ã€‚</span></span><br><span class="line">2ã€  <span class="built_in">trap</span> signal-list</span><br><span class="line"><span class="comment"># trapä¸æŒ‡å®šä»»ä½•å‘½ä»¤ï¼Œæ¥å—ä¿¡å·çš„é»˜è®¤æ“ä½œï¼Œé»˜è®¤æ“ä½œæ˜¯ç»“æŸè¿›ç¨‹çš„è¿è¡Œã€‚</span></span><br><span class="line">3ã€  <span class="built_in">trap</span> <span class="string">&quot; &quot;</span> signal-list</span><br><span class="line"><span class="comment"># trapå‘½ä»¤æŒ‡å®šä¸€ä¸ªç©ºå‘½ä»¤ä¸²ï¼Œå…è®¸å¿½è§†ä¿¡å·ï¼Œæˆ‘ä»¬æœ€å¸¸ç”¨åˆ°çš„å°±æ˜¯è¿™ä¸€ç§ã€‚</span></span><br></pre></td></tr></table></figure><p><font color=red><strong>æ³¨æ„:Â  è„šæœ¬ç¨‹åºé€šå¸¸æ˜¯ä»¥ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºè§£é‡Šæ‰§è¡Œçš„ï¼Œæ‰€ä»¥å¿…é¡»åœ¨ä½ æƒ³ä¿æŠ¤çš„é‚£éƒ¨åˆ†ä»£ç ä»¥å‰æŒ‡å®štrapå‘½ä»¤ã€‚</strong></font></p><div class='spoiler collapsed'>    <div class='spoiler-title'>        SIGNALäº†è§£    </div>    <div class='spoiler-content'>        <p>SIGHUP------------------------&gt;ç»ˆæ­¢è¿›ç¨‹    ç»ˆç«¯çº¿è·¯æŒ‚æ–­</p><p>SIGINT-------------------------&gt;ç»ˆæ­¢è¿›ç¨‹    ä¸­æ–­è¿›ç¨‹</p><p>SIGQUIT-----------------------&gt;å»ºç«‹COREæ–‡ä»¶ ç»ˆæ­¢è¿›ç¨‹ï¼Œå¹¶ä¸”ç”Ÿæˆcoreæ–‡ä»¶</p><p>SIGILL--------------------------&gt;å»ºç«‹COREæ–‡ä»¶    éæ³•æŒ‡ä»¤</p><p>SIGTRAP----------------------&gt;å»ºç«‹COREæ–‡ä»¶     è·Ÿè¸ªè‡ªé™·</p><p>SIGBUS------------------------&gt;å»ºç«‹COREæ–‡ä»¶    æ€»çº¿é”™è¯¯</p><p>SIGSEGV----------------------&gt;å»ºç«‹COREæ–‡ä»¶     æ®µéæ³•é”™è¯¯</p><p>SIGFPE-------------------------&gt;å»ºç«‹COREæ–‡ä»¶    æµ®ç‚¹å¼‚å¸¸</p><p>SIGIOT-------------------------&gt;å»ºç«‹COREæ–‡ä»¶    æ‰§è¡ŒI/Oè‡ªé™·</p><p>SIGKILL------------------------&gt;ç»ˆæ­¢è¿›ç¨‹    æ€æ­»è¿›ç¨‹</p><p>SIGPIPE------------------------&gt;ç»ˆæ­¢è¿›ç¨‹    å‘ä¸€ä¸ªæ²¡æœ‰è¯»è¿›ç¨‹çš„ç®¡é“å†™æ•°æ®</p><p>SIGALARM--------------------&gt;ç»ˆæ­¢è¿›ç¨‹    è®¡æ—¶å™¨åˆ°æ—¶</p><p>SIGTERM----------------------&gt;ç»ˆæ­¢è¿›ç¨‹    è½¯ä»¶ç»ˆæ­¢ä¿¡å·</p><p>SIGSTOP-----------------------&gt;åœæ­¢è¿›ç¨‹    éç»ˆç«¯æ¥çš„åœæ­¢ä¿¡å·</p><p>SIGTSTP------------------------&gt;åœæ­¢è¿›ç¨‹    ç»ˆç«¯æ¥çš„åœæ­¢ä¿¡å·</p><p>SIGCONT-----------------------&gt;å¿½ç•¥ä¿¡å·    ç»§ç»­æ‰§è¡Œä¸€ä¸ªåœæ­¢çš„è¿›ç¨‹</p><p>SIGURG-------------------------&gt;å¿½ç•¥ä¿¡å·   I/Oç´§æ€¥ä¿¡å·</p><p>SIGIO----------------------------&gt;å¿½ç•¥ä¿¡å·   æè¿°ç¬¦ä¸Šå¯ä»¥è¿›è¡ŒI/O</p><p>SIGCHLD-----------------------&gt;å¿½ç•¥ä¿¡å·    å½“å­è¿›ç¨‹åœæ­¢æˆ–é€€å‡ºæ—¶é€šçŸ¥çˆ¶è¿›ç¨‹</p><p>SIGTTOU-----------------------&gt;åœæ­¢è¿›ç¨‹    åå°è¿›ç¨‹å†™ç»ˆç«¯</p><p>SIGTTIN------------------------&gt;åœæ­¢è¿›ç¨‹    åå°è¿›ç¨‹è¯»ç»ˆç«¯</p><p>SIGXGPU-----------------------&gt;ç»ˆæ­¢è¿›ç¨‹    CPUæ—¶é™è¶…æ—¶</p><p>SIGXFSZ------------------------&gt;ç»ˆæ­¢è¿›ç¨‹    æ–‡ä»¶é•¿åº¦è¿‡é•¿</p><p>SIGWINCH---------------------&gt;å¿½ç•¥ä¿¡å·    çª—å£å¤§å°å‘ç”Ÿå˜åŒ–</p><p>SIGPROF-----------------------&gt;ç»ˆæ­¢è¿›ç¨‹    ç»Ÿè®¡åˆ†å¸ƒå›¾ç”¨è®¡æ—¶å™¨åˆ°æ—¶</p><p>SIGUSR1-----------------------&gt;ç»ˆæ­¢è¿›ç¨‹    ç”¨æˆ·å®šä¹‰ä¿¡å·1</p><p>SIGUSR2-----------------------&gt;ç»ˆæ­¢è¿›ç¨‹    ç”¨æˆ·å®šä¹‰ä¿¡å·2</p><p>SIGVTALRM-------------------&gt;ç»ˆæ­¢è¿›ç¨‹    è™šæ‹Ÿè®¡æ—¶å™¨åˆ°æ—¶</p>    </div></div><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxiblogfoot.png" alt="nanxiblogfoot"></p><blockquote><p><em><strong>ä¼˜ç§€çš„å…¬å¸ä¸ç›¸ä¿¡å“è¶Šï¼Œåªç›¸ä¿¡ä¸æ–­æ”¹è¿›å’Œä¸æ–­å˜åŒ–ã€‚</strong></em></p><p align="right">â€”â€”æ±¤å§†.å½¼å¾—æ–¯</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Shellç¼–ç¨‹åŸºç¡€çŸ¥è¯†è¡¥å……&lt;/center&gt;&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸŸ  sedæ›¿æ¢æ–‡æœ¬ä¸­æŸè¡Œçš„æŸä¸ªå­—ç¬¦  &lt;code&gt;sed -i &#39;/^admin/s/100/22/&#39; nanxi.txt&lt;/code&gt; æŠŠnanxi.txtä¸­ä»¥adminå¼€å¤´çš„è¡Œé‡Œé¢çš„100æ›¿æ¢æˆ22ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;ä¸€ã€whileè¯»å–æ–‡æœ¬&quot;&gt;ä¸€ã€whileè¯»å–æ–‡æœ¬&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240125205335929.png&quot; alt=&quot;image-20240125205335929&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="Shellç¼–ç¨‹" scheme="https://smallflames.github.io/tags/Shell%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>å—æ±çš„äº‘ç«¯å°é“º</title>
    <link href="https://smallflames.github.io/2024/01/25/%E5%8D%97%E6%B1%90%E7%9A%84%E4%BA%91%E7%AB%AF%E5%B0%8F%E9%93%BA/"/>
    <id>https://smallflames.github.io/2024/01/25/%E5%8D%97%E6%B1%90%E7%9A%84%E4%BA%91%E7%AB%AF%E5%B0%8F%E9%93%BA/</id>
    <published>2024-01-25T10:03:10.000Z</published>
    <updated>2024-01-28T11:07:56.220Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>å—æ±çš„äº‘ç«¯å°é“º(Shellç‰ˆ)</center></h1><blockquote><p>ğŸƒâ€ƒçªå‘å¥‡æƒ³ï¼Œæ€ä¹ˆæ ·è®©å¤§å®¶å¿«é€Ÿçš„æŒæ¡ç¼–ç¨‹é‡Œé¢çš„åˆ¤æ–­å’Œå¾ªç¯å‘¢ï¼Œç†è®ºçŸ¥è¯†åªæ˜¯åŸºç¡€ï¼Œå…³é”®åœ¨äºè‡ªå·±çš„ä»£ç æ‰‹æ„Ÿå’Œç¼–ç¨‹çš„æ€ç»´ï¼Œæ— ä»–ï¼Œå­¦ä¹ ç¼–ç¨‹æˆ‘ä»¬åªéœ€è¦è®°ä½ä¸€ç‚¹ï¼š<font color=red><strong>ç™¾ç‚¼æˆç¥</strong></font>ã€‚å…¶ä½™ï¼Œåº•å±‚çš„åŸç†å’Œæ¶æ„æ˜¯æˆ‘ä»¬é«˜çº¬åº¦çš„ç©ºé—´ï¼Œå¤©æ¢¯æ˜¯ä¸å¯åƒ­è¶Šçš„ï¼Œéœ€è¦ä¸€æ­¥ä¸€æ­¥æ”€ç™»ï¼</p></blockquote><table><tr><td bgcolor=#000000><font color="white">åŠŸèƒ½ä»‹ç»</font></td></tr></table><font color="#fc5531">â–šâ€‚ä»‹ç»â€‚ï¼šå—æ±çš„äº‘ç«¯å°é“ºæš‚æ—¶æš‚æ—¶åªå†™äº†ä¸€ä¸ªæ¿å—ï¼ˆä»Šæ—¥ä¸Šæ–°ï¼‰ï¼Œå…¶ä»–æ¿å—å¤§å®¶å¯è‡ªè¡Œæ‹“å±•ï¼Œæˆ–è€…å—æ±æ”¹å¤©å¯ä»¥å†å®Œå–„ä¸€ä¸‹ï¼Œç›®å‰å®ç°çš„åŠŸèƒ½æœ‰ï¼šèœå•æ˜¾ç¤ºã€å•†å“è´­ä¹°ã€ç”¨æˆ·ç™»å½•éªŒè¯ä¸æ³¨å†Œã€è´¦æˆ·ä½™é¢å……å€¼ä¸æ˜¾ç¤ºã€è´­ç‰©è´¦å•æ‰“å°ã€‚ç»†èŠ‚å¤§å®¶å¯è‡ªè¡Œæµ‹è¯•ï¼Œé‡‘æ— è¶³èµ¤ï¼Œäººæ— å®Œäººï¼Œå¦‚æœ‰Bugï¼Œæ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºåé¦ˆï¼Œæˆ–è€…åˆ†äº«å»ºè®®å“¦~ãƒ¾(â€¢Ï‰â€¢`)o</font><table><tr><td bgcolor=#000000><font color="white">å®ç°æ•ˆæœ</font></td></tr></table><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxi_shell.gif" alt="nanxi_shell"></p><div class="tips"><p>æç¤ºï¼šè„šæœ¬é»˜è®¤ä¼šåˆ›å»ºåˆå§‹ç”¨æˆ· <code>nanxi</code>  å¯†ç ï¼š<code>nanxi123</code>ï¼Œå½“ç„¶å¤§å®¶ä¹Ÿå¯ä»¥è‡ªè¡Œæ³¨å†Œè¯•ç©ï¼Œæˆ–è€…æ‹“å±•~</p></div><span id="more"></span><table><tr><td bgcolor=#000000><font color="white">è„šæœ¬å®ç°</font></td></tr></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author:  nanxi</span></span><br><span class="line"><span class="comment">#Date: 2024-1-24</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ˜¾ç¤ºèœå•</span></span><br><span class="line"><span class="function"><span class="title">home</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;------------------------------------------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                                              |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                1)   ä»Šæ—¥ä¸Šæ–°                 |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                2)   ç‹¬å®¶å¥½ç‰©                 |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                3)   äº‘ç«¯å°å±‹                 |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                                              |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-----------  æ¬¢è¿æ¥åˆ°å—æ±çš„äº‘ç«¯å°é“º  -----------&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">new</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-----------------------------------------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                                             |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;| 1)æœˆäº®ç§å­ 2)å¯’å†°å®å‰‘ 3)æ˜Ÿè¾°çº±è¡£ 4)é’ä¸˜å¹¼ç‹ |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|   ï¿¥:666     ï¿¥:777     ï¿¥:888     ï¿¥:999   |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                                             |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-----------------------------------------------&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">cloud</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-----------------------------------------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                                             |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|  1)ç§‹å¶åŸ   2)æ—¶å…‰æµ·   3)åŸé›ªç•Œ   4)å½©è™¹æ¡¥  |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                                             |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-----------------------------------------------&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">exclusive</span></span>()&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-----------------------------------------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                                             |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;| 1)æ—¶å…‰æœºå™¨ 2)ä¹é¾™èŸ æ¡ƒ 3)é’æ˜¥ä¸è€æ¶² 4)å¿˜å¿§è‰ |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|                                             |&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-----------------------------------------------&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®šä¹‰å˜é‡</span></span><br><span class="line">back=<span class="string">&quot;(0è¿”å›åº—é“ºé¦–é¡µ)&quot;</span></span><br><span class="line">flag=0</span><br><span class="line">logfile=/tmp/.nanxi.log</span><br><span class="line">username=null</span><br><span class="line">password=null</span><br><span class="line"></span><br><span class="line"><span class="comment">#åŠŸèƒ½å®ç°</span></span><br><span class="line"><span class="function"><span class="title">shop</span></span>()&#123;</span><br><span class="line">    <span class="built_in">sum</span>=0</span><br><span class="line">    array=()</span><br><span class="line">    i=0</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;1ã€2ã€3ã€4ä¸ºå•†å“æŒ‡ä»¤ï¼Œ6ä¸ºè´­ä¹°æŒ‡ä»¤ï¼Œ0è¿”å›åº—é“ºé¦–é¡µ&quot;</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;äº²äº²,è¯·è¾“å…¥æ‚¨çš„è´­ä¹°æŒ‡ä»¤<span class="variable">$back</span>: &quot;</span> num</span><br><span class="line">    check_in</span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$num</span> <span class="keyword">in</span></span><br><span class="line">        0)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">        ;;</span><br><span class="line">        1)</span><br><span class="line">            <span class="built_in">let</span> i++</span><br><span class="line">            <span class="built_in">sum</span>=$(<span class="built_in">expr</span> <span class="variable">$sum</span> + 666)</span><br><span class="line">            array[<span class="variable">$i</span>]=<span class="string">&quot;æœˆäº®ç§å­&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">        2)</span><br><span class="line">            <span class="built_in">let</span> i++</span><br><span class="line">            <span class="built_in">sum</span>=$(<span class="built_in">expr</span> <span class="variable">$sum</span> + 777)</span><br><span class="line">            array[<span class="variable">$i</span>]=<span class="string">&quot;å¯’å†°å®å‰‘&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">        3)</span><br><span class="line">            <span class="built_in">let</span> i++</span><br><span class="line">            <span class="built_in">sum</span>=$(<span class="built_in">expr</span> <span class="variable">$sum</span> + 888)</span><br><span class="line">            array[<span class="variable">$i</span>]=<span class="string">&quot;æ˜Ÿè¾°çº±è¡£&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">        4)</span><br><span class="line">            <span class="built_in">let</span> i++</span><br><span class="line">            <span class="built_in">sum</span>=$(<span class="built_in">expr</span> <span class="variable">$sum</span> + 999)</span><br><span class="line">            array[<span class="variable">$i</span>]=<span class="string">&quot;é’ä¸˜å¹¼ç‹&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">        6)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="variable">$flag</span> -ne 1 ];<span class="keyword">then</span></span><br><span class="line">                logon</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            pay</span><br><span class="line">        ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="built_in">continue</span></span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">check_in</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> ! [[ <span class="variable">$num</span> =~ ^[012346]$ ]];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;è´­ä¹°æŒ‡ä»¤å¼‚å¸¸ï¼Œæ‚¨éœ€è¦é‡æ–°è¾“å…¥!!!&quot;</span></span><br><span class="line">        <span class="built_in">echo</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">elif</span> [ <span class="variable">$num</span> -gt 6 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;è´­ä¹°æŒ‡ä»¤å¼‚å¸¸ï¼Œæ‚¨éœ€è¦é‡æ–°è¾“å…¥!!!&quot;</span></span><br><span class="line">        <span class="built_in">echo</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">logon</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ ! -f <span class="variable">$logfile</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">touch</span> <span class="variable">$logfile</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;nanxi\t\tnanxi123\t\t9999999999&quot;</span> &gt; <span class="variable">$logfile</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$flag</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;æ­¤æ“ä½œéœ€è¦æ‚¨ç™»å½•è´¦æˆ·ï¼Œæ˜¯å¦ç™»å½•(y/n): &quot;</span> <span class="built_in">log</span></span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$log</span> <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">yes</span>|y)</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line">            <span class="keyword">do</span></span><br><span class="line">            <span class="built_in">read</span> -p <span class="string">&quot;è¯·è¾“å…¥æ‚¨çš„è´¦æˆ·: &quot;</span> username</span><br><span class="line">            <span class="built_in">read</span> -s -p <span class="string">&quot;è¯·è¾“å…¥æ‚¨çš„å¯†ç : &quot;</span> password</span><br><span class="line">            <span class="built_in">echo</span></span><br><span class="line">            check_user</span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">        ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="built_in">break</span> 1</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">check_user</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> ! egrep -w <span class="string">&quot;<span class="variable">$username</span>|<span class="variable">$password</span>&quot;</span> <span class="variable">$logfile</span> &gt;/dev/null;<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;æœªæ£€æµ‹åˆ°å½“å‰ç”¨æˆ·ï¼Œæˆ–å½“å‰è´¦æˆ·çŠ¶æ€å¼‚å¸¸!!!&quot;</span></span><br><span class="line">        <span class="built_in">echo</span></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;æ‚¨æ˜¯å¦éœ€è¦æ³¨å†Œç”¨æˆ·(y/n): &quot;</span> sta</span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$sta</span> <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">yes</span>|y)</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line">            <span class="keyword">do</span></span><br><span class="line">            <span class="built_in">read</span> -p <span class="string">&quot;è¯·è¾“å…¥æ‚¨è¦æ³¨å†Œçš„è´¦æˆ·å: &quot;</span> username</span><br><span class="line">            <span class="built_in">read</span> -p <span class="string">&quot;è¯·è®¾ç½®æ‚¨è´¦æˆ·çš„å¯¹åº”å¯†ç : &quot;</span> password</span><br><span class="line">            <span class="keyword">if</span> [[ <span class="variable">$username</span> =~ ^[0-Z_]+$ ]] &amp;&amp; [ <span class="variable">$&#123;#username&#125;</span> -ge 8 -a <span class="variable">$&#123;#username&#125;</span> -le 12 ];<span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">echo</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;ç”¨æˆ·åªèƒ½ç”±æ•°å­—ã€å­—æ¯ã€ä¸‹åˆ’çº¿ç»„åˆï¼Œä¸”é•¿åº¦ä¸º8-12ä½~&quot;</span></span><br><span class="line">                <span class="built_in">echo</span></span><br><span class="line">                <span class="built_in">continue</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">if</span> awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> <span class="variable">$logfile</span> |grep <span class="variable">$username</span> &gt;/dev/null;<span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;\e[1;31mè´¦æˆ·åå·²å­˜åœ¨ï¼Œè¯·é‡æ–°è¾“å…¥...\e[0m&quot;</span></span><br><span class="line">                <span class="built_in">echo</span></span><br><span class="line">                <span class="built_in">continue</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">break</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$username</span>\t\t<span class="variable">$password</span>\t\t0&quot;</span> &gt;&gt; <span class="variable">$logfile</span></span><br><span class="line">            <span class="built_in">echo</span></span><br><span class="line">        ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="built_in">break</span> 2</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span> egrep -w <span class="string">&quot;<span class="variable">$username</span>&quot;</span> <span class="variable">$logfile</span> &gt;/dev/null;<span class="keyword">then</span></span><br><span class="line">           <span class="keyword">if</span> egrep -w <span class="string">&quot;<span class="variable">$username</span>&quot;</span> <span class="variable">$logfile</span>|grep -w <span class="string">&quot;<span class="variable">$password</span>&quot;</span> &gt;/dev/null;<span class="keyword">then</span></span><br><span class="line">               logon_success</span><br><span class="line">               flag=1</span><br><span class="line">               <span class="built_in">break</span></span><br><span class="line">           <span class="keyword">else</span></span><br><span class="line">               <span class="built_in">echo</span> -e <span class="string">&quot;\e[1;31m\033[05må¯†ç è¾“å…¥é”™è¯¯ï¼ï¼ï¼\e[0m&quot;</span></span><br><span class="line">               <span class="built_in">echo</span></span><br><span class="line">           <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">           <span class="keyword">if</span> egrep -w <span class="string">&quot;<span class="variable">$password</span>&quot;</span> <span class="variable">$logfile</span>|grep -w <span class="string">&quot;<span class="variable">$username</span> &quot;</span> &gt;/dev/null;<span class="keyword">then</span></span><br><span class="line">               logon_success</span><br><span class="line">               flag=1</span><br><span class="line">               <span class="built_in">break</span></span><br><span class="line">           <span class="keyword">else</span></span><br><span class="line">               <span class="built_in">echo</span> -e <span class="string">&quot;\e[1;31m\033[05mç”¨æˆ·åè¾“å…¥é”™è¯¯ï¼ï¼ï¼\e[0m&quot;</span></span><br><span class="line">               <span class="built_in">echo</span></span><br><span class="line">           <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">logon_success</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;---------\t\tç™»å½•æˆåŠŸ\t\t---------&quot;</span></span><br><span class="line">    egrep -w <span class="string">&quot;<span class="variable">$username</span>&quot;</span> <span class="variable">$logfile</span>|awk <span class="string">&#x27;&#123;print $0&#125;&#x27;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;---------\t\té¾™å¹´å¤§å‰\t\t---------&quot;</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">pay</span></span>()&#123;</span><br><span class="line">    value=$(egrep -w <span class="string">&quot;<span class="variable">$username</span>&quot;</span> <span class="variable">$logfile</span>|awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$value</span> -ge <span class="variable">$sum</span> ];<span class="keyword">then</span></span><br><span class="line">        bill</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\e[1;31mæ‚¨çš„è´¦æˆ·ä½™é¢ä¸è¶³ï¼Œè¯·åŠæ—¶å……å€¼ï¼ï¼ï¼\e[0m&quot;</span></span><br><span class="line">        <span class="built_in">echo</span></span><br><span class="line">        <span class="built_in">read</span> -p <span class="string">&quot;æ˜¯å¦é€‰æ‹©å……å€¼(y/n): &quot;</span> recharge</span><br><span class="line">        <span class="built_in">echo</span></span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$recharge</span> <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">yes</span>|y)</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line">            <span class="keyword">do</span></span><br><span class="line">            <span class="built_in">read</span> -p <span class="string">&quot;è¯·è¾“å…¥å……å€¼é‡‘é¢ï¼Œå»ºè®®è´¦æˆ·ä½™é¢è‡³å°‘ï¿¥<span class="variable">$sum</span>: &quot;</span> coin</span><br><span class="line">            <span class="keyword">if</span> [[ <span class="variable">$coin</span> =~ ^[0-9]+$ ]];<span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span></span><br><span class="line">                surplus=$(<span class="built_in">expr</span> $(grep <span class="string">&quot;<span class="variable">$username</span>&quot;</span> <span class="variable">$logfile</span>|awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>) + <span class="variable">$coin</span>)</span><br><span class="line">                line=$(grep <span class="string">&quot;<span class="variable">$username</span>&quot;</span> <span class="variable">$logfile</span> -n |awk -F: <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">                sed -i <span class="string">&quot;<span class="variable">$&#123;line&#125;</span>c <span class="variable">$username</span>          <span class="variable">$password</span>               <span class="variable">$surplus</span>&quot;</span> <span class="variable">$logfile</span></span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;å……å€¼æˆåŠŸï¼Œæœ¬æ¬¡å……å€¼é‡‘é¢ä¸º: \033[1;32m ï¿¥<span class="variable">$coin</span> \033[0m&quot;</span></span><br><span class="line">                <span class="built_in">echo</span></span><br><span class="line">                <span class="built_in">break</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">echo</span></span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">&quot;\e[1;31må‚æ•°ä¸åˆæ³•ï¼Œè¯·é‡æ–°è¾“å…¥ï¼ï¼ï¼\e[0m&quot;</span></span><br><span class="line">                <span class="built_in">echo</span></span><br><span class="line">                <span class="built_in">continue</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">            pay</span><br><span class="line">        ;;</span><br><span class="line">        *)</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">        <span class="built_in">echo</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">bill</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    price=null</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;---------\t\tæ‚¨çš„è´¦å•\t\t---------&quot;</span></span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="variable">$&#123;array[@]&#125;</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$a</span>&quot;</span> = <span class="string">&quot;æœˆäº®ç§å­&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">            price=666</span><br><span class="line">        <span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$a</span>&quot;</span> = <span class="string">&quot;å¯’å†°å®å‰‘&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">            price=777</span><br><span class="line">        <span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$a</span>&quot;</span> = <span class="string">&quot;æ˜Ÿè¾°çº±è¡£&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">            price=888</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            price=999</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;| <span class="variable">$a</span>  \t\t\t\t\t   ï¿¥<span class="variable">$price</span>|&quot;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;|        \t\t\t\t\t        |&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;| æœ¬æ¬¡æ¶ˆè´¹æ€»è®¡: \t\t\t\t  ï¿¥<span class="variable">$sum</span>|&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;---------\t\tæ„Ÿè°¢è´­ä¹°\t\t---------&quot;</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;æ£€æµ‹åˆ°æ”¯ä»˜æˆåŠŸï¼Œæ˜¯å¦æ˜¾ç¤ºæ‚¨å½“å‰çš„è´¦æˆ·ä½™é¢(y/n): &quot;</span> remainder</span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$remainder</span> <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">yes</span>|y)</span><br><span class="line">        show</span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">show</span></span>()&#123;</span><br><span class="line">    surplus=$(<span class="built_in">expr</span> $(grep <span class="string">&quot;<span class="variable">$username</span>&quot;</span> <span class="variable">$logfile</span>|awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>) - <span class="variable">$sum</span>)</span><br><span class="line">    line=$(grep <span class="string">&quot;<span class="variable">$username</span>&quot;</span> <span class="variable">$logfile</span> -n |awk -F: <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    sed -i <span class="string">&quot;<span class="variable">$&#123;line&#125;</span>c <span class="variable">$username</span><span class="variable">$password</span><span class="variable">$surplus</span>&quot;</span> <span class="variable">$logfile</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;---------\t\tå½“å‰ä½™é¢\t\t---------&quot;</span></span><br><span class="line">    egrep -w <span class="string">&quot;<span class="variable">$username</span>&quot;</span> <span class="variable">$logfile</span>|awk <span class="string">&#x27;&#123;print $0&#125;&#x27;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;---------\t\tå†æ¬¡æ„Ÿè°¢\t\t---------&quot;</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    home</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;äº²äº²,è¾“å…¥æ‚¨çš„æŒ‡ä»¤<span class="variable">$back</span>: &quot;</span> num</span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$num</span> <span class="keyword">in</span></span><br><span class="line">        0)</span><br><span class="line">            home</span><br><span class="line">        ;;</span><br><span class="line">        1)</span><br><span class="line">            new</span><br><span class="line">            shop</span><br><span class="line">        ;;</span><br><span class="line">        2)</span><br><span class="line">            exclusive</span><br><span class="line">        ;;</span><br><span class="line">        3)</span><br><span class="line">            cloud</span><br><span class="line">        ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="built_in">continue</span></span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line">main</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxiblogfoot.png" alt="nanxiblogfoot"></p><iframe frameborder="no" border="0" marginwidth="0" allow = "autoplay" marginheight="0" width=100% height=86 src="//music.163.com/outchain/player?type=2&id=519136840&auto=1&height=66"></iframe><blockquote><p><em><strong>åœ¨è¿™ä¸ªä¸–ç•Œä¸Šï¼Œä¸æ˜¯æ‰€æœ‰åˆç†çš„å’Œç¾å¥½çš„éƒ½èƒ½æŒ‰ç…§è‡ªå·±çš„æ„¿æœ›å­˜åœ¨æˆ–å®ç°ã€‚</strong></em></p><p align="right">â€”â€”è·¯é¥</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;å—æ±çš„äº‘ç«¯å°é“º(Shellç‰ˆ)&lt;/center&gt;&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸƒâ€ƒçªå‘å¥‡æƒ³ï¼Œæ€ä¹ˆæ ·è®©å¤§å®¶å¿«é€Ÿçš„æŒæ¡ç¼–ç¨‹é‡Œé¢çš„åˆ¤æ–­å’Œå¾ªç¯å‘¢ï¼Œç†è®ºçŸ¥è¯†åªæ˜¯åŸºç¡€ï¼Œå…³é”®åœ¨äºè‡ªå·±çš„ä»£ç æ‰‹æ„Ÿå’Œç¼–ç¨‹çš„æ€ç»´ï¼Œæ— ä»–ï¼Œå­¦ä¹ ç¼–ç¨‹æˆ‘ä»¬åªéœ€è¦è®°ä½ä¸€ç‚¹ï¼š&lt;font color=red&gt;&lt;strong&gt;ç™¾ç‚¼æˆç¥&lt;/strong&gt;&lt;/font&gt;ã€‚å…¶ä½™ï¼Œåº•å±‚çš„åŸç†å’Œæ¶æ„æ˜¯æˆ‘ä»¬é«˜çº¬åº¦çš„ç©ºé—´ï¼Œå¤©æ¢¯æ˜¯ä¸å¯åƒ­è¶Šçš„ï¼Œéœ€è¦ä¸€æ­¥ä¸€æ­¥æ”€ç™»ï¼&lt;/p&gt;
&lt;/blockquote&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;åŠŸèƒ½ä»‹ç»&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;font color=&quot;#fc5531&quot;&gt;â–šâ€‚ä»‹ç»â€‚ï¼šå—æ±çš„äº‘ç«¯å°é“ºæš‚æ—¶æš‚æ—¶åªå†™äº†ä¸€ä¸ªæ¿å—ï¼ˆä»Šæ—¥ä¸Šæ–°ï¼‰ï¼Œå…¶ä»–æ¿å—å¤§å®¶å¯è‡ªè¡Œæ‹“å±•ï¼Œæˆ–è€…å—æ±æ”¹å¤©å¯ä»¥å†å®Œå–„ä¸€ä¸‹ï¼Œç›®å‰å®ç°çš„åŠŸèƒ½æœ‰ï¼šèœå•æ˜¾ç¤ºã€å•†å“è´­ä¹°ã€ç”¨æˆ·ç™»å½•éªŒè¯ä¸æ³¨å†Œã€è´¦æˆ·ä½™é¢å……å€¼ä¸æ˜¾ç¤ºã€è´­ç‰©è´¦å•æ‰“å°ã€‚ç»†èŠ‚å¤§å®¶å¯è‡ªè¡Œæµ‹è¯•ï¼Œé‡‘æ— è¶³èµ¤ï¼Œäººæ— å®Œäººï¼Œå¦‚æœ‰Bugï¼Œæ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºåé¦ˆï¼Œæˆ–è€…åˆ†äº«å»ºè®®å“¦~ãƒ¾(â€¢Ï‰â€¢`)o&lt;/font&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;å®ç°æ•ˆæœ&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/nanxi_shell.gif&quot; alt=&quot;nanxi_shell&quot;&gt;&lt;/p&gt;
&lt;div class=&quot;tips&quot;&gt;
&lt;p&gt;æç¤ºï¼šè„šæœ¬é»˜è®¤ä¼šåˆ›å»ºåˆå§‹ç”¨æˆ· &lt;code&gt;nanxi&lt;/code&gt;  å¯†ç ï¼š&lt;code&gt;nanxi123&lt;/code&gt;ï¼Œå½“ç„¶å¤§å®¶ä¹Ÿå¯ä»¥è‡ªè¡Œæ³¨å†Œè¯•ç©ï¼Œæˆ–è€…æ‹“å±•~&lt;/p&gt;
&lt;/div&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="Shellç¼–ç¨‹" scheme="https://smallflames.github.io/tags/Shell%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Shellè„šæœ¬ç¯‡003</title>
    <link href="https://smallflames.github.io/2024/01/24/Shell%E8%84%9A%E6%9C%AC%E7%AF%87003/"/>
    <id>https://smallflames.github.io/2024/01/24/Shell%E8%84%9A%E6%9C%AC%E7%AF%87003/</id>
    <published>2024-01-24T08:55:47.000Z</published>
    <updated>2024-01-28T11:08:51.795Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Shellè„šæœ¬ç¯‡003</center></h1><table><tr><td bgcolor=#000000><font color="white">è„šæœ¬éœ€æ±‚</font></td></tr></table><font color="#fc5531">â–šâ€‚éœ€æ±‚â€‚ï¼šå†™ä¸€ä¸ªç½‘å¡æ£€æµ‹è„šæœ¬ï¼Œç”¨æ¥ç›‘æµ‹ç½‘å¡çŠ¶æ€æ˜¯å¦æ­£å¸¸ï¼Œå¹¶ä»¥å†…å®¹çš„æ–¹å¼è¾“å‡ºè‡³å±å¹•ã€‚</font><p><font color="#7183ff">â–šâ€‚æç¤ºâ€‚ï¼šç½‘å¡çš„çŠ¶æ€æ­£å¸¸ä¸å¦ï¼Œå¯ä»¥æ£€æµ‹å•ä½æ—¶é—´å†…ç½‘å¡çš„è¿›å‡ºæµé‡æ¥åˆ¤æ–­ã€‚</font></p><table><tr><td bgcolor=#000000><font color="white">å®ç°æ•ˆæœ</font></td></tr></table><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240124165816497.png" alt="image-20240124165816497"></p><span id="more"></span><table><tr><td bgcolor=#000000><font color="white">è„šæœ¬å®ç°</font></td></tr></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author:  nanxi</span></span><br><span class="line"><span class="comment">#Date: 2024-1-24</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ¤æ–­å‘½ä»¤æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="keyword">if</span> ! <span class="built_in">which</span> sar &gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">    yum -y install sysstat &gt; /dev/null</span><br><span class="line">    [ $? -ne 0 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;æŠ±æ­‰ï¼Œsar å‘½ä»¤å®‰è£…å¤±è´¥ï¼Œæ‚¨å¯ä»¥å°è¯•æ‰‹åŠ¨å®‰è£…~&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æœåŠ¡çŠ¶æ€åˆ¤æ–­</span></span><br><span class="line"><span class="function"><span class="title">check_net</span></span>()&#123;</span><br><span class="line">    <span class="comment">#ç›‘æµ‹ç½‘å¡æµé‡</span></span><br><span class="line">    <span class="built_in">echo</span> -ne <span class="string">&quot;ç½‘å¡çŠ¶æ€ç›‘æµ‹ä¸­...\t\t&quot;</span></span><br><span class="line">    sar -n DEV 1 10|awk <span class="string">&#x27;/^Average/&#x27;</span>|grep <span class="string">&#x27;eth0&#x27;</span> &gt; /tmp/eth0.<span class="built_in">log</span></span><br><span class="line">    n1=$(awk <span class="string">&#x27;&#123;print $5&#125;&#x27;</span> /tmp/eth0.<span class="built_in">log</span> | sed <span class="string">&#x27;s/\.//g&#x27;</span>)</span><br><span class="line">    n2=$(awk <span class="string">&#x27;&#123;print $6&#125;&#x27;</span> /tmp/eth0.<span class="built_in">log</span> | sed <span class="string">&#x27;s/\.//g&#x27;</span>)</span><br><span class="line">    <span class="built_in">rm</span> -rf /tmp/eth0.<span class="built_in">log</span></span><br><span class="line">    <span class="comment">#ç›‘æµ‹ç»“æœè¾“å‡º</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$n1</span> = 000 ] &amp;&amp; [ <span class="variable">$n2</span> = 000 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\e[41;37m\033[05mç½‘å¡çŠ¶æ€å¼‚å¸¸\e[0m&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\e[42;37mç½‘å¡çŠ¶æ€æ­£å¸¸\e[0m&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">check</span></span>()&#123;</span><br><span class="line">    count=<span class="variable">$1</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="variable">$count</span> =~ ^[0-9]+$ ]];<span class="keyword">then</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">seq</span> <span class="variable">$count</span>)</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">            check_net</span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$count</span> <span class="keyword">in</span></span><br><span class="line">             loop)</span><br><span class="line">                 <span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line">                 <span class="keyword">do</span></span><br><span class="line">                     <span class="built_in">let</span> i++</span><br><span class="line">                     max=10</span><br><span class="line">                     check_net</span><br><span class="line">                     <span class="keyword">if</span> [ <span class="variable">$i</span> -ge <span class="variable">$max</span> ];<span class="keyword">then</span></span><br><span class="line">                         <span class="built_in">break</span></span><br><span class="line">                     <span class="keyword">fi</span></span><br><span class="line">                 <span class="keyword">done</span></span><br><span class="line">             ;;</span><br><span class="line">             *)</span><br><span class="line">             check_net</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;é»˜è®¤æ‰§è¡Œä¸€æ¬¡ï¼Œæ‚¨å¯ä»¥æŒ‡å®šæ£€æµ‹æ¬¡æ•°: &quot;</span> count</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;------------- å¼€å§‹è¿›è¡Œç½‘å¡æ£€æµ‹ -------------&quot;</span></span><br><span class="line">check <span class="variable">$count</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;---- æœ¬æ¬¡æ£€æµ‹ç»“æŸï¼Œæ„Ÿè°¢æ‚¨ä½¿ç”¨å—æ±çš„è„šæœ¬ ----&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxiblogfoot.png" alt="nanxiblogfoot"></p><blockquote><p><em><strong>äº†è§£é¢å¯¹é€†å¢ƒï¼Œè¿œæ¯”å¦‚ä½•æ¥å—é¡ºå¢ƒé‡è¦å¾—å¤šã€‚</strong></em></p><p align="right">â€”â€”é©¬ä¸Â·èµ›åŠ›æ ¼æ›¼</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Shellè„šæœ¬ç¯‡003&lt;/center&gt;&lt;/h1&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;è„šæœ¬éœ€æ±‚&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;font color=&quot;#fc5531&quot;&gt;â–šâ€‚éœ€æ±‚â€‚ï¼šå†™ä¸€ä¸ªç½‘å¡æ£€æµ‹è„šæœ¬ï¼Œç”¨æ¥ç›‘æµ‹ç½‘å¡çŠ¶æ€æ˜¯å¦æ­£å¸¸ï¼Œå¹¶ä»¥å†…å®¹çš„æ–¹å¼è¾“å‡ºè‡³å±å¹•ã€‚&lt;/font&gt;
&lt;p&gt;&lt;font color=&quot;#7183ff&quot;&gt;â–šâ€‚æç¤ºâ€‚ï¼šç½‘å¡çš„çŠ¶æ€æ­£å¸¸ä¸å¦ï¼Œå¯ä»¥æ£€æµ‹å•ä½æ—¶é—´å†…ç½‘å¡çš„è¿›å‡ºæµé‡æ¥åˆ¤æ–­ã€‚&lt;/font&gt;&lt;/p&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;å®ç°æ•ˆæœ&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240124165816497.png&quot; alt=&quot;image-20240124165816497&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="Shellç¼–ç¨‹" scheme="https://smallflames.github.io/tags/Shell%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Shellè„šæœ¬ç¯‡002</title>
    <link href="https://smallflames.github.io/2024/01/23/Shell%E8%84%9A%E6%9C%AC%E7%AF%87002/"/>
    <id>https://smallflames.github.io/2024/01/23/Shell%E8%84%9A%E6%9C%AC%E7%AF%87002/</id>
    <published>2024-01-23T12:43:03.000Z</published>
    <updated>2024-01-25T11:30:22.278Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Shellè„šæœ¬ç¯‡002</center></h1><table><tr><td bgcolor=#000000><font color="white">è„šæœ¬éœ€æ±‚</font></td></tr></table><font color="#fc5531">â–šâ€‚éœ€æ±‚â€‚ï¼šå†™ä¸€ä¸ªå·¡æ£€è„šæœ¬ï¼Œç”¨æ¥ç›‘æµ‹ç³»ç»Ÿå„é¡¹æœåŠ¡çš„çŠ¶æ€æƒ…å†µï¼Œå¹¶ä»¥å†…å®¹çš„æ–¹å¼è¾“å‡ºè‡³å±å¹•ã€‚</font><table><tr><td bgcolor=#000000><font color="white">å®ç°æ•ˆæœ</font></td></tr></table><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240123215829275.png" alt="image-20240123215829275"></p><span id="more"></span><table><tr><td bgcolor=#000000><font color="white">å®ç°è„šæœ¬</font></td></tr></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author:  nanxi</span></span><br><span class="line"><span class="comment">#Date: 2024-1-23</span></span><br><span class="line"></span><br><span class="line">. /etc/init.d/functions</span><br><span class="line"><span class="comment">#æ£€æŸ¥ä½¿ç”¨å‘½ä»¤æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="function"><span class="title">check_com</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> ! <span class="built_in">which</span> pgrep &gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;æŠ±æ­‰ï¼Œè„šæœ¬æ‰§è¡Œæ‰€éœ€çš„å‘½ä»¤ï¼ˆpgrepï¼‰ä¸å­˜åœ¨ï¼&quot;</span></span><br><span class="line">        <span class="built_in">exit</span>  1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ! <span class="built_in">which</span> ss &gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;æŠ±æ­‰ï¼Œè„šæœ¬æ‰§è¡Œæ‰€éœ€çš„å‘½ä»¤ï¼ˆssï¼‰ä¸å­˜åœ¨ï¼&quot;</span></span><br><span class="line">        <span class="built_in">exit</span>  1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ£€æŸ¥æœåŠ¡è¿›ç¨‹æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="function"><span class="title">check_ps</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> pgrep <span class="variable">$1</span> &gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">return</span> 0</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">return</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ£€æŸ¥ç«¯å£æ˜¯å¦å¤„äºç›‘å¬çŠ¶æ€</span></span><br><span class="line"><span class="function"><span class="title">check_port</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> ss -lnp | grep <span class="string">&quot;:<span class="variable">$1</span> &quot;</span> &gt; /dev/null ;<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">return</span> 0</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">return</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ¤æ–­æœåŠ¡çŠ¶æ€</span></span><br><span class="line"><span class="function"><span class="title">check_srv</span></span>()&#123;</span><br><span class="line">   <span class="keyword">if</span> check_ps <span class="variable">$1</span> &amp;&amp; check_port <span class="variable">$2</span> ;<span class="keyword">then</span></span><br><span class="line">       action <span class="string">&quot;<span class="variable">$1</span> æœåŠ¡çŠ¶æ€&quot;</span> /bin/true</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">       action <span class="string">&quot;<span class="variable">$1</span> æœåŠ¡çŠ¶æ€&quot;</span> /bin/false</span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">check_com</span><br><span class="line">check_srv nginx 80</span><br><span class="line">check_srv sshd 22</span><br><span class="line">check_srv java 8080</span><br><span class="line">check_srv php 9000</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxiblogfoot.png" alt="nanxiblogfoot"></p><blockquote><p><em><strong>å½“äººä»¬æ„Ÿåˆ°è‡ªå·±æ²¡æœ‰èƒ½åŠ›è·å¾—å·¨å¤§çš„æˆåŠŸæ—¶ï¼Œä»–ä»¬ä¼šé„™è§†ä¼Ÿå¤§çš„ç›®æ ‡ã€‚</strong></em></p><p align="right">â€”â€”æ²ƒç»´çº³æ ¼</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Shellè„šæœ¬ç¯‡002&lt;/center&gt;&lt;/h1&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;è„šæœ¬éœ€æ±‚&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;font color=&quot;#fc5531&quot;&gt;â–šâ€‚éœ€æ±‚â€‚ï¼šå†™ä¸€ä¸ªå·¡æ£€è„šæœ¬ï¼Œç”¨æ¥ç›‘æµ‹ç³»ç»Ÿå„é¡¹æœåŠ¡çš„çŠ¶æ€æƒ…å†µï¼Œå¹¶ä»¥å†…å®¹çš„æ–¹å¼è¾“å‡ºè‡³å±å¹•ã€‚&lt;/font&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;å®ç°æ•ˆæœ&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240123215829275.png&quot; alt=&quot;image-20240123215829275&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="Shellç¼–ç¨‹" scheme="https://smallflames.github.io/tags/Shell%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Shellç¼–ç¨‹çŸ¥è¯†è¡¥å……ï¼ˆäºŒï¼‰</title>
    <link href="https://smallflames.github.io/2024/01/23/Shell%E7%BC%96%E7%A8%8B%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <id>https://smallflames.github.io/2024/01/23/Shell%E7%BC%96%E7%A8%8B%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85%EF%BC%88%E4%BA%8C%EF%BC%89/</id>
    <published>2024-01-23T06:38:57.000Z</published>
    <updated>2024-01-25T14:02:49.254Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Shellç¼–ç¨‹åŸºç¡€çŸ¥è¯†è¡¥å……</center></h1><blockquote><p>âœ¨ Shell è¿™ä¸ªå•è¯çš„åŸæ„æ˜¯â€œå¤–å£³â€ï¼Œè·Ÿ kernelï¼ˆå†…æ ¸ï¼‰ç›¸å¯¹åº”ï¼Œæ¯”å–»å†…æ ¸å¤–é¢çš„ä¸€å±‚ï¼Œå³ç”¨æˆ·è·Ÿå†…æ ¸äº¤äº’çš„å¯¹è¯ç•Œé¢ã€‚<br>ğŸ‰ Shell æ˜¯ä¸€ä¸ªç¨‹åºï¼Œæä¾›ä¸€ä¸ªä¸ç”¨æˆ·å¯¹è¯çš„ç¯å¢ƒã€‚è¿™ä¸ªç¯å¢ƒåªæœ‰ä¸€ä¸ªå‘½ä»¤æç¤ºç¬¦ï¼Œè®©ç”¨æˆ·ä»é”®ç›˜è¾“å…¥å‘½ä»¤ï¼Œæ‰€ä»¥åˆç§°ä¸ºå‘½ä»¤è¡Œç¯å¢ƒï¼ˆcommand line interfaceï¼Œç®€å†™ä¸º CLIï¼‰ã€‚<br>ğŸ Shell æ˜¯ä¸€ä¸ªå‘½ä»¤è§£é‡Šå™¨ï¼Œè§£é‡Šç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ã€‚å…¶æ¬¡ï¼ŒShell æ˜¯ä¸€ä¸ªå·¥å…·ç®±ï¼Œæä¾›äº†å„ç§å°å·¥å…·ï¼Œä¾›ç”¨æˆ·æ–¹ä¾¿åœ°ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„åŠŸèƒ½ã€‚</p></blockquote><h2 id="font-color-red-â–š-u-01-u-æ‹“å±•ï¼šechoè¶£å‘³ç©æ³•-font"><font color=red>â–šâ€‚<u>01</u>â€‚æ‹“å±•ï¼šechoè¶£å‘³ç©æ³•</font></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   echo  å‘½ä»¤æ¦‚è¿°</span></span><br><span class="line">é»˜è®¤å°†è¾“å…¥çš„å­—ç¬¦ä¸²é€å¾€æ ‡å‡†è¾“å‡ºï¼Œè¾“å‡ºçš„å­—ç¬¦ä¸²é—´ä»¥ç©ºç™½å­—ç¬¦éš”å¼€, å¹¶åœ¨æœ€ååŠ ä¸Šæ¢è¡Œç¬¦ï¼›</span><br><span class="line"><span class="comment">#   echo  å‘½ä»¤è¯­æ³•</span></span><br><span class="line"><span class="built_in">echo</span> ã€é€‰é¡¹å‚æ•°ã€‘ ã€å­—ç¬¦ä¸²ã€‘</span><br><span class="line">-n    <span class="comment">#  å–æ¶ˆè‡ªåŠ¨æ¢è¡Œ</span></span><br><span class="line">-e    <span class="comment">#  æ‰“å¼€åæ–œæ ESCè½¬ä¹‰</span></span><br><span class="line">-E    <span class="comment">#  å–æ¶ˆè½¬ä¹‰ (é»˜è®¤)</span></span><br><span class="line"></span><br><span class="line">å…³äºåæ–œæ çš„è½¬ä¹‰ï¼Œè¯¦ç»†å‚æ•°å¦‚ä¸‹ï¼š</span><br></pre></td></tr></table></figure><span id="more"></span><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240123163236254.png" alt="image-20240123163236254"></p><blockquote><p>---------------------------èƒŒæ™¯é¢œè‰²èŒƒå›´:40-49------------------------<br>[root@localhost ~]# echo -e â€œ\e[40;37mé»‘åº•ç™½å­— \e[0mâ€<br><span style="color:#FFFFFF;"><span style="background-color:black;">é»‘åº•ç™½å­—</span></span><br>[root@localhost ~]# echo -e â€œ\e[41;37mæ·±çº¢ç™½å­— \e[0mâ€<br><span style="color:#FFFFFF;"><span style="background-color:red;">æ·±çº¢ç™½å­—</span></span><br>[root@localhost ~]# echo -e â€œ\e[42;37mç»¿åº•ç™½å­— \e[0mâ€<br><span style="color:#FFFFFF;"><span style="background-color:green;">ç»¿åº•ç™½å­—</span></span><br>[root@localhost ~]# echo -e â€œ\e[43;37mé»„åº•ç™½å­— \e[0mâ€<br><span style="color:#FFFFFF;"><span style="background-color:yellow;">é»„åº•ç™½å­—</span></span><br>[root@localhost ~]# echo -e â€œ\e[44;37mè“åº•ç™½å­— \e[0mâ€<br><span style="color:#FFFFFF;"><span style="background-color:blue;">è“åº•ç™½å­—</span></span><br>[root@localhost ~]# echo -e â€œ\e[45;37mç´«åº•ç™½å­— \e[0mâ€<br><span style="color:#FFFFFF;"><span style="background-color:purple;">ç´«åº•ç™½å­—</span></span><br>[root@localhost ~]# echo -e â€œ\e[46;37mæ·±ç»¿ç™½å­— \e[0mâ€<br><span style="color:#FFFFFF;"><span style="background-color:#003221;">æ·±ç»¿ç™½å­—</span></span><br>[root@localhost ~]# echo -e â€œ\e[47;30mç™½åº•é»‘å­— \e[0mâ€<br><span style="color:#000000;"><span style="background-color:#FFFFFF;">ç™½åº•é»‘å­—</span></span><br>------------------------å­—ä½“é¢œè‰²èŒƒå›´:30-39------------------------<br>[root@localhost ~]# echo -e â€œ\e[1;30mé»‘è‰²å­—ä½“ \e[0mâ€<br><font color="black">é»‘è‰²å­—ä½“</font><br>[root@localhost ~]# echo -e â€œ\e[1;31mçº¢è‰²å­—ä½“ \e[0mâ€<br><font color="red">çº¢è‰²å­—ä½“</font><br>[root@localhost ~]# echo -e â€œ\e[1;32mç»¿è‰²å­—ä½“ \e[0mâ€<br><font color="green">ç»¿è‰²å­—ä½“</font><br>[root@localhost ~]# echo -e â€œ\e[1;33mé»„è‰²å­—ä½“ \e[0mâ€<br><font color="yellow">é»„è‰²å­—ä½“</font><br>[root@localhost ~]# echo -e â€œ\e[1;34mè“è‰²å­—ä½“ \e[0mâ€<br><font color="blue">è“è‰²å­—ä½“</font><br>[root@localhost ~]# echo -e â€œ\e[1;35mç´«è‰²å­—ä½“ \e[0mâ€<br><font color="purple">ç´«è‰²å­—ä½“</font><br>[root@localhost ~]# echo -e â€œ\e[1;36mæ·±ç»¿å­—ä½“ \e[0mâ€<br><font color="#003221">æ·±ç»¿å­—ä½“</font><br>[root@localhost ~]# echo -e â€œ\e[1;37mç™½è‰²å­—ä½“ \e[0mâ€<br><font color="white">ç™½è‰²å­—ä½“</font></p></blockquote><h2 id="font-color-red-â–š-u-02-u-æ‹“å±•ï¼šactionç³»ç»Ÿæ˜¾ç¤º-font"><font color=red>â–šâ€‚<u>02</u>â€‚æ‹“å±•ï¼šactionç³»ç»Ÿæ˜¾ç¤º</font></h2><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240123170224054.png" alt="image-20240123170224054"></p><div class="warning"><p><font color=blue><strong>æ³¨æ„ï¼šæœ¬æ¬¡æ¼”ç¤ºä½¿ç”¨çš„æ˜¯CentOS 7.9 ï¼ŒUbantuç‰ˆæœ¬é‡Œé¢å¹¶æ²¡æœ‰/etc/init.d/functionsè¿™ä¸ªç›¸å…³æ–‡ä»¶</strong></font></p></div><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240123171538833.png" alt="image-20240123171538833"></p><h2 id="font-color-red-â–š-u-03-u-æ‹“å±•ï¼šå˜é‡å­ä¸²å¦™ç”¨-font"><font color=red>â–šâ€‚<u>03</u>â€‚æ‹“å±•ï¼šå˜é‡å­ä¸²å¦™ç”¨</font></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root@nanxi:~<span class="comment"># url=www.baidu.com</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $url</span></span><br><span class="line">www.baidu.com</span><br><span class="line"></span><br><span class="line"><span class="comment">#    &quot;#&quot;  è¡¨ç¤ºä»å‰å‘ååŒ¹é…</span></span><br><span class="line">-------------------------------</span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;url#www.&#125;</span></span><br><span class="line">baidu.com</span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;url#*.&#125;</span></span><br><span class="line">baidu.com</span><br><span class="line"><span class="comment">#  ä¸¤ä¸ª#è¡¨ç¤ºè´ªå©ªåŒ¹é…ï¼Œä¸€ç›´åŒ¹é…åˆ°æœ€åä¸€ä¸ª(ç‚¹).</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;url##*.&#125;</span></span><br><span class="line">com</span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;url#*.*.&#125;</span></span><br><span class="line">com</span><br><span class="line"></span><br><span class="line"><span class="comment">#    &quot;%&quot;  è¡¨ç¤ºä»å‰å‘ååŒ¹é…</span></span><br><span class="line">-------------------------------</span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;url%.*&#125;</span></span><br><span class="line">www.baidu</span><br><span class="line"><span class="comment">#  ä¸¤ä¸ª%è¡¨ç¤ºè´ªå©ªåŒ¹é…ï¼Œä¸€ç›´åŒ¹é…åˆ°ç¬¬ä¸€ä¸ª(ç‚¹).</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;url%%.*&#125;</span></span><br><span class="line">www</span><br></pre></td></tr></table></figure><div class="tips"><p><strong>å–å€¼å°æŠ€å·§</strong></p><p>[nanxi@web1 ~]#df -h<br>Filesys  tem      Size  Used Avail Use% Mounted on<br>devtmpfs        911M     0  911M   0% /dev<br>tmpfs           922M     0  922M   0% /dev/shm<br>tmpfs           922M   18M  904M   2% /run<br>tmpfs           922M     0  922M   0% /sys/fs/cgroup<br>/dev/sda3        18G  3.2G   15G  18% /<br>/dev/sda1       197M  110M   88M  56% /boot<br>tmpfs           185M     0  185M   0% /run/user/1000<br>[nanxi@web1 ~]#used_disk=$(df -h |awk â€˜//$/{print $(NF-1)}â€™)<br>[nanxi@web1 ~]#echo $used_disk<br>18%<br>[nanxi@web1 ~]#echo ${used_disk%%}<br>18</p></div><h2 id="font-color-red-â–š-u-04-u-è¡¥å……ï¼šåŒ¹é…æ­£åˆ™åˆ¤æ–­-font"><font color=red>â–šâ€‚<u>04</u>â€‚è¡¥å……ï¼šåŒ¹é…æ­£åˆ™åˆ¤æ–­</font></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[nanxi@web1 ~]<span class="comment">#[[ user =~ ^u ]] &amp;&amp; echo æˆç«‹ || echo ä¸æˆç«‹</span></span><br><span class="line">æˆç«‹</span><br><span class="line">[nanxi@web1 ~]<span class="comment"># [[ user =~ r$ ]] &amp;&amp; echo æˆç«‹ || echo ä¸æˆç«‹</span></span><br><span class="line">æˆç«‹</span><br><span class="line">[nanxi@web1 ~]<span class="comment"># [[ user =~ o$ ]] &amp;&amp; echo æˆç«‹ || echo ä¸æˆç«‹</span></span><br><span class="line">ä¸æˆç«‹</span><br><span class="line">[nanxi@web1 ~]<span class="comment"># [[ 100 =~ ^1 ]] &amp;&amp; echo æˆç«‹ || echo ä¸æˆç«‹</span></span><br><span class="line">æˆç«‹</span><br><span class="line">[nanxi@web1 ~]<span class="comment">#[[ 100 =~ ^[0-9] ]] &amp;&amp; echo æˆç«‹ || echo ä¸æˆç«‹</span></span><br><span class="line">æˆç«‹</span><br><span class="line">[nanxi@web1 ~]<span class="comment"># [[ 12343242 =~ ^[0-9]+$ ]] &amp;&amp; echo æˆç«‹ || echo ä¸æˆç«‹</span></span><br><span class="line">æˆç«‹</span><br><span class="line"><span class="comment">#  å¤šä¸ªæ­£åˆ™æ¯”å¯¹ä½¿ç”¨ &amp;&amp; (ä¸)    || (æˆ–)</span></span><br><span class="line">[nanxi@web1 ~]<span class="comment">#[[ 10 -eq 20 &amp;&amp; 200 -gt 100 ]] &amp;&amp; echo æˆç«‹ || echo ä¸æˆç«‹</span></span><br><span class="line">ä¸æˆç«‹</span><br><span class="line">[nanxi@web1 ~]<span class="comment"># [[ 10 -eq 20 || 200 -gt 100 ]] &amp;&amp; echo æˆç«‹ || echo ä¸æˆç«‹</span></span><br><span class="line">æˆç«‹</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   å¤šä¸ªæ•´æ•°æ¯”è¾ƒä½¿ç”¨ -a (and)   -o (or)</span></span><br><span class="line">[nanxi@web1 ~]<span class="comment"># [ 10 -eq 10 -a 100 -gt 20 ] &amp;&amp; echo æˆç«‹ || echo ä¸æˆç«‹</span></span><br><span class="line">æˆç«‹</span><br><span class="line">[nanxi@web1 ~]<span class="comment">#[ 10 -eq 11 -o 100 -gt 20 ] &amp;&amp; echo æˆç«‹ || echo ä¸æˆç«‹</span></span><br><span class="line">æˆç«‹</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxiblogfoot.png" alt="nanxiblogfoot"></p>        <div id="aplayer-CnFlTxac" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;">            <pre class="aplayer-lrc-content"></pre>        </div>        <script>          var ap = new APlayer({            element: document.getElementById("aplayer-CnFlTxac"),            narrow: false,            autoplay: true,            showlrc: false,            music: {              title: "Whale (é²¸)",              author: "Jannik",              url: "http://cdn.zzxe.eu.org/music/Whale%20%28%E9%B2%B8%29.m4a",              pic: "https://p2.music.126.net/97-CeOH6aysRsv1TYBA71Q==/109951164727131802.jpg",              lrc: ""            }          });          window.aplayers || (window.aplayers = []);          window.aplayers.push(ap);        </script><blockquote><p><em><strong>ä»¥å¸Œæœ›ä¸ºç”Ÿçš„äººï¼Œå°†ç»é£Ÿè€Œæ­»ã€‚</strong></em></p><p align="right">â€”â€”å¯Œå…°å…‹æ—ï¼ˆç¾å›½ï¼‰</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Shellç¼–ç¨‹åŸºç¡€çŸ¥è¯†è¡¥å……&lt;/center&gt;&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;âœ¨ Shell è¿™ä¸ªå•è¯çš„åŸæ„æ˜¯â€œå¤–å£³â€ï¼Œè·Ÿ kernelï¼ˆå†…æ ¸ï¼‰ç›¸å¯¹åº”ï¼Œæ¯”å–»å†…æ ¸å¤–é¢çš„ä¸€å±‚ï¼Œå³ç”¨æˆ·è·Ÿå†…æ ¸äº¤äº’çš„å¯¹è¯ç•Œé¢ã€‚&lt;br&gt;
ğŸ‰ Shell æ˜¯ä¸€ä¸ªç¨‹åºï¼Œæä¾›ä¸€ä¸ªä¸ç”¨æˆ·å¯¹è¯çš„ç¯å¢ƒã€‚è¿™ä¸ªç¯å¢ƒåªæœ‰ä¸€ä¸ªå‘½ä»¤æç¤ºç¬¦ï¼Œè®©ç”¨æˆ·ä»é”®ç›˜è¾“å…¥å‘½ä»¤ï¼Œæ‰€ä»¥åˆç§°ä¸ºå‘½ä»¤è¡Œç¯å¢ƒï¼ˆcommand line interfaceï¼Œç®€å†™ä¸º CLIï¼‰ã€‚&lt;br&gt;
ğŸ Shell æ˜¯ä¸€ä¸ªå‘½ä»¤è§£é‡Šå™¨ï¼Œè§£é‡Šç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ã€‚å…¶æ¬¡ï¼ŒShell æ˜¯ä¸€ä¸ªå·¥å…·ç®±ï¼Œæä¾›äº†å„ç§å°å·¥å…·ï¼Œä¾›ç”¨æˆ·æ–¹ä¾¿åœ°ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;font-color-red-â–š-u-01-u-æ‹“å±•ï¼šechoè¶£å‘³ç©æ³•-font&quot;&gt;&lt;font color=red&gt;â–šâ€‚&lt;u&gt;01&lt;/u&gt;â€‚æ‹“å±•ï¼šechoè¶£å‘³ç©æ³•&lt;/font&gt;&lt;/h2&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#   echo  å‘½ä»¤æ¦‚è¿°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;é»˜è®¤å°†è¾“å…¥çš„å­—ç¬¦ä¸²é€å¾€æ ‡å‡†è¾“å‡ºï¼Œè¾“å‡ºçš„å­—ç¬¦ä¸²é—´ä»¥ç©ºç™½å­—ç¬¦éš”å¼€, å¹¶åœ¨æœ€ååŠ ä¸Šæ¢è¡Œç¬¦ï¼›&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#   echo  å‘½ä»¤è¯­æ³•&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; ã€é€‰é¡¹å‚æ•°ã€‘ ã€å­—ç¬¦ä¸²ã€‘&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-n    &lt;span class=&quot;comment&quot;&gt;#  å–æ¶ˆè‡ªåŠ¨æ¢è¡Œ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-e    &lt;span class=&quot;comment&quot;&gt;#  æ‰“å¼€åæ–œæ ESCè½¬ä¹‰&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-E    &lt;span class=&quot;comment&quot;&gt;#  å–æ¶ˆè½¬ä¹‰ (é»˜è®¤)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;å…³äºåæ–œæ çš„è½¬ä¹‰ï¼Œè¯¦ç»†å‚æ•°å¦‚ä¸‹ï¼š&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="Shellç¼–ç¨‹" scheme="https://smallflames.github.io/tags/Shell%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>JumpServerå¼€æºå ¡å’æœº</title>
    <link href="https://smallflames.github.io/2024/01/22/JumpServer%E7%AE%80%E8%BF%B0/"/>
    <id>https://smallflames.github.io/2024/01/22/JumpServer%E7%AE%80%E8%BF%B0/</id>
    <published>2024-01-22T12:48:23.000Z</published>
    <updated>2024-01-23T11:54:03.795Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>JumpServerç®€è¿°</center></h1><h1>ä¸€ã€JumpServerä»‹ç»</h1><p>â€ƒâ€ƒJumpServerå¼€æºå ¡å’æœºæ˜¯ä¸€æ¬¾è¿ç»´å®‰å…¨å®¡è®¡ç³»ç»Ÿäº§å“ï¼Œæä¾›èº«ä»½éªŒè¯ã€æˆæƒæ§åˆ¶ã€è´¦å·ç®¡ç†ã€å®‰å…¨å®¡è®¡ç­‰åŠŸèƒ½æ”¯æŒï¼Œå¸®åŠ©ä¼ä¸šå¿«é€Ÿæ„å»ºè¿ç»´å®‰å…¨å®¡è®¡èƒ½åŠ›ã€‚åº•å±‚åŒæ ·ä½¿ç”¨ansibleç®¡ç†å…¶ä»–æœåŠ¡ä¸»æœºï¼Œä½†æ˜¯å¯¹äºä¼ä¸šè¿ç»´äººå‘˜æ¥è¯´ï¼Œæˆ‘ä»¬æœ€å¸¸ç”¨çš„ä¾¿æ˜¯å®ƒçš„ç®¡ç†ã€ç›‘å¯Ÿå’Œå®¡è®¡åŠŸèƒ½ã€‚</p><p><img src="https://docs.jumpserver.org/zh/v3/img/index_02.png" alt="jumpserver.org)"></p><span id="more"></span><h1>äºŒã€JumpServerå®‰è£…</h1><p>â€ƒâ€ƒå…³äºè½¯ä»¶çš„å®‰è£…ï¼Œå—æ±çš„ä¹ æƒ¯æ˜¯æ— è®ºWindowsè¿˜æ˜¯Linuxå®‰è£…è½¯ä»¶å‡åœ¨å®˜ç½‘è¿›è¡Œï¼ˆ<a href="https://www.jumpserver.org/">JumpServerå®˜ç½‘åœ°å€</a>ï¼‰ï¼Œå› ä¸ºå®˜ç½‘çš„èµ„æºæ˜¯å®æ—¶æ›´æ–°çš„ï¼Œä¼šä¸åœçš„å¯¹å‡ºç°çš„bugè¿›è¡Œä¿®å¤ï¼Œè¿™èƒ½ä¸ºæˆ‘ä»¬é¿å…å¾ˆå¤šä¸å¿…è¦çš„éº»çƒ¦ï¼Œè€Œä¸”å®˜ç½‘ä¸€èˆ¬æƒ…å†µä¸‹å‡æä¾›å¸®åŠ©æ‰‹å†Œæˆ–è€…æˆ‘ä»¬ç§°å®˜æ–¹æ–‡æ¡£ï¼Œä¼šå¤§å¤§çš„æé«˜æˆ‘ä»¬å¯¹è½¯ä»¶çš„ä½¿ç”¨æ•ˆç‡ã€‚<a href="https://docs.jumpserver.org/zh/v3/">JumpServerå®˜æ–¹æ–‡æ¡£åœ°å€</a></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240122212330586.png" alt="image-20240122212330586"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸€é”®åœ¨çº¿å®‰è£…ï¼Œé»˜è®¤æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œç‰¹æ®Šéœ€æ±‚å¯æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£</span></span><br><span class="line"><span class="comment"># å®‰è£…æ—¶æ³¨æ„æœåŠ¡å™¨é…ç½®å°½å¯èƒ½é«˜ä¸€äº›ï¼Œå®˜æ–¹ä¹Ÿæœ‰å…³äºç¡¬ä»¶é…ç½®çš„ç®€å•è¯´æ˜ï¼Œè‡ªå·±æµ‹è¯•çš„è¯2æ ¸4Gå³å¯</span></span><br><span class="line">curl -sSL https://resource.fit2cloud.com/jumpserver/jumpserver/releases/latest/download/quick_start.sh | bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…è¿‡ç¨‹å¯èƒ½æ¯”è¾ƒç¼“æ…¢ï¼Œè¯·è€å¿ƒç­‰å¾…~</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240123190345095.png" alt="nanxijunmpserver"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ä¸‹è½½åˆ°/optï¼Œcd /opt/jumpserver-installer-v3.10.2</span></span><br><span class="line"><span class="comment"># å®‰è£…å®Œæˆåä¼šæœ‰å¾ˆå¤šçš„æç¤ºï¼Œæ¯”å¦‚æœåŠ¡ç®¡ç†æ–¹å¼ã€webè®¿é—®åœ°å€ã€dockerè¿è¡Œä¿¡æ¯â€¦â€¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨æˆåŠŸåï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—®ç™»å½• JumpServer</span></span><br><span class="line">webé¡µé¢åœ°å€: http://&lt;JumpServeræœåŠ¡å™¨IPåœ°å€&gt;:&lt;æœåŠ¡è¿è¡Œç«¯å£&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·å¯†ç </span></span><br><span class="line">-----------------</span><br><span class="line">ç”¨æˆ·å: admin</span><br><span class="line">å¯†  ç : admin</span><br><span class="line">-----------------</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240123190926279.png" alt="image-20240123190926279"></p><h1>ä¸‰ã€jumpServerç•Œé¢</h1><p><img src="https://docs.jumpserver.org/zh/v3/img/online_install_01.png" alt="jumpserverweb)"></p><div class="warning"><p>â€ƒâ€ƒ<font color=red><strong>æ³¨æ„âš ï¸ ï¼šåˆšåˆšå®‰è£…å¥½JumpServerå¹¶è¿›è¡Œç¬¬ä¸€æ¬¡å¯åŠ¨åï¼Œå¯èƒ½æ— æ³•è®¿é—®JumpServerçš„webé¡µé¢ï¼Œæ˜¾ç¤ºçº¢è‰²çš„502é”™è¯¯ï¼Œä¸è¦ç€æ€¥ï¼Œæ­¤æ—¶å¯èƒ½æ˜¯cpuè´Ÿè½½è¿‡é«˜å¯¼è‡´çš„ï¼Œç­‰å¾…cpuè´Ÿè½½é™ä¸‹æ¥ä¹‹åå³å¯æ­£å¸¸è®¿é—®ã€‚</strong></font></p></div><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/Snipaste_2024-01-23_19-24-48.png" alt="Snipaste_2024-01-23_19-24-48"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/Snipaste_2024-01-23_19-30-21.png" alt="Snipaste_2024-01-23_19-30-21"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxiblogfoot.png" alt="nanxiblogfoot"></p><iframe frameborder="no" border="0" marginwidth="0" allow = "autoplay" marginheight="0" width=100% height=86 src="//music.163.com/outchain/player?type=2&id=479598964&auto=1&height=66"></iframe><blockquote><p><em><strong>å¤§å¤šæ•°äººå¤±å»å·¥ä½œï¼Œæ˜¯å› ä¸ºè¿™äº›å·¥ä½œæŠ«ç€&quot;è¾›å‹¤&quot;çš„å¤–è¡£ã€‚</strong></em></p><p align="right">â€”â€”çˆ±è¿ªç”Ÿ</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;JumpServerç®€è¿°&lt;/center&gt;&lt;/h1&gt;
&lt;h1&gt;ä¸€ã€JumpServerä»‹ç»&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒJumpServerå¼€æºå ¡å’æœºæ˜¯ä¸€æ¬¾è¿ç»´å®‰å…¨å®¡è®¡ç³»ç»Ÿäº§å“ï¼Œæä¾›èº«ä»½éªŒè¯ã€æˆæƒæ§åˆ¶ã€è´¦å·ç®¡ç†ã€å®‰å…¨å®¡è®¡ç­‰åŠŸèƒ½æ”¯æŒï¼Œå¸®åŠ©ä¼ä¸šå¿«é€Ÿæ„å»ºè¿ç»´å®‰å…¨å®¡è®¡èƒ½åŠ›ã€‚åº•å±‚åŒæ ·ä½¿ç”¨ansibleç®¡ç†å…¶ä»–æœåŠ¡ä¸»æœºï¼Œä½†æ˜¯å¯¹äºä¼ä¸šè¿ç»´äººå‘˜æ¥è¯´ï¼Œæˆ‘ä»¬æœ€å¸¸ç”¨çš„ä¾¿æ˜¯å®ƒçš„ç®¡ç†ã€ç›‘å¯Ÿå’Œå®¡è®¡åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://docs.jumpserver.org/zh/v3/img/index_02.png&quot; alt=&quot;jumpserver.org)&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="è½¯ä»¶åº”ç”¨" scheme="https://smallflames.github.io/tags/%E8%BD%AF%E4%BB%B6%E5%BA%94%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>Shellç¼–ç¨‹çŸ¥è¯†è¡¥å……ï¼ˆä¸€ï¼‰</title>
    <link href="https://smallflames.github.io/2024/01/22/Shell%E7%BC%96%E7%A8%8B%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>https://smallflames.github.io/2024/01/22/Shell%E7%BC%96%E7%A8%8B%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85%EF%BC%88%E4%B8%80%EF%BC%89/</id>
    <published>2024-01-22T08:46:42.000Z</published>
    <updated>2024-01-23T07:02:12.318Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Shellç¼–ç¨‹åŸºç¡€çŸ¥è¯†è¡¥å……</center></h1><h1>ä¸€ã€æ‰§è¡Œè„šæœ¬çš„æ–¹å¼</h1><p>1ï¸âƒ£  æŒ‡å®šè§£é‡Šå™¨æ‰§è¡Œ --------&gt;  <code>/bin/bash nanxi.sh</code>  &amp;  <code>sh nanxi.sh</code>  é»˜è®¤è§£é‡Šå™¨å³ä¸º/bin/bash</p><p>2ï¸âƒ£  ä½¿ç”¨è·¯å¾„æ‰§è¡Œï¼ˆéœ€è¦æ‰§è¡Œæƒé™+xï¼‰----&gt; <code>./nanxi.sh</code>  &amp;   <code>/scripts/nanxi.sh</code>  ä¸¤ç§æ–¹å¼å‡å¯</p><p>3ï¸âƒ£  å‘½ä»¤è°ƒç”¨æ‰§è¡Œ   -------------------------&gt;  <code>source /scripts/nanxi.sh</code>   &amp;  <code>.  nanxi.sh</code></p><div class="warning"><p><font color=red><strong>åŒºåˆ«ï¼šæ–¹å¼1ï¸âƒ£å’Œæ–¹å¼2ï¸âƒ£æ‰§è¡Œè„šæœ¬è°ƒç”¨çš„æ˜¯å­shellï¼Œè€Œæ–¹å¼3ï¸âƒ£æ‰§è¡Œè„šæœ¬è°ƒç”¨çš„æ˜¯å½“å‰shell</strong></font></p></div><h1>äºŒã€ç¯å¢ƒå˜é‡çš„æ‰§è¡Œé¡ºåº</h1><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240122182252168.png" alt="image-20240122182252168"></p><span id="more"></span><h1>ä¸‰ã€å®šä¹‰å˜é‡ï¼ˆç‰¹ä¾‹ï¼‰</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ—¶é—´æ˜¯å›ºå®šçš„</span></span><br><span class="line">root@nanxi:~<span class="comment"># time=$(date +%F-%H-%M-%S)</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $time</span></span><br><span class="line">2024-01-22-10-10-14</span><br><span class="line">root@nanxi:~<span class="comment"># echo $time</span></span><br><span class="line">2024-01-22-10-10-14</span><br><span class="line"><span class="comment"># æ—¶é—´æ˜¯ä¸å›ºå®š</span></span><br><span class="line">root@nanxi:~<span class="comment"># time=&quot;date +%F-%H-%M-%S&quot;</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $time</span></span><br><span class="line"><span class="built_in">date</span> +%F-%H-%M-%S</span><br><span class="line">root@nanxi:~<span class="comment"># $time</span></span><br><span class="line">2024-01-22-10-10-39</span><br><span class="line">root@nanxi:~<span class="comment"># $time</span></span><br><span class="line">2024-01-22-10-10-40</span><br><span class="line">root@nanxi:~<span class="comment"># $time</span></span><br><span class="line">2024-01-22-10-10-41</span><br></pre></td></tr></table></figure><h1>å››ã€Shellæ ¸å¿ƒä½ç½®å˜é‡</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$0</span>      <span class="comment"># è¡¨ç¤ºShellè„šæœ¬çš„åç§°</span></span><br><span class="line"><span class="variable">$n</span>      <span class="comment"># è¡¨ç¤ºShellè„šæœ¬å¼•ç”¨çš„ç¬¬nä¸ªå‚æ•° ä»$1å¼€å§‹è¡¨ç¤ºè„šæœ¬çš„ç¬¬1ä¸ªå‚æ•° $&#123;10&#125; $&#123;11&#125;</span></span><br><span class="line"><span class="variable">$#</span>      <span class="comment"># è¡¨ç¤ºShellè„šæœ¬ä¼ å‚çš„ä¸ªæ•°</span></span><br><span class="line">$?      <span class="comment"># è¡¨ç¤ºä¸Šä¸€ä¸ªå‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œ0è¡¨ç¤ºæˆåŠŸï¼Œé0è¡¨ç¤ºå¤±è´¥</span></span><br><span class="line"></span><br><span class="line">$$      <span class="comment"># è¡¨ç¤ºæœ¬æ¬¡æ‰§è¡Œè„šæœ¬çš„è¿›ç¨‹PIDå·ï¼Œè„šæœ¬å†…ä½¿ç”¨</span></span><br><span class="line">$!      <span class="comment"># è¡¨ç¤ºä¸Šä¸€æ¬¡æ‰§è¡Œè„šæœ¬çš„è¿›ç¨‹PIDå·ï¼Œä¸€èˆ¬è°ƒè¯•è„šæœ¬æ—¶ä½¿ç”¨</span></span><br><span class="line">$*      <span class="comment"># è¡¨ç¤ºæ‰€æœ‰å‚æ•°ï¼Œåœ¨å¾ªç¯ä½“ä¸­åŠ åŒå¼•å·è¡¨ç¤ºå°†åŸå‚æ•°ä½œä¸ºä¸€ä¸ªå‚æ•°è¾“å‡º</span></span><br><span class="line"><span class="variable">$@</span>      <span class="comment"># è¡¨ç¤ºæ‰€æœ‰å‚æ•°ï¼Œåœ¨å¾ªç¯ä½“ä¸­åŠ åŒå¼•å·è¡¨ç¤ºä»¥åŸå‚æ•°ä¸ªæ•°ä¾æ¬¡è¾“å‡º</span></span><br><span class="line"><span class="variable">$_</span>      <span class="comment"># è¡¨ç¤ºä¸Šä¸€æ¡å‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•°</span></span><br></pre></td></tr></table></figure><h1>äº”ã€è„šæœ¬ä¼ å‚æ–¹å¼</h1><h2 id="1ã€ç›´æ¥ä¼ å‚">1ã€ç›´æ¥ä¼ å‚</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@nanxi:~<span class="comment"># cat nanxi.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$1</span></span><br><span class="line">root@nanxi:~<span class="comment"># source nanxi.sh nanxi</span></span><br><span class="line">nanxi</span><br></pre></td></tr></table></figure><h2 id="2ã€èµ‹å€¼ä¼ å‚">2ã€èµ‹å€¼ä¼ å‚</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@nanxi:~<span class="comment"># cat nanxi.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">name=<span class="variable">$1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;I love <span class="variable">$name</span>&quot;</span></span><br><span class="line">root@nanxi:~<span class="comment"># source nanxi.sh nanxi</span></span><br><span class="line">I love nanxi</span><br></pre></td></tr></table></figure><h2 id="3ã€readè¯»å…¥">3ã€readè¯»å…¥</h2><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240122185148924.png" alt="image-20240122185148924"></p><div class='spoiler collapsed'>    <div class='spoiler-title'>        readå‘½ä»¤ç®€è¿°    </div>    <div class='spoiler-content'>        <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  ä½¿ç”¨æ–¹å¼ï¼š</span></span><br><span class="line"><span class="built_in">read</span> ã€é€‰é¡¹ã€‘ ã€å˜é‡åã€‘(éå›ºå®šå¯é€‰)</span><br><span class="line"><span class="comment">#  å‚æ•°é€‰é¡¹</span></span><br><span class="line">-p æç¤ºä¿¡æ¯  <span class="comment">#ç­‰å¾…readè¾“å…¥æ—¶ï¼Œè¾“å‡ºæç¤ºä¿¡æ¯;</span></span><br><span class="line">-t ç§’ æ•°     <span class="comment">#readå‘½ä»¤ä¼šä¸€ç›´ç­‰å¾…ç”¨æˆ·è¾“å…¥ï¼Œä½¿ç”¨æ­¤é€‰é¡¹å¯ä»¥æŒ‡å®šç­‰å¾…æ—¶é—´;</span></span><br><span class="line">-n å­—ç¬¦æ•°    <span class="comment">#readå‘½ä»¤åªæ¥å—æŒ‡å®šçš„å­—ç¬¦æ•°é‡ï¼Œç„¶åå°±ä¼šæ‰§è¡Œ;</span></span><br><span class="line">-s éšè—è¾“å…¥  <span class="comment">#éšè—è¾“å…¥å†…å®¹ï¼Œé€‚ç”¨äºæœºå¯†ä¿¡æ¯çš„è¾“å…¥;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  readä½¿ç”¨æ¡ˆä¾‹ </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">read</span> -t 5 -p <span class="string">&quot;Enter your name : &quot;</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;hello <span class="variable">$name</span>, welcome to BeiJing&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;sorry, Output timeout, please execute the command again !&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;------------------&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">read</span> -s -t 5 -p <span class="string">&quot;please enter your password : &quot;</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;status : $? , Ok&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;sorry, Output timeout, please execute the command again !&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><div class="warning"><p><font color=red><strong>æ³¨æ„ï¼šreadè¯»å–çš„å‚æ•°ï¼Œä¸èƒ½å†ç”¨$nçš„æ–¹å¼è¿›è¡Œè°ƒç”¨ï¼ï¼ï¼</strong></font></p></div>    </div></div><h1>å…­ã€å˜é‡çš„å­—ä¸²</h1><h2 id="1ã€å­—ç¬¦ä¸²åˆ‡ç‰‡">1ã€å­—ç¬¦ä¸²åˆ‡ç‰‡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@nanxi:~<span class="comment"># name=&quot;nanxi i love you&quot;</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $name</span></span><br><span class="line">nanxi i love you</span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;name:0:5&#125;</span></span><br><span class="line">nanxi</span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;name:8:-4&#125;</span></span><br><span class="line">love</span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;name:12:15&#125;</span></span><br><span class="line">you</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@nanxi:~<span class="comment"># name=&quot;nanxi i love you&quot;</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;name&#125; | cut -c 1-5,8-16</span></span><br><span class="line">nanxi love you</span><br></pre></td></tr></table></figure><div class="tips"><p><strong>cutå‘½ä»¤çš„ç®€å•ä»‹ç»</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">åŸºæœ¬è¯­æ³•ï¼š cut [é€‰é¡¹å‚æ•°]  filename</span><br><span class="line"></span><br><span class="line">é€‰é¡¹ä¸å‚æ•°ï¼š</span><br><span class="line">-dï¼šåˆ†éš”ç¬¦ï¼ŒæŒ‰ç…§æŒ‡å®šåˆ†éš”ç¬¦åˆ†å‰²åˆ—ã€‚ä¸ -f ä¸€èµ·ä½¿ç”¨</span><br><span class="line">-fï¼šä¾æ® -d çš„åˆ†éš”å­—ç¬¦å°†ä¸€æ®µä¿¡æ¯åˆ†å‰²æˆä¸ºæ•°æ®µï¼Œç”¨ -f å–å‡ºç¬¬å‡ æ®µçš„æ„æ€ï¼ˆåˆ—å·ï¼Œæå–ç¬¬å‡ åˆ—ï¼‰</span><br><span class="line">-cï¼šä»¥å­—ç¬¦ (characters) çš„å•ä½å–å‡ºå›ºå®šå­—ç¬¦åŒºé—´</span><br><span class="line">-bï¼šä»¥å­—èŠ‚ä¸ºå•ä½è¿›è¡Œåˆ†å‰²</span><br></pre></td></tr></table></figure><p><em>æ³¨æ„âš ï¸ï¼š å¦‚æœæ–‡ä»¶é‡Œé¢çš„æŸäº›åŸŸæ˜¯ç”±<strong>è‹¥å¹²ä¸ªç©ºæ ¼æ¥é—´éš”çš„</strong>ï¼Œé‚£ä¹ˆç”¨cutå°±æœ‰ç‚¹éº»çƒ¦äº†ï¼Œå› ä¸º<strong>cutåªæ“…é•¿å¤„ç†â€œä»¥ä¸€ä¸ªå­—ç¬¦é—´éš”â€çš„æ–‡æœ¬å†…å®¹</strong>ã€‚</em></p></div><h2 id="2ã€å˜é‡é•¿åº¦ç»Ÿè®¡">2ã€å˜é‡é•¿åº¦ç»Ÿè®¡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@nanxi:~<span class="comment"># echo nanxi | wc -L</span></span><br><span class="line">5</span><br><span class="line">root@nanxi:~<span class="comment"># expr length &quot;nanxi&quot;</span></span><br><span class="line">5</span><br><span class="line">root@nanxi:~<span class="comment"># echo nanxi | awk &#x27;&#123;print length&#125;&#x27;</span></span><br><span class="line">5</span><br><span class="line">root@nanxi:~<span class="comment"># name=nanxi</span></span><br><span class="line">root@nanxi:~<span class="comment"># echo $&#123;#name&#125;</span></span><br><span class="line">5</span><br></pre></td></tr></table></figure><div class='spoiler collapsed'>    <div class='spoiler-title'>        wcå‘½ä»¤å›é¡¾    </div>    <div class='spoiler-content'>        <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  å‘½ä»¤ä½¿ç”¨</span></span><br><span class="line"><span class="built_in">wc</span> [OPTION]... [FILE]...</span><br><span class="line"><span class="comment">#  å¸¸ç”¨å‚æ•°</span></span><br><span class="line">-l , --lines : æ˜¾ç¤ºè¡Œæ•°ï¼›</span><br><span class="line">-w , --words : æ˜¾ç¤ºå­—æ•°ï¼›</span><br><span class="line">-m , --chars : æ˜¾ç¤ºå­—ç¬¦æ•°ï¼›</span><br><span class="line">-c , --bytes : æ˜¾ç¤ºå­—èŠ‚æ•°ï¼›</span><br><span class="line">-L , --max-line-length : æ˜¾ç¤ºæœ€é•¿è¡Œçš„é•¿åº¦ï¼›</span><br></pre></td></tr></table></figure>    </div></div><h2 id="3ã€ç»Ÿè®¡å­—ç¬¦ä¸²é•¿åº¦å°äº3çš„å¹¶è¾“å‡ºåˆ°å±å¹•">3ã€ç»Ÿè®¡å­—ç¬¦ä¸²é•¿åº¦å°äº3çš„å¹¶è¾“å‡ºåˆ°å±å¹•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root@nanxi:~<span class="comment"># vim select.sh</span></span><br><span class="line">root@nanxi:~<span class="comment"># cat select.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> I am nanxi and i love you</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    [ <span class="variable">$&#123;#i&#125;</span> -lt 3 ] &amp;&amp; <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">root@nanxi:~<span class="comment"># source select.sh</span></span><br><span class="line">I</span><br><span class="line">am</span><br><span class="line">i</span><br><span class="line"></span><br><span class="line">root@nanxi:~<span class="comment"># echo I am nanxi I am 18 |xargs -n1|awk &#x27;&#123;if(length&lt;3)print&#125;&#x27;I</span></span><br><span class="line">am</span><br><span class="line">I</span><br><span class="line">am</span><br><span class="line">18</span><br><span class="line"></span><br><span class="line">root@nanxi:~<span class="comment"># echo I am nanxi I am 18 |xargs -n1|awk &#x27;&#123;for(i=1;i&lt;=NF;i++)if(length($i)&lt;3)print $i&#125;&#x27;</span></span><br><span class="line">I</span><br><span class="line">am</span><br><span class="line">I</span><br><span class="line">am</span><br><span class="line">18</span><br></pre></td></tr></table></figure><h1>ä¸ƒã€åˆ¤æ–­è¡¨è¾¾å¼</h1><h2 id="1ã€æ–‡ä»¶æ¯”è¾ƒè¿ç®—ç¬¦">1ã€æ–‡ä»¶æ¯”è¾ƒè¿ç®—ç¬¦</h2><table><thead><tr><th style="text-align:left">è¡¨è¾¾å¼</th><th style="text-align:left">è¯´æ˜</th><th style="text-align:left">æ¡ˆä¾‹</th></tr></thead><tbody><tr><td style="text-align:left">-e filename</td><td style="text-align:left">å¦‚æœfilenameå­˜åœ¨ï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€“e /etc/hosts ]</td></tr><tr><td style="text-align:left">-d filename</td><td style="text-align:left">å¦‚æœfilenameä¸ºç›®å½•ï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€“e /etc ]</td></tr><tr><td style="text-align:left">-f filename</td><td style="text-align:left">å¦‚æœfilenameä¸ºå¸¸è§„æ–‡ä»¶ï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€“f /usr/bin/grep]</td></tr><tr><td style="text-align:left">-L filename</td><td style="text-align:left">å¦‚æœfilenameä¸ºç¬¦å·é“¾æ¥ï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€“L /usr/bin/grep]</td></tr><tr><td style="text-align:left">-r filename</td><td style="text-align:left">å¦‚æœfilenameå¯è¯»ï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€“r /etc/hosts ]</td></tr><tr><td style="text-align:left">-w filename</td><td style="text-align:left">å¦‚æœfilenameå¯å†™ï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€“w /etc/hosts ]</td></tr><tr><td style="text-align:left">-x filename</td><td style="text-align:left">å¦‚æœfilenameå¯æ‰§è¡Œï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€“x /etc/hosts ]</td></tr><tr><td style="text-align:left">filename1 â€“nt filename2</td><td style="text-align:left">å¦‚æœfilename1æ¯”filename2æ–°ï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[/usr/test/file1.txt â€“nt /usr/test/file2.txt]</td></tr><tr><td style="text-align:left">filename1 â€“ot filename2</td><td style="text-align:left">å¦‚æœfilename1æ¯”filename2æ—§ï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[/usr/test/file1.txt â€“ot /usr/test/file2.txt]</td></tr></tbody></table><h2 id="2ã€å­—ç¬¦ä¸²æ¯”è¾ƒè¿ç®—ç¬¦">2ã€å­—ç¬¦ä¸²æ¯”è¾ƒè¿ç®—ç¬¦</h2><table><thead><tr><th style="text-align:left">è¡¨è¾¾å¼</th><th style="text-align:left">è¯´æ˜</th><th style="text-align:left">æ¡ˆä¾‹</th></tr></thead><tbody><tr><td style="text-align:left">-z string</td><td style="text-align:left">å¦‚æœstringé•¿åº¦ä¸º0,åˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€“z â€œ$varâ€]</td></tr><tr><td style="text-align:left">-n string</td><td style="text-align:left">å¦‚æœstringé•¿åº¦é0,åˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€“n â€œ$varâ€]</td></tr><tr><td style="text-align:left">str1=str2</td><td style="text-align:left">å¦‚æœstr1ä¸str2ç›¸åŒï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€œ$varâ€ = â€hello worldâ€]</td></tr><tr><td style="text-align:left">str1!=str2</td><td style="text-align:left">å¦‚æœstr1ä¸str2ä¸ç›¸åŒï¼Œåˆ™ä¸ºçœŸ</td><td style="text-align:left">[ â€$varâ€œ != â€hello worldâ€œ]</td></tr></tbody></table><h2 id="3ã€ç®—æœ¯æ¯”è¾ƒè¿ç®—ç¬¦">3ã€ç®—æœ¯æ¯”è¾ƒè¿ç®—ç¬¦</h2><table><thead><tr><th style="text-align:left">è¡¨è¾¾å¼</th><th style="text-align:left">è¯´æ˜</th><th style="text-align:left">æ¡ˆä¾‹</th></tr></thead><tbody><tr><td style="text-align:left">num1-eq num2</td><td style="text-align:left">ç­‰äº</td><td style="text-align:left">[ 6 -eq $num ]</td></tr><tr><td style="text-align:left">num1-ne num2</td><td style="text-align:left">ä¸ç­‰äº</td><td style="text-align:left">[ 6 -ne $num ]</td></tr><tr><td style="text-align:left">num1-lt num2</td><td style="text-align:left">å°äº</td><td style="text-align:left">[ 6 -lt $num ]</td></tr><tr><td style="text-align:left">num1-le num2</td><td style="text-align:left">å°äºç­‰äº</td><td style="text-align:left">[ 6 -le $num ]</td></tr><tr><td style="text-align:left">num1-gt num2</td><td style="text-align:left">å¤§äº</td><td style="text-align:left">[ 6 -gt $num ]</td></tr><tr><td style="text-align:left">num1-ge num2</td><td style="text-align:left">å¤§äºç­‰äº</td><td style="text-align:left">[ 6 -ge $num ]</td></tr></tbody></table><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/nanxiblogfoota.png" alt="nanxiblogfoota"></p><iframe frameborder="no" border="0" marginwidth="0" allow = "autoplay" marginheight="0" width=100% height=86 src="//music.163.com/outchain/player?type=2&id=1488212875&auto=1&height=66"></iframe><blockquote><p><em><strong>è‡ªç”±æ˜¯ä¸Šå¸èµç»™äººç±»çš„æœ€å¤§çš„å¹¸ç¦ä¹‹ä¸€ã€‚</strong></em></p><p align="right">â€”â€”å¡ä¸‡ææ–¯</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Shellç¼–ç¨‹åŸºç¡€çŸ¥è¯†è¡¥å……&lt;/center&gt;&lt;/h1&gt;
&lt;h1&gt;ä¸€ã€æ‰§è¡Œè„šæœ¬çš„æ–¹å¼&lt;/h1&gt;
&lt;p&gt;1ï¸âƒ£  æŒ‡å®šè§£é‡Šå™¨æ‰§è¡Œ --------&amp;gt;  &lt;code&gt;/bin/bash nanxi.sh&lt;/code&gt;  &amp;amp;  &lt;code&gt;sh nanxi.sh&lt;/code&gt;  é»˜è®¤è§£é‡Šå™¨å³ä¸º/bin/bash&lt;/p&gt;
&lt;p&gt;2ï¸âƒ£  ä½¿ç”¨è·¯å¾„æ‰§è¡Œï¼ˆéœ€è¦æ‰§è¡Œæƒé™+xï¼‰----&amp;gt; &lt;code&gt;./nanxi.sh&lt;/code&gt;  &amp;amp;   &lt;code&gt;/scripts/nanxi.sh&lt;/code&gt;  ä¸¤ç§æ–¹å¼å‡å¯&lt;/p&gt;
&lt;p&gt;3ï¸âƒ£  å‘½ä»¤è°ƒç”¨æ‰§è¡Œ   -------------------------&amp;gt;  &lt;code&gt;source /scripts/nanxi.sh&lt;/code&gt;   &amp;amp;  &lt;code&gt;.  nanxi.sh&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;warning&quot;&gt;
&lt;p&gt;&lt;font color=red&gt;&lt;strong&gt;åŒºåˆ«ï¼šæ–¹å¼1ï¸âƒ£å’Œæ–¹å¼2ï¸âƒ£æ‰§è¡Œè„šæœ¬è°ƒç”¨çš„æ˜¯å­shellï¼Œè€Œæ–¹å¼3ï¸âƒ£æ‰§è¡Œè„šæœ¬è°ƒç”¨çš„æ˜¯å½“å‰shell&lt;/strong&gt;&lt;/font&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;h1&gt;äºŒã€ç¯å¢ƒå˜é‡çš„æ‰§è¡Œé¡ºåº&lt;/h1&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240122182252168.png&quot; alt=&quot;image-20240122182252168&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="Shellç¼–ç¨‹" scheme="https://smallflames.github.io/tags/Shell%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Ansibleä¸€é”®éƒ¨ç½²å®ä¾‹ï¼ˆä¸‰ï¼‰</title>
    <link href="https://smallflames.github.io/2024/01/21/Ansible%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E5%AE%9E%E4%BE%8B%EF%BC%88%E4%B8%89%EF%BC%89/"/>
    <id>https://smallflames.github.io/2024/01/21/Ansible%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E5%AE%9E%E4%BE%8B%EF%BC%88%E4%B8%89%EF%BC%89/</id>
    <published>2024-01-21T10:36:01.000Z</published>
    <updated>2024-01-21T11:35:17.643Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Ansibleä¸€é”®éƒ¨ç½²å®ä¾‹ï¼ˆä¸‰ï¼‰</center></h1><table><tr><td bgcolor=#000000><font color="white">ä¸šåŠ¡éƒ¨ç½²ä»£ç </font></td></tr></table><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wordpressä¸šåŠ¡éƒ¨ç½²</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/wordpress</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">wordpress.conf</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">wordpress.sql</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">wordpress.tar.gz</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">6</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/wordpress</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for wordpress</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">remove</span> <span class="string">nginx</span> <span class="string">default.conf</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">rm</span> <span class="string">-rf</span> <span class="string">/etc/nginx/conf.d/default.conf</span> <span class="string">warn=false</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">wordpress</span> <span class="string">nginx</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">wordpress.conf</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/nginx/conf.d</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">web</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">wordpress</span> <span class="string">code</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/code/wordpress</span></span><br><span class="line">    <span class="attr">owner:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Extract</span> <span class="string">wordpress.tar.gz</span> <span class="string">into</span> <span class="string">web</span> <span class="string">/code</span></span><br><span class="line">  <span class="attr">unarchive:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">wordpress.tar.gz</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/code/wordpress</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Modify</span> <span class="string">directory</span> <span class="string">permissions</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">chown</span> <span class="string">-R</span> <span class="string">www.www</span> <span class="string">/code</span> <span class="string">warn=false</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sent</span> <span class="string">wordpress.sql</span> <span class="string">to</span> <span class="string">db</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">wordpress.sql</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/tmp</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">import</span> <span class="string">wordpress.sql</span></span><br><span class="line">  <span class="attr">mysql_db:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">all</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">import</span></span><br><span class="line">    <span class="attr">target:</span> <span class="string">/tmp/wordpress.sql</span></span><br><span class="line">  <span class="attr">register:</span> <span class="string">result</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">nginx</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">mariadb</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">mariadb</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mount</span> <span class="string">dir</span> <span class="string">to</span> <span class="string">nfs1</span></span><br><span class="line">  <span class="attr">mount:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.31</span><span class="string">:/data/wordpress</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/code/wordpress/wp-content/uploads</span></span><br><span class="line">    <span class="attr">fstype:</span> <span class="string">nfs</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">mounted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><span id="more"></span><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kodä¸šåŠ¡éƒ¨ç½²</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/kod</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">kod.conf</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">kod.sql</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">kod.tar.gz</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">6</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/kod</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for kod</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">remove</span> <span class="string">nginx</span> <span class="string">default.conf</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">rm</span> <span class="string">-rf</span> <span class="string">/etc/nginx/conf.d/default.conf</span> <span class="string">warn=false</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">kod</span> <span class="string">nginx</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">kod.conf</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/nginx/conf.d</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">web</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">kod</span> <span class="string">code</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/code/kod</span></span><br><span class="line">    <span class="attr">owner:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Extract</span> <span class="string">kod.tar.gz</span> <span class="string">into</span> <span class="string">web</span> <span class="string">/code</span></span><br><span class="line">  <span class="attr">unarchive:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">kod.tar.gz</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/code/kod</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Modify</span> <span class="string">directory</span> <span class="string">permissions</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">chown</span> <span class="string">-R</span> <span class="string">www.www</span> <span class="string">/code</span> <span class="string">warn=false</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sent</span> <span class="string">kod.sql</span> <span class="string">to</span> <span class="string">db</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">kod.sql</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/tmp</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">import</span> <span class="string">kod.sql</span></span><br><span class="line">  <span class="attr">mysql_db:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">all</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">import</span></span><br><span class="line">    <span class="attr">target:</span> <span class="string">/tmp/kod.sql</span></span><br><span class="line">  <span class="attr">register:</span> <span class="string">result</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">nginx</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">mariadb</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">mariadb</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mount</span> <span class="string">dir</span> <span class="string">to</span> <span class="string">nfs1</span></span><br><span class="line">  <span class="attr">mount:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.31</span><span class="string">:/data/kod</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/code/kod/data/files</span></span><br><span class="line">    <span class="attr">fstype:</span> <span class="string">nfs</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">mounted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># éƒ¨ç½²tomcatæœåŠ¡</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/tomcat</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">context.xml</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">jdk.rpm</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">redis-data-cache.properties</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">tomcat.service</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">tomcat_session.tar.gz</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">tomcat.tar.gz</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">9</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/tomcat</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for tomcat</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sent</span> <span class="string">jdk.rpm</span> <span class="string">and</span> <span class="string">tomcat.service</span> <span class="string">to</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/tmp</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">jdk.rpm</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tomcat.service</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">java</span> <span class="string">environment</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">yum</span> <span class="string">-y</span> <span class="string">localinstall</span> <span class="string">/tmp/jdk.rpm</span> <span class="string">warn=false</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">systemctl</span> <span class="string">for</span> <span class="string">tomcat</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">tomcat.service</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/usr/lib/systemd/system</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">soft</span> <span class="string">dir</span> <span class="string">for</span> <span class="string">tomcat</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/soft</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Extract</span> <span class="string">tomcat.tar.gz</span> <span class="string">into</span> <span class="string">web</span> <span class="string">/soft</span></span><br><span class="line">  <span class="attr">unarchive:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">tomcat.tar.gz</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/soft</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">tomcat</span> <span class="string">link</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">/soft/apache-tomcat-9.0.84</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/soft/tomcat</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">link</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Extract</span> <span class="string">tomcat_session.tar.gz</span> <span class="string">into</span> <span class="string">web</span> <span class="string">tomcat</span> <span class="string">for</span> <span class="string">session</span> <span class="string">share</span></span><br><span class="line">  <span class="attr">unarchive:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">tomcat_session.tar.gz</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/soft/tomcat/lib</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cp</span> <span class="string">redis-data-cache.properties</span> <span class="string">and</span> <span class="string">context.xml</span> <span class="string">to</span> <span class="string">tomcat</span> <span class="string">for</span> <span class="string">session</span> <span class="string">share</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/soft/tomcat/conf</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">redis-data-cache.properties</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">context.xml</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">reload</span> <span class="string">by</span> <span class="string">systemctl</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">systemctl</span> <span class="string">daemon-reload</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">systemctl</span> <span class="string">restart</span> <span class="string">tomcat</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">systemctl</span> <span class="string">enable</span> <span class="string">tomcat</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">remove</span> <span class="string">remains</span> <span class="string">for</span> <span class="string">tomcat</span></span><br><span class="line">  <span class="attr">shell:</span>  <span class="string">rm</span> <span class="string">-rf</span> <span class="string">/tmp/jdk.rpm</span> <span class="string">/tmp/sys_tomcat</span> <span class="string">warn=false</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># zrlogæœåŠ¡éƒ¨ç½²</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/zrlog</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">server.xml</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">zrlog.sql</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">zrlog.tar.gz</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">6</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/zrlog</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for zrlog</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">zrlog</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">server.xml</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/soft/tomcat/conf</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">zrlog</span> <span class="string">code</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/code/zrlog/ROOT</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sent</span> <span class="string">zrlog.sql</span> <span class="string">to</span> <span class="string">db</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">zrlog.sql</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/tmp</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">import</span> <span class="string">zrlog.sql</span></span><br><span class="line">  <span class="attr">mysql_db:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">all</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">import</span></span><br><span class="line">    <span class="attr">target:</span> <span class="string">/tmp/zrlog.sql</span></span><br><span class="line">  <span class="attr">register:</span> <span class="string">result</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">mariadb</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">mariadb</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Extract</span> <span class="string">zrlog.tar.gz</span> <span class="string">into</span> <span class="string">web</span> <span class="string">/code/zrlog/ROOT</span></span><br><span class="line">  <span class="attr">unarchive:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">zrlog.tar.gz</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/code/zrlog/ROOT</span></span><br><span class="line">  <span class="attr">ignore_errors:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">tomcat</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">systemctl</span> <span class="string">restart</span> <span class="string">tomcat</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mount</span> <span class="string">dir</span> <span class="string">to</span> <span class="string">nfs1</span></span><br><span class="line">  <span class="attr">mount:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.31</span><span class="string">:/data/zrlog</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/code/zrlog/ROOT/attached</span></span><br><span class="line">    <span class="attr">fstype:</span> <span class="string">nfs</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">mounted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># phpmyadminéƒ¨ç½²</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/phpadmin</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">admin.conf</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">phpadmin.tar.gz</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">5</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/phpadmin</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for phpadmin</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">remove</span> <span class="string">nginx</span> <span class="string">default.conf</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">rm</span> <span class="string">-rf</span> <span class="string">/etc/nginx/conf.d/default.conf</span> <span class="string">warn=false</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">admin</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">admin.conf</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/nginx/conf.d</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">admin</span> <span class="string">code</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/code/phpadmin</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Extract</span> <span class="string">phpadmin.tar.gz</span> <span class="string">into</span> <span class="string">web</span> <span class="string">code_dir</span></span><br><span class="line">  <span class="attr">unarchive:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">phpadmin.tar.gz</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/code/phpadmin</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Modify</span> <span class="string">directory</span> <span class="string">permissions</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">chown</span> <span class="string">-R</span> <span class="string">www.www</span> <span class="string">/code</span> <span class="string">warn=false</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><table><tr><td bgcolor=#000000><font color="white">æœåŠ¡éƒ¨ç½²ä»£ç </font></td></tr></table><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è´Ÿè½½å‡è¡¡é…ç½®</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/lb_nginx</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">proxy.conf</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">proxy_params</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">5</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/lb_nginx</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for lb_nginx</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">remove</span> <span class="string">nginx</span> <span class="string">default.conf</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">rm</span> <span class="string">-rf</span> <span class="string">/etc/nginx/conf.d/default.conf</span> <span class="string">warn=false</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Reverse</span> <span class="string">proxy</span> <span class="string">proxy_params</span> <span class="string">and</span> <span class="string">Proxy</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.src &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.dest &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">src:</span> <span class="string">proxy_params</span>,<span class="attr">dest:</span> <span class="string">/etc/nginx</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">src:</span> <span class="string">proxy.conf</span>,<span class="attr">dest:</span> <span class="string">/etc/nginx/conf.d</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Restart</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è´Ÿè½½å‡è¡¡é«˜å¯ç”¨</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/keepalived</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">keep_nginxcheck.sh</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">keepalived.conf.j2</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">5</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/keepalived</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for keepalived</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Istall</span> <span class="string">keepalived</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">keepalived</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">shell</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/script</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Sent</span> <span class="string">nginx</span> <span class="string">check</span> <span class="string">shell</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">keep_nginxcheck.sh</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/script</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">&#x27;0755&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">keepalived</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">keepalived.conf.j2</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/keepalived/keepalived.conf</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="string">Restart</span> <span class="string">keepalived</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Start</span> <span class="string">keepalived</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">keepalived</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…¨ç½‘å®šæ—¶å¤‡ä»½</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/backup</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">backup.sh</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">tasks</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span> <span class="string">directories,</span> <span class="number">2</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/backup</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for backup</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">shell</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/script/autobackup</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match</span> <span class="string">&quot;backup&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Sent</span> <span class="string">backup.sh</span> <span class="string">all</span> <span class="string">except</span> <span class="string">backup</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">backup.sh</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/script/autobackup</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">&#x27;0755&#x27;</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match</span> <span class="string">&quot;backup&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Write</span> <span class="string">in</span> <span class="string">cron</span> <span class="string">tasks</span> <span class="string">for</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">cron:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.name&#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">minute:</span> <span class="string">&quot;*/5&quot;</span></span><br><span class="line">    <span class="comment">#hour: &quot;02&quot;</span></span><br><span class="line">    <span class="attr">job:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.job &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&quot;Code scheduled backup&quot;</span>,<span class="attr">job:</span> <span class="string">/bin/bash</span> <span class="string">/script/autobackup/backup.sh</span> <span class="string">/code</span> <span class="string">&gt;</span> <span class="string">/dev/null</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&quot;Nginx scheduled backup&quot;</span>,<span class="attr">job:</span> <span class="string">/bin/bash</span> <span class="string">/script/autobackup/backup.sh</span> <span class="string">/etc/nginx</span> <span class="string">&gt;</span> <span class="string">/dev/null</span> &#125;</span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Write</span> <span class="string">in</span> <span class="string">cron</span> <span class="string">tasks</span> <span class="string">for</span> <span class="string">lb</span></span><br><span class="line">  <span class="attr">cron:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;Nginx scheduled backup&quot;</span></span><br><span class="line">    <span class="attr">minute:</span> <span class="string">&quot;*/5&quot;</span></span><br><span class="line">    <span class="comment">#hour: &quot;02&quot;</span></span><br><span class="line">    <span class="attr">job:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/bin/bash</span> <span class="string">/script/autobackup/backup.sh</span> <span class="string">/etc/nginx</span> <span class="string">&gt;</span> <span class="string">/dev/null</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Write</span> <span class="string">in</span> <span class="string">cron</span> <span class="string">tasks</span> <span class="string">for</span> <span class="string">nfs</span></span><br><span class="line">  <span class="attr">cron:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;Data share scheduled backup&quot;</span></span><br><span class="line">    <span class="attr">minute:</span> <span class="string">&quot;*/5&quot;</span></span><br><span class="line">    <span class="comment">#hour: &quot;02&quot;</span></span><br><span class="line">    <span class="attr">job:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/bin/bash</span> <span class="string">/script/autobackup/backup.sh</span> <span class="string">/data</span> <span class="string">&gt;</span> <span class="string">/dev/null</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Write</span> <span class="string">in</span> <span class="string">cron</span> <span class="string">tasks</span> <span class="string">for</span> <span class="string">db</span></span><br><span class="line">  <span class="attr">cron:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.name &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">minute:</span> <span class="string">&quot;*/5&quot;</span></span><br><span class="line">    <span class="comment">#hour: &quot;02&quot;</span></span><br><span class="line">    <span class="attr">job:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.job &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&quot;Mysql conf scheduled backup&quot;</span>,<span class="attr">job:</span> <span class="string">/bin/bash</span> <span class="string">/script/autobackup/backup.sh</span> <span class="string">/etc/my.cnf.d</span> <span class="string">&gt;</span> <span class="string">/dev/null</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&quot;Mysql file scheduled backup&quot;</span>,<span class="attr">job:</span> <span class="string">/bin/bash</span> <span class="string">/script/autobackup/backup.sh</span> <span class="string">/var/lib/mysql</span> <span class="string">&gt;</span> <span class="string">/dev/null</span> &#125;</span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®https</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/https</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">proxy.conf</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">server.crt</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">server.key</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">6</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/https</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for https</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">ssl_key</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/nginx/ssl_key</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Key</span> <span class="string">distribution</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/nginx/ssl_key</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">server.crt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">server.key</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Modifying</span> <span class="string">agent</span> <span class="string">configuration</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">proxy.conf</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/nginx/conf.d</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="string">Restart</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Modifying</span> <span class="string">web</span> <span class="string">configuration</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.path &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">regexp:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.regex &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">line:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.line &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">path:</span> <span class="string">/etc/nginx/conf.d/wordpress.conf</span>,<span class="attr">regex:</span> <span class="string">&#x27;^#fastcgi_param&#x27;</span>,<span class="attr">line:</span> <span class="string">&quot;fastcgi_param HTTPS on;&quot;</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">path:</span> <span class="string">/etc/nginx/conf.d/admin.conf</span>,<span class="attr">regex:</span> <span class="string">&#x27;^#fastcgi_param&#x27;</span>,<span class="attr">line:</span> <span class="string">&quot;fastcgi_param HTTPS on;&quot;</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">path:</span> <span class="string">/etc/nginx/conf.d/kod.conf</span>,<span class="attr">regex:</span> <span class="string">&#x27;^#fastcgi_param&#x27;</span>,<span class="attr">line:</span> <span class="string">&quot;fastcgi_param HTTPS on;&quot;</span> &#125;</span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Restart</span> <span class="string">web</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">port</span> <span class="number">443</span> <span class="string">for</span> <span class="string">tomcat</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/soft/tomcat/conf/server.xml</span></span><br><span class="line">    <span class="attr">regexp:</span> <span class="string">&#x27;redirectPort=&quot;8443&quot;&#x27;</span></span><br><span class="line">    <span class="attr">line:</span> <span class="string">&#x27; redirectPort=&quot;443&quot; proxyPort=&quot;443&quot; scheme=&quot;https&quot; secure=&quot;true&quot; SSLEnabled=&quot;true&quot; &#x27;</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®é˜²ç«å¢™ç­–ç•¥</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/iptables</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">templates</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">iptables_strategy.j2</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span> <span class="string">directories,</span> <span class="number">2</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/iptables</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for iptables</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Stop</span> <span class="string">local</span> <span class="string">firewalld</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">firewalld</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">stopped</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Prohibit</span> <span class="string">self</span> <span class="string">start</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">systemctl</span> <span class="string">disable</span> <span class="string">firewalld</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">iptables-services</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">iptables-services</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Start</span> <span class="string">iptables</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">iptables.service</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Insert</span> <span class="string">configuration</span> <span class="string">in</span> <span class="string">rc.local</span></span><br><span class="line">  <span class="attr">blockinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/rc.d/rc.local</span></span><br><span class="line">    <span class="attr">block:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      modprobe ip_tables</span></span><br><span class="line"><span class="string">      modprobe iptable_filter</span></span><br><span class="line"><span class="string">      modprobe iptable_nat</span></span><br><span class="line"><span class="string">      modprobe ip_contrack</span></span><br><span class="line"><span class="string">      modprobe ip_conntrack_ftp</span></span><br><span class="line"><span class="string">      modprobe ip_nat_ftp</span></span><br><span class="line"><span class="string">      modprobe ipt_state</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Execute</span> <span class="string">permission</span> <span class="string">for</span> <span class="string">rc.local</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">chmod</span> <span class="number">0755</span> <span class="string">/etc/rc.d/rc.local</span> <span class="string">warn=false</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Sent</span> <span class="string">iptables_strategy</span> <span class="string">to</span> <span class="string">lb</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">iptables_strategy.j2</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/tmp/iptables_strategy</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Import</span> <span class="string">iptables_strategy</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">iptables-restore</span> <span class="string">&lt;</span> <span class="string">/tmp/iptables_strategy</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Remove</span> <span class="string">/tmp/iptables_strategy</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">rm</span> <span class="string">-rf</span> <span class="string">/tmp/iptables_strategy</span> <span class="string">warn=false</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å†…éƒ¨æœåŠ¡å™¨è®¿é—®å…¬ç½‘</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/access_net</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">tasks</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span> <span class="string">directory,</span> <span class="number">1</span> <span class="string">file</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/access_net</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for access_net</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Modifying</span> <span class="string">eth1</span> <span class="string">network</span> <span class="string">configuration</span></span><br><span class="line">  <span class="attr">blockinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/sysconfig/network-scripts/ifcfg-eth1</span></span><br><span class="line">    <span class="attr">block:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      GATEWAY=172.16.1.6</span></span><br><span class="line"><span class="string"></span>  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Restart</span> <span class="string">the</span> <span class="string">network</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">systemctl</span> <span class="string">restart</span> <span class="string">network</span> <span class="string">warn=false</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">switch</span> <span class="string">on</span> <span class="string">kernel</span> <span class="string">forward</span></span><br><span class="line">  <span class="attr">blockinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/sysctl.conf</span></span><br><span class="line">    <span class="attr">block:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      net.ipv4.ip_forward = 1</span></span><br><span class="line"><span class="string"></span>  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">load</span> <span class="string">configuration</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">sysctl</span> <span class="string">-p</span> <span class="string">warn=false</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#- name: switch off eth0</span></span><br><span class="line"><span class="comment">#  shell: ifdown eth0 warn=false</span></span><br><span class="line"><span class="comment">#  when: ansible_hostname is not match &quot;lb&quot;</span></span><br><span class="line"><span class="comment">#- name: Modifying eth0 network configuration</span></span><br><span class="line"><span class="comment">#  lineinfile:</span></span><br><span class="line"><span class="comment">#    path: /etc/sysconfig/network-scripts/ifcfg-eth0</span></span><br><span class="line"><span class="comment">#    regexp: &#x27;^ONBOOT&#x27;</span></span><br><span class="line"><span class="comment">#    line: &#x27;ONBOOT=yes&#x27;</span></span><br><span class="line"><span class="comment">#  when: ansible_hostname is not match &quot;lb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ—¶é—´æœåŠ¡å™¨é…ç½®</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/ntpdate</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">tasks</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span> <span class="string">directories,</span> <span class="number">2</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/ntpdate</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for ntpdata</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">ntp</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">ntp</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">cron</span> <span class="string">task</span> <span class="string">in</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">cron:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;TimeSync as Server&quot;</span></span><br><span class="line">    <span class="attr">minute:</span> <span class="string">&quot;*/10&quot;</span></span><br><span class="line">    <span class="attr">job:</span> <span class="string">&quot;/usr/sbin/ntpdate ntp1.aliyun.com &amp;&amp; hwclock -w &gt; /dev/null&quot;</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Modifying</span> <span class="string">configure</span> <span class="string">for</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">blockinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/ntp.conf</span></span><br><span class="line">    <span class="attr">block:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      SYNC_HWCLOCK=yes</span></span><br><span class="line"><span class="string"></span>  <span class="attr">notify:</span> <span class="string">Restart</span> <span class="string">ntpd</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Remove</span> <span class="string">server</span> <span class="string">on</span> <span class="string">client</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/ntp.conf</span></span><br><span class="line">    <span class="attr">regexp:</span> <span class="string">&#x27;^server&#x27;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">absent</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Modifying</span> <span class="string">configure</span> <span class="string">for</span> <span class="string">client</span></span><br><span class="line">  <span class="attr">blockinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/ntp.conf</span></span><br><span class="line">    <span class="attr">block:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      server 172.16.1.32 prefer</span></span><br><span class="line"><span class="string">      server 172.16.1.31</span></span><br><span class="line"><span class="string"></span>  <span class="attr">notify:</span> <span class="string">Restart</span> <span class="string">ntpd</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Start</span> <span class="string">ntpd</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">ntpd</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">cron</span> <span class="string">task</span> <span class="string">in</span> <span class="string">client</span></span><br><span class="line">  <span class="attr">cron:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;TimeSync as Server&quot;</span></span><br><span class="line">    <span class="attr">minute:</span> <span class="string">&quot;*/10&quot;</span></span><br><span class="line">    <span class="attr">job:</span> <span class="string">&quot;/usr/sbin/ntpdate 172.16.1.32 &amp;&amp; hwclock -w &gt; /dev/null&quot;</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Ansibleä¸€é”®éƒ¨ç½²å®ä¾‹ï¼ˆä¸‰ï¼‰&lt;/center&gt;&lt;/h1&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;ä¸šåŠ¡éƒ¨ç½²ä»£ç &lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;figure class=&quot;highlight yaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# wordpressä¸šåŠ¡éƒ¨ç½²&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;string&quot;&gt;root@ansible&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;~/roles/wordpress&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;#tree&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;files&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;â”‚&lt;/span&gt;Â Â  &lt;span class=&quot;string&quot;&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress.conf&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;â”‚&lt;/span&gt;Â Â  &lt;span class=&quot;string&quot;&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress.sql&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;â”‚&lt;/span&gt;Â Â  &lt;span class=&quot;string&quot;&gt;â””â”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress.tar.gz&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;handlers&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;â”‚&lt;/span&gt;Â Â  &lt;span class=&quot;string&quot;&gt;â””â”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;main.yml&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;tasks&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;â”‚&lt;/span&gt;Â Â  &lt;span class=&quot;string&quot;&gt;â””â”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;main.yml&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;templates&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;â””â”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;vars&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;â””â”€â”€&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;main.yml&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;directories,&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;files&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;string&quot;&gt;root@ansible&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;~/roles/wordpress&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;#cat tasks/main.yml&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;---&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# tasks file for wordpress&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;remove&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;nginx&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;default.conf&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;shell:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;-rf&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/etc/nginx/conf.d/default.conf&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;warn=false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;web&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;configure&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;nginx&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;server&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;copy:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;src:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress.conf&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;dest:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/etc/nginx/conf.d&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;notify:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;restart&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;web&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;nginx&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;web&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;code&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;dir&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;file:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;path:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/code/wordpress&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;owner:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;www&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;group:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;www&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;state:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;directory&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;web&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;Extract&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress.tar.gz&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;into&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;web&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/code&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;unarchive:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;src:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress.tar.gz&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;dest:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/code/wordpress&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;web&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;Modify&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;directory&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;permissions&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;shell:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;chown&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;-R&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;www.www&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/code&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;warn=false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;web&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;sent&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress.sql&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;db&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;copy:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;src:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress.sql&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;dest:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/tmp&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;db&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;wordpress.sql&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;mysql_db:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;all&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;state:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;import&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;target:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/tmp/wordpress.sql&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;register:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;result&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;db&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;restart&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;nginx&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;systemd:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;nginx&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;state:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;restarted&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;web&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;restart&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;mariadb&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;systemd:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;mariadb&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;state:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;restarted&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;db&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;mount&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;dir&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;nfs1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;mount:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;src:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;172.16&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.31&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;:/data/wordpress&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;path:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/code/wordpress/wp-content/uploads&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;fstype:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;nfs&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;state:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;mounted&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;web&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="æœåŠ¡æ¶æ„" scheme="https://smallflames.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Ansibleä¸€é”®éƒ¨ç½²å®ä¾‹ï¼ˆäºŒï¼‰</title>
    <link href="https://smallflames.github.io/2024/01/21/Ansible%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E5%AE%9E%E4%BE%8B%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <id>https://smallflames.github.io/2024/01/21/Ansible%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E5%AE%9E%E4%BE%8B%EF%BC%88%E4%BA%8C%EF%BC%89/</id>
    <published>2024-01-21T10:35:40.000Z</published>
    <updated>2024-01-21T11:35:06.680Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Ansibleä¸€é”®éƒ¨ç½²å®ä¾‹ï¼ˆäºŒï¼‰</center></h1><table><tr><td bgcolor=#000000><font color="white">åŸºæœ¬ç¯å¢ƒå‡†å¤‡</font></td></tr></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…å¯†é’¥åˆ†å‘</span></span><br><span class="line">[root@ansible ~/roles]<span class="comment">#cat ssh.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">key=<span class="string">&quot;/root/.ssh/id_rsa.pub&quot;</span></span><br><span class="line">pass=<span class="string">&quot;å¯†ç &quot;</span></span><br><span class="line">nodeip=<span class="string">&quot;ipfile&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> ip</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    sshpass -p <span class="variable">$pass</span> ssh-copy-id -i <span class="variable">$key</span> <span class="variable">$ip</span> -o StrictHostKeyChecking=no &amp;&gt; /dev/null &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;ip&#125;</span> sshkey is success.&quot;</span></span><br><span class="line"><span class="keyword">done</span> &lt; <span class="variable">$nodeip</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ipfile</span></span><br><span class="line">[root@ansible ~/roles]<span class="comment">#cat ipfile</span></span><br><span class="line">172.16.1.5</span><br><span class="line">172.16.1.6</span><br><span class="line">172.16.1.7</span><br><span class="line">172.16.1.8</span><br><span class="line">172.16.1.9</span><br><span class="line">172.16.1.51</span><br><span class="line">172.16.1.31</span><br><span class="line">172.16.1.32</span><br><span class="line">172.16.1.41</span><br><span class="line"></span><br><span class="line"><span class="comment"># hosts</span></span><br><span class="line">[root@ansible ~/roles]<span class="comment">#cat hosts</span></span><br><span class="line">[web]</span><br><span class="line">172.16.1.7</span><br><span class="line">172.16.1.8</span><br><span class="line">172.16.1.9</span><br><span class="line">[nfs]</span><br><span class="line">172.16.1.31</span><br><span class="line">172.16.1.32</span><br><span class="line">[db]</span><br><span class="line">172.16.1.51</span><br><span class="line">[lb]</span><br><span class="line">172.16.1.5</span><br><span class="line">172.16.1.6</span><br><span class="line">[backup]</span><br><span class="line">172.16.1.41</span><br></pre></td></tr></table></figure><span id="more"></span><table><tr><td bgcolor=#000000><font color="white">å…¨å±€éƒ¨ç½²æ–‡ä»¶</font></td></tr></table><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles</span>]<span class="comment">#cat site.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">The</span> <span class="string">configuration</span> <span class="string">of</span> <span class="string">this</span> <span class="string">script</span> <span class="string">is</span> <span class="string">as</span> <span class="string">follows</span></span><br><span class="line">  <span class="attr">roles:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">basic</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">basic</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">local_repo</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">local_repo</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">rsync</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">rsync</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">nfs</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">nfs</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">(ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span><span class="string">)</span> <span class="string">or</span> <span class="string">(ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span><span class="string">)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">php</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">php</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">mysql</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">mysql</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;db&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">sersync</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">sersync</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">global_nginx</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">global_nginx</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">(ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span><span class="string">)</span> <span class="string">or</span> <span class="string">(ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span><span class="string">)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">wordpress</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">wordpress</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">kod</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">kod</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">tomcat</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">tomcat</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">zrlog</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">zrlog</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">phpadmin</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">phpadmin</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">lb_nginx</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">lb_nginx</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">keepalived</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">keepalived</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">backup</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">backup</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">https</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">https</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">(ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span><span class="string">)</span> <span class="string">or</span> <span class="string">(ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;web&quot;</span><span class="string">)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">iptables</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">iptables</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;lb&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">access_net</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">access_net</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">ntpdate</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">ntpdate</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><table><tr><td bgcolor=#000000><font color="white">åŸºç¡€ä¼˜åŒ–é¡¹</font></td></tr></table><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸ºå„é¡¹æœåŠ¡ç»Ÿä¸€ç”¨æˆ·å‡†å¤‡</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/basic</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nified</span> <span class="string">Users</span> <span class="string">create</span> <span class="string">www</span> <span class="string">group</span></span><br><span class="line">  <span class="attr">group:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">gid:</span> <span class="number">666</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">www</span> <span class="string">user</span></span><br><span class="line">  <span class="attr">user:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">uid:</span> <span class="number">666</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">create_home:</span> <span class="literal">false</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><table><tr><td bgcolor=#000000><font color="white">æœåŠ¡ç¯å¢ƒæ­å»º</font></td></tr></table><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®æœ¬åœ°YUMä»“åº“</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/local_repo</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">soft.repo</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">tasks</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span> <span class="string">directories,</span> <span class="number">2</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/local_repo</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for local_repo</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">repo</span> <span class="string">dir</span> <span class="string">for</span> <span class="string">backup</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/repo</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Mv</span> <span class="string">repo</span> <span class="string">to</span> <span class="string">backupdir</span> <span class="string">/repo</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">mv</span> <span class="string">/etc/yum.repos.d/*</span> <span class="string">/repo</span> <span class="string">warn=false</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">local</span> <span class="string">yum</span> <span class="string">repo</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">soft.repo</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/yum.repos.d</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#- name: Install yum-plugin-priorities</span></span><br><span class="line"><span class="comment">#  yum:</span></span><br><span class="line"><span class="comment">#    name: yum-plugin-priorities</span></span><br><span class="line"><span class="comment">#    state: present</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#- name: Mv repo to backupdir /repo</span></span><br><span class="line"><span class="comment">#  shell: mv /repo/* /etc/yum.repos.d warn=false</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…é…ç½®rsyncæœåŠ¡</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/rsync</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">rsyncd.conf</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">4</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/rsync</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for rsync</span></span><br><span class="line"><span class="comment"># backupä¸ºæœåŠ¡ç«¯ï¼Œå…¶ä½™å…¨éƒ¨ä¸ºå®¢æˆ·ç«¯</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">rsync</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">rsync</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">rsync</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">rsyncd.conf</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;backup&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">backup</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">    <span class="attr">owner:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">www</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/backup/lb</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/backup/web</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/backup/nfs</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/backup/msq</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;backup&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">passwd</span> <span class="string">file</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">content:</span> <span class="string">rsync_backup:nanxi</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/rsync.passwd</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="number">0600</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">rsync</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;backup&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">rsync</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">rsyncd</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;backup&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">rsync</span> <span class="string">client</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">content:</span> <span class="string">nanxi</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/rsync.pass</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="number">0600</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">not</span> <span class="string">match</span> <span class="string">&quot;backup&quot;</span></span><br><span class="line"><span class="comment"># nfs2ä¸ºæœåŠ¡ç«¯ï¼Œnfs1ä¸ºå®¢æˆ·ç«¯</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs2</span> <span class="string">configure</span> <span class="string">rsync</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">rsyncd.conf</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs2</span> <span class="string">create</span> <span class="string">backup</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/backup/nfs</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">    <span class="attr">owner:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">www</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs2</span> <span class="string">create</span> <span class="string">passwd</span> <span class="string">file</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">content:</span> <span class="string">rsync_backup:nanxi</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/rsync.passwd</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="number">0600</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">rsync</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">rsyncd</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs2</span> <span class="string">start</span> <span class="string">rsync</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">rsyncd</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…nfsæœåŠ¡</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/nfs</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">exports.j2</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">4</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/nfs</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for nfs</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">nfs</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nfs-utils</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">nfs</span> <span class="string">share</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/data/&#123;&#123;</span> <span class="string">item</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">owner:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">www</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">wordpress</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kod</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">zrlog</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">phpadmin</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">nfs</span> <span class="string">servser</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">exports.j2</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/exports</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">nfs</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">nfs</span> <span class="string">server</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">rpcbind</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">nfs-server</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs&quot;</span></span><br><span class="line">  </span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…é…ç½®PHPæœåŠ¡</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/php</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">php.tar.gz</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">4</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/php</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for php</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Extract</span> <span class="string">php.tar.gz</span> <span class="string">into</span> <span class="string">web</span> <span class="string">/tmp</span></span><br><span class="line">  <span class="attr">unarchive:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">php.tar.gz</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/tmp</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">php</span> <span class="string">into</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">yum</span> <span class="string">-y</span> <span class="string">localinstall</span> <span class="string">/tmp/*.rpm</span> <span class="string">warn=false</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">remove</span> <span class="string">php.*.rpm</span> <span class="string">in</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">rm</span> <span class="string">-rf</span> <span class="string">/tmp/*.rpm</span> <span class="string">warn=false</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">php</span> <span class="string">start</span> <span class="string">user</span> <span class="string">and</span> <span class="string">prepare</span> <span class="string">for</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/php-fpm.d/www.conf</span></span><br><span class="line">    <span class="attr">regexp:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.regex &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">line:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.line &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">php-fpm</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">regex:</span> <span class="string">&#x27;^user&#x27;</span>,<span class="attr">line:</span> <span class="string">user</span> <span class="string">=</span> <span class="string">www</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">regex:</span> <span class="string">&#x27;^group&#x27;</span>,<span class="attr">line:</span> <span class="string">group</span> <span class="string">=</span> <span class="string">www</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">regex:</span> <span class="string">&#x27;^php_value\[session.save_handler\]&#x27;</span>,<span class="attr">line:</span> <span class="string">&quot;;php_value[session.save_handler] = files&quot;</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">regex:</span> <span class="string">&#x27;^php_value\[session.save_path\]&#x27;</span>,<span class="attr">line:</span> <span class="string">&quot;;php_value[session.save_path] = /var/lib/php/session&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">php</span> <span class="string">for</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/php.ini</span></span><br><span class="line">    <span class="attr">regexp:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.regex &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">line:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.line &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">php-fpm</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">regex:</span> <span class="string">&#x27;^session\.save_handler&#x27;</span>,<span class="attr">line:</span> <span class="string">session.save_handler</span> <span class="string">=</span> <span class="string">redis</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">regex:</span> <span class="string">&#x27;^session\.save_path&#x27;</span>,<span class="attr">line:</span> <span class="string">&#x27;session.save_path = &quot;tcp://172.16.1.51:6379&quot;&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">php-fpm</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">php-fpm</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…æ•°æ®åº“ã€redisåŠä¾èµ–</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/mysql</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">3</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/mysql</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for mysql</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">mariadb</span> <span class="string">Server</span> <span class="string">redis</span> <span class="string">and</span> <span class="string">dependent</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">mariadb-server</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">MySQL-python</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">/etc/redis.conf</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/redis.conf</span></span><br><span class="line">    <span class="attr">regexp:</span> <span class="string">&#x27;^bind&#x27;</span></span><br><span class="line">    <span class="attr">line:</span> <span class="string">bind</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.51</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Start</span> <span class="string">mysql</span> <span class="string">and</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">mariadb</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸ºnfsé…ç½®sersyncæœåŠ¡</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/sersync</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â”œâ”€â”€</span> <span class="string">confxml.xml</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">sersync2</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">templates</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span> <span class="string">directories,</span> <span class="number">3</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/sersync</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for sersync</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Cteate</span> <span class="string">sersync</span> <span class="string">dir</span> <span class="string">in</span> <span class="string">nfs1</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/sersync</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Sent</span> <span class="string">sersync</span> <span class="string">to</span> <span class="string">nfs1</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/etc/sersync</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">&#x27;0755&#x27;</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">confxml.xml</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">sersync2</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Modify</span> <span class="string">backup</span> <span class="string">module</span> <span class="string">in</span> <span class="string">nfs2</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/rsyncd.conf</span></span><br><span class="line">    <span class="attr">regexp:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.regex &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">line:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.line &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">regex:</span> <span class="string">&#x27;^\[backup\]&#x27;</span>,<span class="attr">line:</span> <span class="string">&quot;[data]&quot;</span> &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">regex:</span> <span class="string">&#x27;^path&#x27;</span>,<span class="attr">line:</span> <span class="string">path</span> <span class="string">=</span> <span class="string">/data</span> &#125;</span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Restart</span> <span class="string">rsync</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">rsyncd</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Start</span> <span class="string">sersync</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">shell:</span></span><br><span class="line">    <span class="attr">cmd:</span> <span class="string">/etc/sersync/sersync2</span> <span class="string">-dro</span> <span class="string">/etc/sersync/confxml.xml</span></span><br><span class="line">  <span class="attr">ignore_errors:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">is</span> <span class="string">match</span> <span class="string">&quot;nfs1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®å®˜æ–¹nginxæœåŠ¡</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/global_nginx</span>]<span class="comment">#tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">files</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">handlers</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">tasks</span></span><br><span class="line"><span class="string">â”‚</span>Â Â  <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"><span class="string">â”œâ”€â”€</span> <span class="string">templates</span></span><br><span class="line"><span class="string">â””â”€â”€</span> <span class="string">vars</span></span><br><span class="line">    <span class="string">â””â”€â”€</span> <span class="string">main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> <span class="string">directories,</span> <span class="number">3</span> <span class="string">files</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~/roles/global_nginx</span>]<span class="comment">#cat tasks/main.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># tasks file for nginx</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">nginx</span> <span class="string">official</span> <span class="string">yum</span></span><br><span class="line">  <span class="attr">yum_repository:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx-stable</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">nginx</span> <span class="string">yum</span> <span class="string">repo</span></span><br><span class="line">    <span class="attr">baseurl:</span> <span class="string">http://nginx.org/packages/centos/$releasever/$basearch/</span></span><br><span class="line">    <span class="attr">gpgcheck:</span> <span class="literal">no</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">official</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">unified</span> <span class="string">users</span> <span class="string">by</span> <span class="string">www</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/nginx/nginx.conf</span></span><br><span class="line">    <span class="attr">regexp:</span> <span class="string">&#x27;^user&#x27;</span></span><br><span class="line">    <span class="attr">line:</span> <span class="string">user</span> <span class="string">www;</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Start</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Ansibleä¸€é”®éƒ¨ç½²å®ä¾‹ï¼ˆäºŒï¼‰&lt;/center&gt;&lt;/h1&gt;
&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#000000&gt;&lt;font color=&quot;white&quot;&gt;åŸºæœ¬ç¯å¢ƒå‡†å¤‡&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# å…å¯†é’¥åˆ†å‘&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ansible ~/roles]&lt;span class=&quot;comment&quot;&gt;#cat ssh.sh&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;key=&lt;span class=&quot;string&quot;&gt;&amp;quot;/root/.ssh/id_rsa.pub&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pass=&lt;span class=&quot;string&quot;&gt;&amp;quot;å¯†ç &amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nodeip=&lt;span class=&quot;string&quot;&gt;&amp;quot;ipfile&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;read&lt;/span&gt; ip&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sshpass -p &lt;span class=&quot;variable&quot;&gt;$pass&lt;/span&gt; ssh-copy-id -i &lt;span class=&quot;variable&quot;&gt;$key&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$ip&lt;/span&gt; -o StrictHostKeyChecking=no &amp;amp;&amp;gt; /dev/null &amp;amp;&amp;amp; &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;&lt;span class=&quot;variable&quot;&gt;$&amp;#123;ip&amp;#125;&lt;/span&gt; sshkey is success.&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;done&lt;/span&gt; &amp;lt; &lt;span class=&quot;variable&quot;&gt;$nodeip&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# ipfile&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ansible ~/roles]&lt;span class=&quot;comment&quot;&gt;#cat ipfile&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# hosts&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@ansible ~/roles]&lt;span class=&quot;comment&quot;&gt;#cat hosts&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[web]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[nfs]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[db]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[lb]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[backup]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172.16.1.41&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="æœåŠ¡æ¶æ„" scheme="https://smallflames.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Ansibleä¸€é”®éƒ¨ç½²å®ä¾‹ï¼ˆä¸€ï¼‰</title>
    <link href="https://smallflames.github.io/2024/01/21/Ansible%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E5%AE%9E%E4%BE%8B%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>https://smallflames.github.io/2024/01/21/Ansible%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E5%AE%9E%E4%BE%8B%EF%BC%88%E4%B8%80%EF%BC%89/</id>
    <published>2024-01-21T09:25:32.000Z</published>
    <updated>2024-01-21T15:04:35.484Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Ansibleä¸€é”®éƒ¨ç½²å®ä¾‹ï¼ˆä¸€ï¼‰</center></h1><p>â€ƒâ€ƒæˆ‘ä»¬ä»Šå¤©è¦ç”¨Ansibleå®ç°ä¸€é”®éƒ¨ç½²çš„æ¡†æ¶å¤§è‡´å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240121173432410.png" alt="image-20240121173432410"></p><p>â€ƒâ€ƒå—æ±åœ¨è¿™é‡Œå¯¹æœ¬æ¬¡æ¡†æ¶åšä¸€ä¸ªç®€å•çš„ä»‹ç»ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„æ¶æ„ï¼Œè™½ç„¶å¯èƒ½ä¸å¦‚å®é™…åº”ç”¨ä¸­çš„å¤æ‚ï¼Œä½†æ˜¯éº»é›€è™½å°ï¼Œäº¦äº”è„ä¿±å…¨ã€‚ä»ç”¨æˆ·è§’åº¦æ¥çœ‹ï¼Œå½“æˆ‘ä»¬çš„ç”¨æˆ·è®¿é—®æˆ‘ä»¬å…¬å¸çš„ç½‘ç«™æ—¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¼šç»ç”±DNSæ™ºèƒ½è°ƒåº¦ç³»ç»Ÿç»™ç”¨æˆ·è¿”å›è·ç¦»ç”¨æˆ·åœ°åŸŸè·ç¦»æœ€è¿‘çš„æœåŠ¡å™¨åœ°å€ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„CDNæœåŠ¡å™¨ï¼Œå®ƒä¼šé»˜è®¤å­˜å‚¨æˆ‘ä»¬webæœåŠ¡ä¸ŠåŸºæœ¬æ‰€æœ‰çš„é™æ€èµ„æºï¼ˆæˆ–åŠ¨æ€å†…å®¹ã€æµåª’ä½“æ–‡ä»¶ï¼‰ä»¥æé«˜ç”¨æˆ·çš„è®¿é—®ä½“éªŒï¼Œå¦‚æœCDNä¸Šæ²¡æœ‰ç”¨æˆ·æ‰€è¯·æ±‚çš„èµ„æºï¼Œæ­¤æ—¶ä¼šå‡ºç°å›æºã€‚<span id="more"></span>å½“æˆ‘ä»¬çš„ç”¨æˆ·ç›´æ¥è®¿é—®æºç«™çš„æ—¶å€™ï¼Œä¼šç»ç”±æˆ‘ä»¬å‰ç«¯çš„ç½‘ç»œé˜²ç«å¢™è¿‡æ»¤éæ³•æµé‡ï¼Œç„¶ä¼šåˆ°è¾¾æˆ‘ä»¬çš„è´Ÿè½½ï¼Œæœ¬æ¬¡æ¶æ„ä¸­æˆ‘ä»¬ä½¿ç”¨ä¸¤å°æœåŠ¡å™¨åº”ç”¨NGINXä½œä¸ºè´Ÿè½½å‡è¡¡ï¼Œå¹¶åœ¨ä¸¤å°æœåŠ¡å™¨ä¹‹é—´é€šè¿‡keepalivedå®ç°é«˜å¯ç”¨ã€‚è¯·æ±‚ç»ç”±è´Ÿè½½å‡è¡¡çš„è°ƒåº¦ç®—æ³•åè½¬å‘è‡³æˆ‘ä»¬çœŸå®çš„webæœåŠ¡å™¨ï¼Œè¿™é‡ŒwebæœåŠ¡å™¨åœ¨å®é™…ä¸­åŸºæœ¬éƒ½æ˜¯å¤šèŠ‚ç‚¹çš„ï¼Œæˆ‘ä»¬ç§°ä¹‹é›†ç¾¤ï¼Œå—æ±è¿™é‡Œä½¿ç”¨ä¸‰å°æœåŠ¡å™¨æ¥è¿›è¡Œæ¨¡æ‹Ÿã€‚webç«¯çš„é™æ€æ–‡ä»¶ç”±åç«¯çš„ä¸¤å°NFSæœåŠ¡å™¨å­˜å‚¨ï¼Œä»–ä»¬ä¹‹é—´çš„æ•°æ®å®æ—¶åŒæ­¥çš„ï¼Œå¹¶ä¸”å…·å¤‡é«˜å¯ç”¨ï¼Œä»¥é¿å…å•ç‚¹æ•…éšœï¼ŒåŒæ—¶å‰ç«¯æ‰€äº§ç”Ÿçš„ä¸šåŠ¡æ•°æ®æ•°æ®åº“æ–‡ä»¶éƒ½ä¼šå­˜æ”¾åœ¨åç«¯çš„æ•°æ®åº“ã€‚æœ€åä¸ä¸šåŠ¡ç›´æ¥ç›¸å…³çš„æœåŠ¡å™¨ï¼ˆæœ¬æ­¤æ¶æ„ä¸­æœ‰8å°ï¼‰å‡ä¼šå®šæ—¶å°†é‡è¦æ–‡ä»¶å¤‡ä»½è‡³backupæœåŠ¡å™¨ã€‚ä»è¿ç»´ç®¡ç†äººå‘˜çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬ä¼šç»ç”±VPNè¿›å…¥å…¬å¸çš„jumpserveræœåŠ¡å™¨ï¼ˆç›´æ¥è¶Šè¿‡ç”¨æˆ·è·¯å¾„çš„é˜²ç«å¢™è¿›å…¥å†…éƒ¨ï¼‰ï¼Œåº•å±‚é€šè¿‡Ansibleè‡ªåŠ¨åŒ–ç®¡ç†å·¥å…·æ¥å¯¹å…¬å¸çš„æœåŠ¡å™¨è¿›è¡Œç®¡ç†ï¼Œç›‘æ§å’Œç»´æŠ¤ã€‚ä¸ºäº†æé«˜è„šæœ¬å®‰è£…æœåŠ¡çš„æ‰§è¡Œæ•ˆç‡ï¼Œæˆ‘ä»¬é¢å¤–æ­å»ºäº†ä¸€ä¸ªæœ¬åœ°ä»“åº“ä¸ºæä¾›å†…éƒ¨å±€åŸŸç½‘å®‰è£…æœåŠ¡ä½¿ç”¨ã€‚</p><p>â€ƒâ€ƒï¼ˆå—æ±å¹¶æ²¡æœ‰å®ç°æ¶æ„å†…çš„æ‰€æœ‰åŠŸèƒ½ï¼Œæœ¬æ¬¡å±•ç¤ºåªä¸ºå¸®åŠ©å¤§å®¶æé«˜å¯¹Ansibleè‡ªåŠ¨åŒ–ç®¡ç†å·¥å…·çš„åº”ç”¨ï¼‰è¯¦ç»†Playbookè§’è‰²åˆ†å¸ƒå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240121182411299.png" alt="image-20240121182411299"></p><p>â€ƒâ€ƒæ¥ä¸‹æ¥å—æ±ä¼šç”¨å‡ ç¯‡æ–‡ç« ä¾æ¬¡å¼€æ”¾æºç å±•ç¤ºï¼Œå¤§å®¶ä»…ä¾›å‚è€ƒï¼Œå¯è‡ªè¡Œå®è·µç»ƒä¹ â€¦â€¦</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Ansibleä¸€é”®éƒ¨ç½²å®ä¾‹ï¼ˆä¸€ï¼‰&lt;/center&gt;&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒæˆ‘ä»¬ä»Šå¤©è¦ç”¨Ansibleå®ç°ä¸€é”®éƒ¨ç½²çš„æ¡†æ¶å¤§è‡´å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240121173432410.png&quot; alt=&quot;image-20240121173432410&quot;&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒå—æ±åœ¨è¿™é‡Œå¯¹æœ¬æ¬¡æ¡†æ¶åšä¸€ä¸ªç®€å•çš„ä»‹ç»ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„æ¶æ„ï¼Œè™½ç„¶å¯èƒ½ä¸å¦‚å®é™…åº”ç”¨ä¸­çš„å¤æ‚ï¼Œä½†æ˜¯éº»é›€è™½å°ï¼Œäº¦äº”è„ä¿±å…¨ã€‚ä»ç”¨æˆ·è§’åº¦æ¥çœ‹ï¼Œå½“æˆ‘ä»¬çš„ç”¨æˆ·è®¿é—®æˆ‘ä»¬å…¬å¸çš„ç½‘ç«™æ—¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¼šç»ç”±DNSæ™ºèƒ½è°ƒåº¦ç³»ç»Ÿç»™ç”¨æˆ·è¿”å›è·ç¦»ç”¨æˆ·åœ°åŸŸè·ç¦»æœ€è¿‘çš„æœåŠ¡å™¨åœ°å€ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„CDNæœåŠ¡å™¨ï¼Œå®ƒä¼šé»˜è®¤å­˜å‚¨æˆ‘ä»¬webæœåŠ¡ä¸ŠåŸºæœ¬æ‰€æœ‰çš„é™æ€èµ„æºï¼ˆæˆ–åŠ¨æ€å†…å®¹ã€æµåª’ä½“æ–‡ä»¶ï¼‰ä»¥æé«˜ç”¨æˆ·çš„è®¿é—®ä½“éªŒï¼Œå¦‚æœCDNä¸Šæ²¡æœ‰ç”¨æˆ·æ‰€è¯·æ±‚çš„èµ„æºï¼Œæ­¤æ—¶ä¼šå‡ºç°å›æºã€‚</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="æœåŠ¡æ¶æ„" scheme="https://smallflames.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Ansible Jinja2æ¨¡æ¿</title>
    <link href="https://smallflames.github.io/2024/01/04/Jinja2%E6%A8%A1%E6%9D%BF/"/>
    <id>https://smallflames.github.io/2024/01/04/Jinja2%E6%A8%A1%E6%9D%BF/</id>
    <published>2024-01-04T12:49:49.000Z</published>
    <updated>2024-01-04T13:22:34.674Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Ansible Jinja2æ¨¡æ¿</center></h1><p>â€ƒâ€ƒå¦‚æœæˆ‘ä»¬çš„éœ€æ±‚æ˜¯åœ¨100å°ä¸»æœºä¸Šå®‰è£…nginxï¼Œæ¯å°nginxçš„ç«¯å£éƒ½ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬å¦‚ä½•è§£å†³å‘¢ï¼Ÿå¾ˆæ£˜æ‰‹çš„é—®é¢˜ï¼Œä½†æ˜¯jinja2å¯ä»¥ï¼ŒAnsibleé€šå¸¸ä¼šä½¿ç”¨jinja2æ¨¡æ¿æ¥ä¿®æ”¹è¢«ç®¡ç†ä¸»æœºçš„é…ç½®æ–‡ä»¶ï¼Œå°¤å…¶åœ¨æ‰¹é‡ä¿®æ”¹å¤šå°ä¸»æœºçš„é…ç½®æ–‡ä»¶æ—¶ï¼Œå¾ˆä¾¿æ·ã€‚Jinja2æ–‡ä»¶åç¼€é€šå¸¸ä¸º.j2ï¼Œæ˜¯ä¸€ä¸ªé‡Œé¢åŒ…å«å˜é‡çš„æ¨¡æ¿æ–‡ä»¶ï¼Œä½¿ç”¨templateæ¨¡å—è°ƒç”¨ã€‚<font color="gray"><em>ï¼ˆtemplateæ¨¡å—å’Œcopyæ¨¡å—ä¸€æ ·ï¼Œéƒ½æ˜¯å°†æ–‡ä»¶å¤åˆ¶åˆ°è¿œç«¯ä¸»æœºä¸Šå»ï¼ŒåŒºåˆ«åœ¨äºtemplateæ¨¡å—å¯ä»¥è·å–åˆ°æ–‡ä»¶ä¸­çš„å˜é‡ï¼Œè€Œcopyåˆ™æ˜¯åŸå°ä¸åŠ¨çš„æŠŠæ–‡ä»¶å†…å®¹å¤åˆ¶è¿‡å»ï¼‰</em></font></p><span id="more"></span><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible ~]#cat keepalived.j2</span><br><span class="line">global_defs &#123;</span><br><span class="line">    router_id &#123;&#123; ansible_fqdn &#125;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">&#123;% if ansible_fqdn == &quot;web01&quot; %&#125;</span><br><span class="line">    state MASTER</span><br><span class="line">    priority 150</span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    state BACKUP</span><br><span class="line">    priority 100</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 50</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;         </span><br><span class="line">        1.1.1.1</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104211506521.png" alt="image-20240104211506521"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104211849054.png" alt="image-20240104211849054"></p><blockquote><p>Ansibleå…è®¸jinja2æ¨¡æ¿ä¸­ä½¿ç”¨æ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯ï¼Œä½†æ˜¯ä¸å…è®¸åœ¨playbookä¸­ä½¿ç”¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¾ªç¯è¡¨è¾¾å¼</span></span><br><span class="line">&#123;% <span class="keyword">for</span> i <span class="keyword">in</span> EXPR %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¡ä»¶åˆ¤æ–­</span></span><br><span class="line">&#123;% <span class="keyword">if</span> EXPR %&#125;</span><br><span class="line">&#123;% <span class="keyword">elif</span> EXPR %&#125;</span><br><span class="line">&#123;% <span class="keyword">else</span> %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨é‡Š</span></span><br><span class="line">&#123;<span class="comment"># COMMENT #&#125;</span></span><br></pre></td></tr></table></figure></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Ansible Jinja2æ¨¡æ¿&lt;/center&gt;&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒå¦‚æœæˆ‘ä»¬çš„éœ€æ±‚æ˜¯åœ¨100å°ä¸»æœºä¸Šå®‰è£…nginxï¼Œæ¯å°nginxçš„ç«¯å£éƒ½ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬å¦‚ä½•è§£å†³å‘¢ï¼Ÿå¾ˆæ£˜æ‰‹çš„é—®é¢˜ï¼Œä½†æ˜¯jinja2å¯ä»¥ï¼ŒAnsibleé€šå¸¸ä¼šä½¿ç”¨jinja2æ¨¡æ¿æ¥ä¿®æ”¹è¢«ç®¡ç†ä¸»æœºçš„é…ç½®æ–‡ä»¶ï¼Œå°¤å…¶åœ¨æ‰¹é‡ä¿®æ”¹å¤šå°ä¸»æœºçš„é…ç½®æ–‡ä»¶æ—¶ï¼Œå¾ˆä¾¿æ·ã€‚Jinja2æ–‡ä»¶åç¼€é€šå¸¸ä¸º.j2ï¼Œæ˜¯ä¸€ä¸ªé‡Œé¢åŒ…å«å˜é‡çš„æ¨¡æ¿æ–‡ä»¶ï¼Œä½¿ç”¨templateæ¨¡å—è°ƒç”¨ã€‚&lt;font color=&quot;gray&quot;&gt;&lt;em&gt;ï¼ˆtemplateæ¨¡å—å’Œcopyæ¨¡å—ä¸€æ ·ï¼Œéƒ½æ˜¯å°†æ–‡ä»¶å¤åˆ¶åˆ°è¿œç«¯ä¸»æœºä¸Šå»ï¼ŒåŒºåˆ«åœ¨äºtemplateæ¨¡å—å¯ä»¥è·å–åˆ°æ–‡ä»¶ä¸­çš„å˜é‡ï¼Œè€Œcopyåˆ™æ˜¯åŸå°ä¸åŠ¨çš„æŠŠæ–‡ä»¶å†…å®¹å¤åˆ¶è¿‡å»ï¼‰&lt;/em&gt;&lt;/font&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="æœåŠ¡æ¶æ„" scheme="https://smallflames.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Ansibleæµç¨‹æ§åˆ¶</title>
    <link href="https://smallflames.github.io/2024/01/04/Ansible%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/"/>
    <id>https://smallflames.github.io/2024/01/04/Ansible%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/</id>
    <published>2024-01-04T10:42:51.000Z</published>
    <updated>2024-01-04T12:37:44.110Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1><center>Ansibleæµç¨‹æ§åˆ¶</center></h1><p>â€ƒâ€ƒä¸ç®¡æ˜¯shellè¿˜æ˜¯å„å¤§ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæµç¨‹æ§åˆ¶ã€æ¡ä»¶åˆ¤æ–­ã€å¾ªç¯è¿™äº›éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨Ansibleçš„è¿‡ç¨‹ä¸­ï¼Œæ¡ä»¶åˆ¤æ–­çš„ä½¿ç”¨é¢‘ç‡åŒæ ·æå…¶çš„é«˜ï¼Œæ˜¯æˆ‘ä»¬å¿…é¡»æŒæ¡çš„æŠ€èƒ½ã€‚</p><h2 id="ä¸€ã€whenåˆ¤æ–­">ä¸€ã€whenåˆ¤æ–­</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webs</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span>  <span class="string">when</span> <span class="string">ceshi</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">htop</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">tree</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">==</span> <span class="string">&quot;web01&quot;</span>   <span class="comment">### å½“ä¸»æœºåä¸ºweb01æ—¶æ‰§è¡Œæœ¬æ¡ä»»åŠ¡</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104191250989.png" alt="image-20240104191250989"></p><span id="more"></span><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">whenåˆ¤æ–­è¯­æ³•:</span><br><span class="line">when: ansible_hostname == <span class="string">&quot;web01&quot;</span>        <span class="comment"># å®Œå…¨åŒ¹é…</span></span><br><span class="line">when: ansible_hostname != <span class="string">&quot;web01&quot;</span>     <span class="comment"># å–å,å½“ä¸»æœºåä¸ä¸ºweb01æ—¶ä½¿ç”¨</span></span><br><span class="line">when: ansible_hostname is not match <span class="string">&quot;web01&quot;</span> <span class="comment"># åŒä¸Š</span></span><br><span class="line">when: ansible_hostname is match <span class="string">&quot;web&quot;</span>    <span class="comment"># åŒ¹é…ä¸»æœºååŒ…å«webçš„å®¢æˆ·ç«¯</span></span><br><span class="line">when: ansible_hostname is search <span class="string">&quot;web&quot;</span>   <span class="comment"># æœç´¢ä¸»æœºååŒ…å«webçš„å®¢æˆ·ç«¯</span></span><br><span class="line"> </span><br><span class="line">when: ansible_default_ipv4.address is  match <span class="string">&quot;10.0.0.7&quot;</span>  <span class="comment"># åŒ¹é…IPåœ°å€</span></span><br><span class="line">when: (ansible_default_ipv4.address is  match <span class="string">&quot;10.0.0.7&quot;</span>) or (ansible_hostname == <span class="string">&quot;web02&quot;</span>)      <span class="comment"># æˆ–è€…</span></span><br><span class="line">(ansible_default_ipv4.address is  match <span class="string">&quot;10.0.0.7&quot;</span>) and (ansible_hostname == <span class="string">&quot;web02&quot;</span>) <span class="comment"># å¹¶ä¸”</span></span><br><span class="line">when:  <span class="comment"># å¹¶ä¸”å…³ç³»</span></span><br><span class="line">  - ansible_default_ipv4.address is  match <span class="string">&quot;10.0.0.7&quot;</span> </span><br><span class="line">  - ansible_hostname == <span class="string">&quot;web02&quot;</span></span><br><span class="line">when: ansible_facts.distribution_major_version &gt; <span class="string">&quot;6&quot;</span>  <span class="comment"># ä½¿ç”¨æ•°å­—è¿›è¡Œåˆ¤æ–­æ¯”è¾ƒ</span></span><br></pre></td></tr></table></figure><p>æ¡ˆä¾‹. æ ¹æ®nginxçš„è¿”å›ç»“æœæ¥åˆ¤æ–­æ˜¯å¦é‡å¯nginx</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webs</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">install</span> <span class="string">web</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span> <span class="string">offical</span> <span class="string">yum</span></span><br><span class="line">      <span class="attr">yum_repository:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">nginx</span> <span class="string">stable</span> <span class="string">repo</span></span><br><span class="line">        <span class="attr">gpgcheck:</span> <span class="literal">no</span></span><br><span class="line">        <span class="attr">baseurl:</span> <span class="string">http://nginx.org/packages/centos/$releasever/$basearch/</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configer</span> <span class="string">nginx.conf</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./nginx.conf</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/nginx/nginx.conf</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">check</span> <span class="string">nginx</span> <span class="string">syntax</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">nginx</span> <span class="string">-t</span></span><br><span class="line">      <span class="attr">register:</span> <span class="string">result</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">      <span class="attr">when:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">result</span> <span class="string">is</span> <span class="string">search</span> <span class="string">&quot;ok&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">ansible_hostname</span> <span class="string">==</span> <span class="string">&quot;web01&quot;</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104192956127.png" alt="image-20240104192956127"></p><h2 id="äºŒã€å­—å…¸å¾ªç¯">äºŒã€å­—å…¸å¾ªç¯</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### æ³¨æ„ï¼šitemæ˜¯å›ºå®šçš„å˜é‡åç§°ï¼Œä¸èƒ½è‡ªå®šä¹‰</span></span><br><span class="line"><span class="comment">### æœ‰äº†itemå˜é‡ï¼Œæˆ‘ä»¬å°±å¯ä»¥å­—å…¸å¾ªç¯ä¸€æ¬¡å®‰è£…å¤šä¸ªæœåŠ¡,æœ‰å¾ˆé«˜çš„å¯æ‹“å±•æ€§</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webs</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span>  <span class="string">loop</span> <span class="string">ceshi</span></span><br><span class="line">      <span class="attr">file:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.name &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.owner &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.group &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.mode &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">touch</span></span><br><span class="line">      <span class="attr">loop:</span></span><br><span class="line">        <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="number">1.</span><span class="string">txt</span>,<span class="attr">owner:</span> <span class="string">root</span>,<span class="attr">group:</span> <span class="string">root</span>,<span class="attr">mode:</span> <span class="string">&#x27;0666&#x27;</span> &#125;</span><br><span class="line">        <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="number">2.</span><span class="string">txt</span>,<span class="attr">owner:</span> <span class="string">www</span>,<span class="attr">group:</span> <span class="string">www</span>,<span class="attr">mode:</span> <span class="string">&#x27;0600&#x27;</span> &#125;</span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">==</span> <span class="string">&quot;web01&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104194111250.png" alt="image-20240104194111250"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@web01 ~]<span class="comment">#ll</span></span><br><span class="line">total 0</span><br><span class="line">-rw-rw-rw- 1 root root 0 Jan  4 19:40 1.txt</span><br><span class="line">-rw------- 1 www  www  0 Jan  4 19:40 2.txt</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€handlersäº‹ä»¶è§¦å‘æ¨¡å—">ä¸‰ã€handlersäº‹ä»¶è§¦å‘æ¨¡å—</h2><p><strong>åŒæ ·ä»¥å®‰è£…nginxä¸ºä¾‹ï¼Œæ ¹æ®é…ç½®æ–‡ä»¶æ˜¯å¦ä¿®æ”¹æ¥è§¦å‘æ˜¯å¦é‡å¯nginx</strong></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104200922643.png" alt="image-20240104200922643"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104200156161.png" alt="image-20240104200156161"></p><p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104200053928.png" alt="image-20240104200053928"></p><div class="warning"><p><strong>handlersæ¨¡å—ä½¿ç”¨æ³¨æ„äº‹é¡¹</strong></p><ol><li class="lvl-3">æ— è®ºå¤šå°‘ä¸ªtaské€šçŸ¥äº†ç›¸åŒçš„handlersï¼Œhandlersä»…ä¼šåœ¨æ‰€æœ‰tasksç»“æŸåè¿è¡Œä¸€æ¬¡ï¼›</li><li class="lvl-3">handlersåªæœ‰åœ¨å…¶æ‰€åœ¨çš„ä»»åŠ¡è¢«æ‰§è¡Œæ—¶ï¼Œæ‰ä¼šè¢«è¿è¡Œï¼›</li><li class="lvl-3">handlersåªä¼šåœ¨æ¯ä¸€ä¸ªplayçš„æœ«å°¾è¿è¡Œä¸€æ¬¡ï¼Œæƒ³åœ¨ä¸€ä¸ªplaybookä¸­é—´è¿è¡Œhandlersï¼Œåˆ™éœ€è¦ä½¿ç”¨metaæ¨¡å—æ¥å®ç°ï¼Œå¦‚ï¼š <code>-meta: flush_handlers</code> ï¼›</li><li class="lvl-3">ä¸èƒ½ä½¿ç”¨handlersæ›¿ä»£tasksï¼Œhandlerså’Œtasksæ˜¯åŒçº§çš„ï¼Œåœ¨handlersä¸‹å†™çš„ä»»åŠ¡åªç”¨è¢«è°ƒç”¨æ‰èƒ½è¿è¡Œ</li></ol></div><h2 id="å››ã€playbookæ–‡ä»¶å¤ç”¨">å››ã€playbookæ–‡ä»¶å¤ç”¨</h2><blockquote><p>ä¸€ä¸ªyamlæ–‡ä»¶æ‰§è¡Œï¼ˆå¼•ç”¨ï¼‰å¤šä¸ªpalybook</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@ansible</span> <span class="string">~</span>]<span class="comment"># cat site.yml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webs</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">include_tasks:</span> <span class="string">install_nginx.yml</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">==</span> <span class="string">&quot;web01&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">include_tasks:</span> <span class="string">install_nfs.yml</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_hostname</span> <span class="string">==</span> <span class="string">&quot;web02&quot;</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~</span>]<span class="comment"># cat install_nginx.yml </span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">Nginx</span> <span class="string">Server</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">[<span class="string">root@ansible</span> <span class="string">~</span>]<span class="comment"># cat install_nfs.yml </span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">nfs</span> <span class="string">Server</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nfs-utils</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br></pre></td></tr></table></figure></blockquote><div class='spoiler collapsed'>    <div class='spoiler-title'>        Playbookä»»åŠ¡æ ‡ç­¾    </div>    <div class='spoiler-content'>        <p><img src="https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104203741222.png" alt="image-20240104203741222"></p>    </div></div><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;h1&gt;&lt;center&gt;Ansibleæµç¨‹æ§åˆ¶&lt;/center&gt;&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒä¸ç®¡æ˜¯shellè¿˜æ˜¯å„å¤§ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæµç¨‹æ§åˆ¶ã€æ¡ä»¶åˆ¤æ–­ã€å¾ªç¯è¿™äº›éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨Ansibleçš„è¿‡ç¨‹ä¸­ï¼Œæ¡ä»¶åˆ¤æ–­çš„ä½¿ç”¨é¢‘ç‡åŒæ ·æå…¶çš„é«˜ï¼Œæ˜¯æˆ‘ä»¬å¿…é¡»æŒæ¡çš„æŠ€èƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä¸€ã€whenåˆ¤æ–­&quot;&gt;ä¸€ã€whenåˆ¤æ–­&lt;/h2&gt;
&lt;figure class=&quot;highlight yaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;hosts:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;webs&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;tasks:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt;  &lt;span class=&quot;string&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ceshi&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;yum:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;htop&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;tree&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;state:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;present&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;when:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;ansible_hostname&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;web01&amp;quot;&lt;/span&gt;   &lt;span class=&quot;comment&quot;&gt;### å½“ä¸»æœºåä¸ºweb01æ—¶æ‰§è¡Œæœ¬æ¡ä»»åŠ¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/XZ6606/image-bed/raw/master/img/image-20240104191250989.png&quot; alt=&quot;image-20240104191250989&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="è¿ç»´ä¹‹è·¯" scheme="https://smallflames.github.io/tags/%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/"/>
    
    <category term="æœåŠ¡æ¶æ„" scheme="https://smallflames.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
</feed>
